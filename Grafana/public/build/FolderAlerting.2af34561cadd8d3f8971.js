"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4333],{30027:(y,C,a)=>{a.r(C),a.d(C,{BrowseFolderAlertingPage:()=>Y,default:()=>X});var s=a(74848),c=a(96540),o=a(69444),r=a(71101),f=a(31678),t=a(32196),h=a(2543),l=a(40996),B=a(40845),i=a(67061),x=a(67647),b=a(90182),M=a(14578),d=a(10860),A=a(64149),j=a(19384),u=a(15054),T=a(21969),I=a(9518),L=a(98439),g=a(39964),_=a(23770),K=a(98164),W=a(57220),p=a(32642),z=a(56361),V=(e=>(e.Ascending="alpha-asc",e.Descending="alpha-desc",e))(V||{});const G=[{label:"Alphabetically [A-Z]",value:"alpha-asc"},{label:"Alphabetically [Z-A]",value:"alpha-desc"}],S=({folder:e})=>{const m=(0,B.of)(J),n=(0,f.useDispatch)(),E=D=>{const k=(0,K.EU)(P,D);U(k)};(0,c.useEffect)(()=>{n((0,_.mB)({rulesSourceName:W.hY})),n((0,_.eB)({rulesSourceName:W.hY}))},[n]);const O=(0,I.dy)(W.hY),{nameFilter:F,labelFilter:P,sortOrder:v,setNameFilter:R,setLabelFilter:U,setSortOrder:w}=H(),q=O.find(D=>D.uid===e.uid)?.groups.flatMap(D=>D.rules)??[],aa=$(q,F,P,v??"alpha-asc"),sa=q.length===0||aa.length===0,{page:ea,numberOfPages:ta,onPageChange:na,pageItems:oa}=(0,L.W)(aa,1,u.FG);return(0,s.jsx)("div",{className:m.container,children:(0,s.jsxs)(i.B,{direction:"column",gap:3,children:[(0,s.jsx)(x.Z,{value:F,onChange:R,placeholder:"Search alert rules by name","data-testid":"name-filter"}),(0,s.jsxs)(i.B,{direction:"row",children:[(0,s.jsx)(b.l6,{value:v,onChange:({value:D})=>D&&w(D),options:G,width:25,"aria-label":"Sort",placeholder:"Sort (Default A-Z)",prefix:(0,s.jsx)(M.I,{name:v==="alpha-asc"?"sort-amount-up":"sort-amount-down"})}),(0,s.jsx)(x.Z,{value:P,onChange:U,placeholder:"Search alerts by labels",className:m.filterLabelsInput,"data-testid":"label-filter"})]}),(0,s.jsx)(i.B,{direction:"column",gap:1,children:oa.map(D=>(0,s.jsxs)(d.Z,{href:(0,z.w$)("grafana",D,""),className:m.card,"data-testid":"alert-card-row",children:[(0,s.jsx)(d.Z.Heading,{children:D.name}),(0,s.jsx)(d.Z.Tags,{children:(0,s.jsx)(A.L,{onClick:E,tags:Object.entries(D.labels).map(([k,ra])=>`${k}=${ra}`)})}),(0,s.jsx)(d.Z.Meta,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(M.I,{name:"folder"})," ",e.title]})})]},D.name))}),sa&&(0,s.jsx)("div",{className:m.noResults,children:"No alert rules found"}),(0,s.jsx)("div",{className:m.pagination,children:(0,s.jsx)(j.d,{currentPage:ea,numberOfPages:ta,onNavigate:na,hideWhenSinglePage:!0})})]})})};var N=(e=>(e.nameFilter="nameFilter",e.labelFilter="labelFilter",e.sortOrder="sort",e))(N||{});function H(){const[e,m]=(0,g.l)(),[n,E]=(0,c.useState)(e.get("nameFilter")??""),[O,F]=(0,c.useState)(e.get("labelFilter")??""),P=e.get("sort"),[v,R]=(0,c.useState)(P==="alpha-asc"?"alpha-asc":P==="alpha-desc"?"alpha-desc":void 0);return(0,l.A)(()=>m({nameFilter:(0,T.fE)(n),labelFilter:(0,T.fE)(O),sort:(0,T.fE)(v)},!0),400,[n,O,v]),{nameFilter:n,labelFilter:O,sortOrder:v,setNameFilter:E,setLabelFilter:F,setSortOrder:R}}function $(e,m,n,E){const O=(0,p.Zc)(n);let F=e.filter(P=>P.name.toLowerCase().includes(m.toLowerCase())&&(0,K.Av)(P.labels,O));return(0,h.orderBy)(F,P=>P.name.toLowerCase(),[E==="alpha-asc"?"asc":"desc"])}const J=e=>({container:(0,t.css)({padding:e.spacing(1)}),card:(0,t.css)({gridTemplateColumns:"auto 1fr 2fr",margin:0}),pagination:(0,t.css)({alignSelf:"center"}),filterLabelsInput:(0,t.css)({flex:1,width:"auto",minWidth:"240px"}),noResults:(0,t.css)({padding:e.spacing(2),backgroundColor:e.colors.background.secondary,fontStyle:"italic"})});var Z=a(55314),Q=a(9134);function Y({match:e}){const{uid:m}=e.params,{data:n}=(0,Z.kH)(m),E=(0,f.useSelector)(v=>v.folder),[O]=(0,Z.iB)(),F=(0,c.useMemo)(()=>{if(!n)return;const v=(0,r.R4)(n),R=(0,r.Fk)(n.uid),U=v.children?.find(w=>w.id===R);return U&&(U.active=!0),v},[n]),P=m?async v=>{if(n){const R=await O({...n,title:v});if("error"in R)throw R.error}}:void 0;return(0,s.jsx)(o.Y,{navId:"dashboards/browse",pageNav:F,onEditTitle:P,actions:(0,s.jsx)(s.Fragment,{children:n&&(0,s.jsx)(Q.m,{folder:n})}),children:(0,s.jsx)(o.Y.Contents,{children:(0,s.jsx)(S,{folder:E})})})}const X=Y},18241:(y,C,a)=>{a.d(C,{T:()=>x});var s=a(74848),c=a(96540),o=a(32264),r=a(96374),f=a(94753),t=a(68402),h=a(42418),l=a(8484),B=a(55314),i=a(43907);const x=({onConfirm:b,onDismiss:M,selectedItems:d,...A})=>{const{data:j}=(0,B.G2)(d),u=!!(j&&(j.alertRule||j.libraryPanel)),[T,I]=(0,c.useState)(!1),L=async()=>{I(!0);try{await b(),I(!1),M()}catch{I(!1)}};return(0,s.jsx)(r.u,{body:(0,s.jsxs)(s.Fragment,{children:[o.$.featureToggles.dashboardRestore&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.E,{element:"p",children:(0,s.jsx)(l.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,s.jsx)(t.$,{v:2})]}),(0,s.jsx)(f.E,{element:"p",children:(0,s.jsx)(l.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,s.jsx)(i.x,{selectedItems:d}),(0,s.jsx)(t.$,{v:2})]}),description:(0,s.jsx)(s.Fragment,{children:u?(0,s.jsx)(h.F,{severity:"warning",title:(0,l.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,s.jsx)(l.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,l.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:T?(0,l.t)("browse-dashboards.action.deleting","Deleting..."):(0,l.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:M,onConfirm:L,title:(0,l.t)("browse-dashboards.action.delete-modal-title","Delete"),...A,disabled:u})}},51887:(y,C,a)=>{a.d(C,{J:()=>b});var s=a(74848),c=a(96540),o=a(37390),r=a(42418),f=a(94753),t=a(68402),h=a(88575),l=a(55852),B=a(36607),i=a(8484),x=a(43907);const b=({onConfirm:M,onDismiss:d,selectedItems:A,...j})=>{const[u,T]=(0,c.useState)(),[I,L]=(0,c.useState)(!1),g=Object.keys(A.folder).filter(K=>A.folder[K]),_=async()=>{if(u!==void 0){L(!0);try{await M(u),L(!1),d()}catch{L(!1)}}};return(0,s.jsxs)(o.a,{title:(0,i.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:d,...j,children:[g.length>0&&(0,s.jsx)(r.F,{severity:"info",title:(0,i.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,s.jsx)(f.E,{element:"p",children:(0,s.jsx)(i.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,s.jsx)(x.x,{selectedItems:A}),(0,s.jsx)(t.$,{v:3}),(0,s.jsx)(h.D,{label:(0,i.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,s.jsx)(B.d,{value:u,excludeUIDs:g,onChange:T})}),(0,s.jsxs)(o.a.ButtonRow,{children:[(0,s.jsx)(l.$n,{onClick:d,variant:"secondary",fill:"outline",children:(0,s.jsx)(i.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,s.jsx)(l.$n,{disabled:u===void 0||I,onClick:_,variant:"primary",children:I?(0,i.t)("browse-dashboards.action.moving","Moving..."):(0,i.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(y,C,a)=>{a.d(C,{m:()=>L});var s=a(74848),c=a(96540),o=a(32264),r=a(14110),f=a(12131),t=a(38138),h=a(64539),l=a(83122),B=a(55852),i=a(14578),x=a(87978),b=a(5108),M=a(10096),d=a(8484),A=a(28444),j=a(55314),u=a(49904),T=a(18241),I=a(51887);function L({folder:g}){const[_,K]=(0,c.useState)(!1),[W,p]=(0,c.useState)(!1),[z]=(0,j.aF)(),[V]=(0,j.Ko)(),{canEditFolders:G,canDeleteFolders:S,canViewPermissions:N,canSetPermissions:H}=(0,u.N)(g),$=o.$.featureToggles.nestedFolders&&G,J=async E=>{await z({folder:g,destinationUID:E}),(0,r.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},Z=async()=>{await V(g),(0,r.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:E}=g,O=E&&E.length?E[E.length-1].url:"/dashboards";f.Ny.push(O)},Q=()=>{M.lE.publish(new A.S8({component:I.J,props:{selectedItems:{folder:{[g.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:J}}))},Y=()=>{M.lE.publish(new A.S8({component:T.T,props:{selectedItems:{folder:{[g.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Z}}))},X=(0,d.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),e=(0,d.t)("browse-dashboards.folder-actions-button.move","Move"),m=(0,d.t)("browse-dashboards.folder-actions-button.delete","Delete"),n=(0,s.jsxs)(t.W,{children:[N&&(0,s.jsx)(h.D,{onClick:()=>p(!0),label:X}),$&&(0,s.jsx)(h.D,{onClick:Q,label:e}),S&&(0,s.jsx)(h.D,{destructive:!0,onClick:Y,label:m})]});return!N&&!$&&!S?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.m,{overlay:n,onVisibleChange:K,children:(0,s.jsxs)(B.$n,{variant:"secondary",children:[(0,s.jsx)(d.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,s.jsx)(i.I,{name:_?"angle-up":"angle-down"})]})}),W&&(0,s.jsx)(x._,{title:(0,d.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:g.title,onClose:()=>p(!1),size:"md",children:(0,s.jsx)(b.x,{resource:"folders",resourceId:g.uid,canSetPermissions:H})})]})}},49904:(y,C,a)=>{a.d(C,{N:()=>f});var s=a(32264),c=a(10096),o=a(31678);function r(t,h){return h?c.TP.hasPermissionInMetadata(t,h):c.TP.hasPermission(t)}function f(t){const h=r(o.AccessControlAction.DashboardsCreate,t),l=!!((!t||s.$.featureToggles.nestedFolders)&&r(o.AccessControlAction.FoldersCreate)),B=r(o.AccessControlAction.FoldersDelete,t),i=r(o.AccessControlAction.DashboardsWrite,t),x=r(o.AccessControlAction.FoldersWrite,t),b=r(o.AccessControlAction.FoldersPermissionsWrite,t),M=r(o.AccessControlAction.FoldersPermissionsRead,t);return{canCreateDashboards:h,canCreateFolders:l,canDeleteFolders:B,canEditDashboards:i,canEditFolders:x,canSetPermissions:b,canViewPermissions:M}}}}]);

//# sourceMappingURL=FolderAlerting.2af34561cadd8d3f8971.js.map