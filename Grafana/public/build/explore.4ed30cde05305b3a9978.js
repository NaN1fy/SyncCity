"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9604],{2864:(Hs,Ze,h)=>{h.d(Ze,{h:()=>p,j:()=>U});var t=h(91890),f=h(8484);function p(N){switch(N){case t.CC.Logfmt:return{label:(0,f.t)("correlations.trans-details.logfmt-label","Logfmt"),value:t.CC.Logfmt,description:(0,f.t)("correlations.trans-details.logfmt-description","Parse provided field with logfmt to get variables"),expressionDetails:{show:!1},mapValueDetails:{show:!1}};case t.CC.Regex:return{label:(0,f.t)("correlations.trans-details.regex-label","Regular expression"),value:t.CC.Regex,description:(0,f.t)("correlations.trans-details.regex-description","Field will be parsed with regex. Use named capture groups to return multiple variables, or a single unnamed capture group to add variable to named map value. Regex is case insensitive."),expressionDetails:{show:!0,required:!0,helpText:(0,f.t)("correlations.trans-details.regex-expression","Use capture groups to extract a portion of the field.")},mapValueDetails:{show:!0,required:!1,helpText:(0,f.t)("correlations.trans-details.regex-map-values","Defines the name of the variable if the capture group is not named.")}};default:return{label:N,value:N,expressionDetails:{show:!1},mapValueDetails:{show:!1}}}}const U=()=>Object.values(t.CC).map(N=>{const se=p(N);return{label:se.label,value:se.value,description:se.description}})},47902:(Hs,Ze,h)=>{h.r(Ze),h.d(Ze,{default:()=>Cc});var t=h(74848),f=h(32196),p=h(96540),U=h(32264),N=h(40845),se=h(66602),es=h(58720),St=h(76888),$s=h(25249),j=h(8484),D=h(31678),xo=h(24180),Ct=h(2739),vo=function(e,s){e===void 0&&(e=!0);var n=(0,p.useCallback)(function(o){var r=typeof e=="function"?e():!0;if(r)return o.preventDefault(),s&&(o.returnValue=s),s},[e,s]);(0,p.useEffect)(function(){if(e)return(0,Ct.on)(window,"beforeunload",n),function(){return(0,Ct.AU)(window,"beforeunload",n)}},[e,n])};const Bs=vo;var ts=h(64305),ss=h(23596),z=h(14110),Ye=h(67061),be=h(56034),fe=h(14578),V=h(55852),Je=h(37390);const bo=({onSave:e,onDiscard:s,onCancel:n,message:o})=>(0,t.jsxs)(Je.a,{isOpen:!0,title:"Unsaved changes to correlation",onDismiss:n,icon:"exclamation-triangle",className:(0,f.css)({width:"600px"}),children:[(0,t.jsx)("h5",{children:o}),(0,t.jsxs)(Je.a.ButtonRow,{children:[(0,t.jsx)(V.$n,{variant:"secondary",onClick:n,fill:"outline",children:"Cancel"}),(0,t.jsx)(V.$n,{variant:"destructive",onClick:s,children:"Continue without saving"}),(0,t.jsx)(V.$n,{variant:"primary",onClick:e,children:"Save correlation"})]})]});var ne=h(2543),So=(e=>(e.SOURCE_TARGET_CHANGE="cause the query in the right pane to be re-ran and links added to that data",e.FULL_QUERY_LOSS="lose the changed query",e.FULL_CORR_LOSS="cause the correlation in progress to be lost",e.INVALID_VAR="remove the variables, and your changed query may no longer be valid",e))(So||{});const Co=(e,s,n,o)=>{const r=(0,ne.template)("<%= actionStr %> will <%= consequenceStr %>. Would you like to save before continuing?");let i="",a="";if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE)if(i="Closing the pane",s)if(n)a="cause the correlation in progress to be lost";else if(o)a="cause the query in the right pane to be re-ran and links added to that data";else return;else if(n)a="cause the correlation in progress to be lost";else if(o)a="lose the changed query";else return;else if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE)if(i="Changing the datasource",s)if(n)a="cause the correlation in progress to be lost";else return;else if(o)a="lose the changed query";else return;else if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR)if(i="Closing the editor",n)a="cause the correlation in progress to be lost";else if(o)a="remove the variables, and your changed query may no longer be valid";else return;return r({actionStr:i,consequenceStr:a})};var jo=h(324),Be=h(62860),Fe=h(62256),Y=h(29436),K=h(23994),J=h(9955);const wo=({panes:e})=>{const s=(0,D.useDispatch)(),n=(0,N.of)(Ro),o=(0,D.useSelector)(J.vC),r=(0,D.useSelector)(J.st),[i,a]=(0,p.useState)(void 0);Bs(o?.correlationDirty||!1,"Save correlation?"),Bs(!o?.correlationDirty&&o?.queryEditorDirty||!1,"The query editor was changed. Save correlation before continuing?"),(0,p.useEffect)(()=>{if(o?.isExiting){const{correlationDirty:u,queryEditorDirty:x}=o;let m,C;o.postConfirmAction?(m=o.postConfirmAction.isActionLeft,C=o.postConfirmAction.action):(C=D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR,m=!1);const y=Co(C,m,u,x);if(y!==void 0)a(y);else if(C===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&o.postConfirmAction){const{exploreId:b,changeDatasourceUid:S}=o?.postConfirmAction;b&&S&&(s((0,Be.wh)({exploreId:b,datasource:S,options:{importQueries:!0}})),s((0,Y.am)({isExiting:!1})))}else if(C===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE&&o.postConfirmAction){const{exploreId:b}=o?.postConfirmAction;b!==void 0&&(s((0,Y.J8)(b)),s((0,Y.am)({isExiting:!1})))}else C===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR&&s((0,Y.am)({editorMode:!1}))}},[o,s,r]),(0,ts.A)(()=>{s((0,Y.am)({editorMode:!1,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(u=>{s((0,Fe.nE)({exploreId:u[0],correlationEditorHelperData:void 0})),s((0,K.Od)({exploreId:u[0]}))})});const l=()=>{s((0,Y.am)({editorMode:!0,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(u=>{s((0,Fe.nE)({exploreId:u[0],correlationEditorHelperData:void 0})),s((0,K.Od)({exploreId:u[0]}))})},d=u=>{a(void 0),s((0,Y.J8)(u)),(0,z.rR)("grafana_explore_split_view_closed")},g=(u,x)=>{a(void 0),s((0,Be.wh)({exploreId:u,datasource:x,options:{importQueries:!0}}))},c=u=>{if(s((0,jo.v)(o?.label,o?.description,o?.transformations)),!u&&o?.postConfirmAction!==void 0){const{exploreId:x,action:m,changeDatasourceUid:C}=o?.postConfirmAction;m===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?(d(x),l()):m===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&C!==void 0&&((0,Be.wh)({exploreId:x,datasource:C}),l())}else s((0,Y.am)({editorMode:!1,correlationDirty:!1,isExiting:!1}))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(xo.XG,{message:u=>u.pathname!=="/explore"&&o?.editorMode&&o?.correlationDirty?"You have unsaved correlation data. Continue?":!0}),i!==void 0&&(0,t.jsx)(bo,{onDiscard:()=>{if(o?.postConfirmAction!==void 0){const{exploreId:u,action:x,changeDatasourceUid:m}=o?.postConfirmAction;x===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?d(u):x===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&m!==void 0&&g(u,m),s((0,Y.am)({isExiting:!1}))}else s((0,Y.am)({editorMode:!1,correlationDirty:!1,isExiting:!1}))},onCancel:()=>{s((0,Y.am)({isExiting:!1})),a(void 0)},onSave:()=>{c(!1)},message:i}),(0,t.jsx)("div",{className:n.correlationEditorTop,children:(0,t.jsxs)(Ye.B,{gap:2,justifyContent:"flex-end",alignItems:"center",children:[(0,t.jsx)(be.m,{content:"Correlations editor in Explore is an experimental feature.",children:(0,t.jsx)(fe.I,{className:n.iconColor,name:"info-circle",size:"xl"})}),(0,t.jsx)(V.$n,{variant:"secondary",disabled:!o?.canSave,fill:"outline",className:o?.canSave?n.buttonColor:n.disabledButtonColor,onClick:()=>{c(!0)},children:"Save"}),(0,t.jsx)(V.$n,{variant:"secondary",fill:"outline",className:n.buttonColor,icon:"times",onClick:()=>{s((0,Y.am)({isExiting:!0})),(0,z.rR)("grafana_explore_correlation_editor_exit_pressed")},children:"Exit correlation editor"})]})})]})},Ro=e=>{const s=e.colors.getContrastText(e.colors.primary.main),n=ss.MV.lighten(e.colors.primary.main,.1),o=ss.MV.darken(e.colors.primary.main,.2),r=ss.MV.darken(s,.2);return{correlationEditorTop:(0,f.css)({backgroundColor:e.colors.primary.main,marginTop:"3px",padding:e.spacing(1)}),iconColor:(0,f.css)({color:s}),buttonColor:(0,f.css)({color:s,borderColor:s,"&:hover":{color:s,borderColor:s,backgroundColor:n}}),disabledButtonColor:(0,f.css)({color:`${r} !important`,backgroundColor:`${o} !important`})}};var ns=h(1503),jt=h(16233),wt=h(14678);const To=()=>{const[e,s]=(0,p.useState)([]),{query:n}=(0,ns.useKBar)(),o=(0,D.useDispatch)(),r=(0,D.useSelector)(J.Qb),i=(0,D.useSelector)(J.pF),a=jt.TP.hasPermission(D.AccessControlAction.DataSourcesWrite);return(0,p.useEffect)(()=>{const l=Object.keys(r),d={name:"Explore",priority:ns.Priority.HIGH+1},g=[];if(i)g.push({id:"explore/run-query-left",name:"Run query (left)",keywords:"query left",perform:()=>{o((0,K.Od)({exploreId:l[0]}))},section:d}),r[1],g.push({id:"explore/run-query-right",name:"Run query (right)",keywords:"query right",perform:()=>{o((0,K.Od)({exploreId:l[1]}))},section:d}),g.push({id:"explore/split-view-close-left",name:"Close split view left",keywords:"split",perform:()=>{o((0,Y.J8)(l[0]))},section:d}),g.push({id:"explore/split-view-close-right",name:"Close split view right",keywords:"split",perform:()=>{o((0,Y.J8)(l[1]))},section:d});else{const c=Object.values(r).some(u=>u?.datasourceInstance?.uid===wt.uv);U.$.featureToggles.correlations&&a&&!c&&g.push({id:"explore/correlations-editor",name:"Correlations editor",perform:()=>{o((0,Y.am)({editorMode:!0})),o((0,K.Od)({exploreId:l[0]}))},section:d}),g.push({id:"explore/run-query",name:"Run query",keywords:"query",perform:()=>{o((0,K.Od)({exploreId:l[0]}))},section:d}),g.push({id:"explore/split-view-open",name:"Open split view",keywords:"split",perform:()=>{o((0,Y.ve)())},section:d})}s(g)},[r,i,n,o,a]),(0,ns.useRegisterActions)(n?e:[],[e,n]),null};var Lo=h(40961),Io=function(){var e=function(s,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,r){o.__proto__=r}||function(o,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(o[i]=r[i])},e(s,n)};return function(s,n){e(s,n);function o(){this.constructor=s}s.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}}(),te=function(){return te=Object.assign||function(e){for(var s,n=1,o=arguments.length;n<o;n++){s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},te.apply(this,arguments)},Qs={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},Ws={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},Rt={width:"20px",height:"20px",position:"absolute"},Eo={top:te(te({},Qs),{top:"-5px"}),right:te(te({},Ws),{left:void 0,right:"-5px"}),bottom:te(te({},Qs),{top:void 0,bottom:"-5px"}),left:te(te({},Ws),{left:"-5px"}),topRight:te(te({},Rt),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:te(te({},Rt),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:te(te({},Rt),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:te(te({},Rt),{left:"-10px",top:"-10px",cursor:"nw-resize"})},Oo=function(e){Io(s,e);function s(){var n=e!==null&&e.apply(this,arguments)||this;return n.onMouseDown=function(o){n.props.onResizeStart(o,n.props.direction)},n.onTouchStart=function(o){n.props.onResizeStart(o,n.props.direction)},n}return s.prototype.render=function(){return p.createElement("div",{className:this.props.className||"",style:te(te({position:"absolute",userSelect:"none"},Eo[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},s}(p.PureComponent),Fo=function(){var e=function(s,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,r){o.__proto__=r}||function(o,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(o[i]=r[i])},e(s,n)};return function(s,n){e(s,n);function o(){this.constructor=s}s.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}}(),we=function(){return we=Object.assign||function(e){for(var s,n=1,o=arguments.length;n<o;n++){s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},we.apply(this,arguments)},Do={width:"auto",height:"auto"},Tt=function(e,s,n){return Math.max(Math.min(e,n),s)},Vs=function(e,s){return Math.round(e/s)*s},Xe=function(e,s){return new RegExp(e,"i").test(s)},Lt=function(e){return!!(e.touches&&e.touches.length)},Ao=function(e){return!!((e.clientX||e.clientX===0)&&(e.clientY||e.clientY===0))},Us=function(e,s,n){n===void 0&&(n=0);var o=s.reduce(function(i,a,l){return Math.abs(a-e)<Math.abs(s[i]-e)?l:i},0),r=Math.abs(s[o]-e);return n===0||r<n?s[o]:e},os=function(e){return e=e.toString(),e==="auto"||e.endsWith("px")||e.endsWith("%")||e.endsWith("vh")||e.endsWith("vw")||e.endsWith("vmax")||e.endsWith("vmin")?e:e+"px"},It=function(e,s,n,o){if(e&&typeof e=="string"){if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("%")){var r=Number(e.replace("%",""))/100;return s*r}if(e.endsWith("vw")){var r=Number(e.replace("vw",""))/100;return n*r}if(e.endsWith("vh")){var r=Number(e.replace("vh",""))/100;return o*r}}return e},No=function(e,s,n,o,r,i,a){return o=It(o,e.width,s,n),r=It(r,e.height,s,n),i=It(i,e.width,s,n),a=It(a,e.height,s,n),{maxWidth:typeof o>"u"?void 0:Number(o),maxHeight:typeof r>"u"?void 0:Number(r),minWidth:typeof i>"u"?void 0:Number(i),minHeight:typeof a>"u"?void 0:Number(a)}},Po=function(e){return Array.isArray(e)?e:[e,e]},ko=["as","ref","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],qs="__resizable_base__",Gs=function(e){Fo(s,e);function s(n){var o,r,i,a,l=e.call(this,n)||this;return l.ratio=1,l.resizable=null,l.parentLeft=0,l.parentTop=0,l.resizableLeft=0,l.resizableRight=0,l.resizableTop=0,l.resizableBottom=0,l.targetLeft=0,l.targetTop=0,l.appendBase=function(){if(!l.resizable||!l.window)return null;var d=l.parentNode;if(!d)return null;var g=l.window.document.createElement("div");return g.style.width="100%",g.style.height="100%",g.style.position="absolute",g.style.transform="scale(0, 0)",g.style.left="0",g.style.flex="0 0 100%",g.classList?g.classList.add(qs):g.className+=qs,d.appendChild(g),g},l.removeBase=function(d){var g=l.parentNode;g&&g.removeChild(d)},l.state={isResizing:!1,width:(r=(o=l.propsSize)===null||o===void 0?void 0:o.width)!==null&&r!==void 0?r:"auto",height:(a=(i=l.propsSize)===null||i===void 0?void 0:i.height)!==null&&a!==void 0?a:"auto",direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},l.onResizeStart=l.onResizeStart.bind(l),l.onMouseMove=l.onMouseMove.bind(l),l.onMouseUp=l.onMouseUp.bind(l),l}return Object.defineProperty(s.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||Do},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"size",{get:function(){var n=0,o=0;if(this.resizable&&this.window){var r=this.resizable.offsetWidth,i=this.resizable.offsetHeight,a=this.resizable.style.position;a!=="relative"&&(this.resizable.style.position="relative"),n=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:r,o=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:i,this.resizable.style.position=a}return{width:n,height:o}},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"sizeStyle",{get:function(){var n=this,o=this.props.size,r=function(l){var d;if(typeof n.state[l]>"u"||n.state[l]==="auto")return"auto";if(n.propsSize&&n.propsSize[l]&&(!((d=n.propsSize[l])===null||d===void 0)&&d.toString().endsWith("%"))){if(n.state[l].toString().endsWith("%"))return n.state[l].toString();var g=n.getParentSize(),c=Number(n.state[l].toString().replace("px","")),u=c/g[l]*100;return u+"%"}return os(n.state[l])},i=o&&typeof o.width<"u"&&!this.state.isResizing?os(o.width):r("width"),a=o&&typeof o.height<"u"&&!this.state.isResizing?os(o.height):r("height");return{width:i,height:a}},enumerable:!1,configurable:!0}),s.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var n=this.appendBase();if(!n)return{width:0,height:0};var o=!1,r=this.parentNode.style.flexWrap;r!=="wrap"&&(o=!0,this.parentNode.style.flexWrap="wrap"),n.style.position="relative",n.style.minWidth="100%",n.style.minHeight="100%";var i={width:n.offsetWidth,height:n.offsetHeight};return o&&(this.parentNode.style.flexWrap=r),this.removeBase(n),i},s.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},s.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},s.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var n=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:n.flexBasis!=="auto"?n.flexBasis:void 0})}},s.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},s.prototype.createSizeForCssProperty=function(n,o){var r=this.propsSize&&this.propsSize[o];return this.state[o]==="auto"&&this.state.original[o]===n&&(typeof r>"u"||r==="auto")?"auto":n},s.prototype.calculateNewMaxFromBoundary=function(n,o){var r=this.props.boundsByDirection,i=this.state.direction,a=r&&Xe("left",i),l=r&&Xe("top",i),d,g;if(this.props.bounds==="parent"){var c=this.parentNode;c&&(d=a?this.resizableRight-this.parentLeft:c.offsetWidth+(this.parentLeft-this.resizableLeft),g=l?this.resizableBottom-this.parentTop:c.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(d=a?this.resizableRight:this.window.innerWidth-this.resizableLeft,g=l?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(d=a?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),g=l?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return d&&Number.isFinite(d)&&(n=n&&n<d?n:d),g&&Number.isFinite(g)&&(o=o&&o<g?o:g),{maxWidth:n,maxHeight:o}},s.prototype.calculateNewSizeFromDirection=function(n,o){var r=this.props.scale||1,i=Po(this.props.resizeRatio||1),a=i[0],l=i[1],d=this.state,g=d.direction,c=d.original,u=this.props,x=u.lockAspectRatio,m=u.lockAspectRatioExtraHeight,C=u.lockAspectRatioExtraWidth,y=c.width,b=c.height,S=m||0,L=C||0;return Xe("right",g)&&(y=c.width+(n-c.x)*a/r,x&&(b=(y-L)/this.ratio+S)),Xe("left",g)&&(y=c.width-(n-c.x)*a/r,x&&(b=(y-L)/this.ratio+S)),Xe("bottom",g)&&(b=c.height+(o-c.y)*l/r,x&&(y=(b-S)*this.ratio+L)),Xe("top",g)&&(b=c.height-(o-c.y)*l/r,x&&(y=(b-S)*this.ratio+L)),{newWidth:y,newHeight:b}},s.prototype.calculateNewSizeFromAspectRatio=function(n,o,r,i){var a=this.props,l=a.lockAspectRatio,d=a.lockAspectRatioExtraHeight,g=a.lockAspectRatioExtraWidth,c=typeof i.width>"u"?10:i.width,u=typeof r.width>"u"||r.width<0?n:r.width,x=typeof i.height>"u"?10:i.height,m=typeof r.height>"u"||r.height<0?o:r.height,C=d||0,y=g||0;if(l){var b=(x-C)*this.ratio+y,S=(m-C)*this.ratio+y,L=(c-y)/this.ratio+C,T=(u-y)/this.ratio+C,v=Math.max(c,b),w=Math.min(u,S),R=Math.max(x,L),A=Math.min(m,T);n=Tt(n,v,w),o=Tt(o,R,A)}else n=Tt(n,c,u),o=Tt(o,x,m);return{newWidth:n,newHeight:o}},s.prototype.setBoundingClientRect=function(){if(this.props.bounds==="parent"){var n=this.parentNode;if(n){var o=n.getBoundingClientRect();this.parentLeft=o.left,this.parentTop=o.top}}if(this.props.bounds&&typeof this.props.bounds!="string"){var r=this.props.bounds.getBoundingClientRect();this.targetLeft=r.left,this.targetTop=r.top}if(this.resizable){var i=this.resizable.getBoundingClientRect(),a=i.left,l=i.top,d=i.right,g=i.bottom;this.resizableLeft=a,this.resizableRight=d,this.resizableTop=l,this.resizableBottom=g}},s.prototype.onResizeStart=function(n,o){if(!(!this.resizable||!this.window)){var r=0,i=0;if(n.nativeEvent&&Ao(n.nativeEvent)?(r=n.nativeEvent.clientX,i=n.nativeEvent.clientY):n.nativeEvent&&Lt(n.nativeEvent)&&(r=n.nativeEvent.touches[0].clientX,i=n.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var a=this.props.onResizeStart(n,o,this.resizable);if(a===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var l,d=this.window.getComputedStyle(this.resizable);if(d.flexBasis!=="auto"){var g=this.parentNode;if(g){var c=this.window.getComputedStyle(g).flexDirection;this.flexDir=c.startsWith("row")?"row":"column",l=d.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var u={original:{x:r,y:i,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:we(we({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(n.target).cursor||"auto"}),direction:o,flexBasis:l};this.setState(u)}},s.prototype.onMouseMove=function(n){var o=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&Lt(n))try{n.preventDefault(),n.stopPropagation()}catch{}var r=this.props,i=r.maxWidth,a=r.maxHeight,l=r.minWidth,d=r.minHeight,g=Lt(n)?n.touches[0].clientX:n.clientX,c=Lt(n)?n.touches[0].clientY:n.clientY,u=this.state,x=u.direction,m=u.original,C=u.width,y=u.height,b=this.getParentSize(),S=No(b,this.window.innerWidth,this.window.innerHeight,i,a,l,d);i=S.maxWidth,a=S.maxHeight,l=S.minWidth,d=S.minHeight;var L=this.calculateNewSizeFromDirection(g,c),T=L.newHeight,v=L.newWidth,w=this.calculateNewMaxFromBoundary(i,a);this.props.snap&&this.props.snap.x&&(v=Us(v,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(T=Us(T,this.props.snap.y,this.props.snapGap));var R=this.calculateNewSizeFromAspectRatio(v,T,{width:w.maxWidth,height:w.maxHeight},{width:l,height:d});if(v=R.newWidth,T=R.newHeight,this.props.grid){var A=Vs(v,this.props.grid[0]),P=Vs(T,this.props.grid[1]),k=this.props.snapGap||0,W=k===0||Math.abs(A-v)<=k?A:v,O=k===0||Math.abs(P-T)<=k?P:T;v=W,T=O}var B={width:v-m.width,height:T-m.height};if(C&&typeof C=="string"){if(C.endsWith("%")){var ie=v/b.width*100;v=ie+"%"}else if(C.endsWith("vw")){var oe=v/this.window.innerWidth*100;v=oe+"vw"}else if(C.endsWith("vh")){var ue=v/this.window.innerHeight*100;v=ue+"vh"}}if(y&&typeof y=="string"){if(y.endsWith("%")){var ie=T/b.height*100;T=ie+"%"}else if(y.endsWith("vw")){var oe=T/this.window.innerWidth*100;T=oe+"vw"}else if(y.endsWith("vh")){var ue=T/this.window.innerHeight*100;T=ue+"vh"}}var E={width:this.createSizeForCssProperty(v,"width"),height:this.createSizeForCssProperty(T,"height")};this.flexDir==="row"?E.flexBasis=E.width:this.flexDir==="column"&&(E.flexBasis=E.height);var M=this.state.width!==E.width,H=this.state.height!==E.height,F=this.state.flexBasis!==E.flexBasis,q=M||H||F;q&&(0,Lo.flushSync)(function(){o.setState(E)}),this.props.onResize&&q&&this.props.onResize(n,x,this.resizable,B)}},s.prototype.onMouseUp=function(n){var o,r,i=this.state,a=i.isResizing,l=i.direction,d=i.original;if(!(!a||!this.resizable)){var g={width:this.size.width-d.width,height:this.size.height-d.height};this.props.onResizeStop&&this.props.onResizeStop(n,l,this.resizable,g),this.props.size&&this.setState({width:(o=this.props.size.width)!==null&&o!==void 0?o:"auto",height:(r=this.props.size.height)!==null&&r!==void 0?r:"auto"}),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:we(we({},this.state.backgroundStyle),{cursor:"auto"})})}},s.prototype.updateSize=function(n){var o,r;this.setState({width:(o=n.width)!==null&&o!==void 0?o:"auto",height:(r=n.height)!==null&&r!==void 0?r:"auto"})},s.prototype.renderResizer=function(){var n=this,o=this.props,r=o.enable,i=o.handleStyles,a=o.handleClasses,l=o.handleWrapperStyle,d=o.handleWrapperClass,g=o.handleComponent;if(!r)return null;var c=Object.keys(r).map(function(u){return r[u]!==!1?p.createElement(Oo,{key:u,direction:u,onResizeStart:n.onResizeStart,replaceStyles:i&&i[u],className:a&&a[u]},g&&g[u]?g[u]:null):null});return p.createElement("div",{className:d,style:l},c)},s.prototype.render=function(){var n=this,o=Object.keys(this.props).reduce(function(a,l){return ko.indexOf(l)!==-1||(a[l]=n.props[l]),a},{}),r=we(we(we({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(r.flexBasis=this.state.flexBasis);var i=this.props.as||"div";return p.createElement(i,we({style:r,className:this.props.className},o,{ref:function(a){a&&(n.resizable=a)}}),this.state.isResizing&&p.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},s.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},s}(p.PureComponent),Mo=h(69144);function Ks(e){const{children:s,onResize:n,initialHeight:o}=e,r=(0,N.$j)(),i=(0,N.of)(Ho),a=(0,Mo.l)(r),l=o||`${r.components.horizontalDrawer.defaultHeight}px`;return(0,t.jsx)(Gs,{className:(0,f.cx)(i.fixed,i.container,i.drawerActive),defaultSize:{width:"100%",height:l},handleClasses:{top:a.dragHandleHorizontal},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",onResize:n,children:s})}const zo=e=>(0,f.keyframes)`
  0% {
    transform: translateY(${e.components.horizontalDrawer.defaultHeight}px);
  }

  100% {
    transform: translateY(0px);
  }
`,Ho=e=>({fixed:(0,f.css)({position:"absolute !important"}),container:(0,f.css)({bottom:0,background:e.colors.background.primary,borderTop:`1px solid ${e.colors.border.weak}`,boxShadow:e.shadows.z3,zIndex:e.zIndex.navbarFixed}),drawerActive:(0,f.css)({opacity:1,[e.transitions.handleMotion("no-preference")]:{animation:`0.5s ease-out ${zo(e)}`}})});var Se=h(71468),$o=h(18226),Zs=h(1933),nt=h(13544),Et=h(40276),ot=h(87490),Bo=h(70713),Ot=h(68941),_=h(9557),me=h(39070),Pe=h(19347),rs=h(52494),Ft=h(88407),rt=h(11401),Dt=h(32901),Ys=h(42941),Qo=h(23535),Wo=function(e){var s=(0,Qo.A)({x:0,y:0}),n=s[0],o=s[1];return(0,p.useEffect)(function(){var r=function(){e.current&&o({x:e.current.scrollLeft,y:e.current.scrollTop})};return e.current&&(0,Ct.on)(e.current,"scroll",r,{capture:!1,passive:!0}),function(){e.current&&(0,Ct.AU)(e.current,"scroll",r)}},[e]),n};const Vo=Wo,Js=(0,p.createContext)(void 0);function Uo({children:e,refreshDependencies:s}){const[n,o]=(0,p.useState)([]),r=(0,p.useRef)({}),i=(0,p.useCallback)(c=>{const u=c.id?c.id:(0,ne.uniqueId)(`${c.panelId}-${c.title}-${c.icon}_`);return o(x=>{if(c.level==="root"){const m=r.current[c.panelId]||[];return m.length>0&&r.current[c.panelId].forEach(y=>{y.type==="filter"&&(y.ref=c.ref)}),r.current[c.panelId]=[],[...x,{...c,id:u,children:m}].sort(Xs)}if(c.level==="child"){let m=!1;if(Object.keys(r.current).forEach(v=>{if(r.current[v].find(R=>R.title===c.title&&c.type==="filter"&&c.panelId===R.panelId)){m=!0;return}}),m)return[...x];const C=x.findIndex(v=>v.panelId===c.panelId&&v.level==="root");if(C===-1)return Object.keys(r.current).find(w=>w===c.panelId)?r.current[c.panelId].push({...c,id:u}):r.current[c.panelId]=[{...c,id:u}],[...x];const y=[...x],b={...y[C]},S=b.children?.find(v=>v.title===c.title&&c.type==="filter"&&c.panelId===v.panelId);if(S&&S.highlight!==c.highlight)return b.children?.map(v=>{v.title===S?.title&&(v.highlight=c.highlight)}),[...x];if(S)return[...x];let L=c.ref;c.type==="filter"&&(L=b.ref);let T=[{...c,id:u,ref:L},...b.children||[]];return c.childOnTop||(T=_s(T)),y[C]={...b,children:T},y}return[...x]}),u},[]),a=(0,p.useCallback)(c=>{o(u=>u.filter(x=>x.id!==c).map(x=>(x.children&&(x.children=x.children.filter(m=>m.id!==c)),x)))},[]),l=(0,p.useCallback)(c=>{o(c)},[]),d=(0,p.useCallback)((c,u)=>{o(x=>x.map(m=>m.id===c?{...m,...u}:m))},[]),g=(0,p.useCallback)((c,u)=>{o(x=>{const m=c(x);return m?x.map(C=>(C.id===m&&(C.children=C.children?.filter(y=>y.type!==u)),C)):x})},[]);return(0,p.useEffect)(()=>{o(c=>{const u=[...c];for(const x of u){const m=_s(x.children||[]);x.children=m}return u})},[s]),(0,t.jsx)(Js.Provider,{value:{outlineItems:n,register:i,unregister:a,updateOutlineItems:l,unregisterAllChildren:g,updateItem:d},children:e})}function Xs(e,s){if(e.ref&&s.ref){const n=e.ref.compareDocumentPosition(s.ref);if(n===Node.DOCUMENT_POSITION_PRECEDING)return 1;if(n===Node.DOCUMENT_POSITION_FOLLOWING)return-1}return 0}function _s(e){const[s,n]=e.reduce((o,r)=>(r.childOnTop?o[0].push(r):o[1].push(r),o),[[],[]]);return n.sort(Xs),[...s,...n]}function is(){return(0,p.useContext)(Js)}var qo=h(8887);function as({contentOutlineExpanded:e,title:s,icon:n,tooltip:o,tooltipPlacement:r="bottom",className:i,indentStyle:a,collapsible:l,collapsed:d,isActive:g,extraHighlight:c,sectionId:u,toggleCollapsed:x,color:m,onRemove:C,...y}){const b=(0,N.$j)(),S=Go(b,m),L=(0,f.cx)(S.button,i),T=(0,p.useRef)(null),[v,w]=(0,p.useState)(!1);(0,p.useEffect)(()=>{T.current&&w(T.current?.scrollWidth>T.current?.clientWidth)},[s]);const R=(0,t.jsxs)("div",{className:(0,f.cx)(S.buttonContainer,a),children:[l&&(0,t.jsx)("button",{className:S.collapseButton,onClick:x,"aria-label":"Content outline item collapse button","aria-expanded":!d,"aria-controls":u,children:(0,t.jsx)(en,{icon:d?"angle-right":"angle-down"})}),(0,t.jsxs)("button",{className:(0,f.cx)(L,{[S.active]:g,[S.extraHighlight]:c}),"aria-label":o,...y,children:[(0,t.jsx)(en,{icon:n}),s&&(0,t.jsx)("span",{className:S.textContainer,ref:T,children:s})]}),C&&(0,t.jsx)(V.$n,{variant:"destructive",className:S.deleteButton,icon:"times",onClick:()=>C(),"data-testid":"content-outline-item-delete-button"})]});return o&&(!e||v)?(0,t.jsx)(be.m,{content:o,placement:r,children:R}):R}function en({icon:e}){return e?(0,qo.n6)(e)?(0,t.jsx)(fe.I,{name:e,size:"lg",title:e}):e:null}const Go=(e,s)=>({buttonContainer:(0,f.css)({position:"relative",display:"flex",alignItems:"center",flexGrow:1,gap:e.spacing(.25),width:"100%",overflow:"hidden"}),button:(0,f.css)({label:"content-outline-item-button",display:"flex",alignItems:"center",height:e.spacing(e.components.height.md),gap:e.spacing(.5),color:e.colors.text.secondary,width:"100%",background:"transparent",overflow:"hidden",border:"none"}),collapseButton:(0,f.css)({display:"flex",alignItems:"center",justifyContent:"center",width:e.spacing(3),height:e.spacing(4),borderRadius:e.shape.radius.default,color:e.colors.text.secondary,background:"transparent",border:"none",overflow:"hidden","&:hover":{color:e.colors.text.primary,background:e.colors.secondary.shade}}),textContainer:(0,f.css)({whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:e.typography.bodySmall.fontSize,marginLeft:e.spacing(.5)}),active:(0,f.css)({backgroundColor:e.colors.background.secondary,borderTopRightRadius:e.shape.radius.default,borderBottomRightRadius:e.shape.radius.default,position:"relative",height:e.spacing(e.components.height.md),"&::before":{backgroundImage:s!==void 0?"none":e.colors.gradients.brandVertical,backgroundColor:s!==void 0?s:"none",borderRadius:e.shape.radius.default,content:'" "',display:"block",height:"100%",position:"absolute",transform:"translateX(-50%)",width:e.spacing(.5),left:"2px"}}),extraHighlight:(0,f.css)({backgroundColor:e.colors.background.secondary,borderTopRightRadius:e.shape.radius.default,borderBottomRightRadius:e.shape.radius.default,position:"relative","&::before":{backgroundImage:s!==void 0?"none":e.colors.gradients.brandVertical,backgroundColor:s!==void 0?s:"none",borderRadius:e.shape.radius.default,content:'" "',display:"block",height:"100%",position:"absolute",transform:"translateX(-50%)",width:e.spacing(.5),left:"2px"}}),deleteButton:(0,f.css)({width:e.spacing(1),height:e.spacing(1),padding:e.spacing(.75,.75),marginRight:e.spacing(.5)})});function tn(e){return e.children?.filter(s=>s.type!=="filter")||[]}function sn(e,s,n,o){const r=s===e.id,i=n===e.id,a=!o[e.id],l=tn(e).length>0,d=Pt(e,n)&&!o[e.id];return l?a&&(r||d):r||i}const At={visible:"grafana.explore.contentOutline.visible",expanded:"grafana.explore.contentOutline.expanded"};function Ko({scroller:e,panelId:s}){const[n,o]=(0,Ys.A)(Ot.M.getBool(At.expanded,!0)),r=(0,N.of)(Zo,n),i=(0,p.useRef)(e||null),{y:a}=Vo(i),{outlineItems:l}=is()??{outlineItems:[]},[d,g]=(0,p.useState)(l[0]?.id),[c,u]=(0,p.useState)(l[0]?.children?.[0]?.id),x=l.some(v=>v.children&&!(v.mergeSingleChild&&v.children?.length===1)&&v.children.length>0),m=l.some(v=>v.children?.some(w=>w.onRemove)),[C,y]=(0,p.useState)(()=>l.reduce((v,w)=>(v[w.id]=!!w.expanded,v),{})),b=(v,w=0)=>{let R=0,A=v;if(A){do R+=A?.offsetTop||0,A=A?.offsetParent instanceof HTMLElement?A.offsetParent:void 0;while(A&&A!==e);e?.scroll({top:R+w,behavior:"smooth"})}},S=v=>{if(v.level==="child"&&v.type==="filter"){const w=l.find(R=>R.children?.find(A=>A.id===v.id));w&&b(w.ref,w.customTopOffset)}else b(v.ref,v.customTopOffset),(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"select_section",type:v.panelId})},L=()=>{Ot.M.set(At.expanded,!n),o(),(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n?"minimize":"expand"})},T=v=>{y(w=>({...w,[v]:!w[v]})),(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:C[v]?"expand":"minimize"})};return(0,p.useEffect)(()=>{let v;for(const w of l){let R=w?.ref?.getBoundingClientRect().top;R&&R>=0&&(v=w);const A=tn(w).find(P=>{const k=P.customTopOffset||0;let W=P?.ref?.getBoundingClientRect().top;return W&&W>=k});if(A&&Nt(w)){u(A.id),g(w.id);break}if(v){g(v.id),u(void 0);break}}},[l,a]),(0,t.jsx)(rs._,{className:r.wrapper,id:s,children:(0,t.jsx)(Et.E,{children:(0,t.jsxs)("div",{className:r.content,children:[(0,t.jsx)(as,{icon:"arrow-from-right",tooltip:n?"Collapse outline":"Expand outline",tooltipPlacement:n?"right":"bottom",onClick:L,className:(0,f.cx)(r.toggleContentOutlineButton,{[r.justifyCenter]:!n&&!x}),"aria-expanded":n}),l.map(v=>(0,t.jsxs)(p.Fragment,{children:[(0,t.jsx)(as,{title:n?v.title:void 0,contentOutlineExpanded:n,className:(0,f.cx)(r.buttonStyles,{[r.justifyCenter]:!n&&!m,[r.sectionHighlighter]:Pt(v,c)&&!n}),indentStyle:(0,f.cx)({[r.indentRoot]:!Nt(v)&&x,[r.sectionHighlighter]:Pt(v,c)&&!n&&C[v.id]}),icon:v.icon,onClick:()=>S(v),tooltip:v.title,collapsible:Nt(v),collapsed:!C[v.id],toggleCollapsed:()=>T(v.id),isActive:sn(v,d,c,C),sectionId:v.id,color:v.color},v.id),(0,t.jsx)("div",{id:v.id,"data-testid":`section-wrapper-${v.id}`,children:v.children&&Nt(v)&&C[v.id]&&v.children.map((w,R)=>(0,t.jsxs)("div",{className:r.itemWrapper,children:[n&&(0,t.jsx)("div",{className:(0,f.cx)(r.itemConnector,{[r.firstItemConnector]:R===0,[r.lastItemConnector]:R===(v.children?.length||0)-1})}),(0,t.jsx)(as,{title:n?w.title:void 0,contentOutlineExpanded:n,icon:n?void 0:v.icon,className:(0,f.cx)(r.buttonStyles,{[r.justifyCenter]:!n&&!m,[r.sectionHighlighter]:Pt(v,c)&&!n}),indentStyle:r.indentChild,onClick:A=>{S(w),w.onClick?.(A)},tooltip:w.title,isActive:sn(w,d,c,C),extraHighlight:w.highlight,color:w.color,onRemove:w.onRemove?()=>w.onRemove?.(w.id):void 0},w.id)]},w.id))})]},v.id))]})})})}const Zo=(e,s)=>({wrapper:(0,f.css)({label:"wrapper",position:"relative",display:"flex",justifyContent:"center",marginRight:e.spacing(1),height:"100%",backgroundColor:e.colors.background.primary,width:s?"160px":void 0,minWidth:s?"160px":void 0}),content:(0,f.css)({label:"content",marginLeft:e.spacing(.5),top:0}),buttonStyles:(0,f.css)({display:"flex","&:hover":{color:e.colors.text.primary,textDecoration:"underline"}}),toggleContentOutlineButton:(0,f.css)({"&:hover":{color:e.colors.text.primary},transform:s?"rotate(180deg)":"",marginRight:s?e.spacing(.5):void 0}),indentRoot:(0,f.css)({paddingLeft:e.spacing(3)}),indentChild:(0,f.css)({paddingLeft:s?e.spacing(5):e.spacing(2.75)}),itemWrapper:(0,f.css)({display:"flex",height:e.spacing(4),alignItems:"center"}),itemConnector:(0,f.css)({position:"relative",height:"100%",width:e.spacing(1.5),"&::before":{borderRight:`1px solid ${e.colors.border.medium}`,content:'""',height:"100%",left:e.spacing(4.75),position:"absolute",transform:"translateX(50%)"}}),firstItemConnector:(0,f.css)({"&::before":{top:e.spacing(1),height:`calc(100% - ${e.spacing(1)})`}}),lastItemConnector:(0,f.css)({"&::before":{height:`calc(100% - ${e.spacing(1)})`}}),justifyCenter:(0,f.css)({justifyContent:"center"}),sectionHighlighter:(0,f.css)({backgroundColor:e.colors.background.secondary})});function Nt(e){return!!(e.children&&e.children.length>0&&(!e.mergeSingleChild||e.children.length!==1))}function Pt(e,s){return e.children?.some(n=>n.id===s)}function Ce({panelId:e,title:s,icon:n,customTopOffset:o,children:r,className:i,level:a="root",mergeSingleChild:l,type:d="scrollIntoView",onClick:g}){const{register:c,unregister:u}=is()??{},x=(0,p.useRef)(null);return(0,p.useEffect)(()=>{if(!c||!u)return;const m=c({panelId:e,title:s,icon:n,ref:x.current,customTopOffset:o,level:a,mergeSingleChild:l,type:d});return()=>u(m)},[e,s,n,o,a,l,c,u,d,g]),(0,t.jsx)("div",{className:i,ref:x,children:r})}var it=h(49785),kt=h(16817),at=h(42418),Mt=h(82762),pe=h(88575),Qe=h(10354),zt=h(10860),We=h(29158),Yo=h(91605),ls=h(67023),Jo=h(18380),Xo=h(23257),_o=h.n(Xo),er=h(60029),ke=h(90182),cs=h(2864);const nn=({label:e,tooltipText:s})=>(0,t.jsxs)(Ye.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"flex-start",children:[(0,t.jsx)(er.J,{children:e}),(0,t.jsx)(be.m,{content:s,children:(0,t.jsx)(fe.I,{name:"info-circle",size:"sm"})})]}),tr=({onSave:e,onCancel:s,fieldList:n,transformationToEdit:o})=>{const[r,i]=(0,p.useState)(void 0),[a,l]=(0,p.useState)({}),[d,g]=(0,p.useState)({mapValueDetails:{show:!1},expressionDetails:{show:!1}}),[c,u]=(0,p.useState)(!1),[x,m]=(0,p.useState)(!1),{getValues:C,control:y,register:b,watch:S}=(0,it.mN)({defaultValues:(0,p.useMemo)(()=>{if(o){const T=n[o?.field];i(T),o?.expression&&u(!0);const v=(0,cs.h)(o?.type);g({mapValueDetails:v.mapValueDetails,expressionDetails:v.expressionDetails});const w=(0,ls.k)({type:o?.type,expression:o?.expression,mapValue:o?.mapValue},T||"",o?.field);return l({...w}),m(!0),{type:o?.type,field:o?.field,mapValue:o?.mapValue,expression:o?.expression}}else return},[n,o])}),L=(0,p.useId)();return(0,p.useEffect)(()=>{const T=S(v=>{const w=v.expression;let R=!1;if(w!==void 0){R=!0;try{new RegExp(w)}catch{R=!1}}else R=!d.expressionDetails.show;u(R);let A=[];if(v.type){const P=(0,ls.k)({type:v.type,expression:R?w:"",mapValue:v.mapValue},n[v.field]||"",v.field);A=Object.keys(P),l(A.length>0?{...P}:{})}A.length===0||!R?m(!1):m(!0)});return()=>T.unsubscribe()},[n,d.expressionDetails.show,S]),(0,t.jsxs)(Je.a,{isOpen:!0,title:`${o?"Edit":"Add"} transformation`,onDismiss:s,className:(0,f.css)({width:"700px"}),children:[(0,t.jsx)("p",{children:"A transformation extracts variables out of a single field. These variables will be available along with your field variables."}),(0,t.jsx)(pe.D,{label:"Field",children:(0,t.jsx)(it.xI,{control:y,render:({field:{onChange:T,ref:v,...w}})=>(0,t.jsx)(ke.l6,{...w,onChange:R=>{R.value&&(T(R.value),i(n[R.value]))},options:Object.entries(n).map(R=>({label:R[0],value:R[0]})),"aria-label":"field"}),name:"field"})}),r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("pre",{children:(0,t.jsx)(_o(),{textToHighlight:r,searchWords:[c?C("expression")??"":""],autoEscape:!1})}),(0,t.jsx)(pe.D,{label:"Type",children:(0,t.jsx)(it.xI,{control:y,render:({field:{onChange:T,ref:v,...w}})=>(0,t.jsx)(ke.l6,{...w,onChange:R=>{T(R.value);const A=(0,cs.h)(R.value);g({mapValueDetails:A.mapValueDetails,expressionDetails:A.expressionDetails})},options:(0,cs.j)(),"aria-label":"type"}),name:"type"})}),d.expressionDetails.show&&(0,t.jsx)(pe.D,{label:d.expressionDetails.helpText?(0,t.jsx)(nn,{label:"Expression",tooltipText:d.expressionDetails.helpText}):"Expression",htmlFor:`${L}-expression`,required:d.expressionDetails.required,children:(0,t.jsx)(Qe.p,{...b("expression"),id:`${L}-expression`})}),d.mapValueDetails.show&&(0,t.jsx)(pe.D,{label:d.mapValueDetails.helpText?(0,t.jsx)(nn,{label:"Variable Name",tooltipText:d.mapValueDetails.helpText}):"Variable Name",htmlFor:`${L}-mapValue`,children:(0,t.jsx)(Qe.p,{...b("mapValue"),id:`${L}-mapValue`})}),Object.entries(a).length>0&&(0,t.jsxs)(t.Fragment,{children:["This transformation will add the following variables:",(0,t.jsx)("pre",{children:Object.entries(a).map(T=>`\${${T[0]}} = ${T[1]?.value}
`)})]})]}),(0,t.jsxs)(Je.a.ButtonRow,{children:[(0,t.jsx)(V.$n,{variant:"secondary",onClick:s,fill:"outline",children:"Cancel"}),(0,t.jsx)(V.$n,{variant:"primary",onClick:()=>e(C()),disabled:!x,children:o?"Edit transformation":"Add transformation to correlation"})]})]})},sr=({exploreId:e,correlations:s})=>{const n=(0,D.useDispatch)(),o=(0,N.of)(nr),r=(0,D.useSelector)(J.Qb),i=Object.values(r),{value:a,loading:l}=(0,kt.A)(async()=>await(0,Jo.tZ)(i[0],i[1]),[i[0]?.datasourceInstance,i[0]?.queries[0].datasource,i[1]?.datasourceInstance,i[1]?.queries[0].datasource]),{register:d,watch:g,getValues:c,setValue:u}=(0,it.mN)(),[x,m]=(0,p.useState)(!1),[C,y]=(0,p.useState)(!1),[b,S]=(0,p.useState)(!1),[L,T]=(0,p.useState)([]),[v,w]=(0,p.useState)(void 0),R=(0,D.useSelector)(J.vC),A=(0,p.useId)();return(0,p.useEffect)(()=>(n((0,Y.am)({canSave:!0})),()=>{n((0,Y.am)({canSave:!1}))}),[n]),(0,p.useEffect)(()=>{!l&&a!==void 0&&!R?.correlationDirty&&c("label")!==""&&u("label",a)},[R?.correlationDirty,a,c,l,u]),(0,p.useEffect)(()=>{const P=g(k=>{let W=R?.correlationDirty||!1,O=k.description||"";!W&&(k.label!==a||O!=="")?W=!0:W&&k.label===a&&O.trim()===""&&(W=!1),n((0,Y.am)({label:k.label,description:k.description,correlationDirty:W}))});return()=>P.unsubscribe()},[R?.correlationDirty,a,n,g]),(0,p.useEffect)(()=>{const P=!R?.correlationDirty&&L.length>0?!0:R?.correlationDirty;n((0,Y.am)({transformations:L,correlationDirty:P}));let k={};L.forEach(W=>{const O=(0,ls.k)({type:W.type,expression:W.expression,mapValue:W.mapValue},s.vars[W.field],W.field);Object.keys(O).forEach(B=>{k[B]=O[B]?.value})}),n((0,Fe.nE)({exploreId:e,correlationEditorHelperData:{resultField:s.resultField,origVars:s.origVars,vars:{...s.origVars,...k}}}))},[n,L]),(0,t.jsxs)(t.Fragment,{children:[b&&(0,t.jsx)(tr,{onCancel:()=>{w(void 0),S(!1)},onSave:P=>{if(v!==void 0){const k=[...L];k[v]=P,T(k),w(void 0)}else T([...L,P]);S(!1)},fieldList:s.origVars,transformationToEdit:v!==void 0?L[v]:void 0}),(0,t.jsxs)(at.F,{title:"Correlation details",severity:"info",children:["The correlation link will appear by the ",(0,t.jsx)("code",{children:s.resultField})," field. You can use the following variables to set up your correlations:",(0,t.jsx)("pre",{children:Object.entries(s.vars).map(P=>`\${${P[0]}} = ${P[1]}
`)}),(0,t.jsxs)(Mt.S,{collapsible:!0,isOpen:x,onToggle:()=>{m(!x)},label:(0,t.jsxs)(Ye.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"center",children:["Label / Description",!x&&!l&&(0,t.jsx)("span",{className:o.labelCollapseDetails,children:`Label: ${c("label")||a}`})]}),children:[(0,t.jsx)(pe.D,{label:"Label",htmlFor:`${A}-label`,children:(0,t.jsx)(Qe.p,{...d("label"),id:`${A}-label`,onBlur:()=>{c("label")===""&&a!==void 0&&u("label",a)}})}),(0,t.jsx)(pe.D,{label:"Description",htmlFor:`${A}-description`,children:(0,t.jsx)(Qe.p,{...d("description"),id:`${A}-description`})})]}),(0,t.jsxs)(Mt.S,{collapsible:!0,isOpen:C,onToggle:()=>{y(!C)},label:(0,t.jsxs)(Ye.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"center",children:["Transformations",(0,t.jsx)(be.m,{content:"A transformation extracts one or more variables out of a single field.",children:(0,t.jsx)(fe.I,{name:"info-circle",size:"sm"})})]}),children:[(0,t.jsx)(V.$n,{variant:"secondary",fill:"outline",onClick:()=>{S(!0)},className:o.transformationAction,children:"Add transformation"}),L.map((P,k)=>{const{type:W,field:O,expression:B,mapValue:ie}=P,oe=[(ie??"").length>0?`Variable name: ${ie}`:void 0,(B??"").length>0?(0,t.jsxs)(t.Fragment,{children:["Expression: ",(0,t.jsx)("code",{children:B})]}):void 0].filter(ue=>ue);return(0,t.jsxs)(zt.Z,{children:[(0,t.jsxs)(zt.Z.Heading,{children:[O,": ",W]}),oe.length>0&&(0,t.jsx)(zt.Z.Meta,{className:o.transformationMeta,children:oe}),(0,t.jsxs)(zt.Z.SecondaryActions,{children:[(0,t.jsx)(We.K,{name:"edit","aria-label":"edit transformation",onClick:()=>{w(k),S(!0)}},"edit"),(0,t.jsx)(Yo.e,{"aria-label":"delete transformation",onConfirm:()=>T(L.filter((ue,E)=>k!==E)),closeOnConfirm:!0})]})]},`trans-${k}`)})]})]})]})},nr=e=>({labelCollapseDetails:(0,f.css)({marginLeft:e.spacing(2),...e.typography.bodySmall,fontStyle:"italic"}),transformationAction:(0,f.css)({marginBottom:e.spacing(2)}),transformationMeta:(0,f.css)({alignItems:"baseline"})});var Re=h(47232),or=h(24308),rr=h(79041),De=h(91052),ir=h(15162),ar=h(33368);function lr({width:e,height:s,timeZone:n,state:o,pluginId:r,frames:i,absoluteRange:a,splitOpenFn:l,eventBus:d}){const g=(0,p.useMemo)(()=>({from:(0,Re.KQ)(a.from),to:(0,Re.KQ)(a.to),raw:{from:(0,Re.KQ)(a.from),to:(0,Re.KQ)(a.to)}}),[a.from,a.to]),c=(0,ir.d4)(r),x={dataLinkPostProcessor:(0,ar.h)(l,g),eventBus:d,eventsScope:"explore"};return(0,t.jsx)(rr.XF,{value:x,children:(0,t.jsx)(De.NR,{title:c.name,width:e,height:s,loadingState:o,children:(m,C)=>(0,t.jsx)(or.m,{data:{series:i,state:o,timeRange:g},pluginId:r,title:"",width:m,height:C,timeZone:n})})})}var cr=h(67570),dr=h(95247),re=h(27746),ds=h(19727),Ht=h(11134),ur=h(75269),pr=h(51612),us=h(76698),ye=h(64756),ps=h(10096),on=h(81862),rn=h(85858),hr=h(15648),gr=h(25573),an=h(80582);function fr(e){const{onClick:s,isSynced:n}=e,o=()=>{const{isSynced:r}=e,i=r?"Unsync all views":"Sync all views to this time range";return(0,t.jsx)(t.Fragment,{children:i})};return(0,t.jsx)(be.m,{content:o,placement:"bottom",children:(0,t.jsx)(re.I,{icon:"link",variant:n?"active":"canvas","aria-label":n?"Synced times":"Unsynced times",onClick:s})})}class mr extends p.Component{constructor(){super(...arguments),this.onMoveTimePicker=s=>{const{range:n,onChangeTime:o,timeZone:r}=this.props,{from:i,to:a}=(0,an.Wb)(s,n),l={from:(0,Re.oZ)(r,i),to:(0,Re.oZ)(r,a)};o(l)},this.onMoveForward=()=>this.onMoveTimePicker(1),this.onMoveBack=()=>this.onMoveTimePicker(-1),this.onChangeTimePicker=s=>{const n=rn.isMathString(s.raw.from)?s.raw.from:s.from,o=rn.isMathString(s.raw.to)?s.raw.to:s.to;this.props.onChangeTime({from:n,to:o}),(0,z.rR)("grafana_explore_time_picker_time_range_changed",{timeRangeFrom:n,timeRangeTo:o})},this.onZoom=()=>{const{range:s,onChangeTime:n,timeZone:o}=this.props,{from:r,to:i}=(0,an.Zk)(s,2),a={from:(0,Re.oZ)(o,r),to:(0,Re.oZ)(o,i)};n(a)}}render(){const{range:s,timeZone:n,fiscalYearStartMonth:o,splitted:r,syncedTimes:i,onChangeTimeSync:a,hideText:l,onChangeTimeZone:d,onChangeFiscalYearStartMonth:g}=this.props,c=r?(0,t.jsx)(fr,{onClick:a,isSynced:i}):void 0,u={value:s,timeZone:n,fiscalYearStartMonth:o,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:l},x=(0,hr.r)(U.$.bootData.user.weekStart);return(0,t.jsx)(gr.m,{isOnCanvas:!0,...u,timeSyncButton:c,isSynced:i,widthOverride:r?window.innerWidth/2:void 0,onChange:this.onChangeTimePicker,onChangeTimeZone:d,onChangeFiscalYearStartMonth:g,weekStart:x})}}var ln=h(86634);function yr(e){const s=(0,p.useRef)(null),{start:n,pause:o,resume:r,isLive:i,isPaused:a,stop:l,splitted:d}=e,g=i&&!a?"active":"canvas",c=i?a?r:o:n;return(0,t.jsxs)(ds.e,{children:[(0,t.jsx)(be.m,{content:i&&!a?(0,t.jsx)(t.Fragment,{children:"Pause the live stream"}):(0,t.jsx)(t.Fragment,{children:"Start live stream your logs"}),placement:"bottom",children:(0,t.jsx)(re.I,{iconOnly:d,variant:g,icon:!i||a?"play":"pause",onClick:c,children:i&&a?"Paused":"Live"})}),(0,t.jsx)(ln.A,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:i,classNames:{enter:$t.stopButtonEnter,enterActive:$t.stopButtonEnterActive,exit:$t.stopButtonExit,exitActive:$t.stopButtonExitActive},nodeRef:s,children:(0,t.jsx)(be.m,{content:(0,t.jsx)(t.Fragment,{children:"Stop and exit the live stream"}),placement:"bottom",children:(0,t.jsx)(re.I,{ref:s,variant:g,onClick:l,icon:"square-shape"})})})]})}const $t={stopButtonEnter:(0,f.css)({label:"stopButtonEnter",width:0,opacity:0,overflow:"hidden"}),stopButtonEnterActive:(0,f.css)({label:"stopButtonEnterActive",opacity:1,width:"32px"}),stopButtonExit:(0,f.css)({label:"stopButtonExit",width:"32px",opacity:1,overflow:"hidden"}),stopButtonExitActive:(0,f.css)({label:"stopButtonExitActive",opacity:0,width:0})};var je=h(38138),lt=h(83122),Ve=(e=>(e.QueryLibrary="Query library",e.RichHistory="Query history",e.Starred="Starred",e.Settings="Settings",e))(Ve||{});const cn=(0,p.createContext)({selectedTab:void 0,setSelectedTab:()=>{},queryLibraryAvailable:!1,drawerOpened:!1,setDrawerOpened:()=>{}});function _e(){return(0,p.useContext)(cn)}function xr({children:e}){const s=U.$.featureToggles.queryLibrary===!0,[n,o]=(0,p.useState)(s?"Query library":void 0),[r,i]=(0,p.useState)(!1),a=(0,D.useSelector)(J.i6);return(0,p.useEffect)(()=>{a&&!s&&o(a.starredTabAsFirstTab?"Starred":"Query history")},[a,o,s]),(0,t.jsx)(cn.Provider,{value:{queryLibraryAvailable:s,selectedTab:n,setSelectedTab:o,drawerOpened:r,setDrawerOpened:i},children:e})}const Bt={queryLibrary:(0,j.t)("explore.rich-history.query-library","Query library"),queryHistory:(0,j.t)("explore.rich-history.query-history","Query history")};function vr({variant:e}){const{selectedTab:s,setSelectedTab:n,queryLibraryAvailable:o,drawerOpened:r,setDrawerOpened:i}=_e(),a=(0,N.of)(br);if(!o)return;function l(g){n(g),i(!1),i(!0)}const d=(0,t.jsxs)(je.W,{children:[(0,t.jsx)(je.W.Item,{label:Bt.queryLibrary,onClick:()=>l(Ve.QueryLibrary)}),(0,t.jsx)(je.W.Item,{label:Bt.queryHistory,onClick:()=>l(Ve.RichHistory)})]});return(0,t.jsxs)(ds.e,{children:[(0,t.jsx)(re.I,{icon:"book",variant:r?"active":"canvas",onClick:()=>i(!r),"aria-label":s,children:e==="full"?s:void 0}),r?(0,t.jsx)(V.$n,{className:a.close,variant:"secondary",icon:"times",onClick:()=>i(!1)}):(0,t.jsx)(lt.m,{overlay:d,children:(0,t.jsx)(re.I,{className:a.toggle,variant:"canvas",icon:"angle-down"})})]})}const br=()=>({toggle:(0,f.css)({width:"36px"}),close:(0,f.css)({width:"36px","> svg":{position:"relative",left:2}})});var Sr=h(59093),Cr=h(15068),hs=h(7030),Ue=h(96192);const jr={key:"copy-link",label:(0,j.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),icon:"share-alt",getUrl:()=>{},shorten:!0,absTime:!1};function wr(){const e=(0,D.useSelector)(J.Qb),[s,n]=(0,p.useState)(!1),[o,r]=(0,p.useState)(jr),i=(d,g,c)=>{d?((0,hs.VP)(c||h.g.location.href),(0,z.rR)("grafana_explore_shortened_link_clicked",{isAbsoluteTime:g})):((0,ot.uJ)(c!==void 0?`${window.location.protocol}//${window.location.host}${U.$.appSubUrl}${c}`:h.g.location.href),(0,z.rR)("grafana_explore_copy_link_clicked",{isAbsoluteTime:g}))},a=[{key:"normal",label:(0,j.t)("explore.toolbar.copy-links-normal-category","Normal URL links"),items:[{key:"copy-shortened-link",icon:"link",label:(0,j.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),getUrl:()=>{},shorten:!0,absTime:!1},{key:"copy-link",icon:"link",label:(0,j.t)("explore.toolbar.copy-link","Copy URL"),getUrl:()=>{},shorten:!1,absTime:!1}]},{key:"timesync",label:(0,j.t)("explore.toolbar.copy-links-absolute-category","Time-sync URL links (share with time range intact)"),items:[{key:"copy-short-link-abs-time",icon:"clock-nine",label:(0,j.t)("explore.toolbar.copy-shortened-link-abs-time","Copy absolute shortened URL"),shorten:!0,getUrl:()=>(0,Ue._O)(e),absTime:!0},{key:"copy-link-abs-time",icon:"clock-nine",label:(0,j.t)("explore.toolbar.copy-link-abs-time","Copy absolute URL"),shorten:!1,getUrl:()=>(0,Ue._O)(e),absTime:!0}]}],l=(0,t.jsx)(je.W,{children:a.map(d=>(0,t.jsx)(Sr.r,{label:d.label,children:d.items.map(g=>(0,t.jsx)(je.W.Item,{label:g.label,icon:g.icon,onClick:()=>{const c=g.getUrl();i(g.shorten,g.absTime,c),r(g)}},g.key))},d.key))});return(0,t.jsx)(Cr.U,{children:(0,t.jsxs)(Ye.B,{gap:0,direction:"row",alignItems:"center",wrap:"nowrap",children:[(0,t.jsx)(re.I,{tooltip:o.label,icon:o.icon,iconOnly:!0,narrow:!0,onClick:()=>{const d=o.getUrl();i(o.shorten,o.absTime,d)},"aria-label":(0,j.t)("explore.toolbar.copy-shortened-link","Copy shortened URL")}),(0,t.jsx)(lt.m,{overlay:l,placement:"bottom-end",onVisibleChange:n,children:(0,t.jsx)(re.I,{narrow:!0,isOpen:s,"aria-label":(0,j.t)("explore.toolbar.copy-shortened-link-menu","Open copy link options")})})]})})}var Rr=h(74135),Tr=h(3197),Lr=h(24401),Ir=h(30973);const Er=(0,p.lazy)(()=>h.e(4787).then(h.bind(h,74787)).then(({AddToDashboard:e})=>({default:e})));function Or(e){const{exploreId:s}=e,[n,o]=(0,p.useState)(),[r,i]=(0,p.useState)(!1),a=Fr(e),{extensions:l}=(0,Tr.vl)({extensionPointId:Rr.S.ExploreToolbarAction,context:a,limitPerPlugin:3}),d=(0,J.qq)(s),g=(0,D.useSelector)(d)?.queries?.length;if(l.length<=1)return jt.TP.hasPermission(D.AccessControlAction.DashboardsCreate)||jt.TP.hasPermission(D.AccessControlAction.DashboardsWrite)?(0,t.jsx)(p.Suspense,{fallback:null,children:(0,t.jsx)(Er,{exploreId:s})}):null;const c=(0,t.jsx)(Ir.w,{extensions:l,onSelect:o});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(lt.m,{onVisibleChange:i,placement:"bottom-start",overlay:c,children:(0,t.jsx)(re.I,{"aria-label":"Add",disabled:!g,variant:"canvas",isOpen:r,children:"Add"})}),!!n&&!!n.path&&(0,t.jsx)(Lr.s,{path:n.path,title:n.title,onDismiss:()=>o(void 0)})]})}function Fr(e){const{exploreId:s,timeZone:n}=e,r=(0,D.useSelector)(J.vC)?.editorMode||!1,{queries:i,queryResponse:a,range:l}=(0,D.useSelector)((0,J.qq)(s)),d=(0,D.useSelector)((0,J.Jr)(s)),g=i.map(x=>x?.datasource?.uid).filter(x=>x!==void 0),c=[...new Set(g)].length,u=jt.TP.hasPermission(D.AccessControlAction.DataSourcesWrite);return(0,p.useMemo)(()=>({exploreId:s,targets:i,data:a,timeRange:l.raw,timeZone:(0,Zs.O)({timeZone:n}),shouldShowAddCorrelation:U.$.featureToggles.correlations===!0&&u&&!r&&d&&c===1}),[s,i,a,l.raw,n,u,r,d,c])}var xe=h(89224);function Dr(e){const s=(0,D.useDispatch)(),n=(0,p.useCallback)(()=>{s((0,K.qk)({exploreId:e,isPaused:!0}))},[e,s]),o=(0,p.useCallback)(()=>{s((0,K.qk)({exploreId:e,isPaused:!1}))},[e,s]),r=(0,p.useCallback)(()=>{n(),s((0,xe.hO)({exploreId:e,refreshInterval:Ht.cC.offOption.value})),s((0,K.Od)({exploreId:e}))},[e,s,n]),i=(0,p.useCallback)(()=>{s((0,xe.hO)({exploreId:e,refreshInterval:Ht.cC.liveOption.value}))},[e,s]),a=(0,p.useCallback)(()=>{s((0,K.rR)({exploreId:e}))},[e,s]);return{pause:n,resume:o,stop:r,start:i,clear:a}}function dn(e){const s=Dr(e.exploreId);return e.children(s)}const Ar=(e,s)=>({rotateIcon:(0,f.css)({"> div > svg":{transform:"rotate(180deg)"}}),toolbarButton:(0,f.css)({display:"flex",justifyContent:"center",marginRight:e.spacing(.5),width:s&&e.spacing(6)})});function Nr({exploreId:e,onChangeTime:s,onContentOutlineToogle:n,isContentOutlineOpen:o}){const r=(0,ye.wA)(),i=(0,ye.d4)(J.pF),a=(0,N.of)(Ar,i),l=(0,ye.d4)(F=>(0,Dt.O)(F.user)),d=(0,ye.d4)(F=>(0,Dt.q)(F.user)),{refreshInterval:g,datasourceInstance:c,range:u,isLive:x,isPaused:m,syncedTimes:C}=(0,ye.d4)(F=>({...(0,ne.pick)(F.explore.panes[e],"refreshInterval","datasourceInstance","range","isLive","isPaused"),syncedTimes:F.explore.syncedTimes}),Se.shallowEqual),y=(0,ye.d4)((0,K.h1)(e)),b=(0,ye.d4)(F=>F.explore.largerExploreId===e),S=(0,ye.d4)(F=>i||F.explore.panes[e].containerWidth<1210),L=(0,ye.d4)(F=>F.explore.panes[e].containerWidth<(i?700:800)),T=(0,ye.d4)(J.K6),v=(0,ye.d4)(J.vC),w=v?.editorMode||!1,R=(0,ye.d4)((0,J.Jr)(e)),A=(0,p.useMemo)(()=>R&&b||!R&&!b,[R,b]),P=y?(0,j.t)("explore.toolbar.refresh-picker-cancel","Cancel"):(0,j.t)("explore.toolbar.refresh-picker-run","Run query"),k=async F=>{w?v?.correlationDirty||v?.queryEditorDirty?r((0,Y.am)({isExiting:!0,postConfirmAction:{exploreId:e,action:us.IW.CHANGE_DATASOURCE,changeDatasourceUid:F.uid,isActionLeft:R}})):(R&&T.forEach(q=>{r((0,Fe.nE)({exploreId:q[0],correlationEditorHelperData:void 0}))}),r((0,Be.wh)({exploreId:e,datasource:F.uid,options:{importQueries:!0}}))):r((0,Be.wh)({exploreId:e,datasource:F.uid,options:{importQueries:!0}}))},W=(F=!1)=>r(F?(0,K.hS)(e):(0,K.Od)({exploreId:e})),O=F=>r((0,on.Cj)(F)),B=()=>{r((0,Y.ve)()),(0,z.rR)("grafana_explore_split_view_opened",{origin:"menu"})},ie=()=>{w?v?.correlationDirty||v?.queryEditorDirty?r((0,Y.am)({isExiting:!0,postConfirmAction:{exploreId:e,action:us.IW.CLOSE_PANE,isActionLeft:R}})):(T.forEach(F=>{r((0,Fe.nE)({exploreId:F[0],correlationEditorHelperData:void 0}))}),r((0,Y.J8)(e)),(0,z.rR)("grafana_explore_split_view_closed")):(r((0,Y.J8)(e)),(0,z.rR)("grafana_explore_split_view_closed"))},oe=()=>{r(b?(0,Y.JA)():(0,Y.tP)({exploreId:e}))},ue=()=>{r((0,xe.iO)(e))},E=F=>r((0,on.c1)(F)),M=F=>{r((0,xe.hO)({exploreId:e,refreshInterval:F}))},H=[(0,t.jsx)(wr,{},"share"),(0,t.jsx)("div",{style:{flex:1}},"spacer0")];return(0,t.jsxs)("div",{children:[g&&(0,t.jsx)(cr.u,{func:W,interval:g,loading:y}),(0,t.jsx)("div",{children:(0,t.jsx)(ur.H,{actions:H})}),(0,t.jsx)(dr.d,{"aria-label":(0,j.t)("explore.toolbar.aria-label","Explore toolbar"),leftItems:[(0,t.jsx)(re.I,{variant:"canvas",tooltip:"Content outline",icon:"list-ui-alt",iconOnly:i,onClick:n,"aria-expanded":o,"aria-controls":o?"content-outline-container":void 0,className:a.toolbarButton,children:"Outline"},"content-outline"),(0,t.jsx)(pr.s,{mixed:!w,onChange:k,current:c?.getRef(),hideTextValue:L,width:L?8:void 0},`${e}-ds-picker`)].filter(Boolean),forceShowLeftItems:!0,children:[(0,t.jsx)(vr,{variant:i?"compact":"full"},"queryLibrary"),i?(0,t.jsxs)(ds.e,{children:[(0,t.jsx)(re.I,{variant:"canvas",tooltip:b?(0,j.t)("explore.toolbar.split-narrow","Narrow pane"):(0,j.t)("explore.toolbar.split-widen","Widen pane"),onClick:oe,icon:b?"gf-movepane-left":"gf-movepane-right",iconOnly:!0,className:(0,f.cx)(A&&a.rotateIcon)}),(0,t.jsx)(re.I,{tooltip:(0,j.t)("explore.toolbar.split-close-tooltip","Close split pane"),onClick:ie,icon:"times",variant:"canvas",children:(0,t.jsx)(j.x6,{i18nKey:"explore.toolbar.split-close",children:" Close "})})]},"split-controls"):(0,t.jsx)(re.I,{variant:"canvas",tooltip:(0,j.t)("explore.toolbar.split-tooltip","Split the pane"),onClick:B,icon:"columns",disabled:x,children:(0,t.jsx)(j.x6,{i18nKey:"explore.toolbar.split-title",children:"Split"})},"split"),(0,t.jsx)(Or,{exploreId:e,timeZone:l},"toolbar-extension-point"),!x&&(0,t.jsx)(mr,{exploreId:e,range:u,timeZone:l,fiscalYearStartMonth:d,onChangeTime:s,splitted:i,syncedTimes:C,onChangeTimeSync:ue,hideText:S,onChangeTimeZone:O,onChangeFiscalYearStartMonth:E},"timeControls"),(0,t.jsx)(Ht.cC,{onIntervalChanged:M,value:g,isLoading:y,text:S?void 0:P,tooltip:S?P:void 0,intervals:ps.TP.getValidIntervals(Ht.cb),isLive:x,onRefresh:()=>W(y),noIntervalPicker:x,primary:!0,width:(S?35:108)+"px"},"refreshPicker"),c?.meta.streaming&&(0,t.jsx)(dn,{exploreId:e,children:F=>{const q={...F,start:()=>{(0,z.rR)("grafana_explore_logs_live_tailing_clicked",{datasourceType:c?.type}),F.start()}};return(0,t.jsx)(yr,{splitted:i,isLive:x,isPaused:m,start:q.start,pause:q.pause,resume:q.resume,stop:q.stop})}},"liveControls")].filter(Boolean)})]})}var ct=h(41987),Pr=h(85194);function Qt(e,s={}){(0,z.rR)(`grafana_flamegraph_${e}`,{app:ct.Jk.Unknown,grafana_version:U.$.buildInfo.version,...s})}const kr=e=>{const s=(0,N.of)(n=>Mr(n));return(0,t.jsx)("div",{className:s.container,children:(0,t.jsx)(Pr.A,{data:e.dataFrames[0],stickyHeader:!0,getTheme:()=>U.$.theme2,onTableSymbolClick:()=>Qt("table_item_selected"),onViewSelected:n=>Qt("view_selected",{view:n}),onTextAlignSelected:n=>Qt("text_align_selected",{align:n}),onTableSort:n=>Qt("table_sort_selected",{sort:n})})})},Mr=e=>({container:(0,f.css)({background:e.colors.background.primary,display:"flow-root",padding:e.spacing(0,1,1,1),border:`1px solid ${e.components.panel.borderColor}`,borderRadius:e.shape.radius.default})});var zr=h(72519),un=h(84140),Z=h(52622),gs=h(72724),Hr=h(85492),$r=h(77020),Te=h(91002),Br=h(10940),Qr=h(97814);const pn=150,Wr=({resetKey:e,humanize:s,className:n})=>{const[o,r]=(0,p.useState)(0);return(0,Br.A)(()=>r(o+pn),pn),(0,p.useEffect)(()=>r(0),[e]),(0,t.jsx)(Qr.g,{timeInMs:o,className:n,humanize:s})};var Vr=h(34028);const Ur=e=>({logsRowsLive:(0,f.css)`
    label: logs-rows-live;
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
    display: flex;
    flex-flow: column nowrap;
    height: 60vh;
    overflow-y: scroll;
    :first-child {
      margin-top: auto !important;
    }
  `,logsRowFade:(0,f.css)`
    label: logs-row-fresh;
    color: ${e.colors.text};
    background-color: ${(0,un.A)(e.colors.info.transparent).setAlpha(.25).toString()};
    animation: fade 1s ease-out 1s 1 normal forwards;
    @keyframes fade {
      from {
        background-color: ${(0,un.A)(e.colors.info.transparent).setAlpha(.25).toString()};
      }
      to {
        background-color: transparent;
      }
    }
  `,logsRowsIndicator:(0,f.css)`
    font-size: ${e.typography.h6.fontSize};
    padding-top: ${e.spacing(1)};
    display: flex;
    align-items: center;
  `,button:(0,f.css)`
    margin-right: ${e.spacing(1)};
  `,fullWidth:(0,f.css)`
    width: 100%;
  `});class qr extends p.PureComponent{constructor(s){super(s),this.liveEndDiv=null,this.scrollContainerRef=p.createRef(),this.onScroll=n=>{const{isPaused:o,onPause:r}=this.props,{scrollTop:i,clientHeight:a,scrollHeight:l}=n.currentTarget;l-(i+a)>=5&&!o&&r()},this.rowsToRender=()=>{const{isPaused:n}=this.props;let{logRowsToRender:o=[]}=this.state;return n||(o=(0,Te.oR)(o,Z.uH.Ascending).slice(-100)),o},this.state={logRowsToRender:s.logRows}}static getDerivedStateFromProps(s,n){return s.isPaused&&s.clearedAtIndex?{logRowsToRender:(0,Vr.pg)(s.clearedAtIndex,n.logRowsToRender)}:s.isPaused?null:{logRowsToRender:s.logRows}}render(){const{theme:s,timeZone:n,onPause:o,onResume:r,onClear:i,isPaused:a}=this.props,l=Ur(s),{logsRow:d,logsRowLocalTime:g,logsRowMessage:c}=(0,$r.D)(s);return(0,t.jsxs)("div",{children:[(0,t.jsx)("table",{className:l.fullWidth,children:(0,t.jsxs)("tbody",{onScroll:a?void 0:this.onScroll,className:l.logsRowsLive,ref:this.scrollContainerRef,children:[this.rowsToRender().map(u=>(0,t.jsxs)("tr",{className:(0,f.cx)(d,l.logsRowFade),children:[(0,t.jsx)("td",{className:g,children:(0,gs.LE)(u.timeEpochMs,{timeZone:n})}),(0,t.jsx)("td",{className:c,children:u.hasAnsi?(0,t.jsx)(Hr.$,{value:u.raw}):u.entry})]},u.uid)),(0,t.jsx)("tr",{ref:u=>{this.liveEndDiv=u,this.liveEndDiv&&this.scrollContainerRef.current?.scrollTo&&!a&&this.scrollContainerRef.current?.scrollTo(0,this.scrollContainerRef.current.scrollHeight)}})]})}),(0,t.jsxs)("div",{className:l.logsRowsIndicator,children:[(0,t.jsx)(V.$n,{icon:a?"play":"pause",variant:"secondary",onClick:a?r:o,className:l.button,children:a?"Resume":"Pause"}),(0,t.jsx)(V.$n,{icon:"trash-alt",variant:"secondary",onClick:i,className:l.button,children:"Clear logs"}),(0,t.jsx)(V.$n,{icon:"square-shape",variant:"secondary",onClick:this.props.stopLive,className:l.button,children:"Exit live mode"}),a||this.rowsToRender().length>0&&(0,t.jsxs)("span",{children:["Last line received: ",(0,t.jsx)(Wr,{resetKey:this.props.logRows,humanize:!0})," ago"]})]})]})}}const Gr=(0,N.cV)(qr);var dt=h(41811),Kr=h(84596),ut=h(65879),hn=h(69129),gn=h(76885),pt=h(94354),Zr=h(39268),Le=h(14186),Me=h(15292),Yr=h(44895),ae=h(33390),fn=h(81073);const Jr=({children:e,loading:s,loadMoreLogs:n,range:o,rows:r,scrollElement:i,sortOrder:a,timeZone:l,topScrollEnabled:d=!1})=>{const[g,c]=(0,p.useState)(!1),[u,x]=(0,p.useState)(!1),[m,C]=(0,p.useState)(!1),[y,b]=(0,p.useState)(!1),S=(0,p.useRef)(r),L=(0,p.useRef)(i?.scrollTop||0);(0,p.useEffect)(()=>{c(!1),x(!1)},[o,r,a]),(0,p.useEffect)(()=>{s||(C(!1),b(!1))},[s]),(0,p.useEffect)(()=>{y&&i&&i.scrollTo(0,i.scrollHeight-i.clientHeight)},[y,i]),(0,p.useEffect)(()=>{r!==S.current&&r.length===S.current.length&&(m||y)&&(a===Z.uH.Descending&&y?x(!0):a===Z.uH.Ascending&&m&&c(!0)),S.current=r},[y,r,a,m]),(0,p.useEffect)(()=>{if(!i||!n)return;function w(P){if(!i||!n||!r.length||s||!U.$.featureToggles.logsInfiniteScrolling)return;P.stopImmediatePropagation();const k=ei(P,i,L.current);L.current=i.scrollTop,k!==0&&(k===-1&&d?R():k===1&&A())}function R(){const P=ti(yn(r),o,l,a);if(!P){c(!0);return}c(!1),n?.(P),C(!0),(0,z.rR)("grafana_logs_infinite_scrolling",{direction:"top",sort_order:a})}function A(){const P=si(yn(r),o,l,a);if(!P){x(!0);return}x(!1),n?.(P),b(!0),(0,z.rR)("grafana_logs_infinite_scrolling",{direction:"bottom",sort_order:a})}return i.addEventListener("scroll",w),i.addEventListener("wheel",w),()=>{i.removeEventListener("scroll",w),i.removeEventListener("wheel",w)}},[n,s,o,r,i,a,l,d]);const T=a===Z.uH.Descending&&(0,ut.isRelativeTime)(o.raw.to),v=a===Z.uH.Ascending&&(0,ut.isRelativeTime)(o.raw.to);return(0,t.jsxs)(t.Fragment,{children:[m&&(0,t.jsx)(fn.I,{adjective:a===Z.uH.Descending?"newer":"older"}),!T&&g&&mn,e,!v&&u&&mn,y&&(0,t.jsx)(fn.I,{adjective:a===Z.uH.Descending?"older":"newer"})]})},Xr={messageContainer:(0,f.css)({textAlign:"center",padding:.25})},mn=(0,t.jsx)("div",{className:Xr.messageContainer,"data-testid":"end-of-range",children:"End of the selected time range."});var _r=(e=>(e[e.Top=-1]="Top",e[e.Bottom=1]="Bottom",e[e.NoScroll=0]="NoScroll",e))(_r||{});function ei(e,s,n){if(s.scrollHeight<=s.clientHeight)return 0;const o=e instanceof WheelEvent?e.deltaY:s.scrollTop-n;if(o===0)return 0;const r=o<0?-1:1;return(r===-1?s.scrollTop:s.scrollHeight-s.scrollTop-s.clientHeight)<=1?r:0}function yn(e){const s=e[0].timeEpochMs,n=e[e.length-1].timeEpochMs;return n<s?{from:n,to:s}:{from:s,to:n}}function xn(e,s){return{from:s.from.valueOf(),to:e.from}}function vn(e,s,n){return s=fs(s,n),{from:e.to,to:s.to.valueOf()}}const Wt=1e3;function ti(e,s,n,o){return o===Z.uH.Descending?(s=fs(s,n),s.to.valueOf()-e.to>Wt?vn(e,s,n):void 0):Math.abs(s.from.valueOf()-e.from)>Wt?xn(e,s):void 0}function si(e,s,n,o){return o===Z.uH.Descending?Math.abs(s.from.valueOf()-e.from)>Wt?xn(e,s):void 0:(s=fs(s,n),s.to.valueOf()-e.to>Wt?vn(e,s,n):void 0)}function fs(e,s){return(0,ut.isRelativeTimeRange)(e.raw)?(0,ut.convertRawToRange)(e.raw,s):e}var bn=h(14647),ni=h(81166),et=h(69147),tt=h(99140);function oi(){(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-added"})}function ri(){(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-deleted"})}function ii(){(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-limit-reached"})}function ai(){(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-clicked"})}function li(){(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-deleted"})}function ci(e){(0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:`Logs:filter:${e.levelStr}`})}var Sn=h(39590);function di({feedbackUrl:e}){const s=(0,N.of)(ui);return(0,t.jsx)(Ye.B,{children:(0,t.jsxs)("a",{href:e,className:s.link,title:"The logs table is new, please let us know how we can improve it",target:"_blank",rel:"noreferrer noopener",children:[(0,t.jsx)(fe.I,{name:"comment-alt-message"})," Give feedback"]})})}function ui(e){return{link:(0,f.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,":hover":{color:e.colors.text.link}})}}var pi=h(4213),hi=h.n(pi),Cn=h(75505),jn=h(2514),wn=h(18358),Rn=h(93463),gi=h(40455);const Tn=e=>({metaContainer:(0,f.css)({flex:1,color:e.colors.text.secondary,marginBottom:e.spacing(2),minWidth:"30%",display:"flex",flexWrap:"wrap"}),metaItem:(0,f.css)({marginRight:e.spacing(2),marginTop:e.spacing(.5),display:"flex",alignItems:"center",".logs-meta-item__error":{color:e.colors.error.text}}),metaLabel:(0,f.css)({marginRight:`calc(${e.spacing(2)} / 2)`,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium}),metaValue:(0,f.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})}),fi=(0,p.memo)(function(s){const n=(0,N.of)(Tn),{label:o,value:r}=s;return(0,t.jsxs)("div",{"data-testid":"meta-info-text-item",className:n.metaItem,children:[o&&(0,t.jsxs)("span",{className:n.metaLabel,children:[o,":"]}),(0,t.jsx)("span",{className:n.metaValue,children:r})]})}),ms=(0,p.memo)(function(s){const n=(0,N.of)(Tn),{metaItems:o}=s;return(0,t.jsx)("div",{className:n.metaContainer,"data-testid":"meta-info-text",children:o.map((r,i)=>(0,t.jsx)(fi,{label:r.label,value:r.value},`${i}-${r.label}`))})});var Ln=h(14236),Vt=h(90708),ht=h(11261),In=h(41260),ys=h(77093);function mi(e){const{timeZone:s,splitOpen:n,range:o,logsSortOrder:r,width:i,dataFrame:a,columnsWithMeta:l,logsFrame:d}=e,[g,c]=(0,p.useState)(void 0),u=d?.timeField.index,x=(0,p.useCallback)(C=>{if(!C.length)return C;const y=(0,Ln.ES)(C,u,r===Z.uH.Descending),[b]=(0,Vt.we)({data:[y],timeZone:s,theme:U.$.theme2,replaceVariables:S=>S,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const S of b.fields)S.getLinks=L=>(0,Ue.QL)({field:S,rowIndex:L.valueRowIndex,splitOpenFn:n,range:o,dataFrame:y}),S.config={...S.config,custom:{inspect:!0,filterable:!0,width:bi(S),...S.config.custom},filterable:yi(S,d?.bodyField.name??"",d?.timeField.name??"")},S.type=S.type===ht.PU.string?(0,Ln.dF)(S)??ht.PU.string:S.type;return b},[r,s,n,o,d?.bodyField.name,d?.timeField.name,u]);if((0,p.useEffect)(()=>{(async()=>{if(!d?.timeField.name||!d?.bodyField.name){c(void 0);return}const y=En(a);let b=xi(l);const S=vi(b);if(S?y.push(S):y.push({id:"organize",options:{indexByName:{[d.bodyField.name]:0,[d.timeField.name]:1},includeByName:{[d.bodyField.name]:!0,[d.timeField.name]:!0}}}),y.length>0){const L=await(0,Cn.s)((0,jn.m)(y,[a])),T=x(L[0]);c(T)}else c(x(a))})()},[l,a,r,x,d?.bodyField.name,d?.timeField.name]),!g)return null;const m=C=>{const{value:y,key:b,operator:S}=C,{onClickFilterLabel:L,onClickFilterOutLabel:T}=e;!L||!T||(S===Ft.mc&&L(b,y,a),S===Ft.Zi&&T(b,y,a))};return(0,t.jsx)(ys.X,{data:g,width:i,onCellFilterAdded:e.onClickFilterLabel&&e.onClickFilterOutLabel?m:void 0,height:e.height,footerOptions:{show:!0,reducer:["count"],countRows:!0},initialSortBy:[{displayName:d?.timeField.name||"",desc:r===Z.uH.Descending}]})}const yi=(e,s,n)=>!(!s||!n||s===e.name||n===e.name||e.config.links?.length);function En(e){return e.fields.filter(s=>{const n=s.typeInfo?.frame==="json.RawMessage"&&s.name==="labels"&&e?.meta?.type!==In.m.LogLines,o=s.name==="labels"&&s.type===ht.PU.other&&e?.meta?.type===In.m.LogLines;return n||o}).flatMap(s=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:s.name}}])}function xi(e){let s={};return Object.keys(e).filter(n=>e[n].active).forEach(n=>{const o=e[n].index;o!==void 0&&(s[n]=o)}),s}function vi(e){let s={};for(const n in e)s[n]=!0;return Object.keys(e).length>0?{id:"organize",options:{indexByName:e,includeByName:s}}:null}function bi(e){if(e.type===ht.PU.time)return 200}const Si=()=>({metaContainer:(0,f.css)`
    flex: 1;
    display: flex;
    flex-wrap: wrap;
  `});var Ci=(e=>(e.Text="text",e.Json="json",e.CSV="csv",e))(Ci||{});const On=(0,p.memo)(({meta:e,dedupStrategy:s,dedupCount:n,displayedFields:o,clearDetectedFields:r,hasUnescapedContent:i,forceEscape:a,onEscapeNewlines:l,logRows:d})=>{const g=(0,N.of)(Si),c=async m=>{switch((0,z.rR)("grafana_logs_download_logs_clicked",{app:ct.Jk.Explore,format:m,area:"logs-meta-row"}),m){case"text":(0,wn.Zy)({meta:e,rows:d},"Explore");break;case"json":const C=(0,Te.Dg)(d),y=new Blob([JSON.stringify(C)],{type:"application/json;charset=utf-8"}),b=`Explore-logs-${(0,gs.LE)(new Date)}.json`;hi()(y,b);break;case"csv":const S=new Map;d.forEach(L=>{L.dataFrame?.refId&&!S.has(L.dataFrame?.refId)&&S.set(L.dataFrame?.refId,L.dataFrame)}),S.forEach(async L=>{const T=En(L);T.push({id:"organize",options:{excludeByName:{labels:!0,labelTypes:!0}}});const v=await(0,Cn.s)((0,jn.m)(T,[L]));(0,wn.EM)(v[0],`Explore-logs-${L.refId}`)})}},u=[...e];s!==Z.fY.none&&u.push({label:"Deduplication count",value:n,kind:_.tG.Number}),d.some(m=>m.entry.length>gi.S)&&u.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:_.tG.String}),o?.length>0&&u.push({label:"Showing only selected fields",value:(0,t.jsx)(Rn.A,{labels:o})},{label:"",value:(0,t.jsx)(V.$n,{variant:"secondary",size:"sm",onClick:r,children:"Show original line"})}),i&&u.push({label:"Your logs might have incorrectly escaped content",value:(0,t.jsx)(be.m,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right",children:(0,t.jsx)(V.$n,{variant:"secondary",size:"sm",onClick:l,children:a?"Remove escaping":"Escape newlines"})})});const x=(0,t.jsxs)(je.W,{children:[(0,t.jsx)(je.W.Item,{label:"txt",onClick:()=>c("text")}),(0,t.jsx)(je.W.Item,{label:"json",onClick:()=>c("json")}),(0,t.jsx)(je.W.Item,{label:"csv",onClick:()=>c("csv")})]});return(0,t.jsx)(t.Fragment,{children:u&&(0,t.jsxs)("div",{className:g.metaContainer,children:[(0,t.jsx)(ms,{metaItems:u.map(m=>({label:m.label,value:"kind"in m?ji(m.value,m.kind):m.value}))}),(0,t.jsx)(lt.m,{overlay:x,children:(0,t.jsx)(re.I,{isOpen:!1,variant:"canvas",icon:"download-alt",children:"Download"})})]})})});On.displayName="LogsMetaRow";function ji(e,s){return typeof e=="string"||typeof e=="number"?(0,t.jsx)(t.Fragment,{children:e}):s===_.tG.LabelsMap?(0,t.jsx)(Rn.h,{labels:e}):s===_.tG.Error?(0,t.jsx)("span",{className:"logs-meta-item__error",children:e.toString()}):(console.error(`Meta type ${typeof e} ${e} not recognized.`),(0,t.jsx)(t.Fragment,{}))}var gt=h(62930),wi=h(57571),Ri=h(42994);function Ti({pages:e,currentPageIndex:s,oldestLogsFirst:n,timeZone:o,loading:r,onClick:i}){const a=c=>`${(0,gs.LE)(c,{format:Ri.WC.interval.second,timeZone:o})}`,l=(c,u)=>{if(s===u&&r)return(0,t.jsx)(gt.y,{});const x=a(n?c.logsRange.from:c.logsRange.to),m=a(n?c.logsRange.to:c.logsRange.from);return`${x} \u2014 ${m}`},d=(0,N.$j)(),g=Li(d,r);return(0,t.jsx)(Et.E,{autoHide:!0,children:(0,t.jsx)("div",{className:g.pagesWrapper,"data-testid":"logsNavigationPages",children:(0,t.jsx)("div",{className:g.pagesContainer,children:e.map((c,u)=>(0,t.jsxs)("button",{type:"button","data-testid":`page${u+1}`,className:(0,f.cx)((0,V.my)(d),g.page),onClick:()=>{i(c,u+1)},disabled:r,children:[(0,t.jsx)("div",{className:(0,f.cx)(g.line,{selectedBg:s===u})}),(0,t.jsx)("div",{className:(0,f.cx)(g.time,{selectedText:s===u}),children:l(c,u)})]},c.queryRange.to))})})})}const Li=(e,s)=>({pagesWrapper:(0,f.css)`
      height: 100%;
      padding-left: ${e.spacing(.5)};
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
      &::after {
        content: '';
        display: block;
        background: repeating-linear-gradient(
          135deg,
          ${e.colors.background.primary},
          ${e.colors.background.primary} 5px,
          ${e.colors.background.secondary} 5px,
          ${e.colors.background.secondary} 15px
        );
        width: 3px;
        height: inherit;
        margin-bottom: 8px;
      }
    `,pagesContainer:(0,f.css)`
      display: flex;
      padding: 0;
      flex-direction: column;
    `,page:(0,f.css)`
      display: flex;
      margin: ${e.spacing(2)} 0;
      cursor: ${s?"auto":"pointer"};
      white-space: normal;
      .selectedBg {
        background: ${e.colors.primary.main};
      }
      .selectedText {
        color: ${e.colors.primary.main};
      }
    `,line:(0,f.css)`
      width: 3px;
      height: 100%;
      align-items: center;
      background: ${e.colors.text.secondary};
    `,time:(0,f.css)`
      width: 60px;
      min-height: 80px;
      font-size: ${e.v1.typography.size.sm};
      padding-left: ${e.spacing(.5)};
      display: flex;
      align-items: center;
    `});function Ii({absoluteRange:e,logsSortOrder:s,timeZone:n,loading:o,onChangeTime:r,scrollToTopLogs:i,visibleRange:a,queries:l,clearCache:d,addResultsToCache:g}){const[c,u]=(0,p.useState)([]),x=(0,p.useRef)(),m=(0,p.useRef)(),C=(0,p.useRef)(0),y=(0,p.useMemo)(()=>c.findIndex(O=>O.queryRange.to===e.to),[e.to,c]),b=s===Z.uH.Ascending,S=b?y===c.length-1:y===0,L=b?y===0:y===c.length-1,T=(0,N.$j)(),v=Oi(T,b);(0,p.useEffect)(()=>{const O={logsRange:a,queryRange:e};let B=[];!(0,ne.isEqual)(m.current,e)||!(0,ne.isEqual)(x.current,l)?(d(),u([O]),x.current=l,C.current=e.to-e.from):u(ie=>(B=ie.filter(oe=>!(0,ne.isEqual)(O.queryRange,oe.queryRange)),B=[...B,O].sort((oe,ue)=>R(oe,ue,s)),B))},[a,e,s,l,d,g]);const w=(0,p.useCallback)(({from:O,to:B})=>{g(),m.current={from:O,to:B},r({from:O,to:B})},[r,g]),R=(O,B,ie)=>ie===Z.uH.Ascending?O.queryRange.to>B.queryRange.to?1:-1:O.queryRange.to>B.queryRange.to?-1:1,A=(0,t.jsx)(V.$n,{"data-testid":"olderLogsButton",className:v.navButton,variant:"secondary",onClick:()=>{if((0,z.rR)("grafana_explore_logs_pagination_clicked",{pageType:"olderLogsButton"}),L)w({from:a.from-C.current,to:a.from});else{const O=b?-1:1;w({from:c[y+O].queryRange.from,to:c[y+O].queryRange.to})}i()},disabled:o,children:(0,t.jsxs)("div",{className:v.navButtonContent,children:[o?(0,t.jsx)(gt.y,{}):(0,t.jsx)(fe.I,{name:b?"angle-up":"angle-down",size:"lg"}),"Older logs"]})}),P=(0,t.jsx)(V.$n,{"data-testid":"newerLogsButton",className:v.navButton,variant:"secondary",onClick:()=>{if((0,z.rR)("grafana_explore_logs_pagination_clicked",{pageType:"newerLogsButton"}),!S){const O=b?1:-1;w({from:c[y+O].queryRange.from,to:c[y+O].queryRange.to})}i()},disabled:o||S,children:(0,t.jsxs)("div",{className:v.navButtonContent,children:[o&&(0,t.jsx)(gt.y,{}),S||o?null:(0,t.jsx)(fe.I,{name:b?"angle-down":"angle-up",size:"lg"}),S?"Start of range":"Newer logs"]})}),k=(0,p.useCallback)((O,B)=>{(0,z.rR)("grafana_explore_logs_pagination_clicked",{pageType:"page",pageNumber:B}),w({from:O.queryRange.from,to:O.queryRange.to}),i()},[w,i]),W=(0,p.useCallback)(()=>{(0,z.rR)("grafana_explore_logs_scroll_top_clicked"),i()},[i]);return(0,t.jsxs)("div",{className:v.navContainer,children:[!U.$.featureToggles.logsInfiniteScrolling&&(0,t.jsxs)(t.Fragment,{children:[b?A:P,(0,t.jsx)(Ti,{pages:c,currentPageIndex:y,oldestLogsFirst:b,timeZone:n,loading:o,onClick:k}),b?P:A]}),(0,t.jsx)(V.$n,{"data-testid":"scrollToTop",className:v.scrollToTopButton,variant:"secondary",onClick:W,title:"Scroll to top",children:(0,t.jsx)(fe.I,{name:"arrow-up",size:"lg"})})]})}const Ei=(0,p.memo)(Ii),Oi=(e,s)=>{const n=`calc(100vh - 2*${e.spacing(2)} - 2*${wi.l}px)`;return{navContainer:(0,f.css)`
      max-height: ${n};
      display: flex;
      flex-direction: column;
      ${U.$.featureToggles.logsInfiniteScrolling?"justify-content: flex-end;":`justify-content: ${s?"flex-start":"space-between"};`}
      position: sticky;
      top: ${e.spacing(2)};
      right: 0;
    `,navButton:(0,f.css)`
      width: 58px;
      height: 68px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1;
    `,navButtonContent:(0,f.css)`
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      white-space: normal;
    `,scrollToTopButton:(0,f.css)`
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: ${e.spacing(1)};
    `}};var Fn=h(98101);function Fi(e){return{searchWrap:(0,f.css)({padding:`${e.spacing(.4)} 0 ${e.spacing(.4)} ${e.spacing(.4)}`})}}function Di(e){const s=(0,N.$j)(),n=Fi(s);return(0,t.jsx)(pe.D,{className:n.searchWrap,children:(0,t.jsx)(Qe.p,{value:e.value,type:"text",placeholder:"Search fields by name",onChange:e.onChange})})}var xs=h(38127);function Ai(e){return{empty:(0,f.css)({marginBottom:e.spacing(2),marginLeft:e.spacing(1.75),fontSize:e.typography.fontSize})}}function Dn(){const e=(0,N.$j)(),s=Ai(e);return(0,t.jsx)("div",{className:s.empty,children:"No fields"})}var Ni=h(10880);function Pi(e){return{dragIcon:(0,f.css)({cursor:"drag",marginLeft:e.spacing(1),opacity:.4}),labelCount:(0,f.css)({marginLeft:e.spacing(.5),marginRight:e.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11),opacity:.6}),contentWrap:(0,f.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}),checkboxLabel:(0,f.css)({"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}})}}function An(e){const s=(0,N.$j)(),n=Pi(s);if(e.labels[e.label])return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:n.contentWrap,children:[(0,t.jsx)(Ni.S,{className:n.checkboxLabel,label:e.label,onChange:e.onChange,checked:e.labels[e.label]?.active??!1}),e.showCount&&(0,t.jsxs)("button",{className:n.labelCount,onClick:e.onChange,children:[e.labels[e.label]?.percentOfLinesWithLabel,"%"]})]}),e.draggable&&(0,t.jsx)(fe.I,{"aria-label":"Drag and drop icon",title:"Drag and drop to reorder",name:"draggabledots",size:"lg",className:n.dragIcon})]})}function Nn(e){return{wrap:(0,f.css)({marginTop:e.spacing(1),marginBottom:e.spacing(1),display:"flex",background:e.colors.background.primary}),dragging:(0,f.css)({background:e.colors.background.secondary}),columnWrapper:(0,f.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)})}}function ki(e){return(s,n)=>{const o=e[s],r=e[n];return o.index!=null&&r.index!=null?o.index-r.index:0}}const Mi=e=>{const{reorderColumn:s,labels:n,valueFilter:o,toggleColumn:r}=e,i=(0,N.$j)(),a=Nn(i),l=Object.keys(n).filter(c=>o(c)),d=c=>{c.destination&&s(c.source.index,c.destination.index)},g=c=>{const u=n[c];if(u)return`${c} appears in ${u?.percentOfLinesWithLabel}% of log lines`};return l.length?(0,t.jsx)(xs.JY,{onDragEnd:d,children:(0,t.jsx)(xs.gL,{droppableId:"order-fields",direction:"vertical",children:c=>(0,t.jsxs)("div",{className:a.columnWrapper,...c.droppableProps,ref:c.innerRef,children:[l.sort(ki(n)).map((u,x)=>(0,t.jsx)(xs.sx,{draggableId:u,index:x,children:(m,C)=>(0,t.jsx)("div",{className:(0,f.cx)(a.wrap,C.isDragging?a.dragging:void 0),ref:m.innerRef,...m.draggableProps,...m.dragHandleProps,title:g(u),children:(0,t.jsx)(An,{label:u,onChange:()=>r(u),labels:n,draggable:!0})})},u)),c.placeholder]})})}):(0,t.jsx)(Dn,{})},zi=new Intl.Collator(void 0,{sensitivity:"base"});function Hi(e){return(s,n)=>{const o=e[s],r=e[n];return o!=null&&r!=null?+(r.type==="TIME_FIELD")-+(o.type==="TIME_FIELD")||+(r.type==="BODY_FIELD")-+(o.type==="BODY_FIELD")||zi.compare(s,n):0}}const $i=e=>{const{labels:s,valueFilter:n,toggleColumn:o}=e,r=(0,N.$j)(),i=Nn(r),a=Object.keys(s).filter(l=>n(l));return a.length?(0,t.jsx)("div",{className:i.columnWrapper,children:a.sort(Hi(s)).map((l,d)=>(0,t.jsx)("div",{className:i.wrap,title:`${l} appears in ${s[l]?.percentOfLinesWithLabel}% of log lines`,children:(0,t.jsx)(An,{showCount:!0,label:l,onChange:()=>o(l),labels:s})},l))}):(0,t.jsx)(Dn,{})};function Bi(e){return{sidebarWrap:(0,f.css)({overflowY:"scroll",height:"calc(100% - 50px)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"}),columnHeaderButton:(0,f.css)({appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11)}),columnHeader:(0,f.css)({display:"flex",justifyContent:"space-between",fontSize:e.typography.h6.fontSize,background:e.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:e.spacing(.75),paddingRight:e.spacing(.75),paddingBottom:e.spacing(.75),paddingLeft:e.spacing(1.5),zIndex:3,marginBottom:e.spacing(2)})}}const Qi=e=>{const s=(0,N.$j)(),n=Bi(s);return(0,t.jsx)("div",{className:n.sidebarWrap,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:n.columnHeader,children:["Selected fields",(0,t.jsx)("button",{onClick:e.clear,className:n.columnHeaderButton,children:"Reset"})]}),(0,t.jsx)(Mi,{reorderColumn:e.reorderColumn,toggleColumn:e.toggleColumn,labels:e.filteredColumnsWithMeta??e.columnsWithMeta,valueFilter:o=>e.columnsWithMeta[o]?.active??!1,id:"selected-fields"}),(0,t.jsx)("div",{className:n.columnHeader,children:"Fields"}),(0,t.jsx)($i,{toggleColumn:e.toggleColumn,labels:e.filteredColumnsWithMeta??e.columnsWithMeta,valueFilter:o=>!e.columnsWithMeta[o]?.active})]})})};var Pn=h(53076);const Wi=new Pn.A({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function kn(e,s,n){const[o,r,i]=Wi.search(e,s,0,1e5);let a=[],l=new Set;if(o&&i){const d=(g,c)=>{c&&l.add(g)};for(let g=0;g<i.length;g++){let c=i[g];Pn.A.highlight(e[r.idx[c]],r.ranges[c],d),a.push(e[r.idx[c]])}n([a,[...l]])}else s||n([[],[]])}const id=(0,ne.debounce)(kn,300);function Vi(e){const{logsFrames:s,updatePanelState:n,panelState:o}=e,r=o?.columns,[i,a]=(0,p.useState)(void 0),[l,d]=(0,p.useState)(void 0),[g,c]=(0,p.useState)(""),u=Mn(),x=e?.panelState?.refId,[m,C]=(0,p.useState)(s.find(E=>E.refId===x)??s[0]),y=(0,p.useCallback)(E=>{const M=e.panelState?.columns;return M&&Object.values(M).forEach((H,F)=>{E[H]&&(E[H].active=!0,E[H].index=F)}),E},[e.panelState?.columns]),b=(0,Fn.O)(m);(0,p.useEffect)(()=>{if(b?.timeField.name&&b?.bodyField.name&&!r){const E={0:b?.timeField.name??"",1:b?.bodyField.name??""};n({columns:Object.values(E),visualisationType:"table",labelFieldName:b?.getLabelFieldName()??void 0})}},[b,r,n]),(0,p.useEffect)(()=>{const E=s.find(M=>M.refId===x)??s[0];E&&C(E)},[s,x]),(0,p.useEffect)(()=>{if(!i||!l)return;let E={...l},M=!1;Object.keys(i).forEach(H=>{E[H]&&E[H].active!==i[H].active&&(E[H]=i[H],M=!0)}),M&&d(E)},[i,l]),(0,p.useEffect)(()=>{if(!m.length)return;const E=m?m.length:0,M=(0,Fn.O)(m),H=M?.getLogFrameLabelsAsLabels(),F=[];M&&F.push(...M.extraFields.filter(ee=>!ee?.config?.custom?.hidden)),M?.severityField&&F.push(M?.severityField),M?.bodyField&&F.push(M?.bodyField),M?.timeField&&F.push(M?.timeField);const q=new Map;let Q={};H?.length&&E&&(H.forEach(ee=>{Object.keys(ee).forEach(de=>{if(q.has(de)){const he=q.get(de);he&&(he?.active?q.set(de,{percentOfLinesWithLabel:he.percentOfLinesWithLabel+1,active:!0,index:he.index}):q.set(de,{percentOfLinesWithLabel:he.percentOfLinesWithLabel+1,active:!1,index:void 0}))}else q.set(de,{percentOfLinesWithLabel:1,active:!1,index:void 0})})}),Q=Object.fromEntries(q),Object.keys(Q).forEach(ee=>{Q[ee].percentOfLinesWithLabel=vs(Q[ee].percentOfLinesWithLabel,E)})),F.forEach(ee=>{const qe=Q[ee.name]?.active,de=Q[ee.name]?.index;qe&&de!==void 0?Q[ee.name]={percentOfLinesWithLabel:vs(ee.values.filter(he=>he!=null).length,E),active:!0,index:de}:Q[ee.name]={percentOfLinesWithLabel:vs(ee.values.filter(he=>he!=null).length,E),active:!1,index:void 0}}),Q=y(Q),Object.keys(Q).filter(ee=>Q[ee].active).length===0&&(M?.bodyField?.name&&(Q[M.bodyField.name].active=!0),M?.timeField?.name&&(Q[M.timeField.name].active=!0)),M?.bodyField?.name&&M?.timeField?.name&&(Q[M.bodyField.name].type="BODY_FIELD",Q[M.timeField.name].type="TIME_FIELD"),a(Q)},[m,y]);const[S,L]=(0,p.useState)(220),T=e.width-S;if(!i)return null;function v(E){if(i){const M=!i[E]?.active,H=Object.keys(i).filter(q=>i[q]?.active)?.length,F={columnAction:M?"add":"remove",columnCount:M?H+1:H-1,datasourceType:e.datasourceType};(0,z.rR)("grafana_explore_logs_table_column_filter_clicked",F)}}function w(E){(0,z.rR)("grafana_explore_logs_table_text_search_result_count",{resultCount:E,datasourceType:e.datasourceType??"unknown"})}const R=()=>{const E={...i};let M=0;Object.keys(E).forEach(H=>{const F=!!E[H].type;E[H].active=F,E[H].index=F?M++:void 0}),a(E)},A=(E,M)=>{if(E===M)return;const H={...i},F=Object.keys(H).filter(Q=>H[Q].active).map(Q=>({fieldName:Q,index:H[Q].index??0})).sort((Q,He)=>Q.index-He.index),[q]=F.splice(E,1);F.splice(M,0,q),F.forEach((Q,He)=>{H[Q.fieldName].index=He}),a(H),P(H)};function P(E){const M=Object.keys(E).filter(Q=>E[Q]?.active).sort((Q,He)=>{const ee=E[Q],qe=E[He];return ee.index!==void 0&&qe.index!==void 0?ee.index-qe.index:0}),H=Object.assign({},M),F={0:b?.timeField.name??"",1:b?.bodyField.name??""},q={...e.panelState,columns:Object.keys(H).length?H:F,refId:m.refId,visualisationType:"table",labelFieldName:b?.getLabelFieldName()??void 0};n(q)}const k=E=>{if(!i||!(E in i)){console.warn("failed to get column",i);return}const M=Object.keys(i).filter(q=>i[q].active).length,H=i[E].active?void 0:!0;let F;if(H?F={...i,[E]:{...i[E],active:H,index:M}}:F={...i,[E]:{...i[E],active:!1,index:void 0}},v(E),a(F),l){const q=!l[E]?.active;let Q;q?Q={...l,[E]:{...l[E],active:q,index:M}}:Q={...l,[E]:{...l[E],active:!1,index:void 0}},d(Q)}P(F)},W=E=>{const M=E[0];let H={},F=0;M.forEach(q=>{q in i&&(H[q]=i[q],F++)}),d(H),w(F)},O=E=>{kn(Object.keys(i),E,W)},B=E=>{const M=E.currentTarget?.value;c(M),M?O(M):d(void 0)},ie=E=>{s.find(H=>H.refId===E.value)&&C(s.find(H=>H.refId===E.value)??s[0]),e.updatePanelState({refId:E.value,labelFieldName:b?.getLabelFieldName()??void 0})},oe=Ui(e.theme,u,S),ue=(E,M,H)=>{const F=Number(H.style.width.slice(0,-2));isNaN(F)||L(F)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:s.length>1&&(0,t.jsx)("div",{children:(0,t.jsx)(Le.I,{label:"Select query",htmlFor:"explore_logs_table_frame_selector",labelWidth:22,tooltip:"Select a query to visualize in the table.",children:(0,t.jsx)(ke.l6,{inputId:"explore_logs_table_frame_selector","aria-label":"Select query by name",value:m.refId,options:s.map(E=>({label:E.refId,value:E.refId})),onChange:ie})})})}),(0,t.jsxs)("div",{className:oe.wrapper,children:[(0,t.jsx)(Gs,{enable:{right:!0},handleClasses:{right:oe.rzHandle},onResize:ue,children:(0,t.jsxs)("section",{className:oe.sidebar,children:[(0,t.jsx)(Di,{value:g,onChange:B}),(0,t.jsx)(Qi,{reorderColumn:A,toggleColumn:k,filteredColumnsWithMeta:l,columnsWithMeta:i,clear:R})]})}),(0,t.jsx)(mi,{logsFrame:b,onClickFilterLabel:e.onClickFilterLabel,onClickFilterOutLabel:e.onClickFilterOutLabel,logsSortOrder:e.logsSortOrder,range:e.range,splitOpen:e.splitOpen,timeZone:e.timeZone,width:T,dataFrame:m,columnsWithMeta:i,height:u})]})]})}const vs=(e,s)=>Math.ceil(100*e/s);function Ui(e,s,n){return{wrapper:(0,f.css)({display:"flex"}),sidebar:(0,f.css)({height:s,fontSize:e.typography.pxToRem(11),overflowY:"hidden",width:n,paddingRight:e.spacing(3)}),rzHandle:(0,f.css)({background:e.colors.secondary.main,[e.transitions.handleMotion("no-preference","reduce")]:{transition:"0.3s background ease-in-out"},position:"relative",height:"50% !important",width:`${e.spacing(1)} !important`,top:"25% !important",right:`${e.spacing(1)} !important`,cursor:"grab",borderRadius:e.shape.radius.pill,"&:hover":{background:e.colors.secondary.shade}})}}const Mn=()=>Math.max(window.innerHeight-500,500);function bs(e){const[s,n]=(0,p.useState)(!1),o=100,{error:r,title:i,suggestedAction:a,onSuggestedAction:l,onRemove:d,severity:g="warning"}=e,c=r?.message||r?.data?.message||"",u=!s&&c.length>o,x=(0,N.$j)(),m=qi(x);return(0,t.jsx)("div",{className:m.supplementaryErrorContainer,children:(0,t.jsx)(at.F,{title:i,severity:g,onRemove:d,children:(0,t.jsxs)("div",{className:m.suggestedActionWrapper,children:[u?(0,t.jsx)(V.$n,{variant:"secondary",size:"xs",onClick:()=>{n(!0)},children:"Show details"}):c,a&&l&&(0,t.jsx)("div",{className:m.suggestedActionWrapper,children:(0,t.jsx)(V.$n,{variant:"primary",size:"xs",onClick:l,children:a})})]})})})}const qi=e=>({supplementaryErrorContainer:(0,f.css)({width:"50%",minWidth:`${e.breakpoints.values.sm}px`,margin:"0 auto"}),suggestedActionWrapper:(0,f.css)({height:e.spacing(6),button:{position:"absolute",right:e.spacing(2),top:e.spacing(7)}})});var Gi=h(9791);function Ki(e){const{width:s,timeZone:n,splitOpen:o,onUpdateTimeRange:r,onHiddenSeriesChanged:i,allLogsVolumeMaximum:a,toggleLegendRef:l}=e,d=(0,N.$j)(),g=(0,N.of)(Zi),c=parseInt(d.spacing(2).slice(0,-2),10),u=150,x=e.logsVolumeData,m=(0,Te.Dm)(x?.data);let C=m?`${m.name}`:"";(0,Te.e3)(x.data)&&(C=[C,"This datasource does not support full-range histograms. The graph below is based on the logs seen in the response."].filter(ne.identity).join(". "));let y=(0,t.jsx)("span",{children:C});return x.state===me.Gu.Streaming&&(y=(0,t.jsxs)(t.Fragment,{children:[y,(0,t.jsx)(be.m,{content:"Streaming",children:(0,t.jsx)(fe.I,{name:"circle-mono",size:"md",className:g.streaming,"data-testid":"logs-volume-streaming"})})]})),(0,t.jsxs)("div",{style:{height:u},className:g.contentContainer,children:[(0,t.jsx)(Gi.k,{toggleLegendRef:l,vizLegendOverrides:{calcs:["sum"]},graphStyle:"lines",loadingState:x.state??me.Gu.Done,data:x.data,height:u,width:s-c*2,absoluteRange:e.absoluteRange,onChangeTime:r,timeZone:n,splitOpenFn:o,tooltipDisplayMode:Z.$N.Multi,onHiddenSeriesChanged:i,anchorToZero:!0,yAxisMaximum:a,eventBus:e.eventBus,annotations:e.annotations}),y&&(0,t.jsx)("div",{className:g.extraInfoContainer,children:y})]})}const Zi=e=>({extraInfoContainer:(0,f.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: -10px;
      font-size: ${e.typography.bodySmall.fontSize};
      color: ${e.colors.text.secondary};
    `,contentContainer:(0,f.css)`
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    `,streaming:(0,f.css)`
      color: ${e.colors.success.text};
    `});function Yi(e){return!e||!e.error&&!e.errors?!1:(e.error?[e.error]:e.errors||[]).some(n=>(`${n.message||n.data?.message}`?.toLowerCase()).includes("timeout"))}const Ji=({logsVolumeData:e,absoluteRange:s,onUpdateTimeRange:n,width:o,onLoadLogsVolume:r,onHiddenSeriesChanged:i,eventBus:a,splitOpen:l,timeZone:d,onClose:g,toggleLegendRef:c})=>{const{logVolumes:u,maximumValue:x,maximumRange:m,annotations:C}=(0,p.useMemo)(()=>{let v=-1/0;const w=e?.data.filter(O=>O.meta?.dataTopic!==Z.QR.Annotations),R=e?.data.filter(O=>O.meta?.dataTopic===Z.QR.Annotations)||[],A=(0,ne.sortBy)(w||[],"meta.custom.datasourceName"),P=(0,ne.groupBy)(A,"meta.custom.datasourceName"),k=(0,ne.mapValues)(P,O=>{const B=(0,Te.oT)(O);return v=Math.max(v,B.maximum),B.dataFrames}),W=(0,Te.Dx)((0,ne.flatten)(Object.values(k)));return{maximumValue:v,maximumRange:W,logVolumes:k,annotations:R}},[e]),y=(0,N.of)(Xi),b=Object.keys(u).length,S=Object.values(u).some(v=>{const w=_i(v,s);return!(0,Te.e3)(v)&&w&&w<1}),L=Yi(e),T={from:Math.max(s.from,m.from),to:Math.min(s.to,m.to)};return e?.state===me.Gu.Loading?(0,t.jsx)("span",{children:"Loading..."}):L?(0,t.jsx)(bs,{title:"The logs volume query has timed out",severity:"info",suggestedAction:"Retry",onSuggestedAction:r,onRemove:g}):e?.error!==void 0?(0,t.jsx)(bs,{error:e.error,title:"Failed to load log volume for this query"}):b===0?(0,t.jsx)("div",{className:y.alertContainer,children:(0,t.jsx)(at.F,{severity:"info",title:"No logs volume available",children:"No volume information available for the current queries and time range."})}):(0,t.jsxs)("div",{className:y.listContainer,children:[Object.keys(u).map((v,w)=>{const R={data:u[v]};return(0,t.jsx)(Ki,{toggleLegendRef:c,absoluteRange:T,allLogsVolumeMaximum:x,width:o,logsVolumeData:R,onUpdateTimeRange:n,timeZone:d,splitOpen:l,onLoadLogsVolume:r,onHiddenSeriesChanged:b>1?()=>{}:i,eventBus:a,annotations:C},w)}),S&&(0,t.jsx)("div",{className:y.extraInfoContainer,children:(0,t.jsx)(Le.I,{label:"Reload log volume",transparent:!0,children:(0,t.jsx)(V.$n,{size:"xs",icon:"sync",variant:"secondary",onClick:r,id:"reload-volume"})})})]})},Xi=e=>({listContainer:(0,f.css)`
      padding-top: 10px;
    `,extraInfoContainer:(0,f.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: 5px;
    `,oldInfoText:(0,f.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      color: ${e.colors.text.secondary};
    `,alertContainer:(0,f.css)`
      width: 50%;
      min-width: ${e.breakpoints.values.sm}px;
      margin: 0 auto;
    `});function _i(e,s){const n=e&&e[0]&&e[0].meta?.custom?.absoluteRange;return n?(s.from-s.to)/(n.from-n.to):void 0}var le=h(97186);const ea=[Z.fY.none,Z.fY.exact,Z.fY.numbers,Z.fY.signature],Ss=()=>{const e=ae.A.get(le.r);return e==="table"?"table":e==="logs"?"logs":U.$.featureToggles.logsExploreTableDefaultVisualization?"table":"logs"},Ut=10,Cs="Pinned log",zn="Pin to content outline",st="Logs",ta=e=>{const{width:s,splitOpen:n,logRows:o,logsMeta:r,logsVolumeEnabled:i,logsVolumeData:a,loadLogsVolumeData:l,loading:d=!1,onClickFilterLabel:g,onClickFilterOutLabel:c,timeZone:u,scanning:x,scanRange:m,showContextToggle:C,absoluteRange:y,onChangeTime:b,getFieldLinks:S,theme:L,logsQueries:T,clearCache:v,addResultsToCache:w,exploreId:R,getRowContext:A,getLogRowContextUi:P,getRowContextQuery:k,loadMoreLogs:W,panelState:O,eventBus:B}=e,[ie,oe]=(0,p.useState)(ae.A.getBool(le.$.showLabels,!1)),[ue,E]=(0,p.useState)(ae.A.getBool(le.$.showTime,!0)),[M,H]=(0,p.useState)(ae.A.getBool(le.$.wrapLogMessage,!0)),[F,q]=(0,p.useState)(ae.A.getBool(le.$.prettifyLogMessage,!1)),[Q,He]=(0,p.useState)(Z.fY.none),[ee,qe]=(0,p.useState)([]),[de,he]=(0,p.useState)(ae.A.get(le.$.logsSortOrder)||Z.uH.Descending),[Rc,to]=(0,p.useState)(!1),[$e,Os]=(0,p.useState)([]),[Zt,Tc]=(0,p.useState)(!1),[Lc,so]=(0,p.useState)(!1),[Ge,no]=(0,p.useState)(void 0),[Ic,oo]=(0,p.useState)(zn),[Ee,ro]=(0,p.useState)(O?.logs?.visualisationType??Ss()),[Ec,Oc]=(0,p.useState)(void 0),Ne=(0,p.useRef)(void 0),vt=(0,D.useDispatch)(),io=(0,Kr.A)(d),Fc=B.newScopedBus("logsvolume",{onlyLocal:!1}),{register:Yt,unregister:ao,outlineItems:bt,updateItem:lo,unregisterAllChildren:Fs}=is()??{},Ds=(0,p.useRef)(void 0),As=(0,p.useRef)(void 0),Ns=(0,p.useRef)(()=>{}),Jt=(0,p.useRef)(null),Dc=Mn(),X=na(L,M,Dc),Ps=o&&o.length>0,Ac=m?`Scanning ${ut.describeTimeRange(m)}`:"Scanning...",co=bt?.find(I=>I.panelId===st&&I.level==="root")?.children?.filter(I=>I.title===Cs).map(I=>I.id),Xt=(0,p.useCallback)(()=>bt?.find($=>$.panelId===st&&$.level==="root")?.children?.filter($=>$.title===Cs).length??0,[bt]),uo=(0,p.useCallback)(()=>{const I=Object.keys(et.cZ),$=new Set(a?.data),G=a?.data.filter(ge=>ge.meta?.dataTopic!==Z.QR.Annotations),Oe=(0,ne.groupBy)(G,"meta.custom.datasourceName"),ve=Object.keys(Oe).length;Fs&&Fs(ge=>ge?.find(_t=>_t.panelId===st&&_t.level==="root")?.id,"filter");const mo=[];$.forEach(ge=>{const{level:Ke}=(0,Te.tX)(ge);mo.push({levelStr:Ke,logLevel:(0,Te.XM)(Ke)})});const rd=mo.sort((ge,Ke)=>I.indexOf(ge.logLevel.toString())>I.indexOf(Ke.logLevel.toString())?1:-1),yo=new Set(rd);yo.size>1&&i&&ve===1&&yo.forEach(ge=>{const Ke=ee.length===0,_t=!ee.find(zs=>zs===ge.levelStr);Yt&&Yt({title:ge.levelStr,icon:"gf-logs",panelId:st,level:"child",type:"filter",highlight:_t&&!Ke,onClick:zs=>{Ns.current?.(ge.levelStr,(0,Yr.W)(zs)),ci(ge)},ref:null,color:et.cZ[ge.logLevel]})})},[a?.data,Fs,i,ee,Yt,Ns]);(0,p.useEffect)(()=>{Xt()===Ut?oo((0,t.jsxs)("span",{style:{display:"flex",textAlign:"center"},children:["\u2757\uFE0F",(0,t.jsxs)(j.x6,{i18nKey:"explore.logs.maximum-pinned-logs",children:["Maximum of ",{PINNED_LOGS_LIMIT:Ut}," pinned logs reached. Unpin a log to add another."]})]})):oo(zn)},[bt,Xt]),(0,p.useEffect)(()=>{d&&!io&&O?.logs?.id&&(delete O.logs.id,vt((0,Fe.EA)(R,"logs",{...O})))},[vt,R,d,O,io]),(0,p.useEffect)(()=>{const I=O?.logs?.visualisationType??Ss();ro(I),ae.A.set(le.r,I)},[O?.logs?.visualisationType]),(0,p.useEffect)(()=>{uo()},[a?.data,ee,uo]),(0,ts.A)(()=>{Ds&&window.clearTimeout(Ds.current),As&&window.clearTimeout(As.current)}),(0,ts.A)(()=>{(O?.logs?.columns||O?.logs?.refId||O?.logs?.labelFieldName)&&vt((0,Fe.EA)(R,"logs",{...O?.logs,columns:void 0,visualisationType:Ee,labelFieldName:void 0,refId:void 0}))});const ks=(0,p.useCallback)(I=>{const $=(0,tt.Gu)().explore.panes[R];$?.panelsState&&vt((0,Fe.EA)(R,"logs",{...$.panelsState.logs,columns:I.columns??O?.logs?.columns,visualisationType:I.visualisationType??Ee,labelFieldName:I.labelFieldName,refId:I.refId??O?.logs?.refId}))},[vt,R,O?.logs?.columns,O?.logs?.refId,Ee]),Nc=(0,p.useCallback)(I=>{I?e.eventBus.publish(new hn.b_({point:{time:I.timeEpochMs}})):e.eventBus.publish(new hn.ql)},[e.eventBus]),Pc=(0,p.useCallback)(I=>{Ne.current=I,Oc(()=>$=>{if(U.$.featureToggles.logsInfiniteScrolling){Ne.current&&(Jt.current?.scrollIntoView(),Ne.current.scroll({behavior:"smooth",top:Ne.current.scrollTop+$.getBoundingClientRect().top-window.innerHeight/2}));return}const G=e.scrollElement;G&&G.scroll({behavior:"smooth",top:G.scrollTop+$.getBoundingClientRect().top-window.innerHeight/2})})},[e.scrollElement]),kc=()=>{to(!0),Ds.current=window.setTimeout(()=>{const I=de===Z.uH.Descending?Z.uH.Ascending:Z.uH.Descending;ae.A.set(le.$.logsSortOrder,I),he(I)},0),As.current=window.setTimeout(()=>to(!1),1e3)},Mc=(0,p.useCallback)(()=>{Tc(!Zt)},[Zt]),zc=(0,p.useCallback)(I=>{ro(I);const $={...O?.logs,visualisationType:I};ks($),(0,z.rR)("grafana_explore_logs_visualisation_changed",{newVisualizationType:I,datasourceType:e.datasourceType??"unknown",defaultVisualisationType:U.$.featureToggles.logsExploreTableDefaultVisualization?"table":"logs"})},[O?.logs,e.datasourceType,ks]),Hc=(0,p.useCallback)(I=>{(0,z.rR)("grafana_explore_logs_deduplication_clicked",{deduplicationType:I,datasourceType:e.datasourceType}),He(I)},[e.datasourceType]),$c=(0,p.useCallback)(I=>{const{target:$}=I;if($){const G=$.checked;oe(G),ae.A.set(le.$.showLabels,G)}},[]),Bc=(0,p.useCallback)(I=>{const{target:$}=I;if($){const G=$.checked;E(G),ae.A.set(le.$.showTime,G)}},[]),Qc=(0,p.useCallback)(I=>{const{target:$}=I;if($){const G=$.checked;H(G),ae.A.set(le.$.wrapLogMessage,G)}},[]),Wc=(0,p.useCallback)(I=>{const{target:$}=I;if($){const G=$.checked;q(G),ae.A.set(le.$.prettifyLogMessage,G)}},[]),Vc=(0,p.useCallback)(I=>{const $=I.map(G=>(0,Te.EK)(G));qe($)},[]),po=(0,p.useCallback)(I=>{e.onSetLogsVolumeEnabled(!I),(0,z.rR)("grafana_explore_logs_histogram_toggle_clicked",{datasourceType:e.datasourceType,type:I?"close":"open"})},[e]),Uc=(0,p.useCallback)(I=>{I.preventDefault(),e.onStartScanning&&(e.onStartScanning(),(0,z.rR)("grafana_explore_logs_scanning_button_clicked",{type:"start",datasourceType:e.datasourceType}))},[e]),qc=(0,p.useCallback)(I=>{I.preventDefault(),e.onStopScanning&&e.onStopScanning()},[e]),Gc=(0,p.useCallback)(I=>{$e.indexOf(I)===-1&&Os($e.concat(I))},[$e]),Kc=(0,p.useCallback)(I=>{$e.indexOf(I)>-1&&Os($e.filter(G=>I!==G))},[$e]),Zc=(0,p.useCallback)(()=>{Os([])},[]),Ms=(0,p.useRef)(()=>{});let Yc=(0,p.useCallback)(()=>{so(!1),no(void 0),(0,z.rR)("grafana_explore_logs_log_context_closed",{datasourceType:Ge?.datasourceType,logRowUid:Ge?.uid}),Ms?.current()},[Ge?.datasourceType,Ge?.uid,Ms]);const ho=(I,$)=>{so(!0),no(I),(0,z.rR)("grafana_explore_logs_log_context_opened",{datasourceType:I.datasourceType,logRowUid:I.uid}),Ms.current=$},go=(0,p.useCallback)((I,$)=>{for(let G=$.indexOf(I)-1;G>=0;G--)if($[G].timeEpochMs>I.timeEpochMs)return $[G];return null},[]),Jc=(0,p.useCallback)(I=>{const $={from:new Date(y.from).toISOString(),to:new Date(y.to).toISOString()};if(!U.$.featureToggles.logsInfiniteScrolling)return $;const G=o.filter(ve=>ve.dataFrame.refId===I.dataFrame.refId),Oe=go(I,G);return I.timeEpochMs>y.to&&!Oe?{from:new Date(y.from).toISOString(),to:new Date(I.timeEpochMs+1).toISOString()}:{from:new Date(y.from).toISOString(),to:new Date(Oe?Oe.timeEpochMs:y.to).toISOString()}},[y.from,y.to,go,o]),Xc=async I=>{if(I.rowId===void 0)return;const $=(0,Sn.m)((0,tt.Gu)().explore.panes[R]);$.panelsState={...O,logs:{id:I.uid,visualisationType:Ee??Ss()}},$.range=Jc(I);const G=(0,gn.Pp)($),Oe=/.*(?=\/explore)/.exec(`${window.location.href}`)[0],ve=gn.kM.renderUrl(`${Oe}/explore`,{left:G});await(0,hs.VP)(ve),(0,z.rR)("grafana_explore_logs_permalink_clicked",{datasourceType:I.datasourceType??"unknown",logRowUid:I.uid,logRowLevel:I.logLevel})},_c=(0,p.useCallback)(()=>{U.$.featureToggles.logsInfiniteScrolling&&Ne.current&&Ne.current.scroll({behavior:"auto",top:0}),Jt.current?.scrollIntoView()},[Ne,Jt]),fo=(I,$=!0)=>{if(Xt()===Ut&&!$){ii();return}const G=bt?.find(ve=>ve.panelId===st&&ve.level==="root");G&&lo&&lo(G.id,{expanded:!0});const Oe=co?.find(ve=>ve===I.rowId);Oe&&I.rowId&&$?(ao?.(I.rowId),ri()):Xt()!==Ut&&!Oe&&(Yt?.({id:I.rowId,icon:"gf-logs",title:Cs,panelId:st,level:"child",ref:null,color:et.cZ[I.logLevel],childOnTop:!0,onClick:()=>{ho(I,()=>{}),ai()},onRemove:ve=>{ao?.(ve),li()}}),oi()),e.onPinLineCallback?.()},ed=oa(o),td=ia(o,ee),{dedupedRows:sd,dedupCount:nd}=ra(td,Q),od=aa(o);return(0,t.jsxs)(t.Fragment,{children:[A&&Ge&&(0,t.jsx)(ni.V,{open:Lc,row:Ge,onClose:Yc,getRowContext:(I,$)=>A(I,Ge,$),getRowContextQuery:k,getLogRowContextUi:P,logsSortOrder:de,timeZone:u}),(0,t.jsx)(De.NR,{title:"Logs volume",collapsible:!0,collapsed:!i,onToggleCollapse:po,children:i&&(0,t.jsx)(Ji,{toggleLegendRef:Ns,absoluteRange:y,width:s,logsVolumeData:a,onUpdateTimeRange:b,timeZone:u,splitOpen:n,onLoadLogsVolume:l,onHiddenSeriesChanged:Vc,eventBus:Fc,onClose:()=>po(!0)})}),(0,t.jsxs)(De.NR,{titleItems:[U.$.featureToggles.logsExploreTableVisualisation?Ee==="logs"?null:(0,t.jsx)(De.NR.TitleItem,{title:"Feedback",children:(0,t.jsx)(di,{feedbackUrl:"https://forms.gle/5YyKdRQJ5hzq4c289"})},"A"):null],title:"Logs",actions:(0,t.jsx)(t.Fragment,{children:U.$.featureToggles.logsExploreTableVisualisation&&(0,t.jsx)("div",{className:X.visualisationType,children:(0,t.jsx)(pt.z,{className:X.visualisationTypeRadio,options:[{label:"Logs",value:"logs",description:"Show results in logs visualisation"},{label:"Table",value:"table",description:"Show results in table visualisation"}],size:"sm",value:Ee,onChange:zc})})}),loadingState:d?me.Gu.Loading:me.Gu.Done,children:[(0,t.jsxs)("div",{className:X.stickyNavigation,children:[Ee!=="table"&&(0,t.jsxs)("div",{className:X.logOptions,children:[(0,t.jsxs)(Zr.C,{children:[(0,t.jsx)(Le.I,{label:"Time",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Me.K,{value:ue,onChange:Bc,className:X.horizontalInlineSwitch,transparent:!0,id:`show-time_${R}`})}),(0,t.jsx)(Le.I,{label:"Unique labels",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Me.K,{value:ie,onChange:$c,className:X.horizontalInlineSwitch,transparent:!0,id:`unique-labels_${R}`})}),(0,t.jsx)(Le.I,{label:"Wrap lines",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Me.K,{value:M,onChange:Qc,className:X.horizontalInlineSwitch,transparent:!0,id:`wrap-lines_${R}`})}),(0,t.jsx)(Le.I,{label:"Prettify JSON",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(Me.K,{value:F,onChange:Wc,className:X.horizontalInlineSwitch,transparent:!0,id:`prettify_${R}`})}),(0,t.jsx)(Le.I,{label:"Deduplication",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(pt.z,{options:ea.map(I=>({label:(0,ne.capitalize)(I),value:I,description:_._C[I]})),value:Q,onChange:Hc,className:X.radioButtons})})]}),(0,t.jsx)("div",{children:(0,t.jsx)(Le.I,{label:"Display results",className:X.horizontalInlineLabel,transparent:!0,disabled:Rc||d,children:(0,t.jsx)(pt.z,{options:[{label:"Newest first",value:Z.uH.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:Z.uH.Ascending,description:"Show results oldest to newest"}],value:de,onChange:kc,className:X.radioButtons})})})]}),(0,t.jsx)("div",{ref:Jt}),(0,t.jsx)(On,{logRows:o,meta:r||[],dedupStrategy:Q,dedupCount:nd,hasUnescapedContent:ed,forceEscape:Zt,displayedFields:$e,onEscapeNewlines:Mc,clearDetectedFields:Zc})]}),(0,t.jsxs)("div",{className:(0,f.cx)(X.logsSection,Ee==="table"?X.logsTable:void 0),children:[Ee==="table"&&Ps&&(0,t.jsx)("div",{className:X.logRows,"data-testid":"logRowsTable",children:(0,t.jsx)(Vi,{logsSortOrder:de,range:e.range,splitOpen:n,timeZone:u,width:s-80,logsFrames:e.logsFrames??[],onClickFilterLabel:g,onClickFilterOutLabel:c,panelState:O?.logs,theme:L,updatePanelState:ks,datasourceType:e.datasourceType})}),Ee==="logs"&&Ps&&(0,t.jsx)("div",{className:U.$.featureToggles.logsInfiniteScrolling?X.scrollableLogRows:X.logRows,"data-testid":"logRows",ref:Pc,children:(0,t.jsx)(Jr,{loading:d,loadMoreLogs:W,range:e.range,timeZone:u,rows:o,scrollElement:Ne.current,sortOrder:de,children:(0,t.jsx)(bn.k,{pinnedLogs:co,logRows:o,deduplicatedRows:sd,dedupStrategy:Q,onClickFilterLabel:g,onClickFilterOutLabel:c,showContextToggle:C,getRowContextQuery:k,showLabels:ie,showTime:ue,enableLogDetails:!0,forceEscape:Zt,wrapLogMessage:M,prettifyLogMessage:F,timeZone:u,getFieldLinks:S,logsSortOrder:de,displayedFields:$e,onClickShowField:Gc,onClickHideField:Kc,app:ct.Jk.Explore,onLogRowHover:Nc,onOpenContext:ho,onPermalinkClick:Xc,permalinkedRowId:O?.logs?.id,scrollIntoView:Ec,isFilterLabelActive:e.isFilterLabelActive,containerRendered:!!Ne,onClickFilterString:e.onClickFilterString,onClickFilterOutString:e.onClickFilterOutString,onUnpinLine:fo,onPinLine:fo,pinLineButtonTooltipTitle:Ic})})}),!d&&!Ps&&!x&&(0,t.jsx)("div",{className:X.logRows,children:(0,t.jsxs)("div",{className:X.noData,children:[(0,t.jsx)(j.x6,{i18nKey:"explore.logs.no-logs-found",children:"No logs found."}),(0,t.jsx)(V.$n,{size:"sm",variant:"secondary",onClick:Uc,children:(0,t.jsx)(j.x6,{i18nKey:"explore.logs.scan-for-older-logs",children:"Scan for older logs"})})]})}),x&&(0,t.jsx)("div",{className:X.logRows,children:(0,t.jsxs)("div",{className:X.noData,children:[(0,t.jsx)("span",{children:Ac}),(0,t.jsx)(V.$n,{size:"sm",variant:"secondary",onClick:qc,children:(0,t.jsx)(j.x6,{i18nKey:"explore.logs.stop-scan",children:"Stop scan"})})]})}),(0,t.jsx)(Ei,{logsSortOrder:de,visibleRange:od??y,absoluteRange:y,timeZone:u,onChangeTime:b,loading:d,queries:T??[],scrollToTopLogs:_c,addResultsToCache:w,clearCache:v})]})]})]})},sa=(0,N.cV)(ta),na=(e,s,n)=>({noData:(0,f.css)({"& > *":{marginLeft:"0.5em"}}),logOptions:(0,f.css)({display:"flex",justifyContent:"space-between",alignItems:"baseline",flexWrap:"wrap",backgroundColor:e.colors.background.primary,padding:`${e.spacing(1)} ${e.spacing(2)}`,borderRadius:e.shape.radius.default,margin:`${e.spacing(0,0,1)}`,border:`1px solid ${e.colors.border.medium}`}),headerButton:(0,f.css)({margin:`${e.spacing(.5,0,0,1)}`}),horizontalInlineLabel:(0,f.css)({"& > label":{marginRight:"0"}}),horizontalInlineSwitch:(0,f.css)({padding:`0 ${e.spacing(1)} 0 0`}),radioButtons:(0,f.css)({margin:"0"}),logsSection:(0,f.css)({display:"flex",flexDirection:"row",justifyContent:"space-between"}),logsTable:(0,f.css)({maxHeight:`${n}px`}),scrollableLogRows:(0,f.css)({overflowY:"scroll",width:"100%",maxHeight:"75vh"}),logRows:(0,f.css)({overflowX:`${s?"unset":"scroll"}`,overflowY:"visible",width:"100%"}),visualisationType:(0,f.css)({display:"flex",flex:"1",justifyContent:"space-between"}),visualisationTypeRadio:(0,f.css)({margin:`0 0 0 ${e.spacing(1)}`}),stickyNavigation:(0,f.css)({overflow:"visible",...U.$.featureToggles.logsInfiniteScrolling&&{marginBottom:"0px"}})}),oa=(0,dt.A)(e=>e.some(s=>s.hasUnescapedContent)),ra=(0,dt.A)((e,s)=>{const n=(0,et.M0)(e,s),o=n.reduce((r,i)=>i.duplicates?r+i.duplicates:r,0);return{dedupedRows:n,dedupCount:o}}),ia=(0,dt.A)((e,s)=>(0,et.ct)(e,new Set(s))),aa=(0,dt.A)(e=>{if(!e||e.length===0)return;const s=e[0].timeEpochMs,n=e[e.length-1].timeEpochMs;return n<s?{from:n,to:s}:{from:s,to:n}}),js=500,ws=100,la=(0,dt.A)(()=>({logsEnter:(0,f.css)`
      label: logsEnter;
      position: absolute;
      opacity: 0;
      height: auto;
      width: 100%;
    `,logsEnterActive:(0,f.css)`
      label: logsEnterActive;
      opacity: 1;
      transition: opacity ${js}ms ease-out ${ws}ms;
    `,logsExit:(0,f.css)`
      label: logsExit;
      position: absolute;
      opacity: 1;
      height: auto;
      width: 100%;
    `,logsExitActive:(0,f.css)`
      label: logsExitActive;
      opacity: 0;
      transition: opacity ${js}ms ease-out ${ws}ms;
    `}));function Hn(e){const{visible:s,children:n}=e,o=(0,p.useRef)(null),r=la();return(0,t.jsx)(ln.A,{in:s,mountOnEnter:!0,unmountOnExit:!0,timeout:js+ws,classNames:{enter:r.logsEnter,enterActive:r.logsEnterActive,exit:r.logsExit,exitActive:r.logsExitActive},nodeRef:o,children:(0,t.jsx)("div",{ref:o,children:n})})}class ca extends p.PureComponent{constructor(){super(...arguments),this.state={dsInstances:{}},this.onChangeTime=s=>{const{exploreId:n,updateTimeRange:o}=this.props;o({exploreId:n,absoluteRange:s})},this.loadMoreLogs=s=>{const{exploreId:n,loadMoreLogs:o}=this.props;o({exploreId:n,absoluteRange:s})},this.getLogRowContext=async(s,n,o)=>{const{logsQueries:r}=this.props;if(!n.dataFrame.refId||!this.state.dsInstances[n.dataFrame.refId])return Promise.resolve([]);const i=this.state.dsInstances[n.dataFrame.refId];if(!(0,_.Ol)(i))return Promise.resolve([]);const a=this.getQuery(r,n,i);return a?i.getLogRowContext(s,o,a):Promise.resolve([])},this.getLogRowContextQuery=async(s,n,o=!0)=>{const{logsQueries:r}=this.props;if(!s.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId])return Promise.resolve(null);const i=this.state.dsInstances[s.dataFrame.refId];if(!(0,_.Ol)(i))return Promise.resolve(null);const a=this.getQuery(r,s,i);return a&&i.getLogRowContextQuery?i.getLogRowContextQuery(s,n,a,o):Promise.resolve(null)},this.getLogRowContextUi=(s,n)=>{const{logsQueries:o}=this.props;if(!s.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId])return(0,t.jsx)(t.Fragment,{});const r=this.state.dsInstances[s.dataFrame.refId];if(!(0,_.Ol)(r))return(0,t.jsx)(t.Fragment,{});const i=this.getQuery(o,s,r);return i&&(0,_.wj)(r)&&r.getLogRowContextUi?r.getLogRowContextUi(s,n,i):(0,t.jsx)(t.Fragment,{})},this.showContextToggle=s=>!s?.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId]?!1:(0,_.Ol)(this.state.dsInstances[s.dataFrame.refId]),this.getFieldLinks=(s,n,o)=>{const{splitOpenFn:r,range:i}=this.props;return(0,Ue.QL)({field:s,rowIndex:n,splitOpenFn:r,range:i,dataFrame:o})},this.logDetailsFilterAvailable=()=>Object.values(this.state.dsInstances).some(s=>s?.modifyQuery||(0,_._0)(s)||(0,_.FP)(s)),this.filterValueAvailable=()=>Object.values(this.state.dsInstances).some(s=>(0,_._0)(s)&&s?.getSupportedQueryModifications().includes("ADD_STRING_FILTER")),this.filterOutValueAvailable=()=>Object.values(this.state.dsInstances).some(s=>(0,_._0)(s)&&s?.getSupportedQueryModifications().includes("ADD_STRING_FILTER_OUT")),this.addResultsToCache=()=>{this.props.addResultsToCache(this.props.exploreId)},this.clearCache=()=>{this.props.clearCache(this.props.exploreId)}}componentDidMount(){this.updateDataSourceInstances()}componentDidUpdate(s){s.logsQueries!==this.props.logsQueries&&this.updateDataSourceInstances()}updateDataSourceInstances(){const{logsQueries:s,datasourceInstance:n}=this.props;if(!s||!n)return;const o={};if(n.uid!==wt.uv){s.forEach(({refId:i})=>{o[i]=n}),this.setState({dsInstances:o});return}const r=[];for(const i of s){if(!i.datasource)continue;(!o[i.refId]||o[i.refId].uid!==i.datasource.uid)&&r.push(new Promise(l=>{(0,Pe.l)().get(i.datasource).then(d=>{l({ds:d,refId:i.refId})})}))}r.length&&Promise.all(r).then(i=>{i.forEach(({ds:a,refId:l})=>{o[l]=a}),this.setState({dsInstances:o})})}getQuery(s,n,o){return(s??[]).find(r=>r.refId===n.dataFrame.refId&&r.datasource!=null&&r.datasource.type===o.type)}render(){const{loading:s,loadingState:n,logRows:o,logsMeta:r,logsSeries:i,logsQueries:a,loadSupplementaryQueryData:l,setSupplementaryQueryEnabled:d,onClickFilterLabel:g,onClickFilterOutLabel:c,onStartScanning:u,onStopScanning:x,absoluteRange:m,timeZone:C,visibleRange:y,scanning:b,range:S,width:L,splitOpenFn:T,isLive:v,exploreId:w,logsVolume:R,scrollElement:A,onPinLineCallback:P}=this.props;return o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Hn,{visible:v,children:(0,t.jsx)(Mt.S,{label:"Logs",loading:!1,isOpen:!0,children:(0,t.jsx)(dn,{exploreId:w,children:k=>(0,t.jsx)(Gr,{logRows:o,timeZone:C,stopLive:k.stop,isPaused:this.props.isPaused,onPause:k.pause,onResume:k.resume,onClear:k.clear,clearedAtIndex:this.props.clearedAtIndex})})})}),(0,t.jsx)(Hn,{visible:!v,children:(0,t.jsx)(sa,{exploreId:w,datasourceType:this.props.datasourceInstance?.type,logRows:o,logsMeta:r,logsSeries:i,logsVolumeEnabled:R.enabled,onSetLogsVolumeEnabled:k=>d(w,k,_.cF.LogsVolume),logsVolumeData:R.data,logsQueries:a,width:L,splitOpen:T,loading:s,loadingState:n,loadLogsVolumeData:()=>l(w,_.cF.LogsVolume),onChangeTime:this.onChangeTime,loadMoreLogs:this.loadMoreLogs,onClickFilterLabel:this.logDetailsFilterAvailable()?g:void 0,onClickFilterOutLabel:this.logDetailsFilterAvailable()?c:void 0,onStartScanning:u,onStopScanning:x,absoluteRange:m,visibleRange:y,timeZone:C,scanning:b,scanRange:S.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getRowContextQuery:this.getLogRowContextQuery,getLogRowContextUi:this.getLogRowContextUi,getFieldLinks:this.getFieldLinks,addResultsToCache:this.addResultsToCache,clearCache:this.clearCache,eventBus:this.props.eventBus,panelState:this.props.panelState,logsFrames:this.props.logsFrames,scrollElement:A,isFilterLabelActive:this.logDetailsFilterAvailable()?this.props.isFilterLabelActive:void 0,range:S,onPinLineCallback:P,onClickFilterString:this.filterValueAvailable()?this.props.onClickFilterString:void 0,onClickFilterOutString:this.filterOutValueAvailable()?this.props.onClickFilterOutString:void 0})})]}):null}}function da(e,{exploreId:s}){const o=e.explore.panes[s],{logsResult:r,scanning:i,datasourceInstance:a,isLive:l,isPaused:d,clearedAtIndex:g,range:c,absoluteRange:u,supplementaryQueries:x}=o,m=(0,K.h1)(s)(e),C=o.panelsState,y=(0,Dt.O)(e.user),b=x[_.cF.LogsVolume];return{loading:m,logRows:r?.rows,logsMeta:r?.meta,logsSeries:r?.series,logsQueries:r?.queries,visibleRange:r?.visibleRange,scanning:i,timeZone:y,datasourceInstance:a,isLive:l,isPaused:d,clearedAtIndex:g,range:c,absoluteRange:u,logsVolume:b,panelState:C,logsFrames:o.queryResponse.logsFrames}}const ua={updateTimeRange:xe.GH,loadMoreLogs:xe.zY,addResultsToCache:K.He,clearCache:K.IL,loadSupplementaryQueryData:K.Az,setSupplementaryQueryEnabled:K.TO},pa=(0,Se.connect)(da,ua)(ca);function ha(e){const{queryResponse:s,timeZone:n,enabled:o,setLogsSampleEnabled:r,datasourceInstance:i,queries:a,splitOpen:l}=e,d=(0,N.of)(ga),g=x=>{r(x),(0,z.rR)("grafana_explore_logs_sample_toggle_clicked",{datasourceType:i?.type??"unknown",type:x?"open":"close"})},c=()=>{if(!i||!(0,_.Nc)(i,_.cF.LogsSample))return null;const x=a.map(C=>i.getSupplementaryQuery({type:_.cF.LogsSample},C)).filter(C=>!!C);if(!x.length)return null;const m=()=>{l({queries:x,datasourceUid:i.uid}),(0,z.rR)("grafana_explore_logs_sample_split_button_clicked",{datasourceType:i?.type??"unknown",queriesCount:x.length})};return(0,t.jsx)(V.$n,{size:"sm",className:d.logSamplesButton,onClick:m,children:"Open logs in split view"})};let u;if(s===void 0)u=null;else if(s.error!==void 0)u=(0,t.jsx)(bs,{error:s.error,title:"Failed to load logs sample for this query"});else if(s.state===me.Gu.Loading)u=(0,t.jsx)("span",{children:"Logs sample is loading..."});else if(s.data.length===0||s.data.every(x=>x.length===0))u=(0,t.jsx)("span",{children:"No logs sample data."});else{const x=(0,et.HT)(s.data);u=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c,{}),(0,t.jsx)("div",{className:d.logContainer,children:(0,t.jsx)(bn.k,{logRows:x.rows,dedupStrategy:Z.fY.none,showLabels:ae.A.getBool(le.$.showLabels,!1),showTime:ae.A.getBool(le.$.showTime,!0),wrapLogMessage:ae.A.getBool(le.$.wrapLogMessage,!0),prettifyLogMessage:ae.A.getBool(le.$.prettifyLogMessage,!1),timeZone:n,enableLogDetails:!0})})]})}return s?.state!==me.Gu.NotStarted?(0,t.jsx)(Mt.S,{label:(0,t.jsxs)("div",{children:["Logs sample",(0,t.jsx)(be.m,{content:"Show log lines that contributed to visualized metrics",children:(0,t.jsx)(fe.I,{name:"info-circle",className:d.infoTooltip})})]}),isOpen:o,collapsible:!0,onToggle:g,children:u}):null}const ga=e=>({logSamplesButton:(0,f.css)`
      position: absolute;
      top: ${e.spacing(1)};
      right: ${e.spacing(1)};
    `,logContainer:(0,f.css)`
      overflow: scroll;
    `,infoTooltip:(0,f.css)`
      margin-left: ${e.spacing(1)};
    `}),fa=()=>{const e=(0,N.of)(ma);return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(rs._,{"data-testid":"explore-no-data",className:e.wrapper,children:(0,t.jsx)("span",{className:e.message,children:"No data"})})})},ma=e=>({wrapper:(0,f.css)({label:"no-data-card",padding:e.spacing(3),background:e.colors.background.primary,borderRadius:e.shape.radius.default,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1}),message:(0,f.css)({fontSize:e.typography.h2.fontSize,padding:e.spacing(4),color:e.colors.text.disabled})});var ya=h(76442);function xa(e){return(0,f.css)({maxWidth:`${e.breakpoints.values.lg}px`,marginTop:e.spacing(2),alignSelf:"center"})}const va=()=>{const e=(0,N.of)(xa),s=ps.TP.hasPermission(D.AccessControlAction.DataSourcesCreate)&&ps.TP.hasPermission(D.AccessControlAction.DataSourcesWrite),n="Explore requires at least one data source. Once you have added a data source, you can query it here.",o=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(fe.I,{name:"rocket"}),(0,t.jsx)(t.Fragment,{children:" ProTip: You can also define data sources through configuration files. "}),(0,t.jsx)("a",{href:"http://docs.grafana.org/administration/provisioning/?utm_source=explore#data-sources",target:"_blank",rel:"noreferrer",className:"text-link",children:"Learn more"})]}),r=(0,t.jsx)(V.z9,{size:"lg",href:"datasources/new",icon:"database",disabled:!s,children:"Add data source"});return(0,t.jsx)(ya.c,{callToActionElement:r,className:e,footer:o,message:n})};var Rs=h(52908),ba=h(95511),Sa=h(94382);const Ca=e=>({warningText:(0,f.css)`
    label: warningText;
    display: flex;
    align-items: center;
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
  `});function ja(e){const{dataFrames:s,range:n,splitOpenFn:o,withTraceView:r,datasourceType:i}=e,a=(0,Ue.JQ)(n,o),l=(0,N.$j)(),d=(0,N.of)(Ca),g=(0,Vt.we)({fieldConfig:{defaults:{},overrides:[]},data:s,replaceVariables:v=>v,theme:l}),{nodes:c}=(0,Sa.d)(g),[u,x]=(0,Ys.A)(!0),m=()=>{x(),(0,z.rR)("grafana_traces_node_graph_panel_clicked",{datasourceType:i,grafana_version:U.$.buildInfo.version,isExpanded:!open})},{height:C}=(0,Rs.A)(),y=(0,p.useRef)(null),[b,S]=(0,p.useState)(250);(0,p.useEffect)(()=>{if(y.current){const{top:v}=y.current.getBoundingClientRect();S(v)}},[y]);const L=C-b-32,T=r&&c[0]?.length>1e3?(0,t.jsxs)("span",{className:d.warningText,children:[" (",c[0].length," nodes, can be slow to load)"]}):null;return(0,t.jsx)(De.NR,{title:"Node graph",titleItems:T,collapsible:!!r,collapsed:r?u:!1,onToggleCollapse:r?m:void 0,children:(0,t.jsx)("div",{ref:y,style:r?{height:500}:{minHeight:600,height:L},children:(0,t.jsx)(ba.F,{dataFrames:g,getLinks:a})})})}function wa(e,{exploreId:s}){return{range:e.explore.panes[s].range}}const Ra=(0,Se.connect)(wa,{})(ja);var ft=h(25508),Ta=h(77789),$n=h(31193),La=h(44932);const Ia=e=>{const s=(0,J.qq)(e);return{getQueries:(0,ft.Mz)(s,n=>n.queries),getQueryResponse:(0,ft.Mz)(s,n=>n.queryResponse),getHistory:(0,ft.Mz)(s,n=>n.history),getEventBridge:(0,ft.Mz)(s,n=>n.eventBridge),getDatasourceInstanceSettings:(0,ft.Mz)(s,n=>(0,$n.tR)().getInstanceSettings(n.datasourceInstance?.uid))}},Ea=({exploreId:e})=>{const s=(0,D.useDispatch)(),{getQueries:n,getDatasourceInstanceSettings:o,getQueryResponse:r,getHistory:i,getEventBridge:a}=(0,p.useMemo)(()=>Ia(e),[e]),l=(0,D.useSelector)(n),d=(0,D.useSelector)(o),g=(0,D.useSelector)(r),c=(0,D.useSelector)(i),u=(0,D.useSelector)(a),x=(0,p.useCallback)(()=>{s((0,K.Od)({exploreId:e}))},[s,e]),m=(0,p.useCallback)(L=>{s((0,K.bO)({exploreId:e,queries:L}))},[s,e]),C=(0,p.useCallback)(L=>{m([...l,{...L,refId:(0,Ta.M)(l)}])},[m,l]),y=()=>{(0,z.rR)("grafana_explore_query_row_copy")},b=()=>{(0,z.rR)("grafana_explore_query_row_remove")},S=L=>{(0,z.rR)("grafana_query_row_toggle",L===void 0?{}:{queryEnabled:L})};return(0,t.jsx)(La.L,{dsSettings:d,queries:l,onQueriesChange:m,onAddQuery:C,onRunQueries:x,onQueryCopied:y,onQueryRemoved:b,onQueryToggled:S,data:g,app:ct.Jk.Explore,history:c,eventBus:u,queryRowWrapper:(L,T)=>(0,t.jsx)(Ce,{title:T,icon:"arrow",panelId:"Queries",customTopOffset:-10,level:"child",children:L},T)})};var qt=h(72574),Ts=h(2913),Oa=h(15054),Fa=h(91793),Da=h(9651),Aa=h(9663),Bn=h(57408);const mt={wrapper:(0,f.css)`
    height: 100%;
    overflow: scroll;
  `,switchWrapper:(0,f.css)`
    display: flex;
    flex-direction: row;
    margin-bottom: 0;
  `,switchLabel:(0,f.css)`
    margin-left: 15px;
    margin-bottom: 0;
  `,switch:(0,f.css)`
    margin-left: 10px;
  `,resultCount:(0,f.css)`
    margin-bottom: 4px;
  `,header:(0,f.css)`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    font-size: 12px;
    line-height: 1.25;
  `},Na=480,Pa=2,ka=e=>{const{tableResult:s}=e,n=(0,ne.cloneDeep)(s),o=(0,p.useRef)(null),r=n.fields.filter(m=>m.name.includes("Value")),i=(0,Bn.E)(n),{width:a}=(0,Rs.A)(),[l,d]=(0,p.useState)(a<=Na||r.length>Pa),g=()=>{d(!l);const m={isExpanded:!l};(0,z.rR)("grafana_explore_prometheus_instant_query_ui_raw_toggle_expand",m)};(0,p.useEffect)(()=>{o.current?.resetAfterIndex(0,!0)},[l]);const c=m=>{if(m<10){let b=0;for(let S=0;S<m;S++)b+=u(S,!0);return Math.min(600,b)}return 600},u=(m,C)=>{if(!C)return 32;const S=i[m];return 1.5*32+(Object.keys(S).length-r.length)*22},x=`isExpandedView ${(0,p.useId)()}`;return(0,t.jsxs)("section",{children:[(0,t.jsxs)("header",{className:mt.header,children:[(0,t.jsx)(pe.D,{className:mt.switchWrapper,label:"Expand results",htmlFor:"isExpandedView",children:(0,t.jsx)("div",{className:mt.switch,children:(0,t.jsx)(Me.d,{onChange:g,id:x,value:l,label:"Expand results"})})}),(0,t.jsxs)("div",{className:mt.resultCount,children:["Result series: ",i.length]})]}),(0,t.jsx)("div",{role:"table",children:(0,t.jsxs)(t.Fragment,{children:[r.length>1&&!l&&(0,t.jsx)(Da.d,{valueLabels:r,expanded:l}),(0,t.jsx)(Fa._m,{ref:o,itemCount:i.length,className:mt.wrapper,itemSize:m=>u(m,l),height:c(i.length),width:"100%",children:({index:m,style:C})=>{let y;return l&&(y=r.filter(b=>{const S=i[m][b.name];return S&&S!==Bn.M})),(0,t.jsx)("div",{role:"row",style:{...C,overflow:"hidden"},children:(0,t.jsx)(Aa.Ay,{isExpandedView:l,valueLabels:y,totalNumberOfValues:r.length,listKey:i[m].__name__,listItemData:i[m]})})}})]})})]})};function Ma(e,{exploreId:s}){const o=e.explore.panes[s],{tableResult:r,rawPrometheusResult:i,range:a,queryResponse:l}=o,d=i?[i]:[],g=(r?.length??0)>0&&i?r:d;return{loading:l.state,tableResult:g,range:a}}const za=(0,Se.connect)(Ma,{});class Ha extends p.PureComponent{constructor(s){super(s),this.onChangeResultsStyle=n=>{this.setState({resultsStyle:n})},this.renderLabel=()=>{const n=(0,f.css)({display:"flex",justifyContent:"space-between",flex:"1"}),o=us.jH.map(r=>({value:r,label:r[0].toUpperCase()+r.slice(1).replace(/_/," ")}));return(0,t.jsx)("div",{className:n,children:(0,t.jsx)(pt.z,{onClick:()=>{const r={state:this.state.resultsStyle===D.TABLE_RESULTS_STYLE.table?D.TABLE_RESULTS_STYLE.raw:D.TABLE_RESULTS_STYLE.table};(0,z.rR)("grafana_explore_prometheus_instant_query_ui_toggle_clicked",r)},size:"sm",options:o,value:this.state?.resultsStyle,onChange:this.onChangeResultsStyle})})},s.showRawPrometheus&&(this.state={resultsStyle:D.TABLE_RESULTS_STYLE.raw})}getTableHeight(){const{tableResult:s}=this.props;return!s||s.length===0?200:Math.max(Math.min(600,s[0].length*35)+35)}render(){const{loading:s,onCellFilterAdded:n,tableResult:o,width:r,splitOpenFn:i,range:a,ariaLabel:l,timeZone:d}=this.props,g=this.getTableHeight(),c=r-Ts.config.theme.panelPadding*2-Oa.IZ;let u=o;const x=(0,Ue.YV)(i,a);u?.length&&(u=(0,Vt.we)({data:u,timeZone:d,theme:Ts.config.theme2,replaceVariables:(0,qt.w)().replace.bind((0,qt.w)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:x}));const m=u?.filter(S=>!!S&&S.length!==0),C=this.state.resultsStyle===D.TABLE_RESULTS_STYLE.raw?"Raw":"Table",y=this.state?.resultsStyle!==void 0?this.renderLabel():"Table",b=!this.state?.resultsStyle||this.state?.resultsStyle===D.TABLE_RESULTS_STYLE.table;return(0,t.jsxs)(De.NR,{title:C,actions:y,loadingState:s,children:[m?.length&&(0,t.jsxs)(t.Fragment,{children:[b&&(0,t.jsx)(ys.X,{ariaLabel:l,data:m[0],width:c,height:g,onCellFilterAdded:n}),this.state?.resultsStyle===D.TABLE_RESULTS_STYLE.raw&&(0,t.jsx)(ka,{tableResult:m[0]})]}),!m?.length&&(0,t.jsx)(ms,{metaItems:[{value:"0 series returned"}]})]})}}const $a=za(Ha);var Ba=h(22669);const Qa=e=>{const s=(0,p.useRef)(null),n={transition:`opacity ${e.duration}ms linear`,opacity:0},o={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return(0,t.jsx)(Ba.Ay,{in:e.in,timeout:e.duration,unmountOnExit:e.unmountOnExit||!1,onExited:e.onExited,nodeRef:s,children:r=>(0,t.jsx)("div",{ref:s,style:{...n,...o[r]},children:e.children})})},Wa=e=>{const{queryError:s}=e,n=!!s,o=n?100:10,r=s?"Query error":"Unknown error",i=s?.message||s?.data?.message||null;return(0,t.jsx)(Qa,{in:n,duration:o,children:(0,t.jsx)(at.F,{severity:"error",title:r,topSpacing:2,children:i})})};function Va(e){const s=(0,D.useSelector)(o=>o.explore.panes[e.exploreId].queryResponse),n=s?.state===me.Gu.Error?s?.error:void 0;return n?.refId?null:(0,t.jsx)(Wa,{queryError:n})}var Ua=h(13390);const qa=e=>({containerMargin:(0,f.css)({display:"flex",flexWrap:"wrap",gap:e.spacing(1),marginTop:e.spacing(2)})});function Ga(e){const s=(0,N.$j)(),n=qa(s),{drawerOpened:o,setDrawerOpened:r,queryLibraryAvailable:i}=_e(),a=!e.richHistoryRowButtonHidden&&!i;return(0,t.jsxs)("div",{className:n.containerMargin,children:[!e.addQueryRowButtonHidden&&(0,t.jsx)(re.I,{variant:"canvas","aria-label":(0,j.t)("explore.secondary-actions.query-add-button-aria-label","Add query"),onClick:e.onClickAddQueryRowButton,disabled:e.addQueryRowButtonDisabled,icon:"plus",children:(0,t.jsx)(j.x6,{i18nKey:"explore.secondary-actions.query-add-button",children:"Add query"})}),a&&(0,t.jsx)(re.I,{variant:o?"active":"canvas","aria-label":(0,j.t)("explore.secondary-actions.query-history-button-aria-label","Query history"),onClick:()=>r(!o),"data-testid":Ua.X.QueryTab.queryHistoryButton,icon:"history",children:(0,t.jsx)(j.x6,{i18nKey:"explore.secondary-actions.query-history-button",children:"Query history"})}),(0,t.jsx)(re.I,{variant:e.queryInspectorButtonActive?"active":"canvas","aria-label":(0,j.t)("explore.secondary-actions.query-inspector-button-aria-label","Query inspector"),onClick:e.onClickQueryInspectorButton,icon:"info-circle",children:(0,t.jsx)(j.x6,{i18nKey:"explore.secondary-actions.query-inspector-button",children:"Query inspector"})})]})}var Qn=h(65885);function Ka(e,{exploreId:s}){const o=e.explore.panes[s],{tableResult:r,range:i}=o,a=(0,K.h1)(s);return{loading:r&&r.length>0?!1:a,tableResult:r,range:i}}const Za=(0,Se.connect)(Ka,{});class Wn extends p.PureComponent{constructor(){super(...arguments),this.hasSubFrames=s=>s.fields.some(n=>n.type===ht.PU.nestedFrames)}getTableHeight(s,n){return s===0?200:Math.min(600,Math.max(s*36,n?300:0)+40+46)}getTableTitle(s,n,o){let r=n.name;return!r&&(s?.length??0)>1&&(r=n.refId||`${o}`),r?(0,j.t)("explore.table.title-with-name","Table - {{name}}",{name:r,interpolation:{escapeValue:!1}}):(0,j.t)("explore.table.title","Table")}render(){const{loading:s,onCellFilterAdded:n,tableResult:o,width:r,splitOpenFn:i,range:a,ariaLabel:l,timeZone:d,theme:g}=this.props;let c=(0,Qn.gy)(o)?(0,Qn.S5)(o):o;const u=(0,Ue.YV)(i,a);c?.length&&(c=(0,Vt.we)({data:c,timeZone:d,theme:Ts.config.theme2,replaceVariables:(0,qt.w)().replace.bind((0,qt.w)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:u}));const x=c?.filter(m=>!!m&&m.length!==0);return(0,t.jsxs)(t.Fragment,{children:[x&&x.length===0&&(0,t.jsx)(De.NR,{title:(0,j.t)("explore.table.title","Table"),width:r,height:200,children:()=>(0,t.jsx)(ms,{metaItems:[{value:(0,j.t)("explore.table.no-data","0 series returned")}]})}),x&&x.length>0&&(0,t.jsx)("div",{className:(0,f.css)({display:"flex",flexDirection:"column",gap:g.spacing(1)}),children:x.map((m,C)=>(0,t.jsx)(De.NR,{title:this.getTableTitle(c,m,C),width:r,height:this.getTableHeight(m.length,this.hasSubFrames(m)),loadingState:s?me.Gu.Loading:void 0,children:(y,b)=>(0,t.jsx)(ys.X,{ariaLabel:l,data:m,width:y,height:b,onCellFilterAdded:n})},m.refId||`table-${C}`))})]})}}const dd=(0,N.cV)(Wn),Ya=(0,N.cV)(Za(Wn));var Ja=h(92599),Xa=h(35090);function _a(e){const s=e.dataFrames[0],{dataFrames:n,splitOpenFn:o,exploreId:r,scrollElement:i}=e,a=(0,p.useMemo)(()=>(0,Xa.L)(s),[s]),l=(0,D.useSelector)(d=>d.explore.panes[e.exploreId]?.datasourceInstance??void 0);return a?(0,t.jsx)(De.NR,{padding:"none",title:"Trace",children:(0,t.jsx)(Ja.V,{exploreId:r,dataFrames:n,splitOpenFn:o,scrollElement:i,traceProp:a,datasource:l})}):null}const el=e=>({exploreMain:(0,f.css)({label:"exploreMain",position:"relative",marginTop:"21px",display:"flex",flexDirection:"column",gap:e.spacing(1)}),queryContainer:(0,f.css)({label:"queryContainer",padding:e.spacing(1)}),exploreContainer:(0,f.css)({label:"exploreContainer",display:"flex",flexDirection:"column",paddingRight:e.spacing(2),marginBottom:e.spacing(2)}),wrapper:(0,f.css)({position:"absolute",top:0,left:e.spacing(2),right:0,bottom:0,display:"flex"})});class tl extends p.PureComponent{constructor(s){super(s),this.onChangeTime=n=>{const{updateTimeRange:o,exploreId:r}=this.props;o({exploreId:r,rawRange:n})},this.onClickExample=n=>{this.props.setQueries(this.props.exploreId,[n])},this.onCellFilterAdded=n=>{const{value:o,key:r,operator:i}=n;i===Ft.mc&&this.onClickFilterLabel(r,o),i===Ft.Zi&&this.onClickFilterOutLabel(r,o)},this.onContentOutlineToogle=()=>{Ot.M.set(At.visible,!this.state.contentOutlineVisible),this.setState(n=>((0,z.rR)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n.contentOutlineVisible?"close":"open"}),{contentOutlineVisible:!n.contentOutlineVisible}))},this.isFilterLabelActive=async(n,o,r)=>{const i=this.props.queries.find(l=>l.refId===r);if(!i)return!1;const a=await(0,Pe.l)().get(i.datasource);return!!((0,_.FP)(a)&&a.queryHasFilter(i,{key:n,value:o.toString()}))},this.onClickFilterLabel=(n,o,r)=>{this.onModifyQueries({type:"ADD_FILTER",options:{key:n,value:o.toString()},frame:r},r?.refId)},this.onClickFilterOutLabel=(n,o,r)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",options:{key:n,value:o.toString()},frame:r},r?.refId)},this.onClickFilterString=(n,o)=>{this.onModifyQueries({type:"ADD_STRING_FILTER",options:{value:n.toString()}},o)},this.onClickFilterOutString=(n,o)=>{this.onModifyQueries({type:"ADD_STRING_FILTER_OUT",options:{value:n.toString()}},o)},this.onClickAddQueryRowButton=()=>{const{exploreId:n,queryKeys:o}=this.props;this.props.addQueryRow(n,o.length)},this.onModifyQueries=(n,o)=>{const r=async(i,a)=>{if(o&&o!==i.refId)return i;const{datasource:l}=i;if(l==null)return i;const d=await(0,Pe.l)().get(l),g=["ADD_FILTER","ADD_FILTER_OUT"];return(0,_.FP)(d)&&g.includes(a.type)?d.toggleQueryFilter(i,{type:a.type==="ADD_FILTER"?"FILTER_FOR":"FILTER_OUT",options:a.options??{},frame:a.frame}):d.modifyQuery?d.modifyQuery(i,a):i};this.props.modifyQueries(this.props.exploreId,n,r)},this.onResize=n=>{this.props.changeSize(this.props.exploreId,n)},this.onStartScanning=()=>{this.props.scanStart(this.props.exploreId)},this.onStopScanning=()=>{this.props.scanStopAction({exploreId:this.props.exploreId})},this.onUpdateTimeRange=n=>{const{exploreId:o,updateTimeRange:r}=this.props;r({exploreId:o,absoluteRange:n})},this.onSplitOpen=n=>async o=>{if(this.props.splitOpen(o),o&&this.props.datasourceInstance){const r=(await(0,Pe.l)().get(o.datasourceUid)).type,i=this.props.datasourceInstance.uid===wt.uv?(0,ne.get)(this.props.queries,"0.datasource.type"):this.props.datasourceInstance.type,a={origin:"panel",panelType:n,source:i,target:r,exploreId:this.props.exploreId};(0,z.rR)("grafana_explore_split_view_opened",a)}},this.state={contentOutlineVisible:Ot.M.getBool(At.visible,!0)},this.graphEventBus=s.eventBus.newScopedBus("graph",{onlyLocal:!1}),this.logsEventBus=s.eventBus.newScopedBus("logs",{onlyLocal:!1})}renderEmptyState(s){return(0,t.jsx)("div",{className:(0,f.cx)(s),children:(0,t.jsx)(va,{})})}renderNoData(){return(0,t.jsx)(fa,{})}renderCustom(s){const{timeZone:n,queryResponse:o,absoluteRange:r,eventBus:i}=this.props,a=(0,ne.groupBy)(o?.customFrames,"meta.preferredVisualisationPluginId");return Object.entries(a).map(([l,d],g)=>(0,t.jsx)(Ce,{panelId:l,title:l,icon:"plug",children:(0,t.jsx)(lr,{timeZone:n,pluginId:l,frames:d,state:o.state,absoluteRange:r,height:400,width:s,splitOpenFn:this.onSplitOpen(l),eventBus:i},g)},g))}renderGraphPanel(s){const{graphResult:n,absoluteRange:o,timeZone:r,queryResponse:i,showFlameGraph:a}=this.props;return(0,t.jsx)(Ce,{panelId:"Graph",title:"Graph",icon:"graph-bar",children:(0,t.jsx)(zr.y,{data:n,height:a?180:400,width:s,absoluteRange:o,timeZone:r,onChangeTime:this.onUpdateTimeRange,annotations:i.annotations,splitOpenFn:this.onSplitOpen("graph"),loadingState:i.state,eventBus:this.graphEventBus})})}renderTablePanel(s){const{exploreId:n,timeZone:o}=this.props;return(0,t.jsx)(Ce,{panelId:"Table",title:"Table",icon:"table",children:(0,t.jsx)(Ya,{ariaLabel:nt.Tp.pages.Explore.General.table,width:s,exploreId:n,onCellFilterAdded:this.onCellFilterAdded,timeZone:o,splitOpenFn:this.onSplitOpen("table")})})}renderRawPrometheus(s){const{exploreId:n,datasourceInstance:o,timeZone:r}=this.props;return(0,t.jsx)(Ce,{panelId:"Raw Prometheus",title:"Raw Prometheus",icon:"gf-prometheus",children:(0,t.jsx)($a,{showRawPrometheus:!0,ariaLabel:nt.Tp.pages.Explore.General.table,width:s,exploreId:n,onCellFilterAdded:o?.modifyQuery?this.onCellFilterAdded:void 0,timeZone:r,splitOpenFn:this.onSplitOpen("table")})})}renderLogsPanel(s){const{exploreId:n,syncedTimes:o,theme:r,queryResponse:i}=this.props,a=parseInt(r.spacing(2).slice(0,-2),10),l=(0,f.css)({display:"flex",flexDirection:"column",gap:r.spacing(1)});return(0,t.jsx)(Ce,{panelId:"Logs",title:"Logs",icon:"gf-logs",className:l,children:(0,t.jsx)(pa,{exploreId:n,loadingState:i.state,syncedTimes:o,width:s-a,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning,eventBus:this.logsEventBus,splitOpenFn:this.onSplitOpen("logs"),scrollElement:this.scrollElement,isFilterLabelActive:this.isFilterLabelActive,onClickFilterString:this.onClickFilterString,onClickFilterOutString:this.onClickFilterOutString,onPinLineCallback:()=>{this.setState({contentOutlineVisible:!0})}})})}renderLogsSamplePanel(){const{logsSample:s,timeZone:n,setSupplementaryQueryEnabled:o,exploreId:r,datasourceInstance:i,queries:a}=this.props;return(0,t.jsx)(Ce,{panelId:"Logs Sample",title:"Logs Sample",icon:"gf-logs",children:(0,t.jsx)(ha,{queryResponse:s.data,timeZone:n,enabled:s.enabled,queries:a,datasourceInstance:i,splitOpen:this.onSplitOpen("logsSample"),setLogsSampleEnabled:l=>o(r,l,_.cF.LogsSample)})})}renderNodeGraphPanel(){const{exploreId:s,showTrace:n,queryResponse:o,datasourceInstance:r}=this.props,i=r?r?.type:"unknown";return(0,t.jsx)(Ce,{panelId:"Node Graph",title:"Node Graph",icon:"code-branch",children:(0,t.jsx)(Ra,{dataFrames:o.nodeGraphFrames,exploreId:s,withTraceView:n,datasourceType:i,splitOpenFn:this.onSplitOpen("nodeGraph")})})}renderFlameGraphPanel(){const{queryResponse:s}=this.props;return(0,t.jsx)(Ce,{panelId:"Flame Graph",title:"Flame Graph",icon:"fire",children:(0,t.jsx)(kr,{dataFrames:s.flameGraphFrames})})}renderTraceViewPanel(){const{queryResponse:s,exploreId:n}=this.props,o=s.series.filter(r=>r.meta?.preferredVisualisationType==="trace");return o.length&&(0,t.jsx)(Ce,{panelId:"Traces",title:"Traces",icon:"file-alt",children:(0,t.jsx)(_a,{exploreId:n,dataFrames:o,splitOpenFn:this.onSplitOpen("traceView"),scrollElement:this.scrollElement})})}render(){const{datasourceInstance:s,exploreId:n,graphResult:o,queryResponse:r,isLive:i,theme:a,showMetrics:l,showTable:d,showRawPrometheus:g,showLogs:c,showTrace:u,showCustom:x,showNodeGraph:m,showFlameGraph:C,showLogsSample:y,correlationEditorDetails:b,correlationEditorHelperData:S,showQueryInspector:L,setShowQueryInspector:T}=this.props,{contentOutlineVisible:v}=this.state,w=el(a),R=r&&r.state!==me.Gu.NotStarted,A=!(0,rt.gQ)().queryHistoryAvailable,P=r.state===me.Gu.Done&&[r.logsFrames,r.graphFrames,r.nodeGraphFrames,r.flameGraphFrames,r.tableFrames,r.rawPrometheusFrames,r.traceFrames,r.customFrames].every(B=>B.length===0);let k;const W=b?.editorMode;return!!(W||b?.correlationDirty)&&S!==void 0&&(k=(0,t.jsx)(sr,{exploreId:n,correlations:S})),(0,t.jsxs)(Uo,{refreshDependencies:this.props.queries,children:[(0,t.jsx)(Nr,{exploreId:n,onChangeTime:this.onChangeTime,onContentOutlineToogle:this.onContentOutlineToogle,isContentOutlineOpen:v}),(0,t.jsx)("div",{style:{position:"relative",height:"100%",paddingLeft:a.spacing(2)},children:(0,t.jsxs)("div",{className:w.wrapper,children:[v&&(0,t.jsx)(Ko,{scroller:this.scrollElement,panelId:`content-outline-container-${n}`}),(0,t.jsx)(Et.E,{testId:nt.Tp.pages.Explore.General.scrollView,scrollRefCallback:B=>this.scrollElement=B||void 0,hideHorizontalTrack:!0,children:(0,t.jsx)("div",{className:w.exploreContainer,children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ce,{panelId:"Queries",title:"Queries",icon:"arrow",mergeSingleChild:!0,children:(0,t.jsxs)(rs._,{className:w.queryContainer,children:[k,(0,t.jsx)(Ea,{exploreId:n}),(0,t.jsx)(Ga,{addQueryRowButtonDisabled:i||W&&s.meta.mixed,addQueryRowButtonHidden:!1,richHistoryRowButtonHidden:A,queryInspectorButtonActive:L,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickQueryInspectorButton:()=>T(!L)}),(0,t.jsx)(Va,{exploreId:n})]})}),(0,t.jsx)(Bo.Ay,{onResize:this.onResize,disableHeight:!0,children:({width:B})=>B===0?null:(0,t.jsx)("main",{className:(0,f.cx)(w.exploreMain),style:{width:B},children:(0,t.jsx)(se.Xw,{children:R&&(0,t.jsxs)(t.Fragment,{children:[l&&o&&(0,t.jsx)(se.Xw,{children:this.renderGraphPanel(B)}),g&&(0,t.jsx)(se.Xw,{children:this.renderRawPrometheus(B)}),d&&(0,t.jsx)(se.Xw,{children:this.renderTablePanel(B)}),c&&(0,t.jsx)(se.Xw,{children:this.renderLogsPanel(B)}),m&&(0,t.jsx)(se.Xw,{children:this.renderNodeGraphPanel()}),C&&(0,t.jsx)(se.Xw,{children:this.renderFlameGraphPanel()}),u&&(0,t.jsx)(se.Xw,{children:this.renderTraceViewPanel()}),y&&(0,t.jsx)(se.Xw,{children:this.renderLogsSamplePanel()}),x&&(0,t.jsx)(se.Xw,{children:this.renderCustom(B)}),P&&(0,t.jsx)(se.Xw,{children:this.renderNoData()})]})})})})]}):this.renderEmptyState(w.exploreContainer)})})]})})]})}}function sl(e,{exploreId:s}){const n=e.explore,{syncedTimes:o}=n,r=n.panes[s],i=(0,Dt.O)(e.user),{datasourceInstance:a,queryKeys:l,queries:d,isLive:g,graphResult:c,tableResult:u,logsResult:x,showLogs:m,showMetrics:C,showTable:y,showTrace:b,showCustom:S,absoluteRange:L,queryResponse:T,showNodeGraph:v,showFlameGraph:w,showRawPrometheus:R,supplementaryQueries:A,correlationEditorHelperData:P}=r,k=(0,K.h1)(s)(e),W=A[_.cF.LogsSample],O=!!(W.dataProvider!==void 0&&!x&&(c||u));return{datasourceInstance:a,queryKeys:l,queries:d,isLive:g,graphResult:c,logsResult:x??void 0,absoluteRange:L,queryResponse:T,syncedTimes:o,timeZone:i,showLogs:m,showMetrics:C,showTable:y,showTrace:b,showCustom:S,showNodeGraph:v,showRawPrometheus:R,showFlameGraph:w,splitted:(0,J.pF)(e),loading:k,logsSample:W,showLogsSample:O,correlationEditorHelperData:P,correlationEditorDetails:n.correlationEditorDetails}}const nl={changeSize:Fe.QZ,modifyQueries:K.PD,scanStart:K.GI,scanStopAction:K.q9,setQueries:K.Rk,updateTimeRange:xe.GH,addQueryRow:K._0,splitOpen:Y.ve,setSupplementaryQueryEnabled:K.TO},ol=(0,Se.connect)(sl,nl),rl=(0,N.cV)(ol(tl));var Vn=h(60734),il=h(61453),al=h(82344),ll=h(61396),cl=h(32067),dl=h(90820);function ul(e){const{onClose:s,queryResponse:n,timeZone:o,isMixed:r,exploreId:i}=e,[a,l]=(0,p.useState)({withTransforms:!1,withFieldConfig:!0}),d=n?.series||[];let g=n?.errors;!g?.length&&n?.error&&(g=[n.error]);const c=(0,N.of)(gl);(0,p.useEffect)(()=>{(0,z.rR)("grafana_explore_query_inspector_opened")},[]);const u={label:"Stats",value:"stats",icon:"chart-line",content:(0,t.jsx)(cl.N,{data:n,timeZone:n?.request?.timezone??Z.vp})},x={label:"JSON",value:"json",icon:"brackets-curly",content:(0,t.jsx)(ll.w,{data:n,onClose:s})},m={label:"Data",value:"data",icon:"database",content:(0,t.jsx)(il.q,{data:d,dataName:"Explore",isLoading:n.state===me.Gu.Loading,options:a,timeZone:o,app:ct.Jk.Explore,formattedDataDescription:"Matches the format in the panel",onOptionsChange:l})},C={label:"Query",value:"query",icon:"info-circle",content:(0,t.jsx)("div",{className:c.queryInspectorWrapper,children:(0,t.jsx)(dl.e,{instanceId:r?(0,wt.qM)(0,(0,ot.uq)(i)):(0,ot.uq)(i),data:n,onRefreshQuery:()=>e.runQueries({exploreId:i})})})},y=[u,C,x,m];if(g?.length){const b={label:"Error",value:"error",icon:"exclamation-triangle",content:(0,t.jsx)(al.y,{errors:g})};y.push(b)}return(0,t.jsx)(Ks,{children:(0,t.jsx)(Vn.q,{tabs:y,onClose:s,closeIconTooltip:"Close query inspector"})})}function pl(e,{exploreId:s}){const o=e.explore.panes[s],{queryResponse:r}=o;return{queryResponse:r,isMixed:o.datasourceInstance?.meta.mixed||!1}}const hl={runQueries:K.Od},gl=e=>({queryInspectorWrapper:(0,f.css)({paddingBottom:e.spacing(3)})}),fl=(0,Se.connect)(pl,hl)(ul),ml=(0,f.css)({label:"explorePaneContainer",display:"flex",flexDirection:"column",minWidth:"600px",height:"100%"});function yl({exploreId:e}){bl(e);const s=(0,p.useRef)(new $o.o),n=(0,p.useRef)(null),[o,r]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{const i=s.current;return()=>i.removeAllListeners()},[]),(0,t.jsx)(Et.E,{hideVerticalTrack:!0,children:(0,t.jsxs)("div",{className:ml,ref:n,"data-testid":nt.Tp.pages.Explore.General.container,children:[(0,t.jsx)(rl,{exploreId:e,eventBus:s.current,showQueryInspector:o,setShowQueryInspector:r}),o&&(0,t.jsx)(fl,{exploreId:e,onClose:()=>r(!1),timeZone:(0,Zs.O)()})]})})}function xl(e,s){return{pane:e.explore.panes[s.exploreId]}}const vl=(0,Se.connect)(xl)(yl);function bl(e){const s=(0,p.useMemo)(()=>(0,J.qq)(e),[e]),n=(0,p.useRef)();n.current=(0,D.useSelector)(s),(0,p.useEffect)(()=>()=>{(0,ot._u)(n.current?.querySubscription)},[])}var Ie=h(72433),ce=h(81523),Un=h(69529),Sl=h(2858),Cl=h(56389);const jl=()=>({kind:"QueryTemplateList",apiVersion:"peakq.grafana.app/v0alpha1",metadata:{resourceVersion:"1783293408052252672",remainingItemCount:0},items:[{kind:"QueryTemplate",apiVersion:"peakq.grafana.app/v0alpha1",metadata:{name:"AElastic2nkf9",generateName:"AElastic",namespace:"default",uid:"65327fce-c545-489d-ada5-16f909453d12",resourceVersion:"1783293341664808960",creationTimestamp:"2024-04-25T20:32:58Z",annotations:{"grafana.app/createdBy":"user:1:admin"}},spec:{title:"Elastic Query Template",targets:[{variables:{},properties:{refId:"A",datasource:{type:"elasticsearch",uid:"elastic-uid"},alias:"",metrics:[{id:"1",type:"count"}],bucketAggs:[{field:"@timestamp",id:"2",settings:{interval:"auto"},type:"date_histogram"}],timeField:"@timestamp",query:"test:test "}}]}},{kind:"QueryTemplate",apiVersion:"peakq.grafana.app/v0alpha1",metadata:{name:"ALoki296tj",generateName:"ALoki",namespace:"default",uid:"3e71de65-efa7-40e3-8f23-124212cca455",resourceVersion:"1783214217151647744",creationTimestamp:"2024-04-25T11:05:55Z",annotations:{"grafana.app/createdBy":"user:1:admin"}},spec:{title:"Loki Query Template",vars:[{key:"__value",defaultValues:[""],valueListDefinition:{customValues:""}}],targets:[{variables:{__value:[{path:"$.datasource.jsonData.derivedFields.0.url",position:{start:0,end:14},format:"raw"},{path:"$.datasource.jsonData.derivedFields.1.url",position:{start:0,end:14},format:"raw"},{path:"$.datasource.jsonData.derivedFields.2.url",position:{start:0,end:14},format:"raw"}]},properties:{refId:"A",datasource:{type:"loki",uid:"loki-uid"},queryType:"range",editorMode:"code",expr:'{test="test"}'}}]}}]}),wl={all:{url:Cl.C1,response:jl()}},{useAllQueryTemplatesQuery:Rl,useAddQueryTemplateMutation:Tl,useDeleteQueryTemplateMutation:Ll}=Sl.g;function Il(){return U.$.featureToggles.queryLibrary}const hd={data:wl};var El=h(48840),Ae=h(3591),Gt=h(82467),Kt=h(3169),ze=h(28444),yt=h(76412);const Ol={setQueries:K.Rk,changeDatasource:Be.wh},Fl=(0,Se.connect)(void 0,Ol);function Dl({rootDatasourceUid:e,queries:s,disabled:n=!1,onClick:o,changeDatasource:r,setQueries:i}){const[a,l]=(0,p.useState)(!1),d=(0,D.useSelector)(J.pF),g=(0,D.useSelector)(J.Kl),c=(0,D.useSelector)(J.K6),u=(y,b)=>!g.dsToExplore.find(S=>S.datasource.uid===y)?.exploreIds.includes(b),x=(y,b)=>b!==void 0&&y!==void 0&&u(b,y)?{fallbackText:"Switch data source and run query",translation:(0,yt.t)("explore.run-query.switch-datasource-button","Switch data source and run query")}:{fallbackText:"Run query",translation:(0,yt.t)("explore.run-query.run-query-button","Run query")},m=async y=>{const b=u(e,y);b&&await r({exploreId:y,datasource:e}),i(y,s),(0,z.rR)("grafana_explore_query_history_run",{queryHistoryEnabled:U.$.queryHistoryEnabled,differentDataSource:b})},C=()=>{const y=n||s.length===0||e===void 0;if(d){const b=(0,t.jsx)(je.W,{children:c.map((S,L)=>{const T=x(S[0],e),v=L===0?(0,yt.t)("explore.run-query.left-pane","Left pane"):(0,yt.t)("explore.run-query.right-pane","Right pane");return(0,t.jsx)(je.W.Item,{ariaLabel:T.fallbackText,onClick:()=>{m(S[0]),o?.()},label:`${v}: ${T.translation}`,disabled:y||S[0]===void 0},L)})});return(0,t.jsx)(lt.m,{onVisibleChange:S=>l(S),placement:"bottom-start",overlay:b,children:(0,t.jsx)(re.I,{"aria-label":"run query options",variant:"canvas",isOpen:a,children:(0,yt.t)("explore.run-query.run-query-button","Run query")})})}else{const b=g.exploreToDS[0]?.exploreId,S=x(b,e);return(0,t.jsx)(V.$n,{variant:"secondary","aria-label":S.translation,onClick:()=>{m(b),o?.()},disabled:y||b===void 0,children:S.translation})}};return(0,t.jsx)(t.Fragment,{children:C()})}const qn=Fl(Dl),xt=()=>(0,N.of)(Al),Al=e=>({logo:(0,f.css)({marginRight:e.spacing(2),width:"16px"}),header:(0,f.css)({margin:0,fontSize:e.typography.h5.fontSize,color:e.colors.text.secondary}),mainText:(0,f.css)({margin:0,fontSize:e.typography.body.fontSize,textOverflow:"ellipsis"}),otherText:(0,f.css)({margin:0,fontSize:e.typography.body.fontSize,color:e.colors.text.secondary,textOverflow:"ellipsis"}),singleLine:(0,f.css)({display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:1,overflow:"hidden"}),cell:(0,f.css)({display:"flex",alignItems:"center","&:last-child":{justifyContent:"end"}}),actionButton:(0,f.css)({padding:e.spacing(1)})});function Nl({query:e,rootDatasourceUid:s,queryUid:n}){const[o]=Ll(),{setDrawerOpened:r}=_e(),i=xt(),a=l=>{const d=g=>{o({uid:g}),(0,tt.JD)((0,Gt.dx)((0,Kt.tZ)((0,j.t)("explore.query-library.query-deleted","Query deleted")))),(0,z.rR)("grafana_explore_query_library_deleted")};(0,Ae.J7)().publish(new ze.bY({title:(0,j.t)("explore.query-library.delete-query-title","Delete query"),text:(0,j.t)("explore.query-library.delete-query-text","You're about to remove this query from the query library. This action cannot be undone. Do you want to continue?"),yesText:(0,j.t)("query-library.delete-query-button","Delete query"),icon:"trash-alt",onConfirm:()=>d(l)}))};return(0,t.jsxs)("div",{className:i.cell,children:[(0,t.jsx)(We.K,{className:i.actionButton,size:"lg",name:"trash-alt",title:(0,j.t)("explore.query-library.delete-query","Delete query"),tooltip:(0,j.t)("explore.query-library.delete-query","Delete query"),onClick:()=>{n&&a(n)}}),(0,t.jsx)(qn,{queries:e?[e]:[],rootDatasourceUid:s,onClick:()=>r(!1)})]})}const Pl=Nl;function kl(e){const s=xt();return(0,t.jsx)("div",{children:(0,t.jsx)("span",{className:s.otherText,children:e.user||"Unknown"})})}function Ls(e){const{value:s}=(0,kt.A)(async()=>await(0,Pe.l)().get(e),[e]);return s}function Ml(e){const s=Ls(e.row.original.datasourceRef),n=xt();return(0,t.jsx)("p",{className:n.otherText,children:s?.meta.name})}function zl(e){const s=xt(),n=(0,Re.KQ)(e.row.original.createdAtTimestamp).format("YYYY-MM-DD HH:mm:ss");return(0,t.jsx)("p",{className:s.otherText,children:n})}function Hl(e){const s=Ls(e.row.original.datasourceRef),n=xt();if(!s)return(0,t.jsx)(gt.y,{});if(!e.row.original.query)return(0,t.jsx)("div",{children:"No queries"});const o=e.row.original.query,r=s?.getQueryDisplayText?.(o)||"",i=e.row.original.description,a=s?.name||"";return(0,t.jsxs)("div",{"aria-label":`Query template for ${a}: ${i}`,children:[(0,t.jsxs)("p",{className:n.header,children:[(0,t.jsx)("img",{className:n.logo,src:s?.meta.info.logos.small||"public/img/icn-datasource.svg",alt:s?.meta.info.description}),a]}),(0,t.jsx)(be.m,{content:r,placement:"bottom-start",children:(0,t.jsx)("p",{className:(0,f.cx)(n.mainText,n.singleLine),children:r})}),(0,t.jsx)("p",{className:(0,f.cx)(n.otherText,n.singleLine),children:i})]})}const $l=[{id:"description",header:"Data source and query",cell:Hl},{id:"addedBy",header:"Added by",cell:({row:{original:e}})=>(0,t.jsx)(kl,{user:e.user})},{id:"datasourceType",header:"Datasource type",cell:Ml,sortType:"string"},{id:"createdAtTimestamp",header:"Date added",cell:zl,sortType:(e,s,n,o)=>{const r=e.original.createdAtTimestamp||0,i=s.original.createdAtTimestamp||0;return o?r-i:i-r}},{id:"actions",header:"",cell:({row:{original:e}})=>(0,t.jsx)(Pl,{query:e.query,rootDatasourceUid:e.datasourceRef?.uid,queryUid:e.uid})}],Bl={tableWithSpacing:(0,f.css)({"th:first-child":{width:"50%"}})};function Ql({queryTemplateRows:e}){return(0,t.jsx)(El.j,{className:Bl.tableWithSpacing,columns:$l,data:e,getRowId:s=>s.index})}function Wl(){const{data:e,isLoading:s,error:n}=Rl();if(n)return(0,t.jsx)(Un.p,{variant:"not-found",message:"Something went wrong",children:n.message});if(s)return(0,t.jsx)(gt.y,{});if(!e||e.length===0)return(0,t.jsx)(Un.p,{message:"Query Library",variant:"not-found",children:(0,t.jsx)("p",{children:"You haven't saved any queries to your library yet. Start adding them from Explore or your Query History tab."})});const o=e.map((r,i)=>{const a=r.targets[0]?.datasource,l=(0,$n.tR)().getInstanceSettings(a)?.meta.name||"";return{index:i.toString(),uid:r.uid,datasourceRef:a,datasourceType:l,createdAtTimestamp:r?.createdAtTimestamp||0,query:r.targets[0],description:r.title,user:r.user}});return(0,t.jsx)(Ql,{queryTemplateRows:o})}function Vl(){return(0,t.jsx)(Wl,{})}var Ul=h(47097),Gn=h(67647),Kn=h(21744),Is=h(72635),ql=h(26272),Gl=h(55882);const Kl=[{value:"Public",label:"Public"},{value:"Private",label:"Private"}],Zl=(0,j.t)("explore.add-to-library-modal.info","You're about to save this query. Once saved, you can easily access it in the Query Library tab for future use and reference."),Yl=({onCancel:e,onSave:s,query:n})=>{const{register:o,handleSubmit:r}=(0,it.mN)(),i=Ls(n.datasource),a=(0,p.useMemo)(()=>i?.getQueryDisplayText?.(n)||(0,ce.ev)(n),[i,n]),l=d=>{s(d)};return(0,t.jsxs)("form",{onSubmit:r(l),children:[(0,t.jsx)("p",{children:Zl}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.query","Query"),children:(0,t.jsx)(Kn.f,{readOnly:!0,value:a})}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.data-source-name","Data source name"),children:(0,t.jsx)(Gl.s,{current:i?.uid,disabled:!0})}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.data-source-type","Data source type"),children:(0,t.jsx)(Qe.p,{disabled:!0,defaultValue:i?.meta.name})}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.description","Description"),children:(0,t.jsx)(Qe.p,{id:"query-template-description",autoFocus:!0,...o("description")})}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.visibility","Visibility"),children:(0,t.jsx)(pt.z,{options:Kl,value:"Public",disabled:!0})}),(0,t.jsx)(Me.K,{showLabel:!0,disabled:!0,label:(0,j.t)("explore.add-to-library-modal.auto-star","Auto-star this query to add it to your starred list in the Query Library.")}),(0,t.jsxs)(Je.a.ButtonRow,{children:[(0,t.jsx)(V.$n,{variant:"secondary",onClick:()=>e(),fill:"outline",children:"Cancel"}),(0,t.jsx)(V.$n,{variant:"primary",type:"submit",children:"Save"})]})]})},Jl=({query:e})=>{const[s,n]=(0,p.useState)(!1),[o,{isSuccess:r}]=Tl(),i=async d=>{(await o(d)).error||(0,Ae.J7)().publish({type:ql.r1.alertSuccess.name,payload:[(0,Is.t)("explore.rich-history-card.query-template-added","Query template successfully added to the library")]})},a=(0,Is.t)("explore.rich-history-card.add-to-library","Add to library"),l=d=>{const g=(0,Re.KQ)().toISOString(),c=d.description||`Imported from Explore - ${g}`;i({title:c,targets:[e]})};return Il()&&!r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V.$n,{variant:"secondary","aria-label":a,onClick:()=>n(!0),children:a}),(0,t.jsx)(Je.a,{title:(0,Is.t)("explore.add-to-library-modal.title","Add query to Query Library"),isOpen:s,onDismiss:()=>n(!1),children:(0,t.jsx)(Yl,{onCancel:()=>n(()=>!1),query:e,onSave:d=>{l(d),n(!1)}})})]}):void 0},Xl={changeDatasource:Be.wh,deleteHistoryItem:Ie.VM,commentHistoryItem:Ie.H9,starHistoryItem:Ie.sh,setQueries:K.Rk},_l=(0,Se.connect)(void 0,Xl),ec=e=>{const s="240px",n="170px",o=e.colors.background.secondary;return{queryCard:(0,f.css)`
      position: relative;
      display: flex;
      flex-direction: column;
      border: 1px solid ${e.colors.border.weak};
      margin: ${e.spacing(1)} 0;
      background-color: ${o};
      border-radius: ${e.shape.radius.default};
      .starred {
        color: ${e.v1.palette.orange};
      }
    `,cardRow:(0,f.css)`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: ${e.spacing(1)};
      border-bottom: none;
      :first-of-type {
        border-bottom: 1px solid ${e.colors.border.weak};
        padding: ${e.spacing(.5,1)};
      }
      img {
        height: ${e.typography.fontSize}px;
        max-width: ${e.typography.fontSize}px;
        margin-right: ${e.spacing(1)};
      }
    `,queryActionButtons:(0,f.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      font-size: ${e.typography.size.base};
      button {
        margin-left: ${e.spacing(1)};
      }
    `,queryContainer:(0,f.css)`
      font-weight: ${e.typography.fontWeightMedium};
      width: calc(100% - ${s});
    `,updateCommentContainer:(0,f.css)`
      width: calc(100% + ${s});
      margin-top: ${e.spacing(1)};
    `,comment:(0,f.css)`
      overflow-wrap: break-word;
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.fontWeightRegular};
      margin-top: ${e.spacing(.5)};
    `,commentButtonRow:(0,f.css)`
      > * {
        margin-top: ${e.spacing(1)};
        margin-right: ${e.spacing(1)};
      }
    `,textArea:(0,f.css)`
      width: 100%;
    `,runButton:(0,f.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      button {
        height: auto;
        padding: ${e.spacing(.5,2)};
        line-height: 1.4;
        span {
          white-space: normal !important;
        }
      }
    `,loader:(0,f.css)`
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: ${e.colors.background.secondary};
    `}};function tc(e){const{queryHistoryItem:s,commentHistoryItem:n,starHistoryItem:o,deleteHistoryItem:r,datasourceInstances:i}=e,[a,l]=(0,p.useState)(!1),[d,g]=(0,p.useState)(s.comment),c=(0,N.of)(ec),u=i?i.find(R=>R.uid===s.datasourceUid):void 0,x=async()=>{const R=[...s.queries.map(P=>P.datasource?.type||"unknown")];(0,z.rR)("grafana_explore_query_history_copy_query",{datasources:R,mixed:!!u?.meta.mixed});const A=s.queries.map(P=>{let k=i?.find(W=>W.uid===s.datasourceUid);return k?.meta.mixed&&(k=i?.find(W=>W.uid===P.datasource?.uid)),(0,ce.Ax)(P,k)}).join(`
`);(0,ot.uJ)(A),(0,tt.JD)((0,Gt.dx)((0,Kt.tZ)((0,j.t)("explore.rich-history-notification.query-copied","Query copied to clipboard"))))},m=async()=>{const R=(0,ce.U3)(s);await(0,hs.VP)(R)},C=()=>{const R=A=>{r(A),(0,tt.JD)((0,Gt.dx)((0,Kt.tZ)((0,j.t)("explore.rich-history-notification.query-deleted","Query deleted")))),(0,z.rR)("grafana_explore_query_history_deleted",{queryHistoryEnabled:U.$.queryHistoryEnabled})};s.starred?(0,Ae.J7)().publish(new ze.bY({title:(0,j.t)("explore.rich-history-card.delete-query-confirmation-title","Delete"),text:(0,j.t)("explore.rich-history-card.delete-starred-query-confirmation-text","Are you sure you want to permanently delete your starred query?"),yesText:(0,j.t)("explore.rich-history-card.confirm-delete","Delete"),icon:"trash-alt",onConfirm:()=>R(s.id)})):R(s.id)},y=()=>{o(s.id,!s.starred),(0,z.rR)("grafana_explore_query_history_starred",{queryHistoryEnabled:U.$.queryHistoryEnabled,newValue:!s.starred})},b=()=>l(!a),S=()=>{n(s.id,d),l(!1),(0,z.rR)("grafana_explore_query_history_commented",{queryHistoryEnabled:U.$.queryHistoryEnabled})},L=()=>{l(!1),g(s.comment)},T=R=>{R.key==="Enter"&&(R.shiftKey||R.ctrlKey)&&S(),R.key==="Escape"&&L()},v=(0,t.jsxs)("div",{className:c.updateCommentContainer,"aria-label":d?(0,j.t)("explore.rich-history-card.update-comment-form","Update comment form"):(0,j.t)("explore.rich-history-card.add-comment-form","Add comment form"),children:[(0,t.jsx)(Kn.f,{onKeyDown:T,value:d,placeholder:d?void 0:(0,j.t)("explore.rich-history-card.optional-description","An optional description of what the query does."),onChange:R=>g(R.currentTarget.value),className:c.textArea}),(0,t.jsxs)("div",{className:c.commentButtonRow,children:[(0,t.jsx)(V.$n,{onClick:S,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-card.save-comment",children:"Save comment"})}),(0,t.jsx)(V.$n,{variant:"secondary",onClick:L,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-card.cancel",children:"Cancel"})})]})]}),w=(0,t.jsxs)("div",{className:c.queryActionButtons,children:[(0,t.jsx)(We.K,{name:"comment-alt",onClick:b,tooltip:s.comment?.length>0?(0,j.t)("explore.rich-history-card.edit-comment-tooltip","Edit comment"):(0,j.t)("explore.rich-history-card.add-comment-tooltip","Add comment")}),(0,t.jsx)(We.K,{name:"copy",onClick:x,tooltip:(0,j.t)("explore.rich-history-card.copy-query-tooltip","Copy query to clipboard")}),u&&(0,t.jsx)(We.K,{name:"share-alt",onClick:m,tooltip:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-card.copy-shortened-link-tooltip",children:"Copy shortened link to clipboard"})}),(0,t.jsx)(We.K,{name:"trash-alt",title:(0,j.t)("explore.rich-history-card.delete-query-title","Delete query"),tooltip:(0,j.t)("explore.rich-history-card.delete-query-tooltip","Delete query"),onClick:C}),(0,t.jsx)(We.K,{name:s.starred?"favorite":"star",iconType:s.starred?"mono":"default",onClick:y,tooltip:s.starred?(0,j.t)("explore.rich-history-card.unstar-query-tooltip","Unstar query"):(0,j.t)("explore.rich-history-card.star-query-tooltip","Star query")})]});return(0,t.jsxs)("div",{className:c.queryCard,children:[(0,t.jsxs)("div",{className:c.cardRow,children:[(0,t.jsx)(Zn,{dsApi:u,size:"sm"}),w]}),(0,t.jsxs)("div",{className:(0,f.cx)(c.cardRow),children:[(0,t.jsxs)("div",{className:c.queryContainer,children:[s?.queries.map((R,A)=>{const P=i?.find(k=>k.uid===R.datasource?.uid);return(0,t.jsx)(nc,{query:{query:R,datasource:P},showDsInfo:u?.meta.mixed},`${R}-${A}`)}),!a&&s.comment&&(0,t.jsx)("div",{"aria-label":(0,j.t)("explore.rich-history-card.query-comment-label","Query comment"),className:c.comment,children:s.comment}),a&&v]}),!a&&(0,t.jsx)(Jl,{query:s?.queries[0]}),!a&&(0,t.jsx)("div",{className:c.runButton,children:(0,t.jsx)(qn,{queries:s.queries,rootDatasourceUid:u?.uid})})]})]})}const sc=e=>({queryRow:(0,f.css)`
    border-top: 1px solid ${e.colors.border.weak};
    display: flex;
    flex-direction: row;
    padding: 4px 0px;
    gap: 4px;
    :first-child {
      border-top: none;
    }
  `,dsInfoContainer:(0,f.css)`
    display: flex;
    align-items: center;
  `,queryText:(0,f.css)`
    word-break: break-all;
  `}),nc=({query:e,showDsInfo:s=!1})=>{const n=(0,N.of)(sc);return(0,t.jsxs)("div",{className:n.queryRow,children:[s&&(0,t.jsxs)("div",{className:n.dsInfoContainer,children:[(0,t.jsx)(Zn,{dsApi:e.datasource,size:"md"}),": "]}),(0,t.jsx)("span",{"aria-label":(0,j.t)("explore.rich-history-card.query-text-label","Query text"),className:n.queryText,children:(0,ce.Ax)(e.query,e.datasource)})]})},oc=e=>s=>(0,f.css)`
  display: flex;
  align-items: center;
  font-size: ${s.typography[e==="sm"?"bodySmall":"body"].fontSize};
  font-weight: ${s.typography.fontWeightMedium};
  white-space: nowrap;
`;function Zn({dsApi:e,size:s}){const n=(0,p.useCallback)(r=>oc(s)(r),[s]),o=(0,N.of)(n);return(0,t.jsxs)("div",{className:o,children:[(0,t.jsx)("img",{src:e?.meta.info.logos.small||"public/img/icn-datasource.svg",alt:e?.type||(0,j.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore"),"aria-label":(0,j.t)("explore.rich-history-card.datasource-icon-label","Data source icon")}),(0,t.jsx)("div",{"aria-label":(0,j.t)("explore.rich-history-card.datasource-name-label","Data source name"),children:e?.name||(0,j.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore")})]})}const Yn=_l(tc),rc=(e,s)=>({container:(0,f.css)`
      display: flex;
    `,labelSlider:(0,f.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      &:last-of-type {
        margin-top: ${e.spacing(3)};
      }
      &:first-of-type {
        font-weight: ${e.typography.fontWeightMedium};
        margin-bottom: ${e.spacing(2)};
      }
    `,containerContent:(0,f.css)`
      /* 134px is based on the width of the Query history tabs bar, so the content is aligned to right side of the tab */
      width: calc(100% - 134px);
    `,containerSlider:(0,f.css)`
      width: 129px;
      margin-right: ${e.spacing(1)};
    `,fixedSlider:(0,f.css)`
      position: fixed;
    `,slider:(0,f.css)`
      bottom: 10px;
      height: ${s-180}px;
      width: 129px;
      padding: ${e.spacing(1)} 0;
    `,selectors:(0,f.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,filterInput:(0,f.css)`
      margin-bottom: ${e.spacing(1)};
    `,multiselect:(0,f.css)`
      width: 100%;
      margin-bottom: ${e.spacing(1)};
    `,sort:(0,f.css)`
      width: 170px;
    `,sessionName:(0,f.css)`
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin-top: ${e.spacing(3)};
      h4 {
        margin: 0 10px 0 0;
      }
    `,heading:(0,f.css)`
      font-size: ${e.typography.h4.fontSize};
      margin: ${e.spacing(2,.25,1,.25)};
    `,footer:(0,f.css)`
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: ${e.typography.fontWeightLight};
      font-size: ${e.typography.bodySmall.fontSize};
      a {
        font-weight: ${e.typography.fontWeightMedium};
        margin-left: ${e.spacing(.25)};
      }
    `,queries:(0,f.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.fontWeightRegular};
      margin-left: ${e.spacing(.5)};
    `});function ic(e){const{queries:s,totalQueries:n,loading:o,richHistorySearchFilters:r,updateFilters:i,clearRichHistoryResults:a,loadMoreRichHistory:l,richHistorySettings:d,height:g}=e,c=(0,D.useSelector)(J.Kl),u=(0,N.of)(rc,g),x=(0,ce.TR)();(0,p.useEffect)(()=>{const T=!d.activeDatasourcesOnly&&d.lastUsedDatasourceFilters?d.lastUsedDatasourceFilters:c.dsToExplore.map(w=>x.find(R=>R.uid===w.datasource?.uid)?.name).filter(w=>!!w),v={search:"",sortOrder:ce.xB.Descending,datasourceFilters:T,from:0,to:d.retentionPeriod,starred:!1};return i(v),()=>{a()}},[]);const{value:m,loading:C}=(0,kt.A)(async()=>{const v=x.map(w=>w.uid).map(async w=>{try{return(0,Pe.l)().get(w)}catch{return Promise.resolve()}});return v!==void 0?(await Promise.all(v)).filter(R=>!!R):[]},[r?.datasourceFilters]);if(!r)return(0,t.jsx)("span",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.loading",children:"Loading..."})});const y=(0,ce.x8)(s,r.sortOrder),b=Xn(),S=s.length&&s.length!==n,L=[r.from||0,r.to||d.retentionPeriod];return(0,t.jsxs)("div",{className:u.container,children:[(0,t.jsx)("div",{className:u.containerSlider,children:(0,t.jsxs)("div",{className:u.fixedSlider,children:[(0,t.jsx)("div",{className:u.labelSlider,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.filter-history",children:"Filter history"})}),(0,t.jsx)("div",{className:u.labelSlider,children:(0,ce.IA)(L[0])}),(0,t.jsx)("div",{className:u.slider,children:(0,t.jsx)(Ul.F,{tooltipAlwaysVisible:!1,min:0,max:d.retentionPeriod,value:L,orientation:"vertical",formatTooltipResult:ce.IA,reverse:!0,onAfterChange:T=>{i({from:T[0],to:T[1]})}})}),(0,t.jsx)("div",{className:u.labelSlider,children:(0,ce.IA)(L[1])})]})}),(0,t.jsxs)("div",{className:u.containerContent,"data-testid":"query-history-queries-tab",children:[(0,t.jsxs)("div",{className:u.selectors,children:[!d.activeDatasourcesOnly&&(0,t.jsx)(ke.KF,{className:u.multiselect,options:x.map(T=>({value:T.name,label:T.name})),value:r.datasourceFilters,placeholder:(0,j.t)("explore.rich-history-queries-tab.filter-placeholder","Filter queries for data sources(s)"),"aria-label":(0,j.t)("explore.rich-history-queries-tab.filter-aria-label","Filter queries for data sources(s)"),onChange:T=>{i({datasourceFilters:T.map(v=>v.value)})}}),(0,t.jsx)("div",{className:u.filterInput,children:(0,t.jsx)(Gn.Z,{escapeRegex:!1,placeholder:(0,j.t)("explore.rich-history-queries-tab.search-placeholder","Search queries"),value:r.search,onChange:T=>i({search:T})})}),(0,t.jsx)("div",{"aria-label":(0,j.t)("explore.rich-history-queries-tab.sort-aria-label","Sort queries"),className:u.sort,children:(0,t.jsx)(ke.l6,{value:b.filter(T=>T.value===r.sortOrder),options:b,placeholder:(0,j.t)("explore.rich-history-queries-tab.sort-placeholder","Sort queries by"),onChange:T=>i({sortOrder:T.value})})})]}),(o||C)&&(0,t.jsx)("span",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.loading-results",children:"Loading results..."})}),!(o||C)&&Object.keys(y).map(T=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:u.heading,children:[T," ",(0,t.jsx)("span",{className:u.queries,children:S?(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.displaying-partial-queries",defaults:"Displaying {{ count }} queries",values:{count:y[T].length}}):(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.displaying-queries",defaults:"{{ count }} queries",values:{count:y[T].length}})})]}),y[T].map(v=>(0,t.jsx)(Yn,{datasourceInstances:m,queryHistoryItem:v},v.id))]},T)),S?(0,t.jsx)("div",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:s.length,total:n},components:[(0,t.jsx)(V.$n,{onClick:l,children:"Load more"},"loadMoreButton")]})}):null,(0,t.jsx)("div",{className:u.footer,children:U.$.queryHistoryEnabled?"":(0,j.t)("explore.rich-history-queries-tab.history-local","The history is local to your browser and is not shared with others.")})]})]})}var ac=h(39640);const lc=e=>({container:(0,f.css)`
      font-size: ${e.typography.bodySmall.fontSize};
    `,spaceBetween:(0,f.css)`
      margin-bottom: ${e.spacing(3)};
    `,input:(0,f.css)`
      max-width: 200px;
    `,bold:(0,f.css)`
      font-weight: ${e.typography.fontWeightBold};
    `,bottomMargin:(0,f.css)`
      margin-bottom: ${e.spacing(1)};
    `}),Jn=[{value:2,label:(0,j.t)("explore.rich-history-settings-tab.retention-period.2-days","2 days")},{value:5,label:(0,j.t)("explore.rich-history-settings-tab.retention-period.5-days","5 days")},{value:7,label:(0,j.t)("explore.rich-history-settings-tab.retention-period.1-week","1 week")},{value:14,label:(0,j.t)("explore.rich-history-settings-tab.retention-period.2-weeks","2 weeks")}];function cc(e){const{retentionPeriod:s,starredTabAsFirstTab:n,activeDatasourcesOnly:o,onChangeRetentionPeriod:r,toggleStarredTabAsFirstTab:i,toggleActiveDatasourcesOnly:a,deleteRichHistory:l}=e,d=(0,N.of)(lc),g=Jn.find(u=>u.value===s),c=()=>{(0,Ae.J7)().publish(new ze.bY({title:(0,j.t)("explore.rich-history-settings-tab.delete-title","Delete"),text:(0,j.t)("explore.rich-history-settings-tab.delete-confirm-text","Are you sure you want to permanently delete your query history?"),yesText:(0,j.t)("explore.rich-history-settings-tab.delete-confirm","Delete"),icon:"trash-alt",onConfirm:()=>{l(),(0,tt.JD)((0,Gt.dx)((0,Kt.tZ)((0,j.t)("explore.rich-history-settings-tab.query-history-deleted","Query history deleted"))))}}))};return(0,t.jsxs)("div",{className:d.container,children:[(0,rt.gQ)().changeRetention?(0,t.jsx)(pe.D,{label:(0,j.t)("explore.rich-history-settings-tab.history-time-span","History time span"),description:(0,j.t)("explore.rich-history-settings-tab.history-time-span-description","Select the period of time for which Grafana will save your query history. Up to {{MAX_HISTORY_ITEMS}} entries will be stored.",{MAX_HISTORY_ITEMS:ac.$H}),children:(0,t.jsx)("div",{className:d.input,children:(0,t.jsx)(ke.l6,{value:g,options:Jn,onChange:r})})}):(0,t.jsx)(at.F,{severity:"info",title:(0,j.t)("explore.rich-history-settings-tab.history-time-span","History time span"),children:(0,j.t)("explore.rich-history-settings-tab.alert-info","Grafana will keep entries up to {{optionLabel}}.Starred entries won't be deleted.",{optionLabel:g?.label})}),(0,t.jsx)(Le.I,{label:(0,j.t)("explore.rich-history-settings-tab.change-default-tab","Change the default active tab from \u201CQuery history\u201D to \u201CStarred\u201D"),className:d.spaceBetween,children:(0,t.jsx)(Me.K,{id:"explore-query-history-settings-default-active-tab",value:n,onChange:i})}),(0,rt.gQ)().onlyActiveDataSource&&(0,t.jsx)(Le.I,{label:(0,j.t)("explore.rich-history-settings-tab.only-show-active-datasource","Only show queries for data source currently active in Explore"),className:d.spaceBetween,children:(0,t.jsx)(Me.K,{id:"explore-query-history-settings-data-source-behavior",value:o,onChange:a})}),(0,rt.gQ)().clearHistory&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:d.bold,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-settings-tab.clear-query-history",children:"Clear query history"})}),(0,t.jsx)("div",{className:d.bottomMargin,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-settings-tab.clear-history-info",children:"Delete all of your query history, permanently."})}),(0,t.jsx)(V.$n,{variant:"destructive",onClick:c,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-settings-tab.clear-query-history-button",children:"Clear query history"})})]})]})}const dc=e=>({container:(0,f.css)`
      display: flex;
    `,containerContent:(0,f.css)`
      width: 100%;
    `,selectors:(0,f.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,multiselect:(0,f.css)`
      width: 100%;
      margin-bottom: ${e.spacing(1)};
    `,filterInput:(0,f.css)`
      margin-bottom: ${e.spacing(1)};
    `,sort:(0,f.css)`
      width: 170px;
    `,footer:(0,f.css)`
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: ${e.typography.fontWeightLight};
      font-size: ${e.typography.bodySmall.fontSize};
      a {
        font-weight: ${e.typography.fontWeightMedium};
        margin-left: ${e.spacing(.25)};
      }
    `});function uc(e){const{updateFilters:s,clearRichHistoryResults:n,loadMoreRichHistory:o,richHistorySettings:r,queries:i,totalQueries:a,loading:l,richHistorySearchFilters:d}=e,g=(0,N.of)(dc),c=(0,D.useSelector)(J.Kl),u=(0,ce.TR)();(0,p.useEffect)(()=>{const y=r.activeDatasourcesOnly&&r.lastUsedDatasourceFilters?r.lastUsedDatasourceFilters:c.dsToExplore.map(S=>u.find(L=>L.uid===S.datasource?.uid)?.name).filter(S=>!!S),b={search:"",sortOrder:ce.xB.Descending,datasourceFilters:y,from:0,to:r.retentionPeriod,starred:!0};return s(b),()=>{n()}},[]);const{value:x,loading:m}=(0,kt.A)(async()=>{const b=await(d?.datasourceFilters&&d?.datasourceFilters.length>0?d?.datasourceFilters:u.map(S=>S.uid)).map(async S=>{try{return(0,Pe.l)().get(S)}catch{return Promise.resolve()}});return b!==void 0?(await Promise.all(b)).filter(L=>!!L):[]},[d?.datasourceFilters]);if(!d)return(0,t.jsxs)("span",{children:[(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-starred-tab.loading",children:"Loading..."}),";"]});const C=Xn();return(0,t.jsx)("div",{className:g.container,children:(0,t.jsxs)("div",{className:g.containerContent,children:[(0,t.jsxs)("div",{className:g.selectors,children:[!r.activeDatasourcesOnly&&(0,t.jsx)(ke.KF,{className:g.multiselect,options:u.map(y=>({value:y.name,label:y.name})),value:d.datasourceFilters,placeholder:(0,j.t)("explore.rich-history-starred-tab.filter-queries-placeholder","Filter queries for data sources(s)"),"aria-label":(0,j.t)("explore.rich-history-starred-tab.filter-queries-aria-label","Filter queries for data sources(s)"),onChange:y=>{s({datasourceFilters:y.map(b=>b.value)})}}),(0,t.jsx)("div",{className:g.filterInput,children:(0,t.jsx)(Gn.Z,{escapeRegex:!1,placeholder:(0,j.t)("explore.rich-history-starred-tab.search-queries-placeholder","Search queries"),value:d.search,onChange:y=>s({search:y})})}),(0,t.jsx)("div",{"aria-label":(0,j.t)("explore.rich-history-starred-tab.sort-queries-aria-label","Sort queries"),className:g.sort,children:(0,t.jsx)(ke.l6,{value:C.filter(y=>y.value===d.sortOrder),options:C,placeholder:(0,j.t)("explore.rich-history-starred-tab.sort-queries-placeholder","Sort queries by"),onChange:y=>s({sortOrder:y.value})})})]}),l&&m&&(0,t.jsx)("span",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-starred-tab.loading-results",children:"Loading results..."})}),!(l&&m)&&i.map(y=>(0,t.jsx)(Yn,{queryHistoryItem:y,datasourceInstances:x},y.id)),i.length&&i.length!==a?(0,t.jsx)("div",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-starred-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:i.length,total:a},components:[(0,t.jsx)(V.$n,{onClick:o,children:"Load more"},"loadMoreButton")]})}):null,(0,t.jsx)("div",{className:g.footer,children:U.$.queryHistoryEnabled?"":(0,j.t)("explore.rich-history-starred-tab.local-history-message","The history is local to your browser and is not shared with others.")})]})})}const Xn=()=>[{label:(0,j.t)("explore.rich-history.newest-first","Newest first"),value:ce.xB.Descending},{label:(0,j.t)("explore.rich-history.oldest-first","Oldest first"),value:ce.xB.Ascending},{label:(0,j.t)("explore.rich-history.datasource-a-z","Data source A-Z"),value:ce.xB.DatasourceAZ},{label:(0,j.t)("explore.rich-history.datasource-z-a","Data source Z-A"),value:ce.xB.DatasourceZA}].filter(e=>(0,rt.gQ)().availableFilters.includes(e.value));function pc(e){const{richHistory:s,richHistoryTotal:n,height:o,deleteRichHistory:r,onClose:i,firstTab:a}=e,[l,d]=(0,p.useState)(!1),{queryLibraryAvailable:g}=_e(),c=w=>{e.updateHistorySettings({...e.richHistorySettings,...w})},u=w=>{const R={...e.richHistorySearchFilters,...w,page:1};e.updateHistorySearchFilters(R),x()},x=(0,ne.debounce)(()=>{e.loadRichHistory(),d(!0)},300),m=w=>{w.value!==void 0&&c({retentionPeriod:w.value})},C=()=>c({starredTabAsFirstTab:!e.richHistorySettings.starredTabAsFirstTab}),y=()=>c({activeDatasourcesOnly:!e.richHistorySettings.activeDatasourcesOnly});(0,p.useEffect)(()=>{d(!1)},[s]);const b={label:Bt.queryLibrary,value:Ve.QueryLibrary,content:(0,t.jsx)(Vl,{}),icon:"book"},S={label:Bt.queryHistory,value:Ve.RichHistory,content:(0,t.jsx)(ic,{queries:s,totalQueries:n||0,loading:l,updateFilters:u,clearRichHistoryResults:()=>e.clearRichHistoryResults(),loadMoreRichHistory:()=>e.loadMoreRichHistory(),richHistorySettings:e.richHistorySettings,richHistorySearchFilters:e.richHistorySearchFilters,height:o}),icon:"history"},L={label:(0,j.t)("explore.rich-history.starred","Starred"),value:Ve.Starred,content:(0,t.jsx)(uc,{queries:s,totalQueries:n||0,loading:l,updateFilters:u,clearRichHistoryResults:()=>e.clearRichHistoryResults(),loadMoreRichHistory:()=>e.loadMoreRichHistory(),richHistorySettings:e.richHistorySettings,richHistorySearchFilters:e.richHistorySearchFilters}),icon:"star"},T={label:(0,j.t)("explore.rich-history.settings","Settings"),value:Ve.Settings,content:(0,t.jsx)(cc,{retentionPeriod:e.richHistorySettings.retentionPeriod,starredTabAsFirstTab:e.richHistorySettings.starredTabAsFirstTab,activeDatasourcesOnly:e.richHistorySettings.activeDatasourcesOnly,onChangeRetentionPeriod:m,toggleStarredTabAsFirstTab:C,toggleActiveDatasourcesOnly:y,deleteRichHistory:r}),icon:"sliders-v-alt"};let v=(g?[b]:[]).concat([S,L,T]);return(0,t.jsx)(Vn.q,{tabs:v,onClose:i,defaultTab:a,closeIconTooltip:(0,j.t)("explore.rich-history.close-tooltip","Close query history"),testId:nt.Tp.pages.Explore.QueryHistory.container})}function hc(e){const s=e.explore,n=s.richHistorySearchFilters,{richHistorySettings:o,richHistory:r,richHistoryTotal:i}=s;return{richHistory:r,richHistoryTotal:i,richHistorySettings:o,richHistorySearchFilters:n}}const gc={initRichHistory:Ie.PA,loadRichHistory:Ie.jX,loadMoreRichHistory:Ie.Uu,clearRichHistoryResults:Ie.wk,updateHistorySettings:Ie.fP,updateHistorySearchFilters:Ie.Bj,deleteRichHistory:Ie.s1},fc=(0,Se.connect)(hc,gc);function mc(e){const s=(0,N.$j)(),{richHistory:n,richHistoryTotal:o,deleteRichHistory:r,initRichHistory:i,loadRichHistory:a,loadMoreRichHistory:l,clearRichHistoryResults:d,richHistorySettings:g,updateHistorySettings:c,richHistorySearchFilters:u,updateHistorySearchFilters:x,onClose:m}=e;(0,p.useEffect)(()=>{i()},[i]);const{selectedTab:C}=_e(),[y,b]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{y||(b(!0),(0,z.rR)("grafana_explore_query_history_opened",{queryHistoryEnabled:U.$.queryHistoryEnabled,selectedTab:C}))},[y,C]),!g||!C?(0,t.jsx)("span",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-container.loading",children:"Loading..."})}):(0,t.jsx)(pc,{richHistory:n,richHistoryTotal:o,firstTab:C,onClose:m,height:s.components.horizontalDrawer.defaultHeight,deleteRichHistory:r,richHistorySettings:g,richHistorySearchFilters:u,updateHistorySettings:c,updateHistorySearchFilters:x,loadRichHistory:a,loadMoreRichHistory:l,clearRichHistoryResults:d})}const yc=fc(mc);var _n=h(19361),eo=h(15961);function xc(e){const s=(0,$s.C)("explore"),{chrome:n}=(0,St.Il)();(0,p.useEffect)(()=>{if(!e.panes||typeof e.panes!="string")return;let o;try{o=JSON.parse(e.panes)}catch{return}typeof o!="object"||o===null||Promise.allSettled(Object.values(o).map(r=>!r||typeof r!="object"||!(0,eo.C)("datasource",r)||!r.datasource||typeof r.datasource!="string"?Promise.reject():(0,Pe.l)().get(r.datasource))).then(r=>r.filter(eo.s).map(i=>i.value)).then(r=>{if(r.length===0){h.g.document.title=`${s.main.text} - ${_n.M.AppTitle}`,n.update({pageNav:void 0});return}const i=r.map(a=>a.name).join(" | ");n.update({pageNav:{text:i}}),h.g.document.title=`${s.main.text} - ${i} - ${_n.M.AppTitle}`})},[e.panes,s.main.text,n])}function vc(){const{keybindings:e}=(0,St.Il)(),s=(0,D.useDispatch)();(0,p.useEffect)(()=>{e.setupTimeRangeBindings(!1);const n=[];return n.push((0,Ae.J7)().subscribe(ze.Rh,()=>{s((0,xe.$_)())})),n.push((0,Ae.J7)().subscribe(ze.Io,o=>{s((0,xe.Iy)(o.payload.direction))})),n.push((0,Ae.J7)().subscribe(ze.U0,o=>{s((0,xe.ke)(o.payload.scale))})),n.push((0,Ae.J7)().subscribe(ze.Bt,()=>{s((0,xe.Xk)())})),n.push((0,Ae.J7)().subscribe(ze.VZ,()=>{s((0,xe.GA)())})),()=>{n.forEach(o=>o.unsubscribe())}},[s,e])}const bc=e=>{const s=(0,D.useDispatch)(),{width:n}=(0,Rs.A)(),o=(0,D.useSelector)(J.K6),r=(0,D.useSelector)(J.pF),[i,a]=(0,p.useState)(.5),l=(0,D.useSelector)(c=>c.explore),d=c=>{const u=n/2,x=(0,ne.inRange)(c,u-100,u+100);s(x?(0,Y.nD)({largerExploreId:void 0}):(0,Y.nD)({largerExploreId:c>u?o[1][0]:o[0][0]})),a(c/n)};let g=0;return r&&(!l.evenSplitPanes&&l.maxedExploreId?g=l.maxedExploreId===o[1][0]?n-e:e:l.evenSplitPanes?g=Math.floor(n/2):i!==void 0&&(g=n*i)),{updateSplitSize:d,widthCalc:g}};function Sc(){const{location:e}=(0,St.Il)();(0,p.useEffect)(()=>{const s=e.getSearchObject();(s.from||s.to)&&e.partial({from:void 0,to:void 0},!0)},[e])}const Es=200;function Cc(e){return(0,t.jsx)(xr,{children:(0,t.jsx)(jc,{...e})})}function jc(e){const s=(0,N.of)(wc),n=(0,N.$j)();Sc(),(0,Sn.s)(e.queryParams),xc(e.queryParams);const{chrome:o}=(0,St.Il)(),r=(0,$s.C)("explore"),{updateSplitSize:i,widthCalc:a}=bc(Es),l=(0,D.useSelector)(J.K6),d=(0,D.useSelector)(J.pF),g=(0,D.useSelector)(J.vC),{drawerOpened:c,setDrawerOpened:u,queryLibraryAvailable:x}=_e(),m=U.$.featureToggles.correlations&&(g?.editorMode||!1);return(0,p.useEffect)(()=>{o.update({sectionNav:r})},[o,r]),vc(),(0,t.jsxs)("div",{className:(0,f.cx)(s.pageScrollbarWrapper,{[s.correlationsEditorIndicator]:m}),children:[(0,t.jsx)("h1",{className:"sr-only",children:(0,t.jsx)(j.x6,{i18nKey:"nav.explore.title"})}),(0,t.jsx)(To,{}),m&&(0,t.jsx)(wo,{panes:l}),(0,t.jsx)(es.g,{splitOrientation:"vertical",paneSize:a,minSize:Es,maxSize:Es*-1,primary:"second",splitVisible:d,parentStyle:m?{height:`calc(100% - ${n.spacing(6)}`}:{},paneStyle:{overflow:"auto",display:"flex",flexDirection:"column"},onDragFinished:C=>C&&i(C),children:l.map(([C])=>(0,t.jsx)(se.Xw,{style:"page",children:(0,t.jsx)(vl,{exploreId:C})},C))}),c&&(0,t.jsx)(Ks,{initialHeight:x?"75vh":void 0,children:(0,t.jsx)(yc,{onClose:()=>{u(!1)}})})]})}const wc=e=>({pageScrollbarWrapper:(0,f.css)({width:"100%",flexGrow:1,minHeight:0,height:"100%",position:"relative",overflow:"hidden"}),correlationsEditorIndicator:(0,f.css)({borderLeft:`4px solid ${e.colors.primary.main}`,borderRight:`4px solid ${e.colors.primary.main}`,borderBottom:`4px solid ${e.colors.primary.main}`,overflow:"scroll"})})},10940:(Hs,Ze,h)=>{h.d(Ze,{A:()=>p});var t=h(96540),f=function(U,N){var se=(0,t.useRef)(function(){});(0,t.useEffect)(function(){se.current=U}),(0,t.useEffect)(function(){if(N!==null){var es=setInterval(function(){return se.current()},N||0);return function(){return clearInterval(es)}}},[N])};const p=f}}]);

//# sourceMappingURL=explore.4ed30cde05305b3a9978.js.map