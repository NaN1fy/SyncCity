"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3704],{19925:(zt,B,s)=>{s.r(B),s.d(B,{default:()=>Ft});var t=s(74848),D=s(32264),I=s(42418),J=s(69444),e=s(8484),h=s(90613),m=s(67061),r=s(94753),T=s(72109);const C=({children:n,title:o,linkHref:a,linkTitle:i})=>(0,t.jsxs)(m.B,{gap:2,direction:"column",children:[(0,t.jsx)(r.E,{element:"h4",children:o}),(0,t.jsx)(r.E,{color:"secondary",children:n}),a&&(0,t.jsx)(T.Y,{href:a,external:!0,children:i??a})]}),q=()=>(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.migrate-to-this-stack.title","Let us help you migrate to this stack"),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migrate-to-this-stack.body",children:"You can migrate some resources from your self-managed Grafana installation to this cloud stack. To do this securely, you'll need to generate a migration token. Your self-managed instance will use the token to authenticate with this cloud stack."})});var G=s(32196),K=s(40845);const _=()=>{const n=(0,K.of)(tt);return(0,t.jsxs)(h.a,{alignItems:"flex-start",display:"flex",direction:"column",gap:2,children:[(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.get-started.title","Performing a migration"),linkTitle:(0,e.t)("migrate-to-cloud.get-started.link-title","Learn more about Private Data Source Connect"),linkHref:"https://grafana.com/docs/grafana-cloud/connect-externally-hosted/private-data-source-connect",children:(0,t.jsxs)(m.B,{direction:"column",gap:2,children:[(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.body",children:"The migration process must be started from your self-managed Grafana instance."}),(0,t.jsxs)("ol",{className:n.list,children:[(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-1",children:"Log in to your self-managed instance and navigate to Administration, General, Migrate to Grafana Cloud."})}),(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-2",children:'Select "Migrate this instance to Cloud".'})}),(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-3",children:"You'll be prompted for a migration token. Generate one from this screen."})}),(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-4",children:'In your self-managed instance, select "Upload everything" to upload data sources and dashboards to this cloud stack.'})}),(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-5",children:"If some of your data sources will not work over the public internet, you\u2019ll need to install Private Data Source Connect in your self-managed environment."})})]})]})}),(0,t.jsx)(T.Y,{href:"/connections/private-data-source-connections",children:(0,e.t)("migrate-to-cloud.get-started.configure-pdc-link","Configure PDC for this stack")}),(0,t.jsx)(T.Y,{href:"https://grafana.com/docs/grafana-cloud/account-management/migration-guide",children:(0,e.t)("migrate-to-cloud.migrate-to-this-stack.link-title","View the full migration guide")})]})},tt=n=>({list:(0,G.css)({padding:"revert"})});var g=s(96540),et=s(17172),x=s(55852),y=s(59120);function O(){return(0,t.jsx)(I.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.migration-token.error-title","Something went wrong"),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.error-body",children:"Unable to generate a migration token. Please try again later."})})}var w=s(37390),R=s(10534),U=s(88575),F=s(10354);const nt=({isOpen:n,hideModal:o,migrationToken:a})=>(0,t.jsxs)(w.a,{isOpen:n,title:(0,e.t)("migrate-to-cloud.migration-token.modal-title","Migration token created"),onDismiss:o,children:[a?(0,t.jsx)(ot,{migrationToken:a}):(0,t.jsx)(O,{}),(0,t.jsxs)(w.a.ButtonRow,{children:[(0,t.jsx)(x.$n,{variant:"secondary",onClick:o,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-close",children:"Close"})}),a&&(0,t.jsx)(R.b,{variant:"primary",getText:()=>a,onClipboardCopy:o,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-copy-and-close",children:"Copy to clipboard and close"})})]})]});function ot({migrationToken:n}){const o=(0,g.useId)();return(0,t.jsx)(U.D,{description:(0,e.t)("migrate-to-cloud.migration-token.modal-field-description","Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."),htmlFor:o,label:(0,e.t)("migrate-to-cloud.migration-token.modal-field-label","Token"),children:(0,t.jsxs)(m.B,{children:[(0,t.jsx)(F.p,{id:o,value:n,readOnly:!0}),(0,t.jsx)(R.b,{icon:"clipboard-alt",getText:()=>n,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-copy-button",children:"Copy to clipboard"})})]})})}var Y=s(96374);function at(n){const{isOpen:o,hasError:a,onConfirm:i,onDismiss:l}=n,d=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.delete-migration-token-confirm.body",children:"If you've already used this token with a self-managed installation, that installation will no longer be able to upload content."})}),a&&(0,t.jsx)(I.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.delete-migration-token-confirm.error-title","Error deleting token")})]});return(0,t.jsx)(Y.u,{isOpen:o,title:(0,e.t)("migrate-to-cloud.delete-migration-token-confirm.title","Delete migration token"),body:d,confirmText:(0,e.t)("migrate-to-cloud.delete-migration-token-confirm.confirm-button","Delete token"),onConfirm:i,onDismiss:l})}var A=s(70255);const it=({hasToken:n,errorMessageId:o,isFetching:a})=>a?(0,t.jsx)(A.A,{width:100}):n?(0,t.jsx)(r.E,{color:"success",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.token-status.active",children:"Token created and active"})}):o==="cloudmigrations.tokenNotFound"?(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.token-status.no-active",children:"No active token"}):o?(0,t.jsx)(r.E,{color:"error",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.token-status.unknown-error",children:"Error retrieving token"})}):(0,t.jsx)(r.E,{color:"warning",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.token-status.unknown",children:"Unknown"})});function st(n){if(!(0,et.NF)(n)||typeof n.data!="object"||!n.data)return null;const o=n?.data,a="message"in o&&typeof o.message=="string"?o.message:null,i="messageId"in o&&typeof o.messageId=="string"?o.messageId:null,l="statusCode"in o&&typeof o.statusCode=="number"?o.statusCode:null;return!a||!i||!l?null:{message:a,messageId:i,statusCode:l}}const rt=()=>{const[n,o]=(0,g.useState)(!1),[a,i]=(0,g.useState)(!1),l=(0,y.YX)(),[d,c]=(0,y.dX)(),[f,b]=(0,y.WH)(),k=st(l.error),v=!!l.data?.id&&k?.statusCode!==404,p=l.isFetching||c.isLoading,u=(0,g.useCallback)(async()=>{"error"in await d()||o(!0)},[d]),j=(0,g.useCallback)(async()=>{if(!l.data?.id)return;"error"in await f({uid:l.data.id})||i(!1)},[f,l.data]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.a,{display:"flex",alignItems:"flex-start",direction:"column",gap:2,children:[c?.isError?(0,t.jsx)(O,{}):(0,t.jsx)(r.E,{color:"secondary",children:(0,t.jsxs)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.status",children:["Current status:"," ",(0,t.jsx)(it,{hasToken:v,isFetching:p,errorMessageId:k?.messageId})]})}),v?(0,t.jsx)(x.$n,{onClick:()=>i(!0),variant:"destructive",children:(0,e.t)("migrate-to-cloud.migration-token.delete-button","Delete token")}):(0,t.jsx)(x.$n,{disabled:p,onClick:u,children:c.isLoading?(0,e.t)("migrate-to-cloud.migration-token.generate-button-loading","Generating a migration token..."):(0,e.t)("migrate-to-cloud.migration-token.generate-button","Generate a migration token")})]}),(0,t.jsx)(nt,{isOpen:n,hideModal:()=>o(!1),migrationToken:c.data?.token}),(0,t.jsx)(at,{isOpen:a,onConfirm:j,onDismiss:()=>i(!1),hasError:!!b.error})]})},lt=()=>(0,t.jsx)(h.a,{backgroundColor:"secondary",display:"flex",alignItems:"center",direction:"column",children:(0,t.jsxs)(h.a,{maxWidth:90,paddingY:6,paddingX:2,gap:6,direction:"column",display:"flex",children:[(0,t.jsxs)(m.B,{gap:2,direction:"column",children:[(0,t.jsx)(q,{}),(0,t.jsx)(rt,{})]}),(0,t.jsx)(_,{})]})});var $=s(10378);const ct=({isOpen:n,isError:o,isLoading:a,onDisconnectConfirm:i,onDismiss:l})=>{const d=(0,t.jsxs)(m.B,{direction:"column",children:[o&&(0,t.jsx)(I.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.disconnect-modal.error","There was an error disconnecting")}),(0,t.jsx)("div",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.disconnect-modal.body",children:"This will remove the migration token from this installation. If you wish to upload more resources in the future, you will need to enter a new migration token."})})]});return(0,t.jsx)(Y.u,{isOpen:n,title:(0,e.t)("migrate-to-cloud.disconnect-modal.title","Disconnect from cloud stack"),body:(0,t.jsx)(t.Fragment,{}),description:d,confirmText:a?(0,e.t)("migrate-to-cloud.disconnect-modal.disconnecting","Disconnecting..."):(0,e.t)("migrate-to-cloud.disconnect-modal.disconnect","Disconnect"),dismissText:(0,e.t)("migrate-to-cloud.disconnect-modal.cancel","Cancel"),onConfirm:i,onDismiss:l})};var dt=s(71259),ut=s(49785);const gt=({isOpen:n,isLoading:o,isError:a,hideModal:i,onConfirm:l})=>{const d=(0,g.useId)(),c=(0,K.of)(mt),{handleSubmit:f,register:b,formState:{errors:k},watch:v}=(0,ut.mN)({defaultValues:{token:""}}),p=v("token"),u=j=>{l({cloudMigrationSessionRequestDto:{authToken:j.token}}).then(S=>{typeof S=="object"&&S&&"error"in S||i()})};return(0,t.jsx)(w.a,{isOpen:n,title:(0,e.t)("migrate-to-cloud.connect-modal.title","Connect to a cloud stack"),onDismiss:i,children:(0,t.jsxs)("form",{onSubmit:f(u),children:[(0,t.jsx)(r.E,{color:"secondary",children:(0,t.jsxs)(m.B,{direction:"column",gap:2,children:[(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-get-started",children:"To get started, you'll need a Grafana.com account."}),(0,t.jsx)("div",{children:(0,t.jsx)(T.Y,{href:"https://grafana.com/auth/sign-up/create-user?pg=prod-cloud",external:!0,children:(0,e.t)("migrate-to-cloud.connect-modal.body-sign-up","Sign up for a Grafana.com account")})}),(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-cloud-stack",children:"You'll also need a cloud stack. If you just signed up, we'll automatically create your first stack. If you have an account, you'll need to select or create a stack."}),(0,t.jsx)("div",{children:(0,t.jsx)(T.Y,{href:"https://grafana.com/auth/sign-in/",external:!0,children:(0,e.t)("migrate-to-cloud.connect-modal.body-view-stacks","View my cloud stacks")})}),(0,t.jsx)("div",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-token",children:"Your self-managed Grafana installation needs special access to securely migrate content. You'll need to create a migration token on your chosen cloud stack."})}),(0,t.jsx)("div",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-token-instructions",children:"Log into your cloud stack and navigate to Administration, General, Migrate to Grafana Cloud. Create a migration token on that screen and paste the token here."})}),a&&(0,t.jsx)(I.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.connect-modal.token-error-title","Error saving token"),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.token-error-description",children:"There was an error saving the token. See the Grafana server logs for more details."})}),(0,t.jsx)(U.D,{className:c.field,invalid:!!k.token,error:k.token?.message,label:(0,e.t)("migrate-to-cloud.connect-modal.body-token-field","Migration token"),required:!0,children:(0,t.jsx)(F.p,{...b("token",{required:(0,e.t)("migrate-to-cloud.connect-modal.token-required-error","Migration token is required")}),id:d,placeholder:(0,e.t)("migrate-to-cloud.connect-modal.body-token-field-placeholder","Paste token here")})})]})}),(0,t.jsxs)(w.a.ButtonRow,{children:[(0,t.jsx)(x.$n,{variant:"secondary",onClick:i,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.cancel",children:"Cancel"})}),(0,t.jsx)(x.$n,{type:"submit",disabled:o||!p,children:o?(0,e.t)("migrate-to-cloud.connect-modal.connecting","Connecting to this stack..."):(0,e.t)("migrate-to-cloud.connect-modal.connect","Connect to this stack")})]})]})})},mt=n=>({field:(0,G.css)({alignSelf:"stretch"})}),ht=()=>{const[n,o]=(0,g.useState)(!1),[a,i]=(0,y.hZ)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.a,{display:"flex",gap:2,direction:"column",alignItems:"center",backgroundColor:"secondary",children:[(0,t.jsx)(r.E,{variant:"h3",textAlignment:"center",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.cta.header",children:"Let us manage your Grafana stack"})}),(0,t.jsx)(x.$n,{disabled:i.isLoading,onClick:()=>o(!0),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.cta.button",children:"Migrate this instance to Cloud"})})]}),(0,t.jsx)(gt,{isOpen:n,isLoading:i.isLoading,isError:i.isError,onConfirm:a,hideModal:()=>o(!1)})]})},xt=()=>(0,t.jsxs)(m.B,{gap:4,direction:"column",children:[(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.what-is-cloud.title","What is Grafana Cloud?"),linkTitle:(0,e.t)("migrate-to-cloud.what-is-cloud.link-title","Learn about cloud features"),linkHref:"https://grafana.com/products/cloud",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.what-is-cloud.body",children:"Grafana cloud is a fully managed cloud-hosted observability platform ideal for cloud native environments. It's everything you love about Grafana without the overhead of maintaining, upgrading, and supporting an installation."})}),(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.why-host.title","Why host with Grafana?"),linkTitle:(0,e.t)("migrate-to-cloud.why-host.link-title","More questions? Talk to an expert"),linkHref:"https://grafana.com/contact",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.why-host.body",children:"In addition to the convenience of managed hosting, Grafana Cloud includes many cloud-exclusive features like SLOs, incident management, machine learning, and powerful observability integrations."})}),(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.is-it-secure.title","Is it secure?"),linkTitle:(0,e.t)("migrate-to-cloud.is-it-secure.link-title","Grafana Labs Trust Center"),linkHref:"https://trust.grafana.com",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.is-it-secure.body",children:"Grafana Labs is committed to maintaining the highest standards of data privacy and security. By implementing industry-standard security technologies and procedures, we help protect our customers' data from unauthorized access, use, or disclosure."})})]}),yt=()=>(0,t.jsxs)(m.B,{gap:4,direction:"column",children:[(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.pdc.title","Not all my data sources are on the public internet"),linkTitle:(0,e.t)("migrate-to-cloud.pdc.link-title","Learn about PDC"),linkHref:"https://grafana.com/docs/grafana-cloud/connect-externally-hosted/private-data-source-connect",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.pdc.body",children:"Exposing your data sources to the internet can raise security concerns. Private data source connect (PDC) allows Grafana Cloud to access your existing data sources over a secure network tunnel."})}),(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.pricing.title","How much does it cost?"),linkTitle:(0,e.t)("migrate-to-cloud.pricing.link-title","Grafana Cloud pricing"),linkHref:"https://grafana.com/pricing",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.pricing.body",children:"Grafana Cloud has a generous free plan and a 14 day unlimited usage trial. After your trial expires, you'll be billed based on usage over the free plan limits."})}),(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.can-i-move.title","Can I move this installation to Grafana Cloud?"),linkTitle:(0,e.t)("migrate-to-cloud.can-i-move.link-title","Learn about migrating other settings"),linkHref:"https://grafana.com/docs/grafana-cloud/account-management/migration-guide",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.can-i-move.body",children:"Once you connect this installation to a cloud stack, you'll be able to upload data sources and dashboards."})})]}),pt=()=>(0,t.jsx)(h.a,{backgroundColor:"secondary",display:"flex",alignItems:"center",direction:"column",children:(0,t.jsx)(h.a,{maxWidth:180,paddingY:6,paddingX:2,children:(0,t.jsxs)(m.B,{gap:5,direction:"column",children:[(0,t.jsx)(ht,{}),(0,t.jsxs)(dt.x,{alignItems:"flex-start",gap:4,columns:{xs:1,lg:2},children:[(0,t.jsx)(xt,{}),(0,t.jsx)(yt,{})]})]})})});var ft=s(68402);function E({title:n,children:o}){return(0,t.jsxs)(h.a,{minWidth:{xs:0,xxl:16},display:"flex",direction:"column",children:[(0,t.jsx)(r.E,{variant:"bodySmall",color:"secondary",children:n}),(0,t.jsx)(r.E,{variant:"h4",children:o})]})}function jt(n){const{session:o,snapshot:a,isBusy:i,disconnectIsLoading:l,onDisconnect:d,showBuildSnapshot:c,buildSnapshotIsLoading:f,onBuildSnapshot:b,showUploadSnapshot:k,uploadSnapshotIsLoading:v,onUploadSnapshot:p}=n;return(0,t.jsxs)(h.a,{borderColor:"weak",borderStyle:"solid",padding:2,display:"flex",gap:4,alignItems:"center",justifyContent:"space-between",children:[(0,t.jsxs)(m.B,{gap:4,wrap:"wrap",children:[(0,t.jsx)(E,{title:(0,e.t)("migrate-to-cloud.summary.snapshot-date","Snapshot timestamp"),children:a?.created?a?.created:(0,t.jsx)(r.E,{color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.snapshot-not-created",children:"Not yet created"})})}),(0,t.jsx)(E,{title:(0,e.t)("migrate-to-cloud.summary.total-resource-count","Total resources"),children:0}),(0,t.jsx)(E,{title:(0,e.t)("migrate-to-cloud.summary.errored-resource-count","Errors"),children:0}),(0,t.jsx)(E,{title:(0,e.t)("migrate-to-cloud.summary.successful-resource-count","Successfully migrated"),children:0}),(0,t.jsxs)(E,{title:(0,e.t)("migrate-to-cloud.summary.target-stack-title","Uploading to"),children:[o.slug,(0,t.jsx)(ft.$,{h:1,layout:"inline"}),(0,t.jsx)(x.$n,{disabled:i,onClick:d,variant:"secondary",size:"sm",icon:l?"spinner":void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.disconnect",children:"Disconnect"})})]})]}),c&&(0,t.jsx)(x.$n,{disabled:i,onClick:b,icon:f?"spinner":void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.start-migration",children:"Build snapshot"})}),k&&(0,t.jsx)(x.$n,{disabled:i||v,onClick:p,icon:v?"spinner":void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.upload-migration",children:"Upload snapshot"})})]})}var kt=s(48840),P=s(14578),H=s(78318);function vt(n){const o=n.row.original;return(0,t.jsxs)(m.B,{direction:"row",gap:2,alignItems:"center",children:[(0,t.jsx)(Tt,{resource:o}),(0,t.jsx)(m.B,{direction:"column",gap:0,children:o.type==="DATASOURCE"?(0,t.jsx)(bt,{data:o}):(0,t.jsx)(St,{data:o})})]})}function Ct(n){if("title"in n&&typeof n.title=="string")return n.title}function bt({data:n}){const o=n.refId,a=z(o);return a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:a.name}),(0,t.jsx)(r.E,{color:"secondary",children:a.type})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.E,{children:(0,t.jsxs)(e.x6,{i18nKey:"migrate-to-cloud.resource-table.unknown-datasource-title",children:["Data source ",{datasourceUID:o}]})}),(0,t.jsx)(r.E,{color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.resource-table.unknown-datasource-type",children:"Unknown data source"})})]})}function St({data:n}){const o=n.refId,{data:a,isError:i}=(0,y.bM)({uid:o}),l=(0,g.useMemo)(()=>(a?.dashboard&&Ct(a.dashboard))??o,[a,o]);return i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.E,{italic:!0,children:"Unable to load dashboard"}),(0,t.jsxs)(r.E,{color:"secondary",children:["Dashboard ",o]})]}):a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:l}),(0,t.jsx)(r.E,{color:"secondary",children:a.meta?.folderTitle??"Dashboards"})]}):(0,t.jsx)(It,{})}function It(){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.A,{width:250}),(0,t.jsx)(A.A,{width:130})]})}function Tt({resource:n}){const o=(0,K.of)(Et),a=z(n.type==="DATASOURCE"?n.refId:void 0);if(n.type==="DASHBOARD")return(0,t.jsx)(P.I,{size:"xl",name:"dashboard"});if(n.type==="DATASOURCE"&&a?.meta?.info?.logos?.small)return(0,t.jsx)("img",{className:o.icon,src:a.meta.info.logos.small,alt:""});if(n.type==="DATASOURCE")return(0,t.jsx)(P.I,{size:"xl",name:"database"})}function Et(){return{icon:(0,G.css)({display:"block",width:(0,H.cs)("xl"),height:(0,H.cs)("xl")})}}function z(n){return(0,g.useMemo)(()=>{if(n)return D.$.datasources[n]||Object.values(D.$.datasources).find(a=>a.uid===n)},[n])}function Lt(n){const{status:o,error:a}=n.row.original;return o==="PENDING"?(0,t.jsx)(r.E,{color:"secondary",children:(0,e.t)("migrate-to-cloud.resource-status.not-migrated","Not yet uploaded")}):o==="OK"?(0,t.jsx)(r.E,{color:"success",children:(0,e.t)("migrate-to-cloud.resource-status.migrated","Uploaded to cloud")}):o==="ERROR"?(0,t.jsxs)(m.B,{alignItems:"center",children:[(0,t.jsx)(r.E,{color:"error",children:(0,e.t)("migrate-to-cloud.resource-status.failed","Error")}),a&&(0,t.jsx)(x.$n,{size:"sm",variant:"secondary",onClick:()=>window.alert(a),children:(0,e.t)("migrate-to-cloud.resource-status.error-details-button","Details")})]}):(0,t.jsx)(r.E,{color:"secondary",children:(0,e.t)("migrate-to-cloud.resource-status.unknown","Unknown")})}function Dt(n){const{type:o}=n.row.original;switch(o){case"DATASOURCE":return(0,e.t)("migrate-to-cloud.resource-type.datasource","Data source");case"DASHBOARD":return(0,e.t)("migrate-to-cloud.resource-type.dashboard","Dashboard");case"FOLDER":return(0,e.t)("migrate-to-cloud.resource-type.folder","Folder");default:return(0,e.t)("migrate-to-cloud.resource-type.unknown","Unknown")}}const wt=[{id:"name",header:"Name",cell:vt},{id:"type",header:"Type",cell:Dt},{id:"status",header:"Status",cell:Lt}];function Gt({resources:n}){return(0,t.jsx)(kt.j,{columns:wt,data:n,getRowId:o=>o.refId,pageSize:15})}var Kt=s(62930);function W(n){const{title:o,accessory:a,children:i}=n;return(0,t.jsxs)(h.a,{maxWidth:44,display:"flex",direction:"row",gap:1,alignItems:"flex-start",children:[a&&(0,t.jsx)(h.a,{children:a}),(0,t.jsxs)(m.B,{gap:2,direction:"column",alignItems:"flex-start",children:[(0,t.jsx)(r.E,{element:"h3",variant:"h5",children:o}),i]})]})}function At(n){const{disabled:o,isLoading:a,onClick:i}=n;return(0,t.jsxs)(W,{title:(0,e.t)("migrate-to-cloud.build-snapshot.title","No snapshot exists"),accessory:(0,t.jsx)(P.I,{name:"cog",size:"lg"}),children:[(0,t.jsx)(r.E,{element:"p",variant:"body",color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.build-snapshot.description",children:"This tool can migrate some resources from this installation to your cloud stack. To get started, you'll need to create a snapshot of this installation. Creating a snapshot typically takes less than two minutes. The snapshot is stored alongside this Grafana installation."})}),(0,t.jsx)(r.E,{element:"p",variant:"body",color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.build-snapshot.when-complete",children:"Once the snapshot is complete, you will be able to upload it to your cloud stack."})}),(0,t.jsx)(x.$n,{disabled:o,onClick:i,icon:a?"spinner":void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.start-migration",children:"Build snapshot"})})]})}function Pt(n){const{disabled:o,isLoading:a,onClick:i}=n;return(0,t.jsxs)(W,{title:(0,e.t)("migrate-to-cloud.building-snapshot.title","Building installation snapshot"),accessory:(0,t.jsx)(Kt.y,{inline:!0}),children:[(0,t.jsx)(r.E,{element:"p",variant:"body",color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.building-snapshot.description",children:"We're creating a point-in-time snapshot of the current state of this installation. Once the snapshot is complete. you'll be able to upload it to Grafana Cloud."})}),(0,t.jsx)(r.E,{element:"p",variant:"body",color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.building-snapshot.description-eta",children:"Creating a snapshot typically takes less than two minutes."})}),(0,t.jsx)(x.$n,{disabled:o,onClick:i,icon:a?"spinner":void 0,variant:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.cancel-snapshot",children:"Cancel snapshot"})})]})}function Mt(){const n=(0,y.SM)(),o=n.data?.sessions?.at(-1);return{...n,data:o}}const Nt=["INITIALIZING","CREATING","UPLOADING","PENDING_PROCESSING","PROCESSING"],Bt=["INITIALIZING","CREATING"],V=["UPLOADING","PENDING_PROCESSING","PROCESSING"],Ot=5*1e3;function Rt(n){const[o,a]=(0,g.useState)(!1),i=(0,y.M8)(n?{uid:n}:$.hT),l=i.data?.snapshots?.at(-1),d=n&&l?.uid?{uid:n,snapshotUid:l.uid}:$.hT,c=(0,y.YD)(d,{pollingInterval:o?Ot:0,skipPollingIfUnfocused:!0});return(0,g.useEffect)(()=>{const f=Nt.includes(c.data?.status);a(f)},[c?.data?.status]),{...c,error:i.error||c.error,isError:i.isError||c.isError,isLoading:i.isLoading||c.isLoading,isFetching:i.isFetching||c.isFetching}}const Ut=()=>{const[n,o]=(0,g.useState)(!1),a=Mt(),i=Rt(a.data?.uid),[l,d]=(0,y.ri)(),[c,f]=(0,y.aD)(),[b,k]=(0,y.r3)(),[v,p]=(0,y.AC)(),u=a.data?.uid,j=i.data?.uid,S=a.isLoading,L=i.data?.status,M=d.isLoading||f.isLoading||k.isLoading||a.isLoading||i.isLoading||p.isLoading,N=!i.isLoading&&!i.data,X=Bt.includes(L),Yt=L==="PENDING_UPLOAD"||V.includes(L),Q=(0,g.useCallback)(async()=>{u&&v({uid:u})},[v,u]),Z=(0,g.useCallback)(()=>{u&&l({uid:u})},[l,u]),$t=(0,g.useCallback)(()=>{u&&j&&c({uid:u,snapshotUid:j})},[c,u,j]),Ht=(0,g.useCallback)(()=>{u&&j&&b({uid:u,snapshotUid:j})},[b,u,j]);return S?(0,t.jsx)("div",{children:"Loading..."}):a.data?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(m.B,{direction:"column",gap:4,children:[d.isError&&(0,t.jsx)(I.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.summary.run-migration-error-title","There was an error migrating your resources"),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.run-migration-error-description",children:"See the Grafana server logs for more details"})}),p.isError&&(0,t.jsx)(I.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.summary.disconnect-error-title","There was an error disconnecting"),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.disconnect-error-description",children:"See the Grafana server logs for more details"})}),a.data&&(0,t.jsx)(jt,{session:a.data,snapshot:i.data,isBusy:M,disconnectIsLoading:p.isLoading,onDisconnect:Q,showBuildSnapshot:N,buildSnapshotIsLoading:d.isLoading,onBuildSnapshot:Z,showUploadSnapshot:Yt,uploadSnapshotIsLoading:f.isLoading||V.includes(L),onUploadSnapshot:$t}),(N||X)&&(0,t.jsxs)(h.a,{display:"flex",justifyContent:"center",paddingY:10,children:[N&&(0,t.jsx)(At,{disabled:M,isLoading:d.isLoading,onClick:Z}),X&&(0,t.jsx)(Pt,{disabled:M,isLoading:k.isLoading,onClick:Ht})]}),i.data?.results&&i.data.results.length>0&&(0,t.jsx)(Gt,{resources:i.data.results})]}),(0,t.jsx)(ct,{isOpen:n,isLoading:p.isLoading,isError:p.isError,onDisconnectConfirm:Q,onDismiss:()=>o(!1)})]}):(0,t.jsx)(pt,{})};function Ft(){const n=D.$.cloudMigrationFeedbackURL;return(0,t.jsxs)(J.Y,{navId:"migrate-to-cloud",children:[(0,t.jsx)(I.F,{title:(0,e.t)("migrate-to-cloud.public-preview.title","Migrate to Grafana Cloud is in public preview"),buttonContent:(0,e.t)("migrate-to-cloud.public-preview.button-text","Give feedback"),severity:"info",onRemove:n?()=>{window.location.href=n}:void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.public-preview.message",children:"Help us improve this feature by providing feedback and reporting any issues."})}),D.$.cloudMigrationIsTarget?(0,t.jsx)(lt,{}):(0,t.jsx)(Ut,{})]})}}}]);

//# sourceMappingURL=MigrateToCloud.30d020a2d3619bfb5f54.js.map