"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3594],{87965:(H,I,t)=>{t.d(I,{E3:()=>d,vj:()=>o});const e=`{{ define "__subject" }}[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ if gt (.Alerts.Resolved | len) 0 }}, RESOLVED:{{ .Alerts.Resolved | len }}{{ end }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}{{ end }}

{{ define "__text_values_list" }}{{ if len .Values }}{{ $first := true }}{{ range $refID, $value := .Values -}}
{{ if $first }}{{ $first = false }}{{ else }}, {{ end }}{{ $refID }}={{ $value }}{{ end -}}
{{ else }}[no value]{{ end }}{{ end }}

{{ define "__text_alert_list" }}{{ range . }}
Value: {{ template "__text_values_list" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}{{ if gt (len .GeneratorURL) 0 }}Source: {{ .GeneratorURL }}
{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: {{ .SilenceURL }}
{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: {{ .DashboardURL }}
{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: {{ .PanelURL }}
{{ end }}{{ end }}{{ end }}

{{ define "default.title" }}{{ template "__subject" . }}{{ end }}

{{ define "default.message" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__text_alert_list" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}

{{ define "__teams_text_alert_list" }}{{ range . }}
Value: {{ template "__text_values_list" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
{{ if gt (len .GeneratorURL) 0 }}Source: [{{ .GeneratorURL }}]({{ .GeneratorURL }})

{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: [{{ .SilenceURL }}]({{ .SilenceURL }})

{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: [{{ .DashboardURL }}]({{ .DashboardURL }})

{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: [{{ .PanelURL }}]({{ .PanelURL }})

{{ end }}
{{ end }}{{ end }}

{{ define "teams.default.message" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__teams_text_alert_list" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__teams_text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}`;var s=t(22153),A=t(49962);const O="/api/alertmanager/grafana/config/api/v1/templates/test",d=A.Hr.injectEndpoints({endpoints:c=>({previewTemplate:c.mutation({query:({template:i,alerts:E,name:C})=>({url:O,data:{template:i,alerts:E,name:C},method:"POST"})}),getDefaultTemplates:c.query({queryFn:async()=>({data:(0,s.D)(e)})})})}),{usePreviewTemplateMutation:o}=d},41965:(H,I,t)=>{t.d(I,{D:()=>o});var e=t(74848),s=t(32196),A=t(40845),O=t(60029),d=t(67061);function o({label:i,actions:E}){const C=(0,A.of)(c);return(0,e.jsxs)("div",{className:C.container,children:[(0,e.jsx)(O.J,{className:C.label,children:i}),(0,e.jsx)(d.B,{direction:"row",gap:1,children:E})]})}const c=i=>({container:(0,s.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:i.spacing(1,2),backgroundColor:i.colors.background.secondary,borderBottom:`1px solid ${i.colors.border.medium}`}),label:(0,s.css)({margin:0})})},33594:(H,I,t)=>{t.d(I,{By:()=>ht,R_:()=>xe});var e=t(74848),s=t(32196),A=t(13999);function O(n,r){return(0,A.f)(n,-r)}const d=null;var o=t(87836),c=t(2940);function i(n,r){return(0,o.A)(n,r*c.Cg)}const E=null;function C(n,r){return(0,o.A)(n,r*c.s0)}const B=null;function W(n,r){return C(n,-r)}const u=null;var x=t(96540),k=t(49785),de=t(42941),Y=t(70713),se=t(17172),m=t(40845),R=t(21633),M=t(67061),S=t(55852),Z=t(42418),Q=t(84167),q=t(14186),ce=t(10354),me=t(90613),ue=t(87978),fe=t(40715),ae=t(30681),he=t(31678),ge=t(75269),Le=t(61410),Pe=t(23770),je=t(57220),Te=t(56361),Ne=t(88467),Ie=t(5586),Se=t(48205),be=t(41965),Be=t(83122),_=t(38138),Me=t(60782),Ue=t(32372),Ae=t(91793),we=t(14578),We=t(56034),Fe=t(78369),le=t(37390),Ke=t(67647),De=t(39558),ze=t(82843),ee=t(75214),Ee=t(70026);function Ve({onSelect:n,isOpen:r,onClose:y}){const a=(0,m.of)(Ge),[l,w]=(0,x.useState)(),[v,L]=(0,x.useState)(null),{useGetAlertmanagerAlertsQuery:K}=ze.m,{currentData:P=[],isFetching:T,isError:z}=K({amSourceName:je.hY,filter:{inhibited:!0,silenced:!0,active:!0}}),[F,G]=(0,x.useState)(""),U=(0,x.useMemo)(()=>{const h={};return!T&&P&&P.forEach(f=>{h[f.labels.alertname]||(h[f.labels.alertname]=[]),h[f.labels.alertname].push(f)}),h},[T,P]),N=(0,x.useCallback)(h=>{w(h),L(null)},[]),j=(0,x.useMemo)(()=>{const h=Object.keys(U).filter(D=>D.toLowerCase().includes(F.toLowerCase())),f={};return h.forEach(D=>{f[D]=U[D]}),f},[U,F]);if(z)return null;const p=Object.keys(j||[]),b=({index:h,style:f})=>{if(!j)return null;const D=p[h],g=D===l;return(0,e.jsxs)("button",{type:"button",title:D,style:f,className:(0,s.cx)(a.rowButton,{[a.rowOdd]:h%2===1,[a.rowSelected]:g}),onClick:()=>N(D),children:[(0,e.jsx)("div",{className:(0,s.cx)(a.ruleTitle,a.rowButtonTitle),children:D}),(0,e.jsx)("div",{className:a.alertFolder,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(we.I,{name:"folder"})," ",j[D][0].labels.grafana_folder??""]})})]})},$=(h,f)=>{const g=h.map(X=>X.labels).map(ee.Dd),J=(0,Ee.Q)(g),V=(0,Ee.$)((0,ee.Dd)(f.labels),J);return V.length?(0,ee.M4)((0,ee.zm)(V)):(0,ee.M4)(f.labels)},te=({index:h,style:f})=>{const D=(0,x.useMemo)(()=>l?U[l]:[],[]),g=D[h],J=v?.includes(g),V=(0,x.useMemo)(()=>$(D,g),[D,g]),ie=()=>{if(J&&v){L(v.filter(X=>X!==g));return}L([...v||[],g])};return(0,e.jsx)("button",{type:"button",style:f,className:(0,s.cx)(a.rowButton,a.instanceButton,{[a.rowOdd]:h%2===1,[a.rowSelected]:J}),onClick:ie,children:(0,e.jsx)("div",{className:a.rowButtonTitle,title:g.labels.alertname,children:(0,e.jsx)(We.m,{placement:"bottom",content:(0,e.jsx)("pre",{children:JSON.stringify(g,null,2)}),theme:"info",children:(0,e.jsx)("div",{children:V.map((X,ye)=>(0,e.jsx)(Fe.v,{name:X,className:a.tag},ye))})})})})},ve=()=>{const h=v?.map(f=>({status:"firing",annotations:f.annotations,labels:f.labels,startsAt:f.startsAt,endsAt:f.endsAt,generatorURL:f.generatorURL,fingerprint:f.fingerprint}))||[];n(h),ne()},ne=()=>{w(void 0),L(null),G(""),re("")},oe=()=>{ne(),y()},re=h=>{G(h)};return(0,e.jsx)("div",{children:(0,e.jsxs)(le.a,{title:"Select alert instances",className:a.modal,closeOnEscape:!0,isOpen:r,onDismiss:oe,contentClassName:a.modalContent,children:[(0,e.jsxs)("div",{className:a.container,children:[(0,e.jsx)(Ke.Z,{value:F,onChange:re,title:"Search alert rule",placeholder:"Search alert rule",autoFocus:!0}),(0,e.jsx)("div",{children:l&&"Select one or more instances from the list below"||""}),(0,e.jsxs)("div",{className:a.column,children:[T&&(0,e.jsx)(De._,{text:"Loading rules...",className:a.loadingPlaceholder}),!T&&(0,e.jsx)(Y.Ay,{children:({height:h,width:f})=>(0,e.jsx)(Ae.Y1,{itemSize:50,height:h,width:f,itemCount:p.length,children:b})})]}),(0,e.jsxs)("div",{className:a.column,children:[!l&&!T&&(0,e.jsx)("div",{className:a.selectedRulePlaceholder,children:(0,e.jsx)("div",{children:"Select an alert rule to get a list of available firing instances"})}),T&&(0,e.jsx)(De._,{text:"Loading rule...",className:a.loadingPlaceholder}),l&&U[l].length&&!T&&(0,e.jsx)(Y.Ay,{children:({width:h,height:f})=>(0,e.jsx)(Ae.Y1,{itemSize:32,height:f,width:h,itemCount:U[l].length||0,children:te})})]})]}),(0,e.jsxs)(le.a.ButtonRow,{children:[(0,e.jsx)(S.$n,{type:"button",variant:"secondary",onClick:oe,children:"Cancel"}),(0,e.jsx)(S.$n,{type:"button",variant:"primary",disabled:!(l&&v),onClick:()=>{l&&v&&ve()},children:"Add alert data to payload"})]})]})})}const Ge=n=>{const r=(0,S.my)(n);return{container:(0,s.css)({display:"grid",gridTemplateColumns:"1fr 1.5fr",gridTemplateRows:"min-content auto",gap:n.spacing(2),flex:1}),tag:(0,s.css)({margin:"5px"}),column:(0,s.css)({flex:"1 1 auto"}),alertLabels:(0,s.css)({overflowX:"auto",height:"32px"}),ruleTitle:(0,s.css)({height:"22px",fontWeight:n.typography.fontWeightBold}),rowButton:(0,s.css)(r,{padding:n.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:n.colors.text.disabled}}),rowButtonTitle:(0,s.css)({overflowX:"auto"}),rowSelected:(0,s.css)({borderColor:n.colors.primary.border}),rowOdd:(0,s.css)({backgroundColor:n.colors.background.secondary}),instanceButton:(0,s.css)({display:"flex",gap:n.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,s.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectedRulePlaceholder:(0,s.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:n.typography.fontWeightBold}),modal:(0,s.css)({height:"100%"}),modalContent:(0,s.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,s.css)({flexGrow:0}),warnIcon:(0,s.css)({fill:n.colors.warning.main}),labels:(0,s.css)({justifyContent:"flex-start"}),alertFolder:(0,s.css)({height:"20px",fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:n.spacing(1),alignItems:"center"})}},$e=[{name:"Receiver",type:"string",notes:"Name of the contact point that the notification is being sent to."},{name:"Status",type:"string",notes:"firing if at least one alert is firing, otherwise resolved"},{name:"Alerts",type:"[]Alert",notes:"List of alert objects that are included in this notification."},{name:"Alerts.Firing",type:"[]Alert",notes:"List of firing alerts"},{name:"Alerts.Resolved",type:"[]Alert",notes:"List of resolved alerts"},{name:"GroupLabels",type:"KeyValue",notes:"Labels these alerts were grouped by."},{name:"CommonLabels",type:"KeyValue",notes:"Labels common to all the alerts included in this notification."},{name:"CommonAnnotations",type:"KeyValue",notes:"Annotations common to all the alerts included in this notification."},{name:"ExternalURL",type:"string",notes:"Back link to the Grafana that sent the notification."}],Je=[{name:"labels",type:"Object{}",notes:"Set of labels attached to the alert."},{name:"annotations",type:"Object{}",notes:"Set of annotations attached to the alert."},{name:"startsAt",type:"string (ISO8601)",notes:"Time the alert started firing."},{name:"endsAt",type:"string (ISO8601)",notes:"Time the alert ends firing."}],He=[{name:"Status",type:"string",notes:"firing or resolved."},{name:"Labels",type:"KeyValue",notes:"Set of labels attached to the alert."},{name:"Annotations",type:"KeyValue",notes:"Set of annotations attached to the alert."},{name:"Values",type:"KeyValue",notes:"The values of all instant queries, reduce and math expressions, and classic conditions for the alert. It does not contain time series data."},{name:"StartsAt",type:"time.Time",notes:"Time the alert started firing."},{name:"EndsAt",type:"time.Time",notes:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{name:"GeneratorURL",type:"string",notes:"A back link to Grafana or external Alertmanager."},{name:"SilenceURL",type:"string",notes:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{name:"DashboardURL",type:"string",notes:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"PanelURL",type:"string",notes:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"Fingerprint",type:"string",notes:"Fingerprint that can be used to identify the alert."},{name:"ValueString",type:"string",notes:"String that contains the labels and value of each reduced expression in the alert."}],Ye=[{name:"SortedPairs",returns:"KeyValue",notes:"Returns sorted list of key & value string pairs"},{name:"Remove",args:"[]string",returns:"KeyValue",notes:"Returns a copy of the Key/Value map without the given keys."},{name:"Names",returns:"[]string",notes:"List of label names"},{name:"Values",returns:"[]string",notes:"List of label values"}],Ze=`{
  "summary": "alert summary",
  "description": "alert description"
}
`;var Ce=t(35108);function Qe(){const n=(0,m.of)(Xe),r=(0,e.jsx)(pe,{caption:(0,e.jsxs)("h4",{className:n.header,children:["Alert template data ",(0,e.jsx)("span",{children:"Available only when in the context of an Alert (e.g. inside .Alerts loop)"})]}),dataItems:He});return(0,e.jsx)(M.B,{gap:2,children:(0,e.jsx)(pe,{caption:(0,e.jsx)("h4",{className:n.header,children:"Template Data"}),dataItems:$e,typeRenderer:y=>y==="[]Alert"?(0,e.jsx)(Ce.j,{content:r,children:(0,e.jsx)("div",{className:n.interactiveType,children:y})}):y==="KeyValue"?(0,e.jsx)(Ce.j,{content:(0,e.jsx)(ke,{}),children:(0,e.jsx)("div",{className:n.interactiveType,children:y})}):y})})}const Xe=n=>({header:(0,s.css)({color:n.colors.text.primary,span:{color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize}}),interactiveType:(0,s.css)({color:n.colors.text.link})});function pe({dataItems:n,caption:r,typeRenderer:y}){const a=(0,m.of)(Re);return(0,e.jsxs)("table",{className:a.table,children:[r&&(0,e.jsx)("caption",{children:r}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{children:"Type"}),(0,e.jsx)("th",{children:"Notes"})]})}),(0,e.jsx)("tbody",{children:n.map(({name:l,type:w,notes:v},L)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:l}),(0,e.jsx)("td",{children:y?y(w):w}),(0,e.jsx)("td",{children:v})]},L))})]})}function ke(){const n=(0,m.of)(Re);return(0,e.jsxs)("div",{children:["KeyValue is a set of key/value string pairs that represent labels and annotations.",(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:Ze})}),(0,e.jsxs)("table",{className:n.table,children:[(0,e.jsx)("caption",{children:"Key-value methods"}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{children:"Arguments"}),(0,e.jsx)("th",{children:"Returns"}),(0,e.jsx)("th",{children:"Notes"})]})}),(0,e.jsx)("tbody",{children:Ye.map(({name:r,args:y,returns:a,notes:l})=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:r}),(0,e.jsx)("td",{children:y}),(0,e.jsx)("td",{children:a}),(0,e.jsx)("td",{children:l})]},r))})]})]})}const Re=n=>({table:(0,s.css)({borderCollapse:"collapse",width:"100%",caption:{captionSide:"top"},"td, th":{padding:n.spacing(1,1)},thead:{fontWeight:n.typography.fontWeightBold},"tbody tr:nth-child(2n + 1)":{backgroundColor:n.colors.background.secondary},"tbody td:nth-child(1)":{fontWeight:n.typography.fontWeightBold},"tbody td:nth-child(2)":{fontStyle:"italic"}})});var qe=t(2543),_e=t(10860),et=t(94354),tt=t(31099),nt=t(97171);const st={annotations:[{key:"",value:""}],labels:[{key:"",value:""}],status:"firing"},at=({isOpen:n,onDismiss:r,onAccept:y})=>{const a=(0,m.of)(lt),[l,w]=(0,x.useState)([]),v=(0,k.mN)({defaultValues:st,mode:"onBlur"}),L=v.watch("annotations"),K=v.watch("labels"),[P,T]=(0,x.useState)("firing"),z=()=>{const N={annotations:L.filter(({key:j,value:p})=>!!j&&!!p).reduce((j,{key:p,value:b})=>({...j,[p]:b}),{}),labels:K.filter(({key:j,value:p})=>!!j&&!!p).reduce((j,{key:p,value:b})=>({...j,[p]:b}),{}),startsAt:"2023-04-01T00:00:00Z",endsAt:P==="firing"?(0,A.f)(new Date,1).toISOString():O(new Date,1).toISOString(),status:P,fingerprint:(0,qe.uniqueId)("fingerprint_")};w(j=>[...j,N]),v.reset()},F=()=>{y(l),w([]),v.reset(),T("firing")},G=()=>{const N=K.some(p=>p.key!==""&&p.value!==""),j=L.some(p=>p.key!==""&&p.value!=="");return N||j},U=[{label:"Firing",value:"firing"},{label:"Resolved",value:"resolved"}];return(0,e.jsx)(le.a,{onDismiss:r,isOpen:n,title:"Add custom alerts",children:(0,e.jsx)(k.Op,{...v,children:(0,e.jsxs)("form",{onSubmit:N=>{N.preventDefault(),N.stopPropagation(),v.reset(),T("firing")},children:[(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(_e.Z,{children:(0,e.jsxs)(M.B,{direction:"column",gap:1,children:[(0,e.jsx)("div",{className:a.section,children:(0,e.jsx)(tt.A,{})}),(0,e.jsx)("div",{className:a.section,children:(0,e.jsx)(nt.Ay,{})}),(0,e.jsxs)("div",{className:a.flexWrapper,children:[(0,e.jsx)(et.z,{value:P,options:U,onChange:N=>T(N)}),(0,e.jsx)(S.$n,{onClick:z,className:a.onAddButton,icon:"plus-circle",type:"button",variant:"secondary",disabled:!G(),children:"Add alert data"})]})]})})}),(0,e.jsx)("div",{className:a.onSubmitWrapper}),l.length>0&&(0,e.jsxs)(M.B,{direction:"column",gap:1,children:[(0,e.jsx)("h5",{children:" Review alert data to add to the payload:"}),(0,e.jsx)("pre",{className:a.result,"data-testid":"payloadJSON",children:JSON.stringify(l,null,2)})]}),(0,e.jsx)("div",{className:a.onSubmitWrapper,children:(0,e.jsx)(le.a.ButtonRow,{children:(0,e.jsx)(S.$n,{onClick:F,disabled:l.length===0,className:a.onSubmitButton,children:"Add alert data to payload"})})})]})})})},lt=n=>({section:(0,s.css)({marginBottom:n.spacing(2)}),onAddButton:(0,s.css)({flex:"none",width:"fit-content",paddingRight:n.spacing(1),marginLeft:"auto"}),flexWrapper:(0,s.css)({display:"flex",flexDirection:"row",justifyContent:"space-between"}),onSubmitWrapper:(0,s.css)({display:"flex",flexDirection:"row",alignItems:"baseline",justifyContent:"flex-end"}),onSubmitButton:(0,s.css)({marginLeft:n.spacing(2)}),result:(0,s.css)({width:"570px",height:"363px"})}),ot="Reset to defaults";function rt({payload:n,setPayload:r,defaultPayload:y,setPayloadFormatError:a,payloadFormatError:l,className:w}){const v=(0,m.of)(dt),L=()=>{r(y)},[K,P]=(0,x.useState)(!1),T=()=>{P(!1)},z=l!==null,F=()=>{try{const b=JSON.parse(n);JSON.stringify([...b]),a(null)}catch(b){throw a(b instanceof Error?b.message:"Invalid JSON."),b}},G=()=>{try{F(),P(!0)}catch{}},U=()=>{try{F(),p(!0)}catch{}},N=b=>{T(),p(!1),r($=>{const te=JSON.parse($);return JSON.stringify([...te,...b],void 0,2)})},[j,p]=(0,x.useState)(!1);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,s.cx)(v.wrapper,w),children:[(0,e.jsx)(be.D,{label:"Payload",actions:(0,e.jsxs)(M.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(Be.m,{overlay:(0,e.jsxs)(_.W,{children:[(0,e.jsx)(_.W.Item,{label:"Use existing alert instances",disabled:z,onClick:U}),(0,e.jsx)(_.W.Item,{label:"Add custom alert instance",disabled:z,onClick:G}),(0,e.jsx)(_.W.Divider,{}),(0,e.jsx)(_.W.Item,{label:ot,onClick:L,destructive:!0})]}),children:(0,e.jsx)(S.$n,{variant:"secondary",size:"sm",icon:"angle-down",children:"Edit payload"})}),(0,e.jsx)(Me.G,{content:(0,e.jsx)(it,{}),placement:"top",fitContent:!0,children:(0,e.jsx)(S.$n,{variant:"secondary",fill:"outline",size:"sm",icon:"question-circle",children:"Help"})})]})}),(0,e.jsx)("div",{className:v.editorWrapper,children:(0,e.jsx)(Y.Ay,{children:({width:b,height:$})=>(0,e.jsx)(Ue.B,{containerStyles:v.editorContainer,width:b,height:$,language:"json",showLineNumbers:!0,showMiniMap:!1,value:n,readOnly:!1,onBlur:r,monacoOptions:{scrollBeyondLastLine:!1}})})})]}),(0,e.jsx)(at,{isOpen:K,onDismiss:T,onAccept:N}),(0,e.jsx)(Ve,{onSelect:N,isOpen:j,onClose:()=>p(!1)})]})}const it=()=>(0,e.jsx)(pe,{dataItems:Je}),dt=n=>({wrapper:(0,s.css)({display:"flex",flexDirection:"column",height:"100%"}),tooltip:(0,s.css)({paddingLeft:n.spacing(1)}),label:(0,s.css)({margin:0}),editorWrapper:(0,s.css)({flex:1}),editorContainer:(0,s.css)({width:"fit-content",border:"none"}),templateDataDocsHeader:(0,s.css)({color:n.colors.text.primary,span:{color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize}})});var ct=t(96615),mt=t(78253),ut=t(57954);const ft=Object.freeze({name:"",content:""}),vt=n=>n.pathname.endsWith("/duplicate"),ht=({existing:n,alertManagerSourceName:r,config:y,provenance:a})=>{const l=(0,m.of)(Oe),w=(0,he.useDispatch)();(0,fe.o)(g=>g.unifiedAlerting.saveAMConfig=Ne.jA);const v=(0,x.useRef)(null),L=r===je.hY,{loading:K,error:P}=(0,Le.$)(g=>g.saveAMConfig),[T,z]=(0,de.A)(!1),[F,G]=(0,x.useState)(xe),[U,N]=(0,x.useState)(null),j=(0,R.h)({direction:"column",initialSize:L?.5:1,dragPosition:"middle"}),p=(0,R.h)({direction:"row",initialSize:L?.6:1,dragPosition:"middle"}),b=g=>{const J=(0,Ie.o)(g.name,g.content),V={...y.template_files,[g.name]:J};n&&n.name!==g.name&&delete V[n.name];const ie=[...(y.alertmanager_config.templates??[]).filter(ye=>ye!==n?.name),g.name],X={template_files:V,alertmanager_config:{...y.alertmanager_config,templates:ie}};w((0,Pe.RW)({alertManagerSourceName:r,newConfig:X,oldConfig:y,successMessage:"Template saved.",redirectPath:"/alerting/notifications",redirectSearch:`tab=${ae.ActiveTab.NotificationTemplates}`}))},$=(0,k.mN)({mode:"onSubmit",defaultValues:n??ft}),{handleSubmit:te,register:ve,formState:{errors:ne},getValues:oe,setValue:re,watch:h}=$,f=g=>!y.template_files[g]||n?.name===g?!0:"Another template with this name already exists.",D=(0,e.jsxs)(M.B,{children:[(0,e.jsx)(S.$n,{onClick:()=>v.current?.requestSubmit(),variant:"primary",size:"sm",disabled:K,children:"Save"}),(0,e.jsx)(S.z9,{disabled:K,href:(0,Te.nL)("alerting/notifications",r,{tab:ae.ActiveTab.NotificationTemplates}),variant:"secondary",size:"sm",children:"Cancel"})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(k.Op,{...$,children:[(0,e.jsx)(ge.H,{actions:D}),(0,e.jsxs)("form",{onSubmit:te(b),ref:v,className:l.form,children:[P&&(0,e.jsx)(Z.F,{severity:"error",title:"Error saving template",children:P.message||(0,se.NF)(P)&&P.data?.message||String(P)}),a&&(0,e.jsx)(Se.Yi,{resource:Se.hk.Template}),(0,e.jsxs)(Q.n,{disabled:!!a,className:l.fieldset,children:[(0,e.jsx)(q.I,{label:"Template name",error:ne?.name?.message,invalid:!!ne.name?.message,required:!0,className:l.nameField,children:(0,e.jsx)(ce.p,{...ve("name",{required:{value:!0,message:"Required."},validate:{nameIsUnique:f}}),placeholder:"Give your template a name",width:42,autoFocus:!0,id:"new-template-name"})}),(0,e.jsxs)("div",{...p.containerProps,className:l.contentContainer,children:[(0,e.jsx)("div",{...p.primaryProps,children:(0,e.jsxs)("div",{...j.containerProps,className:l.contentField,children:[(0,e.jsx)("div",{...j.primaryProps,children:(0,e.jsxs)("div",{className:(0,s.cx)(l.flexColumn,l.containerWithBorderAndRadius,l.minEditorSize),children:[(0,e.jsx)(be.D,{label:"Template",actions:(0,e.jsx)(S.$n,{icon:"question-circle",size:"sm",fill:"outline",variant:"secondary",onClick:z,children:"Help"})}),(0,e.jsx)(me.a,{flex:1,children:(0,e.jsx)(Y.Ay,{children:({width:g,height:J})=>(0,e.jsx)(ct.K,{value:oe("content"),onBlur:V=>re("content",V),containerStyles:l.editorContainer,width:g,height:J})})})]})}),L&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{...j.splitterProps}),(0,e.jsx)("div",{...j.secondaryProps,children:(0,e.jsx)("div",{className:(0,s.cx)(l.containerWithBorderAndRadius,l.minEditorSize,l.payloadEditor,l.flexFull),children:(0,e.jsx)(rt,{payload:F,defaultPayload:xe,setPayload:G,setPayloadFormatError:N,payloadFormatError:U})})})]})]})}),L&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{...p.secondaryProps,children:[(0,e.jsx)("div",{...p.splitterProps}),(0,e.jsx)(mt.p,{payload:F,templateName:h("name"),setPayloadFormatError:N,payloadFormatError:U,className:(0,s.cx)(l.templatePreview,l.minEditorSize)})]})})]})]})]})]}),T&&(0,e.jsx)(ue._,{title:"Templating cheat sheet",onClose:z,size:"lg",children:(0,e.jsx)(pt,{})})]})};function gt(){const n=(0,m.of)(Oe);return(0,e.jsxs)(Z.F,{title:"How to",severity:"info",children:[(0,e.jsxs)(M.B,{direction:"row",children:[(0,e.jsxs)("div",{children:["Grafana uses Go templating language to create notification messages.",(0,e.jsx)("br",{}),"To find out more about templating please visit our documentation."]}),(0,e.jsx)("div",{children:(0,e.jsx)(S.z9,{href:"https://grafana.com/docs/grafana/latest/alerting/manage-notifications/template-notifications/",target:"_blank",icon:"external-link-alt",variant:"secondary",children:"Templating documentation"})})]}),(0,e.jsxs)("div",{className:n.snippets,children:["For auto-completion of common templating code, type the following keywords in the content editor:",(0,e.jsx)("div",{className:n.code,children:Object.values(ut.L).map(r=>r.label).join(", ")})]})]})}function pt(){return(0,e.jsxs)(M.B,{direction:"column",gap:1,children:[(0,e.jsx)(gt,{}),(0,e.jsx)(Qe,{})]})}const Oe=n=>{const r=n.breakpoints.down("md");return{flexFull:(0,s.css)({flex:1}),minEditorSize:(0,s.css)({minHeight:300,minWidth:300}),payloadEditor:(0,s.css)({minHeight:0}),containerWithBorderAndRadius:(0,s.css)({borderRadius:n.shape.radius.default,border:`1px solid ${n.colors.border.medium}`}),flexColumn:(0,s.css)({display:"flex",flex:1,flexDirection:"column"}),form:(0,s.css)({label:"template-form",height:"100%",display:"flex",flexDirection:"column"}),fieldset:(0,s.css)({label:"template-fieldset",flex:1,display:"flex",flexDirection:"column"}),label:(0,s.css)({margin:0}),nameField:(0,s.css)({marginBottom:n.spacing(1)}),contentContainer:(0,s.css)({flex:1,display:"flex",flexDirection:"row"}),contentField:(0,s.css)({display:"flex",flexDirection:"column",flex:1,marginBottom:0}),templatePreview:(0,s.css)({flex:1,display:"flex"}),templatePayload:(0,s.css)({flex:1}),editorContainer:(0,s.css)({width:"fit-content",border:"none"}),payloadCollapseButton:(0,s.css)({backgroundColor:n.colors.info.transparent,margin:0,[r]:{display:"none"}}),snippets:(0,s.css)({marginTop:n.spacing(2),fontSize:n.typography.bodySmall.fontSize}),code:(0,s.css)({color:n.colors.text.secondary,fontWeight:n.typography.fontWeightBold})}},xt=[{status:"firing",annotations:{summary:"Instance instance1 has been down for more than 5 minutes"},labels:{alertname:"InstanceDown",instance:"instance1"},startsAt:O(new Date,1).toISOString(),endsAt:i(new Date,5).toISOString(),fingerprint:"a5331f0d5a9d81d4",generatorURL:"http://grafana.com/alerting/grafana/cdeqmlhvflz40f/view"},{status:"resolved",annotations:{summary:"CPU usage above 90%"},labels:{alertname:"CpuUsage",instance:"instance1"},startsAt:W(new Date,4).toISOString(),endsAt:new Date().toISOString(),fingerprint:"b77d941310f9d381",generatorURL:"http://grafana.com/alerting/grafana/oZSMdGj7z/view"}],xe=JSON.stringify(xt,null,2)},78253:(H,I,t)=>{t.d(I,{P:()=>se,p:()=>x});var e=t(74848),s=t(32196),A=t(2543),O=t.n(A),d=t(49785),o=t(70713),c=t(40845),i=t(55852),E=t(90613),C=t(42418),B=t(56361),W=t(41965),u=t(10506);function x({payload:m,templateName:R,payloadFormatError:M,setPayloadFormatError:S,className:Z}){const Q=(0,c.of)(Y),{watch:q}=(0,d.xW)(),ce=q("content"),{data:me,isLoading:ue,onPreview:fe,error:ae}=(0,u.g)(ce,R,m,S),he=se(ae,M,me);return(0,e.jsxs)("div",{className:(0,s.cx)(Q.container,Z),children:[(0,e.jsx)(W.D,{label:"Preview",actions:(0,e.jsx)(i.$n,{disabled:ue,icon:"sync","aria-label":"Refresh preview",onClick:fe,size:"sm",variant:"secondary",children:"Refresh"})}),(0,e.jsx)(E.a,{flex:1,children:(0,e.jsx)(o.Ay,{disableWidth:!0,children:({height:ge})=>(0,e.jsx)("div",{className:Q.viewerContainer({height:ge}),children:he})})})]})}function k({previews:m}){const R=(0,c.of)(Y),M=m.length===1;return(0,e.jsx)("ul",{className:R.viewer.container,children:m.map(S=>(0,e.jsxs)("li",{className:R.viewer.box,children:[M?null:(0,e.jsx)("header",{className:R.viewer.header,children:S.name}),(0,e.jsx)("pre",{className:R.viewer.pre,children:S.text??"<Empty>"})]},S.name))})}function de({errors:m}){return m.map(R=>(0,e.jsx)(C.F,{title:(0,A.compact)([R.name,R.kind]).join(" \u2013 "),children:R.message},(0,A.uniqueId)("errors-list")))}const Y=m=>({container:(0,s.css)({label:"template-preview-container",display:"flex",flexDirection:"column",borderRadius:m.shape.radius.default,border:`1px solid ${m.colors.border.medium}`}),viewerContainer:({height:R})=>(0,s.css)({height:R,overflow:"auto",backgroundColor:m.colors.background.primary}),viewer:{container:(0,s.css)({display:"flex",flexDirection:"column",height:"inherit"}),box:(0,s.css)({display:"flex",flexDirection:"column",borderBottom:`1px solid ${m.colors.border.medium}`,height:"inherit"}),header:(0,s.css)({fontSize:m.typography.bodySmall.fontSize,padding:m.spacing(1,2),borderBottom:`1px solid ${m.colors.border.medium}`,backgroundColor:m.colors.background.secondary}),errorText:(0,s.css)({color:m.colors.error.text}),pre:(0,s.css)({backgroundColor:"transparent",margin:0,border:"none",padding:m.spacing(2)})}});function se(m,R,M){const S=m?(0,B.JZ)(m):void 0,Z=R||S,Q=M?.results??[],q=M?.errors;return(0,e.jsxs)(e.Fragment,{children:[Z&&(0,e.jsx)(C.F,{severity:"error",title:"Error",children:Z}),q&&(0,e.jsx)(de,{errors:q}),Q&&(0,e.jsx)(k,{previews:Q})]})}},22153:(H,I,t)=>{t.d(I,{D:()=>e,G7:()=>O,Jl:()=>s,gY:()=>A});function e(d){const o={},c=[],i=/{{(-?\s*)(define|end|if|range|else|with|template)(\s*.*?)?(-?\s*)}}/gs;let E,C=0;for(;(E=i.exec(d))!==null;){const[,,B,W]=E;if(C=E.index,B==="define"){const u=W?.match(/"([^"]+)"/);u&&c.push({type:"define",startIndex:C,name:u[1]})}else if(B==="end"){let u=c.pop();for(;u&&u.type!=="define"&&u.type!=="if"&&u.type!=="range"&&u.type!=="with";)u=c.pop();if(u){const x=i.lastIndex;u.type==="define"&&!u.name?.startsWith("__")&&(o[u.name]={name:u.name,content:d.slice(u.startIndex,x)})}}else(B==="if"||B==="range"||B==="else"||B==="with")&&c.push({type:B,startIndex:C})}for(const B of Object.values(o)){const W=/{{ template "([^"]+)" }}/g;let u;for(;(u=W.exec(B.content))!==null;){const x=u[1];o[x]?.content&&(B.content+=`
`+o[x]?.content,delete o[x])}}return Object.values(o)}function s(d){return`{{ template "${d}" . }}`}function A(d){const o=d.match(/\{\{\s*template\s*"(.*)"\s*\.\s*\}\}/);return o?o[1]:""}function O(d){const o=/\{\{\s*template\s*".*?"\s*\.\s*\}\}/g;if(d.match(o)?.length!==1)return!1;const i=d.split(o);for(const E of i)if(E.trim()!=="")return!1;return!0}},10506:(H,I,t)=>{t.d(I,{g:()=>A});var e=t(96540),s=t(87965);function A(O,d,o,c){const[i,{data:E,error:C,isLoading:B}]=(0,s.vj)(),W=(0,e.useCallback)(()=>{try{const u=JSON.parse(o);JSON.stringify([...u]),i({template:O,alerts:u,name:d}),c(null)}catch(u){c(u instanceof Error?u.message:"Invalid JSON.")}},[O,d,o,c,i]);return(0,e.useEffect)(()=>W(),[W]),{data:E,error:C,isLoading:B,onPreview:W}}},70026:(H,I,t)=>{t.d(I,{$:()=>A,Q:()=>O});var e=t(2543),s=t.n(e);function A(d,o){return d.filter(c=>!o.find(i=>JSON.stringify(i)===JSON.stringify(c)))}function O(d){const o=d.flatMap(i=>i);return(0,e.uniqBy)(o.filter(i=>o.filter(C=>(0,e.isEqual)(i,C)).length===Object.keys(d).length),i=>JSON.stringify(i))}},5586:(H,I,t)=>{t.d(I,{a:()=>O,o:()=>A});var e=t(2543),s=t.n(e);function A(d,o){let c=o.trim();if(!c.match(/\{\{\s*define/)){const i=c.split(`
`).map(E=>"  "+E).join(`
`);c=`{{ define "${d}" }}
${i}
{{ end }}`}return c}function O(d){const o=(c,i)=>`{{ define "${i}_NEW_${(0,e.now)()}" }}`;return d.replace(/\{\{\s*define\s*\"(?<defineName>.*)\"\s*\}\}/g,o)}}}]);

//# sourceMappingURL=3594.07b7e10d1d06d1e317ef.js.map