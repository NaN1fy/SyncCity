"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5804],{15111:(I,C,a)=>{a.r(C),a.d(C,{BrowseFolderLibraryPanelsPage:()=>v,default:()=>E});var e=a(74848),D=a(96540),r=a(69444),d=a(9134),i=a(71101),n=a(16678),M=a(24643),o=a(55314);function v({match:f}){const{uid:t}=f.params,{data:s}=(0,o.kH)(t),[P,m]=(0,D.useState)(void 0),[g]=(0,o.iB)(),l=(0,D.useMemo)(()=>{if(!s)return;const _=(0,i.R4)(s),h=(0,i.pq)(s.uid),c=_.children?.find(O=>O.id===h);return c&&(c.active=!0),_},[s]),u=t?async _=>{if(s){const h=await g({...s,title:_});if("error"in h)throw h.error}}:void 0;return(0,e.jsx)(r.Y,{navId:"dashboards/browse",pageNav:l,onEditTitle:u,actions:(0,e.jsx)(e.Fragment,{children:s&&(0,e.jsx)(d.m,{folder:s})}),children:(0,e.jsxs)(r.Y.Contents,{children:[(0,e.jsx)(n.j,{onClick:m,currentFolderUID:t,showSecondaryActions:!0,showSort:!0,showPanelFilter:!0}),P?(0,e.jsx)(M.F,{onDismiss:()=>m(void 0),libraryPanel:P}):null]})})}const E=v},18241:(I,C,a)=>{a.d(C,{T:()=>f});var e=a(74848),D=a(96540),r=a(32264),d=a(96374),i=a(94753),n=a(68402),M=a(42418),o=a(8484),v=a(55314),E=a(43907);const f=({onConfirm:t,onDismiss:s,selectedItems:P,...m})=>{const{data:g}=(0,v.G2)(P),l=!!(g&&(g.alertRule||g.libraryPanel)),[u,_]=(0,D.useState)(!1),h=async()=>{_(!0);try{await t(),_(!1),s()}catch{_(!1)}};return(0,e.jsx)(d.u,{body:(0,e.jsxs)(e.Fragment,{children:[r.$.featureToggles.dashboardRestore&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.E,{element:"p",children:(0,e.jsx)(o.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(n.$,{v:2})]}),(0,e.jsx)(i.E,{element:"p",children:(0,e.jsx)(o.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(E.x,{selectedItems:P}),(0,e.jsx)(n.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:l?(0,e.jsx)(M.F,{severity:"warning",title:(0,o.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(o.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,o.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:u?(0,o.t)("browse-dashboards.action.deleting","Deleting..."):(0,o.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:s,onConfirm:h,title:(0,o.t)("browse-dashboards.action.delete-modal-title","Delete"),...m,disabled:l})}},51887:(I,C,a)=>{a.d(C,{J:()=>t});var e=a(74848),D=a(96540),r=a(37390),d=a(42418),i=a(94753),n=a(68402),M=a(88575),o=a(55852),v=a(36607),E=a(8484),f=a(43907);const t=({onConfirm:s,onDismiss:P,selectedItems:m,...g})=>{const[l,u]=(0,D.useState)(),[_,h]=(0,D.useState)(!1),c=Object.keys(m.folder).filter(L=>m.folder[L]),O=async()=>{if(l!==void 0){h(!0);try{await s(l),h(!1),P()}catch{h(!1)}}};return(0,e.jsxs)(r.a,{title:(0,E.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:P,...g,children:[c.length>0&&(0,e.jsx)(d.F,{severity:"info",title:(0,E.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(i.E,{element:"p",children:(0,e.jsx)(E.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(f.x,{selectedItems:m}),(0,e.jsx)(n.$,{v:3}),(0,e.jsx)(M.D,{label:(0,E.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(v.d,{value:l,excludeUIDs:c,onChange:u})}),(0,e.jsxs)(r.a.ButtonRow,{children:[(0,e.jsx)(o.$n,{onClick:P,variant:"secondary",fill:"outline",children:(0,e.jsx)(E.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(o.$n,{disabled:l===void 0||_,onClick:O,variant:"primary",children:_?(0,E.t)("browse-dashboards.action.moving","Moving..."):(0,E.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(I,C,a)=>{a.d(C,{m:()=>h});var e=a(74848),D=a(96540),r=a(32264),d=a(14110),i=a(12131),n=a(38138),M=a(64539),o=a(83122),v=a(55852),E=a(14578),f=a(87978),t=a(5108),s=a(10096),P=a(8484),m=a(28444),g=a(55314),l=a(49904),u=a(18241),_=a(51887);function h({folder:c}){const[O,L]=(0,D.useState)(!1),[b,B]=(0,D.useState)(!1),[T]=(0,g.aF)(),[R]=(0,g.Ko)(),{canEditFolders:U,canDeleteFolders:A,canViewPermissions:K,canSetPermissions:y}=(0,l.N)(c),W=r.$.featureToggles.nestedFolders&&U,j=async x=>{await T({folder:c,destinationUID:x}),(0,d.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},p=async()=>{await R(c),(0,d.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:x}=c,z=x&&x.length?x[x.length-1].url:"/dashboards";i.Ny.push(z)},F=()=>{s.lE.publish(new m.S8({component:_.J,props:{selectedItems:{folder:{[c.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:j}}))},S=()=>{s.lE.publish(new m.S8({component:u.T,props:{selectedItems:{folder:{[c.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:p}}))},$=(0,P.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),w=(0,P.t)("browse-dashboards.folder-actions-button.move","Move"),N=(0,P.t)("browse-dashboards.folder-actions-button.delete","Delete"),V=(0,e.jsxs)(n.W,{children:[K&&(0,e.jsx)(M.D,{onClick:()=>B(!0),label:$}),W&&(0,e.jsx)(M.D,{onClick:F,label:w}),A&&(0,e.jsx)(M.D,{destructive:!0,onClick:S,label:N})]});return!K&&!W&&!A?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(o.m,{overlay:V,onVisibleChange:L,children:(0,e.jsxs)(v.$n,{variant:"secondary",children:[(0,e.jsx)(P.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(E.I,{name:O?"angle-up":"angle-down"})]})}),b&&(0,e.jsx)(f._,{title:(0,P.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:c.title,onClose:()=>B(!1),size:"md",children:(0,e.jsx)(t.x,{resource:"folders",resourceId:c.uid,canSetPermissions:y})})]})}},49904:(I,C,a)=>{a.d(C,{N:()=>i});var e=a(32264),D=a(10096),r=a(31678);function d(n,M){return M?D.TP.hasPermissionInMetadata(n,M):D.TP.hasPermission(n)}function i(n){const M=d(r.AccessControlAction.DashboardsCreate,n),o=!!((!n||e.$.featureToggles.nestedFolders)&&d(r.AccessControlAction.FoldersCreate)),v=d(r.AccessControlAction.FoldersDelete,n),E=d(r.AccessControlAction.DashboardsWrite,n),f=d(r.AccessControlAction.FoldersWrite,n),t=d(r.AccessControlAction.FoldersPermissionsWrite,n),s=d(r.AccessControlAction.FoldersPermissionsRead,n);return{canCreateDashboards:M,canCreateFolders:o,canDeleteFolders:v,canEditDashboards:E,canEditFolders:f,canSetPermissions:t,canViewPermissions:s}}},24643:(I,C,a)=>{a.d(C,{F:()=>P});var e=a(74848),D=a(32196),r=a(76459),d=a.n(r),i=a(96540),n=a(76885),M=a(12131),o=a(40845),v=a(37390),E=a(90182),f=a(55852),t=a(8484),s=a(57767);function P({libraryPanel:l,onDismiss:u}){const _=(0,o.of)(g),[h,c]=(0,i.useState)(!1),[O,L]=(0,i.useState)(0),[b,B]=(0,i.useState)(void 0);(0,i.useEffect)(()=>{(async()=>{const K=await(0,s.GN)(l.uid);L(K.length)})()},[l.uid]);const T=(0,i.useCallback)(A=>m(l.uid,A,c),[l.uid]),R=(0,i.useMemo)(()=>d()(T,300,{leading:!0}),[T]),U=A=>{A.preventDefault(),M.Ny.push(n.kM.renderUrl(`/d/${b?.value?.uid}`,{}))};return(0,e.jsxs)(v.a,{title:(0,t.t)("library-panels.modal.title","View panel in dashboard"),onDismiss:u,onClickBackdrop:u,isOpen:!0,children:[(0,e.jsxs)("div",{className:_.container,children:[O===0?(0,e.jsx)("span",{children:(0,e.jsx)(t.x6,{i18nKey:"library-panels.modal.panel-not-linked",children:"Panel is not linked to a dashboard. Add the panel to a dashboard and retry."})}):null,O>0?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsxs)(t.x6,{i18nKey:"library-panels.modal.body",count:O,children:["This panel is being used in ",{count:O}," dashboard. Please choose which dashboard to view the panel in:"]})}),(0,e.jsx)(E.DW,{isClearable:!0,isLoading:h,defaultOptions:!0,loadOptions:R,onChange:B,placeholder:(0,t.t)("library-panels.modal.select-placeholder","Start typing to search for dashboard"),noOptionsMessage:(0,t.t)("library-panels.modal.select-no-options-message","No dashboards found")})]}):null]}),(0,e.jsxs)(v.a.ButtonRow,{children:[(0,e.jsx)(f.$n,{variant:"secondary",onClick:u,fill:"outline",children:(0,e.jsx)(t.x6,{i18nKey:"library-panels.modal.button-cancel",children:"Cancel"})}),(0,e.jsx)(f.$n,{onClick:U,disabled:!b,children:b?(0,t.t)("library-panels.modal.button-view-panel1","View panel in {{label}}...",{label:b?.label}):(0,t.t)("library-panels.modal.button-view-panel2","View panel in dashboard...")})]})]})}async function m(l,u,_){_(!0);const c=(await(0,s.xV)(l)).filter(O=>O.title.toLowerCase().includes(u.toLowerCase())).map(O=>({label:O.title,value:O}));return _(!1),c}function g(l){return{container:(0,D.css)``}}}}]);

//# sourceMappingURL=FolderLibraryPanelsPage.b9e7e1c8e1b49d7df939.js.map