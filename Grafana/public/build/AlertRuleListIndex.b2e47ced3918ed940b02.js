"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3511],{7521:(J,j,s)=>{s.d(j,{A:()=>l});var e=s(74848),a=s(32196),x=s(13544),n=s(14578),u=s(42418),m=s(55852),d=s(76442);const y=(0,a.css)({textAlign:"center"}),g=(0,a.css)({maxWidth:"700px",margin:"0 auto"}),l=({title:h,buttonIcon:E,buttonLink:R,buttonTitle:T,buttonDisabled:N,onClick:U,proTip:D,proTipLink:W,proTipLinkTitle:G,proTipTarget:I,infoBox:z,infoBoxTitle:le})=>{const te=()=>(0,e.jsxs)(e.Fragment,{children:[D?(0,e.jsxs)("span",{children:[(0,e.jsx)(n.I,{name:"rocket"}),(0,e.jsxs)(e.Fragment,{children:[" ProTip: ",D," "]}),W&&(0,e.jsx)("a",{href:W,target:I,className:"text-link",children:G})]},"proTipFooter"):"",z?(0,e.jsx)(u.F,{severity:"info",title:le??"",className:g,children:(0,e.jsx)("div",{dangerouslySetInnerHTML:z})}):""]}),C=te()?"":(0,a.css)({marginBottom:"20px"}),B=R?m.z9:m.$n,S=(0,e.jsx)(B,{size:"lg",onClick:U,href:R,icon:E,className:C,"data-testid":x.Tp.components.CallToActionCard.buttonV2(T),disabled:N,children:T});return(0,e.jsx)(d.c,{className:y,message:h,footer:te(),callToActionElement:S})}},76543:(J,j,s)=>{s.r(j),s.d(j,{default:()=>Os});var e=s(74848),a=s(96540),x=s(32264),n=s(32196),u=s(24180),m=s(41053),d=s(10940),y=s(76885),g=s(66602),f=s(40845),l=s(55852),h=s(83277),E=s(31678),R=s(25027),T=s(19073),N=s(9518),U=s(14285),D=s(61410),W=s(23770),G=s(55740),I=s(57220),z=s(37959),le=s(45058),te=s(75648),C=s(67381),B=s(64853),S=s(55127),H=s.n(S),ie=s(94753),Q=s(39558),ce=s(62930),K=s(19384),$=s(15054),X=s(98439),Pe=s(22620),De=s(88467),ss=s(13544),qe=s(67061),ae=s(14578),Ve=s(56034),Ye=s(39938),ts=s(96374),L=s(11167),Z=s(83903),Se=s(41520),Le=s(56361),pe=s(23662),F=s(64047),We=s(82437),Ee=s(79938),Ie=s(16293),de=s(76648),Ce=s(84029);function Be({folder:t,onClose:r}){const[o,c]=(0,a.useState)("yaml");return(0,e.jsx)(de.m,{title:`Export ${t.title} rules`,activeTab:o,onTabChange:c,onClose:r,formatProviders:Object.values(Ce.sl),children:(0,e.jsx)(Je,{folder:t,exportFormat:o,onClose:r})})}function Je({folder:t,exportFormat:r,onClose:o}){const{currentData:c="",isFetching:i}=Ee.hK.endpoints.exportRules.useQuery({folderUid:t.uid,format:r});if(i)return(0,e.jsx)(Q._,{text:"Loading...."});const p=`${t.title}-${t.uid}`;return(0,e.jsx)(Ie.J,{format:r,textDefinition:c,downloadFileName:p,onClose:o})}function Qe({folderUid:t,groupName:r,onClose:o}){const[c,i]=(0,a.useState)("yaml");return(0,e.jsx)(de.m,{title:`Export ${r} rules`,activeTab:c,onTabChange:i,onClose:o,formatProviders:Object.values(Ce.sl),children:(0,e.jsx)(Fe,{folderUid:t,groupName:r,exportFormat:c,onClose:o})})}function Fe({folderUid:t,groupName:r,exportFormat:o,onClose:c}){const{currentData:i="",isFetching:p}=Ee.hK.endpoints.exportRules.useQuery({folderUid:t,group:r,format:o});return p?(0,e.jsx)(Q._,{text:"Loading...."}):(0,e.jsx)(Ie.J,{format:o,textDefinition:i,downloadFileName:r,onClose:c})}var Ke=s(99106),ue=s(72275),Ne=s(22040),Ue=s(38127),b=s(46942),w=s.n(b),Me=s(2543),he=s(37390),_=s(99140),k=s(18461),$e=s(30423);const Xe=t=>{const{group:r,namespace:o,onClose:c,folderUid:i}=t,ee=(0,N.dy)().find(P=>P.rulesSource===o.rulesSource&&P.name===o.name)?.groups.find(P=>P.name===r.name),[ne,me]=(0,a.useState)(!1),[se,ye]=(0,a.useState)(ee?.rules||[]),re=(0,f.of)(M),ve=(0,a.useCallback)(P=>{if(!P.destination||P.destination.index===P.source.index)return;const V=ze(se,P.source.index,P.destination.index);ye(V);const je=(0,I.EV)(o.rulesSource),Te=(0,Me.compact)(V.map(Oe=>Oe.rulerRule));me(!0),(0,_.JD)((0,W.DN)({namespaceName:o.name,groupName:r.name,rulesSourceName:je,newRules:Te,folderUid:i||o.name})).unwrap().finally(()=>{me(!1)})},[r.name,o.name,o.rulesSource,se,i]),oe=se.map(P=>({...P,uid:String((0,k.Ns)(P.rulerRule))}));return(0,e.jsx)(he.a,{className:re.modal,isOpen:!0,title:(0,e.jsx)(Ze,{namespace:o,group:r}),onDismiss:c,onClickBackdrop:c,children:(0,e.jsx)(Ue.JY,{onDragEnd:ve,children:(0,e.jsx)(Ue.gL,{droppableId:"alert-list",mode:"standard",renderClone:(P,O,V)=>(0,e.jsx)(Ge,{provided:P,rule:oe[V.source.index],isClone:!0}),children:P=>(0,e.jsxs)("div",{ref:P.innerRef,className:w()(re.listContainer,ne&&re.disabled),...P.droppableProps,children:[oe.map((O,V)=>(0,e.jsx)(Ue.sx,{draggableId:O.uid,index:V,isDragDisabled:ne,children:je=>(0,e.jsx)(Ge,{provided:je,rule:O},O.uid)},O.uid)),P.placeholder]})})})})},Ge=({provided:t,rule:r,isClone:o=!1,isDragging:c=!1})=>{const i=(0,f.of)(M);return(0,e.jsxs)("div",{"data-testid":"reorder-alert-rule",className:w()(i.listItem,o&&"isClone",c&&"isDragging"),ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,children:[(0,pe.Z8)(r.promRule)&&(0,e.jsx)($e.C,{state:r.promRule.state}),(0,pe.KB)(r.promRule)&&(0,e.jsx)(Ye.E,{text:"Recording",color:"blue"}),(0,e.jsx)("div",{className:i.listItemName,children:r.name}),(0,e.jsx)(ae.I,{name:"draggabledots"})]})},Ze=({namespace:t,group:r})=>{const o=(0,f.of)(M);return(0,e.jsxs)("div",{className:o.header,children:[(0,e.jsx)(ae.I,{name:"folder"}),(0,I.Eb)(t.rulesSource)&&(0,e.jsx)(Ve.m,{content:t.rulesSource.name,placement:"top",children:(0,e.jsx)("img",{alt:t.rulesSource.meta.name,className:o.dataSourceIcon,src:t.rulesSource.meta.info.logos.small})}),(0,e.jsx)("span",{children:t.name}),(0,e.jsx)(ae.I,{name:"angle-right"}),(0,e.jsx)("span",{children:r.name})]})},M=t=>({modal:(0,n.css)({maxWidth:"640px",maxHeight:"80%",overflow:"hidden"}),listItem:(0,n.css)({display:"flex",flexDirection:"row",alignItems:"center",gap:t.spacing(),background:t.colors.background.primary,color:t.colors.text.secondary,borderBottom:`solid 1px ${t.colors.border.medium}`,padding:`${t.spacing(1)} ${t.spacing(2)}`,"&:last-child":{borderBottom:"none"},"&.isClone":{border:`solid 1px ${t.colors.primary.shade}`}}),listContainer:(0,n.css)({userSelect:"none",border:`solid 1px ${t.colors.border.medium}`}),disabled:(0,n.css)({opacity:"0.5",pointerEvents:"none"}),listItemName:(0,n.css)({flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),header:(0,n.css)({display:"flex",alignItems:"center",gap:t.spacing(1)}),dataSourceIcon:(0,n.css)({width:t.spacing(2),height:t.spacing(2)})});function ze(t,r,o){const c=Array.from(t),[i]=c.splice(r,1);return c.splice(o,0,i),c}var He=s(92467),Ae=s(80215);const es=a.memo(({group:t,namespace:r,expandAll:o,viewMode:c})=>{const{rulesSource:i}=r,p=(0,E.useDispatch)(),v=(0,f.of)(q),[ee,ne]=(0,a.useState)(!1),[me,se]=(0,a.useState)(!1),[ye,re]=(0,a.useState)(!1),[ve,oe]=(0,a.useState)(void 0),[P,O]=(0,a.useState)(!o),{canEditRules:V}=(0,Se.V)();(0,a.useEffect)(()=>{O(!o)},[o]);const{hasRuler:je,rulerRulesLoaded:Te}=(0,Z.y)(),Oe=t.rules[0]?.rulerRule,Y=Oe&&(0,pe.lT)(Oe)&&Oe.grafana_alert.namespace_uid||void 0,{folder:xe}=(0,L.a)(Y),ns=je(i)&&Te(i)&&!t.rules.find(Re=>!!Re.rulerRule),we=(0,pe.YN)(t),be=t.rules.some(Re=>(0,pe.lT)(Re.rulerRule)&&Re.rulerRule.grafana_alert.provenance),_e=c==="list",ke=c==="grouped",fe=()=>{p((0,W.g6)(r,t)),se(!1)},A=[];if(ns)A.push((0,e.jsxs)(qe.B,{children:[(0,e.jsx)(ce.y,{}),"deleting"]},"is-deleting"));else if(i===I.hY){if(Y){const Re=(0,Le.NH)(Y);xe?.canSave&&(ke&&!be&&(A.push((0,e.jsx)(ue.M,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>ne(!0)},"edit")),A.push((0,e.jsx)(ue.M,{"data-testid":"reorder-group",icon:"exchange-alt",tooltip:"reorder rules",className:v.rotate90,onClick:()=>re(!0)},"reorder"))),_e&&(A.push((0,e.jsx)(ue.M,{"aria-label":"go to folder",icon:"folder-open",tooltip:"go to folder",to:Re,target:"__blank"},"goto")),xe?.canAdmin&&A.push((0,e.jsx)(ue.M,{"aria-label":"manage permissions",icon:"lock",tooltip:"manage permissions",to:Re+"/permissions",target:"__blank"},"manage-perms")))),xe&&(_e?A.push((0,e.jsx)(ue.M,{"aria-label":"export rule folder","data-testid":"export-folder",icon:"download-alt",tooltip:"Export rules folder",onClick:()=>oe("folder")},"export-folder")):ke&&A.push((0,e.jsx)(ue.M,{"aria-label":"export rule group","data-testid":"export-group",icon:"download-alt",tooltip:"Export rule group",onClick:()=>oe("group")},"export-group")))}}else V(i.name)&&je(i)&&(we||(A.push((0,e.jsx)(ue.M,{"aria-label":"edit rule group","data-testid":"edit-group",icon:"pen",tooltip:"edit rule group",onClick:()=>ne(!0)},"edit")),A.push((0,e.jsx)(ue.M,{"data-testid":"reorder-group",icon:"exchange-alt",tooltip:"reorder rules",className:v.rotate90,onClick:()=>re(!0)},"reorder"))),A.push((0,e.jsx)(ue.M,{"aria-label":"delete rule group","data-testid":"delete-group",icon:"trash-alt",tooltip:"delete rule group",onClick:()=>se(!0)},"delete-group")));const ls=_e?(0,e.jsx)(We.c,{namespace:(0,Ke.EL)(r).name}):(0,e.jsx)(We.c,{namespace:(0,Ke.EL)(r).name,group:t.name}),is=(Re=!1)=>{Re||(0,R.fH)(R.le.leavingRuleGroupEdit),ne(!1)};return(0,e.jsxs)("div",{className:v.wrapper,"data-testid":"rule-group",children:[(0,e.jsxs)("div",{className:v.header,"data-testid":"rule-group-header",children:[(0,e.jsx)(F.e,{size:"sm",className:v.collapseToggle,isCollapsed:P,onToggle:O,"data-testid":ss.Tp.components.AlertRules.groupToggle}),(0,e.jsx)(ae.I,{name:P?"folder":"folder-open"}),(0,I.Eb)(i)&&(0,e.jsx)(Ve.m,{content:i.name,placement:"top",children:(0,e.jsx)("img",{alt:i.meta.name,className:v.dataSourceIcon,src:i.meta.info.logos.small})}),(0,e.jsxs)("div",{className:v.groupName,onClick:()=>O(!P),children:[we&&(0,e.jsx)(Ye.E,{color:"purple",text:"Federated"})," ",ls]}),(0,e.jsx)("div",{className:v.spacer}),(0,e.jsx)("div",{className:v.headerStats,children:(0,e.jsx)(He.j7,{group:t})}),be&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:v.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:v.actionIcons,children:(0,e.jsx)(Ye.E,{color:"purple",text:"Provisioned"})})]}),!!A.length&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:v.actionsSeparator,children:"|"}),(0,e.jsx)("div",{className:v.actionIcons,children:(0,e.jsx)(qe.B,{gap:.5,children:A})})]})]}),!P&&(0,e.jsx)(Ae.s,{showSummaryColumn:!0,className:v.rulesTable,showGuidelines:!0,showNextEvaluationColumn:!!t.interval,rules:t.rules}),ee&&(0,e.jsx)(Ne.u5,{namespace:r,group:t,onClose:()=>is(),folderUrl:xe?.canEdit?(0,Le.qN)(xe.uid):void 0,folderUid:Y}),ye&&(0,e.jsx)(Xe,{group:t,folderUid:Y,namespace:r,onClose:()=>re(!1)}),(0,e.jsx)(ts.u,{isOpen:me,title:"Delete group",body:(0,e.jsxs)("div",{children:[(0,e.jsxs)("p",{children:['Deleting "',(0,e.jsx)("strong",{children:t.name}),'" will permanently remove the group and'," ",t.rules.length," alert ",H()("rule",t.rules.length)," belonging to it."]}),(0,e.jsx)("p",{children:"Are you sure you want to delete this group?"})]}),onConfirm:fe,onDismiss:()=>se(!1),confirmText:"Delete"}),xe&&ve==="folder"&&(0,e.jsx)(Be,{folder:xe,onClose:()=>oe(void 0)}),xe&&ve==="group"&&(0,e.jsx)(Qe,{folderUid:xe.uid,groupName:t.name,onClose:()=>oe(void 0)})]})});es.displayName="RulesGroup";const q=t=>({wrapper:(0,n.css)({}),header:(0,n.css)({display:"flex",flexDirection:"row",alignItems:"center",padding:`${t.spacing(1)} ${t.spacing(1)} ${t.spacing(1)} 0`,flexWrap:"nowrap",borderBottom:`1px solid ${t.colors.border.weak}`,"&:hover":{backgroundColor:t.components.table.rowHoverBackground}}),headerStats:(0,n.css)({flexShrink:0,span:{verticalAlign:"middle"},[t.breakpoints.down("sm")]:{order:2,width:"100%",paddingLeft:t.spacing(1)}}),groupName:(0,n.css)({marginLeft:t.spacing(1),marginBottom:0,cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),spacer:(0,n.css)({flex:1}),collapseToggle:(0,n.css)({background:"none",border:"none",marginTop:`-${t.spacing(1)}`,marginBottom:`-${t.spacing(1)}`,svg:{marginBottom:0}}),dataSourceIcon:(0,n.css)({width:t.spacing(2),height:t.spacing(2),marginLeft:t.spacing(2)}),dataSourceOrigin:(0,n.css)({marginRight:"1em",color:t.colors.text.disabled}),actionsSeparator:(0,n.css)({margin:`0 ${t.spacing(2)}`}),actionIcons:(0,n.css)({width:"80px",alignItems:"center",flexShrink:0}),rulesTable:(0,n.css)({margin:t.spacing(2,0)}),rotate90:(0,n.css)({transform:"rotate(90deg)"})});function rs(t){return(0,a.useMemo)(()=>t.flatMap(r=>r.groups.map(o=>({namespace:r,group:o}))),[t])}const cs=({namespaces:t,expandAll:r})=>{const o=(0,f.of)(ds),c=(0,D.$)(O=>O.dataSources),i=(0,D.$)(O=>O.promRules),p=(0,a.useMemo)(I.qi,[]),v=rs(t),ee=(0,a.useMemo)(()=>p.filter(O=>(0,De.ML)(i[O.name])||(0,De.ML)(c[O.name])),[i,c,p]),ne=p.some(O=>!!i[O.name]?.result?.length),me=p.length>0,se=ee.length>0,ye=t.length>0,{numberOfPages:re,onPageChange:ve,page:oe,pageItems:P}=(0,X.W)(v,1,$.FG);return(0,e.jsxs)("section",{className:o.wrapper,children:[(0,e.jsx)("div",{className:o.sectionHeader,children:(0,e.jsxs)("div",{className:o.headerRow,children:[(0,e.jsx)(ie.E,{element:"h2",variant:"h5",children:"Mimir / Cortex / Loki"}),ee.length?(0,e.jsx)(Q._,{className:o.loader,text:`Loading rules from ${ee.length} ${H()("source",ee.length)}`}):(0,e.jsx)("div",{}),(0,e.jsx)(us,{})]})}),P.map(({group:O,namespace:V})=>(0,e.jsx)(es,{group:O,namespace:V,expandAll:r,viewMode:"grouped"},`${(0,I.v0)(V.rulesSource)}-${V.name}-${O.name}`)),!me&&(0,e.jsx)("p",{children:"There are no Prometheus or Loki data sources configured."}),me&&!se&&!ye&&(0,e.jsx)("p",{children:"No rules found."}),!ne&&se&&(0,e.jsx)(ce.y,{size:"xl",className:o.spinner}),(0,e.jsx)(K.d,{className:o.pagination,currentPage:oe,numberOfPages:re,onNavigate:ve,hideWhenSinglePage:!0})]})},ds=t=>({loader:(0,n.css)({marginBottom:0}),sectionHeader:(0,n.css)({display:"flex",justifyContent:"space-between"}),wrapper:(0,n.css)({marginBottom:t.spacing(4)}),spinner:(0,n.css)({textAlign:"center",padding:t.spacing(2)}),pagination:(0,Pe.H)(t),headerRow:(0,n.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",marginBottom:t.spacing(1)})});function us(){const[t,r]=(0,T.Ej)(T.RY.CreateExternalAlertRule),o=(0,u.zy)();return t&&r?(0,e.jsx)(l.z9,{href:y.kM.renderUrl("alerting/new/recording",{returnTo:o.pathname+o.search}),icon:"plus",variant:"secondary",children:"New recording rule"},"new-recording-rule"):null}var gs=s(42941);function ms({onClose:t}){const[r,o]=(0,a.useState)("yaml");return(0,e.jsx)(de.m,{activeTab:r,onTabChange:o,onClose:t,formatProviders:Object.values(Ce.sl),children:(0,e.jsx)(xs,{exportFormat:r,onClose:t})})}function xs({exportFormat:t,onClose:r}){const{currentData:o="",isFetching:c}=Ee.hK.endpoints.exportRules.useQuery({format:t}),i=`alert-rules-${new Date().getTime()}`;return c?(0,e.jsx)(Q._,{text:"Loading...."}):(0,e.jsx)(Ie.J,{format:t,textDefinition:o,downloadFileName:i,onClose:r})}const hs=({namespaces:t,expandAll:r})=>{const o=(0,f.of)(fs),[c]=(0,h.s)(),{prom:i,ruler:p}=(0,D.$)(Y=>({prom:Y.promRules[I.hY]||De.jA,ruler:Y.rulerRules[I.hY]||De.jA})),v=i.loading||p.loading,ee=!!i.result||!!p.result,ne=c.view==="list",me=ne?(0,N.Jr)(t):t,se=rs(me),{numberOfPages:ye,onPageChange:re,page:ve,pageItems:oe}=(0,X.W)(se,1,$.FG),[P,O]=(0,T.Ej)(T.RY.ExportGrafanaManagedRules),V=P&&O,[je,Te]=(0,gs.A)(!1),Oe=t.length>0;return(0,e.jsxs)("section",{className:o.wrapper,children:[(0,e.jsx)("div",{className:o.sectionHeader,children:(0,e.jsxs)("div",{className:o.headerRow,children:[(0,e.jsx)(ie.E,{element:"h2",variant:"h5",children:"Grafana"}),v?(0,e.jsx)(Q._,{className:o.loader,text:"Loading..."}):(0,e.jsx)("div",{}),Oe&&V&&(0,e.jsx)(l.$n,{"aria-label":"export all grafana rules","data-testid":"export-all-grafana-rules",icon:"download-alt",tooltip:"Export all Grafana-managed rules",onClick:Te,variant:"secondary",children:"Export rules"})]})}),oe.map(({group:Y,namespace:xe})=>(0,e.jsx)(es,{group:Y,namespace:xe,expandAll:r,viewMode:ne?"list":"grouped"},`${xe.name}-${Y.name}`)),ee&&me?.length===0&&(0,e.jsx)("p",{children:"No rules found."}),!ee&&v&&(0,e.jsx)(ce.y,{size:"xl",className:o.spinner}),(0,e.jsx)(K.d,{className:o.pagination,currentPage:ve,numberOfPages:ye,onNavigate:re,hideWhenSinglePage:!0}),V&&je&&(0,e.jsx)(ms,{onClose:Te})]})},fs=t=>({loader:(0,n.css)({marginBottom:0}),sectionHeader:(0,n.css)({display:"flex",justifyContent:"space-between",marginBottom:t.spacing(1)}),wrapper:(0,n.css)({marginBottom:t.spacing(4)}),spinner:(0,n.css)({textAlign:"center",padding:t.spacing(2)}),pagination:(0,Pe.H)(t),headerRow:(0,n.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",flexDirection:"row"})}),ps=({namespaces:t,expandAll:r})=>{const[o,c]=(0,a.useMemo)(()=>{const i=t.map(p=>({...p,groups:p.groups.sort((v,ee)=>v.name.localeCompare(ee.name))})).sort((p,v)=>p.name.localeCompare(v.name));return[i.filter(p=>(0,I.z2)(p.rulesSource)),i.filter(p=>(0,I.Eb)(p.rulesSource))]},[t]);return(0,a.useEffect)(()=>{(0,R.fH)(R.le.loadedList)},[]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B._,{actions:[T.RY.ViewAlertRule],children:(0,e.jsx)(hs,{namespaces:o,expandAll:r})}),(0,e.jsx)(B._,{actions:[T.RY.ViewExternalAlertRule],children:(0,e.jsx)(cs,{namespaces:c,expandAll:r})})]})};var ge=s(94822);const as=({rules:t,state:r,defaultCollapsed:o=!1})=>{const[c,i]=(0,a.useState)(o),p=(0,f.of)(vs);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("h4",{className:p.header,children:[(0,e.jsx)(F.e,{className:p.collapseToggle,size:"xxl",isCollapsed:c,onToggle:()=>i(!c)}),(0,pe.XI)(r)," (",t.length,")"]}),!c&&(0,e.jsx)(Ae.s,{className:p.rulesTable,rules:t,showGroupColumn:!0})]})},vs=t=>({collapseToggle:(0,n.css)({verticalAlign:"middle"}),header:(0,n.css)({marginTop:t.spacing(2)}),rulesTable:(0,n.css)({marginTop:t.spacing(3)})}),Es=({namespaces:t})=>{const r=(0,Le.Ht)((0,h.s)()[0]),o=(0,a.useMemo)(()=>{const c={[ge.cF.Firing]:[],[ge.cF.Inactive]:[],[ge.cF.Pending]:[]};return t.forEach(i=>i.groups.forEach(p=>p.rules.forEach(v=>{v.promRule&&(0,pe.Z8)(v.promRule)&&c[v.promRule.state].push(v)}))),Object.values(c).forEach(i=>i.sort((p,v)=>p.name.localeCompare(v.name))),c},[t]);return(0,e.jsxs)(e.Fragment,{children:[(!r.alertState||r.alertState===ge.cF.Firing)&&(0,e.jsx)(as,{state:ge.cF.Firing,rules:o[ge.cF.Firing]}),(!r.alertState||r.alertState===ge.cF.Pending)&&(0,e.jsx)(as,{state:ge.cF.Pending,rules:o[ge.cF.Pending]}),(!r.alertState||r.alertState===ge.cF.Inactive)&&(0,e.jsx)(as,{defaultCollapsed:r.alertState!==ge.cF.Inactive,state:ge.cF.Inactive,rules:o[ge.cF.Inactive]})]})};var js=s(84866);const os={groups:ps,state:Es},Rs=te.Ys+1,Ps=(0,g.Xc)(()=>{const t=(0,E.useDispatch)(),r=(0,f.of)(Ds),o=(0,a.useMemo)(I.gR,[]),[c,i]=(0,a.useState)(!1),p=(0,a.useCallback)(()=>i(!1),[]),[v]=(0,h.s)(),{filterState:ee,hasActiveFilters:ne}=(0,U.dI)(),me=v.view,se=os[me]?me:"groups",ye=os[se],re=(0,D.$)(fe=>fe.promRules),ve=(0,D.$)(fe=>fe.rulerRules),oe=o.some(fe=>re[fe]?.loading||ve[fe]?.loading),P=Object.entries(re),O=Object.entries(ve),V=P.every(([fe,A])=>A.dispatched&&(A?.result!==void 0||A?.error!==void 0)),je=O.every(([fe,A])=>A.dispatched&&(A?.result!==void 0||A?.error!==void 0)),Te=P.every(([fe,A])=>A.dispatched&&A?.result?.length===0),Oe=O.every(([fe,A])=>Object.entries(A?.result??{}).every(([Re,Is])=>Is?.length===0)&&A.dispatched),Y=ne?void 0:Rs,[xe,ns]=(0,m.A)(async()=>{oe||await t((0,W.yo)(!1,{limitAlerts:Y}))},[oe,Y,t]);(0,a.useEffect)(()=>{(0,R.Sq)().catch(()=>{})},[]),(0,a.useEffect)(()=>{t((0,W.yo)(!1,{limitAlerts:Y}))},[t,Y]),(0,d.A)(ns,G.HH);const we=V&&Te&&P.length>0&&Oe&&je,be=!we,_e=(0,N.dy)(),ke=(0,U.i7)(_e,ee);return(0,e.jsxs)(z.d,{navId:"alert-list",isLoading:!1,actions:be&&(0,e.jsx)(Ms,{}),children:[(0,e.jsx)(C.o,{}),(0,e.jsx)(js.A,{onFilterCleared:p}),be&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:r.break}),(0,e.jsx)("div",{className:r.buttonsContainer,children:(0,e.jsxs)("div",{className:r.statsContainer,children:[se==="groups"&&ne&&(0,e.jsx)(l.$n,{className:r.expandAllButton,icon:c?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>i(!c),children:c?"Collapse all":"Expand all"}),(0,e.jsx)(He.M_,{namespaces:ke})]})})]}),we&&(0,e.jsx)(le.w,{}),be&&(0,e.jsx)(ye,{expandAll:c,namespaces:ke})]})},{style:"page"}),Ds=t=>({break:(0,n.css)({width:"100%",height:0,marginBottom:t.spacing(2),borderBottom:`solid 1px ${t.colors.border.medium}`}),buttonsContainer:(0,n.css)({marginBottom:t.spacing(2),display:"flex",justifyContent:"space-between"}),statsContainer:(0,n.css)({display:"flex",flexDirection:"row",alignItems:"center"}),expandAllButton:(0,n.css)({marginRight:t.spacing(1)})}),Cs=Ps;function Ms(){const[t,r]=(0,T.Ej)(T.RY.CreateAlertRule),[o,c]=(0,T.Ej)(T.RY.CreateExternalAlertRule),i=(0,u.zy)();return t&&r||o&&c?(0,e.jsx)(l.z9,{href:y.kM.renderUrl("alerting/new/alerting",{returnTo:i.pathname+i.search}),icon:"plus",onClick:()=>(0,R.fH)(R.le.alertRuleFromScratch),children:"New alert rule"}):null}const ys=(0,a.lazy)(()=>s.e(2042).then(s.bind(s,82042))),Os=()=>{const t=x.$.featureToggles.alertingListViewV2;return(0,e.jsx)(a.Suspense,{children:t?(0,e.jsx)(ys,{}):(0,e.jsx)(Cs,{})})}},64853:(J,j,s)=>{s.d(j,{_:()=>u});var e=s(74848),a=s(2543),x=s.n(a),n=s(19073);const u=({actions:l,children:h})=>{const E=(0,a.filter)(l,g),R=(0,a.filter)(l,f);return E.length?(0,e.jsx)(m,{actions:E,children:h}):R.length?(0,e.jsx)(d,{actions:R,children:h}):null},m=({actions:l,children:h})=>{const E=(0,n.iI)();return y(E,l)?(0,e.jsx)(e.Fragment,{children:h}):null},d=({actions:l,children:h})=>{const E=(0,n.e2)();return y(E,l)?(0,e.jsx)(e.Fragment,{children:h}):null};function y(l,h){return(0,a.chain)(l).pick(h).values().value().some(([E,R])=>R===!0)}function g(l){return Object.values(n.QI).includes(l)}function f(l){return Object.values(n.RY).includes(l)}},64047:(J,j,s)=>{s.d(j,{e:()=>x});var e=s(74848),a=s(55852);const x=({isCollapsed:n,onToggle:u,idControlled:m,className:d,text:y,size:g="xl",...f})=>(0,e.jsx)(a.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!n,"aria-controls":m,className:d,icon:n?"angle-right":"angle-down",onClick:()=>u(!n),...f,children:y})},16293:(J,j,s)=>{s.d(j,{J:()=>R});var e=s(74848),a=s(32196),x=s(4213),n=s.n(x),u=s(96540),m=s(70713),d=s(40845),y=s(32372),g=s(55852),f=s(10534),l=s(72109),h=s(42418),E=s(84029);function R({format:U,textDefinition:D,downloadFileName:W,onClose:G}){const I=(0,d.of)(T),z=E.sl[U],le=(0,u.useCallback)(()=>{const C=new Blob([D],{type:`application/${U};charset=utf-8`});n()(C,`${W}.${U}`)},[D,W,U]),te=(0,u.useMemo)(()=>z.formatter?z.formatter(D):D,[z,D]);return(0,e.jsxs)("div",{className:I.container,children:[(0,e.jsx)(N,{exportProvider:z}),(0,e.jsx)("div",{className:I.content,children:(0,e.jsx)(m.Ay,{disableWidth:!0,children:({height:C})=>(0,e.jsx)(y.B,{width:"100%",height:C,language:U,value:te,monacoOptions:{minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",readOnly:!0}})})}),(0,e.jsxs)("div",{className:I.actions,children:[(0,e.jsx)(g.$n,{variant:"secondary",onClick:G,children:"Cancel"}),(0,e.jsx)(f.b,{icon:"copy",getText:()=>D,children:"Copy code"}),(0,e.jsx)(g.$n,{icon:"download-alt",onClick:le,children:"Download"})]})]})}const T=U=>({container:(0,a.css)({display:"flex",flexDirection:"column",height:"100%",gap:U.spacing(2)}),content:(0,a.css)({flex:"1 1 100%"}),actions:(0,a.css)({flex:0,justifyContent:"flex-end",display:"flex",gap:U.spacing(1)})});function N({exportProvider:U}){const{name:D,type:W}=U,G={file:{title:"File-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[D," format is only valid for File Provisioning."," ",(0,e.jsx)(l.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/file-provisioning/",external:!0,children:"Read more in the docs."})]})},api:{title:"API-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[D," format is only valid for API Provisioning."," ",(0,e.jsx)(l.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/http-api-provisioning/",external:!0,children:"Read more in the docs."})]})},terraform:{title:"Terraform-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[D," format is only valid for Terraform Provisioning."," ",(0,e.jsx)(l.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/terraform-provisioning/",external:!0,children:"Read more in the docs."})]})}},{title:I,component:z}=G[W];return(0,e.jsx)(h.F,{title:I,severity:"info",bottomSpacing:0,topSpacing:0,children:z})}},76648:(J,j,s)=>{s.d(j,{m:()=>n});var e=s(74848),a=s(87978),x=s(73716);function n({activeTab:u,onTabChange:m,children:d,onClose:y,formatProviders:g,title:f="Export"}){const l=Object.values(g).map(h=>({label:h.name,value:h.exportFormat}));return(0,e.jsx)(a._,{title:f,subtitle:"Select the format and download the file or copy the contents to clipboard",tabs:(0,e.jsx)(x.sb,{tabs:l,setActiveTab:m,activeTab:u}),onClose:y,size:"md",children:d})}},84029:(J,j,s)=>{s.d(j,{sl:()=>n});const e={name:"JSON",exportFormat:"json",type:"file",formatter:m=>{try{return JSON.stringify(JSON.parse(m),null,4)}catch{return m}}},a={name:"YAML",exportFormat:"yaml",type:"file"},x={name:"Terraform (HCL)",exportFormat:"hcl",type:"terraform"},n={[e.exportFormat]:e,[a.exportFormat]:a,[x.exportFormat]:x},u=[e,a]},19338:(J,j,s)=>{s.d(j,{G:()=>y});var e=s(74848),a=s(32196),x=s(40845),n=s(60782),u=s(67061),m=s(14578),d=s(94753);function y({contentText:f,externalLink:l,linkText:h,title:E="Need help?"}){const R=(0,x.of)(g);return(0,e.jsx)(n.G,{content:(0,e.jsx)("div",{className:R.mutedText,children:f}),title:(0,e.jsxs)(u.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,e.jsx)(m.I,{name:"question-circle"}),E]}),footer:l?(0,e.jsx)("a",{href:l,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(u.B,{direction:"row",gap:.5,alignItems:"center",children:(0,e.jsxs)(d.E,{color:"link",children:[h," ",(0,e.jsx)(m.I,{size:"sm",name:"external-link-alt"})]})})}):void 0,closeButton:!0,placement:"bottom-start",children:(0,e.jsx)("div",{className:R.helpInfo,children:(0,e.jsxs)(u.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(m.I,{name:"question-circle",size:"sm"}),(0,e.jsx)(d.E,{variant:"bodySmall",color:"primary",children:"Need help?"})]})})})}const g=f=>({mutedText:(0,a.css)({color:f.colors.text.secondary,fontSize:f.typography.size.sm}),helpInfo:(0,a.css)({cursor:"pointer",textDecoration:"underline"})})},271:(J,j,s)=>{s.d(j,{P:()=>d});var e=s(74848),a=s(32196),x=s(40845),n=s(84167),u=s(94753),m=s(67061);const d=({title:g,stepNo:f,children:l,fullWidth:h=!1,description:E})=>{const R=(0,x.of)(y);return(0,e.jsx)("div",{className:R.parent,children:(0,e.jsx)(n.n,{className:(0,a.cx)(h&&R.fullWidth),label:(0,e.jsxs)(u.E,{variant:"h3",children:[f,". ",g]}),children:(0,e.jsxs)(m.B,{direction:"column",children:[E&&(0,e.jsx)("div",{className:R.description,children:E}),l]})})})},y=g=>({parent:(0,a.css)({display:"flex",flexDirection:"row",border:`solid 1px ${g.colors.border.weak}`,borderRadius:g.shape.radius.default,padding:`${g.spacing(2)} ${g.spacing(3)}`}),description:(0,a.css)({marginTop:`-${g.spacing(2)}`}),fullWidth:(0,a.css)({width:"100%"})})},73716:(J,j,s)=>{s.d(j,{G_:()=>D,sb:()=>W});var e=s(74848),a=s(32196),x=s(20382),n=s(96540),u=s(49785),m=s(70713),d=s(40845),y=s(87978),g=s(63021),f=s(40675),l=s(55852),h=s(56034),E=s(14578),R=s(32372),T=s(63066),N=s(23662);const U=[{label:"Yaml",value:"yaml"}],D=({onClose:C})=>{const[B,S]=(0,n.useState)("yaml"),{setValue:H}=(0,u.xW)(),ie=(0,d.of)(te),Q=ce=>{for(const K in ce)H(K,ce[K]);C()};return(0,e.jsx)(y._,{title:"Inspect Alert rule",subtitle:(0,e.jsx)("div",{className:ie.subtitle,children:(0,e.jsx)(W,{tabs:U,setActiveTab:S,activeTab:B})}),onClose:C,children:B==="yaml"&&(0,e.jsx)(G,{onSubmit:Q})})};function W({tabs:C,activeTab:B,setActiveTab:S}){return(0,e.jsx)(g.U,{children:C.map((H,ie)=>(0,e.jsx)(f.o,{label:H.label,value:H.value,onChangeTab:()=>S(H.value),active:B===H.value},`${H.value}-${ie}`))})}const G=({onSubmit:C})=>{const B=(0,d.of)(le),{getValues:S}=(0,u.xW)(),H=(0,T.l1)(S()),[ie,Q]=(0,n.useState)((0,x.Bh)(H)),ce=()=>{const K=(0,x.Hh)(ie),$=S(),X=z(K);C({...$,...X})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:B.applyButton,children:[(0,e.jsx)(l.$n,{type:"button",onClick:ce,children:"Apply"}),(0,e.jsx)(h.m,{content:(0,e.jsx)(I,{}),theme:"info",placement:"left-start",interactive:!0,children:(0,e.jsx)(E.I,{name:"exclamation-triangle",size:"xl"})})]}),(0,e.jsx)("div",{className:B.content,children:(0,e.jsx)(m.Ay,{disableWidth:!0,children:({height:K})=>(0,e.jsx)(R.B,{width:"100%",height:K,language:"yaml",value:ie,onBlur:Q,monacoOptions:{minimap:{enabled:!1}}})})})]})};function I(){return(0,e.jsxs)("div",{children:["The YAML content in the editor only contains alert rule configuration ",(0,e.jsx)("br",{}),"To configure Prometheus, you need to provide the rest of the"," ",(0,e.jsx)("a",{href:"https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/",target:"_blank",rel:"noreferrer",children:"configuration file content."})]})}function z(C){return(0,N.$y)(C)?(0,T.Qk)(C):(0,N.i7)(C)?(0,T.XI)(C):{}}const le=C=>({content:(0,a.css)({flexGrow:1,height:"100%",paddingBottom:"16px",marginBottom:C.spacing(2)}),applyButton:(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexGrow:0,marginBottom:C.spacing(2)})}),te=()=>({subtitle:(0,a.css)({display:"flex",alignItems:"center",justifyContent:"space-between"})})},72275:(J,j,s)=>{s.d(j,{M:()=>n});var e=s(74848),a=s(56034),x=s(55852);const n=({tooltip:u,icon:m,to:d,target:y,onClick:g,className:f,tooltipPlacement:l="top",...h})=>{const E=typeof u=="string"?u:void 0;return(0,e.jsx)(a.m,{content:u,placement:l,children:d?(0,e.jsx)(x.z9,{variant:"secondary",fill:"text",icon:m,href:d,size:"sm",target:y,...h,"aria-label":E}):(0,e.jsx)(x.$n,{className:f,variant:"secondary",fill:"text",size:"sm",icon:m,type:"button",onClick:g,...h,"aria-label":E})})}},45058:(J,j,s)=>{s.d(j,{w:()=>g});var e=s(74848),a=s(32196),x=s(40845),n=s(67061),u=s(76442),m=s(7521),d=s(25027),y=s(41520);const g=()=>{const{canCreateGrafanaRules:l,canCreateCloudRules:h}=(0,y.V)(),E=(0,x.of)(f);return l||h?(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"You haven't created any alert rules yet"}),(0,e.jsxs)(n.B,{gap:1,children:[(0,e.jsx)("div",{className:E.newRuleCard,children:(0,e.jsx)(m.A,{title:"",buttonIcon:"bell",buttonLink:"alerting/new/alerting",buttonTitle:"New alert rule",proTip:"you can also create alert rules from existing panels and queries.",proTipLink:"https://grafana.com/docs/",proTipLinkTitle:"Learn more",proTipTarget:"_blank",onClick:()=>(0,d.fH)(d.le.alertRuleFromScratch)})}),(0,e.jsx)("div",{className:E.newRuleCard,children:(0,e.jsx)(m.A,{title:"",buttonIcon:"plus",buttonLink:"alerting/new/recording",buttonTitle:"New recording rule",onClick:()=>(0,d.fH)(d.le.recordingRuleFromScratch)})})]})]}):(0,e.jsx)(u.c,{message:"No rules exist yet.",callToActionElement:(0,e.jsx)("div",{})})},f=l=>({newRuleCard:(0,a.css)({width:`calc(50% - ${l.spacing(1)})`,"> div":{height:"100%"}})})},67381:(J,j,s)=>{s.d(j,{o:()=>T});var e=s(74848),a=s(32196),x=s(55127),n=s.n(x),u=s(96540),m=s(78685),d=s(40845),y=s(42418),g=s(55852),f=s(56034),l=s(61410),h=s(57220),E=s(56361),R=s(23662);function T(){const[D,W]=(0,u.useState)(!1),[G,I]=(0,m.A)("grafana.unifiedalerting.hideErrors",!1),z=(0,l.$)(S=>S.dataSources),le=(0,l.$)(S=>S.promRules),te=(0,l.$)(S=>S.rulerRules),C=(0,d.of)(U),B=(0,u.useMemo)(()=>{const[S,H,ie]=[z,le,te].map($=>(0,h.qi)().reduce((X,Pe)=>{const De=$[Pe.name]?.error;return $[Pe.name]&&De&&!(0,R.$7)($[Pe.name])?[...X,{dataSource:Pe,error:De}]:X},[])),Q=le[h.hY]?.error,ce=te[h.hY]?.error,K=[];return Q&&K.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules state: ",Q.message||"Unknown error."]})),ce&&K.push((0,e.jsxs)(e.Fragment,{children:["Failed to load Grafana rules config: ",ce.message||"Unknown error."]})),S.forEach(({dataSource:$,error:X})=>{K.push((0,e.jsxs)(e.Fragment,{children:["Failed to load the data source configuration for"," ",(0,e.jsx)("a",{href:(0,E.GD)($.uid),className:C.dsLink,children:$.name}),": ",X.message||"Unknown error."]}))}),H.forEach(({dataSource:$,error:X})=>K.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules state from"," ",(0,e.jsx)("a",{href:(0,E.GD)($.uid),className:C.dsLink,children:$.name}),": ",X.message||"Unknown error."]}))),ie.forEach(({dataSource:$,error:X})=>K.push((0,e.jsxs)(e.Fragment,{children:["Failed to load rules config from"," ",(0,e.jsx)("a",{href:(0,E.GD)($.uid),className:C.dsLink,children:$.name}),": ",X.message||"Unknown error."]}))),K},[z,le,te,C.dsLink]);return(0,e.jsxs)(e.Fragment,{children:[!!B.length&&G&&(0,e.jsx)(N,{count:B.length,onClick:()=>I(S=>!S)}),!!B.length&&!G&&(0,e.jsxs)(y.F,{"data-testid":"cloud-rulessource-errors",title:"Errors loading rules",severity:"error",onRemove:()=>I(!0),children:[D&&B.map((S,H)=>(0,e.jsx)("div",{children:S},H)),!D&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:B[0]}),B.length>=2&&(0,e.jsxs)(g.$n,{className:C.moreButton,fill:"text",icon:"angle-right",size:"sm",onClick:()=>W(!0),children:[B.length-1," more ",n()("error",B.length-1)]})]})]})]})}const N=({count:D,onClick:W})=>{const G=(0,d.of)(U);return(0,e.jsx)("div",{className:G.floatRight,children:(0,e.jsx)(f.m,{content:"Show all errors",placement:"bottom",children:(0,e.jsx)(g.$n,{fill:"text",variant:"destructive",icon:"exclamation-triangle",onClick:W,children:D>1?(0,e.jsxs)(e.Fragment,{children:[D," errors"]}):(0,e.jsx)(e.Fragment,{children:"1 error"})})})})},U=D=>({moreButton:(0,a.css)({padding:0}),floatRight:(0,a.css)({display:"flex",justifyContent:"flex-end"}),dsLink:(0,a.css)({fontWeight:D.typography.fontWeightBold})})},84866:(J,j,s)=>{s.d(j,{A:()=>ts});var e=s(74848),a=s(32196),x=s(96540),n=s(49785),u=s(40845),m=s(14578),d=s(67061),y=s(88575),g=s(60029),f=s(56034),l=s(94354),h=s(10354),E=s(55852),R=s(59429),T=s(94822),N=s(25027),U=s(14285),D=s(39964),W=s(86171),G=s(28475),I=s(23662),z=s(35108),le=s(22391),te=s(51527),C=s(13544),B=s(19347),S=s(26657),H=s(90182),ie=s(98624),Q=s(57220);const ce=L=>{const Z=(0,B.l)(),[Se,Le]=(0,x.useState)(),pe=(b,w)=>{if(w.action==="clear"&&L.onClear){L.onClear();return}const Me=b[b.length-1];let he,_;w.action==="pop-value"||w.action==="remove-value"?(he=w.removedValue?.value,_="remove"):(he=Me.value,_="add");const k=Z.getInstanceSettings(he);k&&(L.onChange(k,_),Le({error:void 0}))},F=()=>{const{current:b,hideTextValue:w,noDefault:Me}=L;if(!(!b&&Me))return b?.map(he=>{const _=Z.getInstanceSettings(he);if(_)return{label:_.name.slice(0,37),value:_.name,imgUrl:_.meta.info.logos.small,hideText:w,meta:_.meta};const k=(0,le.Iz)(he);return k===S.dR.uid||k===S.dR.name?{label:k,value:k,hideText:w}:{label:(k??"no name")+" - not found",value:k??void 0,imgUrl:"",hideText:w}})},We=()=>{const{alerting:b,tracing:w,metrics:Me,mixed:he,dashboard:_,variables:k,annotations:$e,pluginId:Xe,type:Ge,filter:Ze,logs:M}=L,ze=Z.getList({alerting:b,tracing:w,metrics:Me,logs:M,dashboard:_,mixed:he,variables:k,annotations:$e,pluginId:Xe,filter:Ze,type:Ge}),He=ze.filter(Q.hP).map(q=>({value:q.name,label:`${q.name}${q.isDefault?" (default)":""}`,imgUrl:q.meta.info.logos.small,meta:q.meta})),Ae=ze.filter(q=>!(0,Q.hP)(q)).map(q=>({value:q.name,label:`${q.name}${q.isDefault?" (default)":""}`,imgUrl:q.meta.info.logos.small,meta:q.meta}));return[{label:"Data sources with configured alert rules",options:He,expanded:!0},{label:"Other data sources",options:Ae,expanded:!0}]},{autoFocus:Ee,onBlur:Ie,onClear:de,openMenuOnFocus:Ce,placeholder:Be,width:Je,inputId:Qe,disabled:Fe=!1,isLoading:Ke=!1}=L,ue=We(),Ne=F(),Ue=typeof de=="function";return(0,e.jsx)("div",{"data-testid":C.Tp.components.DataSourcePicker.container,children:(0,e.jsx)(H.KF,{isLoading:Ke,disabled:Fe,"data-testid":C.Tp.components.DataSourcePicker.inputV2,inputId:Qe||"data-source-picker",className:"ds-picker select-container",isClearable:Ue,backspaceRemovesValue:!0,onChange:pe,options:ue,autoFocus:Ee,onBlur:Ie,width:Je,openMenuOnFocus:Ce,maxMenuHeight:500,placeholder:Be,noOptionsMessage:"No datasources found",value:Ne??[],invalid:!!Se?.error||!!L.invalid,getOptionLabel:b=>b.meta&&(0,te.x)(b.meta.signature)&&b!==Ne?(0,e.jsxs)(d.B,{alignItems:"center",justifyContent:"space-between",children:[(0,e.jsx)("span",{children:b.label})," ",(0,e.jsx)(ie.B,{status:b.meta.signature})]}):b.label||""})})},K=[{icon:"folder",label:"Grouped",value:"grouped"},{icon:"list-ul",label:"List",value:"list"},{icon:"heart-rate",label:"State",value:"state"}],$=[{label:"Alert ",value:T.JS.Alerting},{label:"Recording ",value:T.JS.Recording}],X=[{label:"Ok",value:G.Jc.Ok},{label:"No Data",value:G.Jc.NoData},{label:"Error",value:G.Jc.Error}],Pe=Object.entries(T.cF).map(([L,Z])=>({label:(0,I.XI)(Z),value:Z})),De=({onFilterCleared:L=()=>{}})=>{const Z=(0,u.of)(ss),[Se,Le]=(0,D.l)(),{pluginsFilterEnabled:pe}=Ye(),{filterState:F,hasActiveFilters:We,searchQuery:Ee,setSearchQuery:Ie,updateFilters:de}=(0,U.dI)(),[Ce,Be]=(0,x.useState)(Math.floor(Math.random()*100)),Je=`dataSource-${Ce}`,Qe=`queryString-${Ce}`,Fe=(0,x.useRef)(null),{handleSubmit:Ke,register:ue,setValue:Ne}=(0,n.mN)({defaultValues:{searchQuery:Ee}}),{ref:Ue,...b}=ue("searchQuery");(0,x.useEffect)(()=>{Ne("searchQuery",Ee)},[Ee,Ne]);const w=(M,ze)=>{const He=ze==="add"?[...F.dataSourceNames].concat([M.name]):F.dataSourceNames.filter(Ae=>Ae!==M.name);de({...F,dataSourceNames:He}),Be(Ae=>Ae+1),(0,N.Sn)("dataSourceNames")},Me=M=>{de({...F,dashboardUid:M}),(0,N.Sn)("dashboardUid")},he=()=>{de({...F,dataSourceNames:[]}),Be(M=>M+1)},_=M=>{(0,N.fH)(N.le.clickingAlertStateFilters),de({...F,ruleState:M}),(0,N.Sn)("ruleState")},k=M=>{de({...F,ruleType:M}),(0,N.Sn)("ruleType")},$e=M=>{de({...F,ruleHealth:M}),(0,N.Sn)("ruleHealth")},Xe=()=>{Ie(void 0),L(),setTimeout(()=>Be(Ce+1),100)},Ge=M=>{Le({view:M}),(0,N.aL)({view:M})},Ze=(0,e.jsx)(m.I,{name:"search"});return(0,e.jsx)("div",{className:Z.container,children:(0,e.jsxs)(d.B,{direction:"column",gap:1,children:[(0,e.jsxs)(d.B,{direction:"row",gap:1,wrap:"wrap",children:[(0,e.jsx)(y.D,{className:Z.dsPickerContainer,label:(0,e.jsx)(g.J,{htmlFor:"data-source-picker",children:(0,e.jsxs)(d.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:"Search by data sources"}),(0,e.jsx)(f.m,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{children:"Data sources containing configured alert rules are Mimir or Loki data sources where alert rules are stored and evaluated in the data source itself."}),(0,e.jsx)("p",{children:"In these data sources, you can select Manage alerts via Alerting UI to be able to manage these alert rules in the Grafana UI as well as in the data source where they were configured."})]}),children:(0,e.jsx)(m.I,{id:"data-source-picker-inline-help",name:"info-circle",size:"sm",title:"Search by data sources help"})})]})}),children:(0,e.jsx)(ce,{alerting:!0,noDefault:!0,placeholder:"All data sources",current:F.dataSourceNames,onChange:w,onClear:he},Je)}),(0,e.jsx)(y.D,{className:Z.dashboardPickerContainer,label:(0,e.jsx)(g.J,{htmlFor:"filters-dashboard-picker",children:"Dashboard"}),children:(0,e.jsx)(R.b,{inputId:"filters-dashboard-picker",value:F.dashboardUid,onChange:M=>Me(M?.uid),isClearable:!0,cacheOptions:!0},F.dashboardUid?"dashboard-defined":"dashboard-not-defined")}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"State"}),(0,e.jsx)(l.z,{options:Pe,value:F.ruleState,onChange:_})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"Rule type"}),(0,e.jsx)(l.z,{options:$,value:F.ruleType,onChange:k})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"Health"}),(0,e.jsx)(l.z,{options:X,value:F.ruleHealth,onChange:$e})]}),pe&&(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"Plugin rules"}),(0,e.jsx)(l.z,{options:[{label:"Show",value:void 0},{label:"Hide",value:"hide"}],value:F.plugins,onChange:M=>de({...F,plugins:M})})]})]}),(0,e.jsxs)(d.B,{direction:"column",gap:1,children:[(0,e.jsxs)(d.B,{direction:"row",gap:1,children:[(0,e.jsxs)("form",{className:Z.searchInput,onSubmit:Ke(M=>{Ie(M.searchQuery),Fe.current?.blur(),(0,N.zs)({oldQuery:Ee,newQuery:M.searchQuery})}),children:[(0,e.jsx)(y.D,{label:(0,e.jsx)(g.J,{htmlFor:"rulesSearchInput",children:(0,e.jsxs)(d.B,{gap:.5,alignItems:"center",children:[(0,e.jsx)("span",{children:"Search"}),(0,e.jsx)(z.j,{content:(0,e.jsx)(qe,{}),children:(0,e.jsx)(m.I,{name:"info-circle",size:"sm",tabIndex:0,title:"Search help"})})]})}),children:(0,e.jsx)(h.p,{id:"rulesSearchInput",prefix:Ze,ref:M=>{Ue(M),Fe.current=M},...b,placeholder:"Search","data-testid":"search-query-input"},Qe)}),(0,e.jsx)("input",{type:"submit",hidden:!0})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(g.J,{children:"View as"}),(0,e.jsx)(l.z,{options:K,value:Se.get("view")??K[0].value,onChange:Ge})]})]}),We&&(0,e.jsx)("div",{children:(0,e.jsx)(E.$n,{fullWidth:!1,icon:"times",variant:"secondary",onClick:Xe,children:"Clear filters"})})]})]})})},ss=L=>({container:(0,a.css)({marginBottom:L.spacing(1)}),dsPickerContainer:(0,a.css)({width:L.spacing(60),flexGrow:0,margin:0}),dashboardPickerContainer:(0,a.css)({minWidth:L.spacing(50)}),searchInput:(0,a.css)({flex:1,margin:0})});function qe(){const L=(0,u.of)(Ve);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{children:"Search syntax allows to query alert rules by the parameters defined below."}),(0,e.jsx)("hr",{}),(0,e.jsxs)("div",{className:L.grid,children:[(0,e.jsx)("div",{children:"Filter type"}),(0,e.jsx)("div",{children:"Expression"}),(0,e.jsx)(ae,{title:"Datasources",expr:"datasource:mimir datasource:prometheus"}),(0,e.jsx)(ae,{title:"Folder/Namespace",expr:"namespace:global"}),(0,e.jsx)(ae,{title:"Group",expr:"group:cpu-usage"}),(0,e.jsx)(ae,{title:"Rule",expr:'rule:"cpu 80%"'}),(0,e.jsx)(ae,{title:"Labels",expr:"label:team=A label:cluster=a1"}),(0,e.jsx)(ae,{title:"State",expr:"state:firing|normal|pending"}),(0,e.jsx)(ae,{title:"Type",expr:"type:alerting|recording"}),(0,e.jsx)(ae,{title:"Health",expr:"health:ok|nodata|error"}),(0,e.jsx)(ae,{title:"Dashboard UID",expr:"dashboard:eadde4c7-54e6-4964-85c0-484ab852fd04"})]})]})}function ae({title:L,expr:Z}){const Se=(0,u.of)(Ve);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:L}),(0,e.jsx)("code",{className:Se.code,children:Z})]})}const Ve=L=>({grid:(0,a.css)({display:"grid",gridTemplateColumns:"max-content auto",gap:L.spacing(1),alignItems:"center"}),code:(0,a.css)({display:"block",textAlign:"center"})});function Ye(){const{extensions:L}=(0,W.u)();return{pluginsFilterEnabled:L.length>0}}const ts=De},86171:(J,j,s)=>{s.d(j,{u:()=>x});var e=s(74135),a=s(3197);function x(){return(0,a.kr)({extensionPointId:e.S.AlertingHomePage,limitPerPlugin:1})}},10940:(J,j,s)=>{s.d(j,{A:()=>x});var e=s(96540),a=function(n,u){var m=(0,e.useRef)(function(){});(0,e.useEffect)(function(){m.current=n}),(0,e.useEffect)(function(){if(u!==null){var d=setInterval(function(){return m.current()},u||0);return function(){return clearInterval(d)}}},[u])};const x=a}}]);

//# sourceMappingURL=AlertRuleListIndex.b2e47ced3918ed940b02.js.map