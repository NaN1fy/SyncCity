"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[152],{2471:(ne,F,t)=>{t.r(F),t.d(F,{default:()=>ft});var e=t(74848),u=t(32196),r=t(96540),b=t(24180),L=t(70713),d=t(14110),v=t(40845),y=t(67647),C=t(69444),p=t(31678),D=t(71101),E=t(39788),i=t(8484);function O(s=!1){return s?(0,i.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,i.t)("search.search-input.placeholder","Search for dashboards and folders")}function A(){return(0,i.t)("search.dashboard-actions.new-dashboard","New dashboard")}function T(){return(0,i.t)("search.dashboard-actions.new-folder","New folder")}function c(){return(0,i.t)("search.dashboard-actions.import","Import")}function I(){return(0,i.t)("search.dashboard-actions.new","New")}var a=t(55314),m=t(32264),f=t(55852),K=t(67061),U=t(56034),Q=t(28138),J=t(28444),j=t(37690),X=t(18241),re=t(51887);function q(){const s=(0,p.useDispatch)(),o=(0,j.xK)(),[g]=(0,a.uz)(),[l]=(0,a.wt)(),[,n]=(0,E.ET)(),h=(0,r.useMemo)(()=>!m.$.featureToggles.nestedFolders&&Object.values(o.folder).some(V=>V),[o]),x=n.hasSearchFilters(),S=()=>{s((0,j.cT)({isSelected:!1,folderUID:void 0})),x&&n.doSearchWithDebounce()},M=async()=>{await g({selectedItems:o}),R("delete",o),S()},P=async V=>{await l({selectedItems:o,destinationUID:V}),R("move",o),S()},w=()=>{Q.A.publish(new J.S8({component:re.J,props:{selectedItems:o,onConfirm:P}}))},B=()=>{Q.A.publish(new J.S8({component:X.T,props:{selectedItems:o,onConfirm:M}}))},$=(0,e.jsx)(f.$n,{onClick:w,variant:"secondary",disabled:h,children:(0,e.jsx)(i.x6,{i18nKey:"browse-dashboards.action.move-button",children:"Move"})});return(0,e.jsxs)(K.B,{gap:1,"data-testid":"manage-actions",children:[h?(0,e.jsx)(U.m,{content:(0,i.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved"),children:$}):$,(0,e.jsx)(f.$n,{onClick:B,variant:"destructive",children:(0,e.jsx)(i.x6,{i18nKey:"browse-dashboards.action.delete-button",children:"Delete"})})]})}const ee={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function R(s,o){const g=Object.keys(o.dashboard).filter(n=>o.dashboard[n]),l=Object.keys(o.folder).filter(n=>o.folder[n]);(0,d.rR)(ee[s],{item_counts:{folder:l.length,dashboard:g.length},source:"tree_actions",restore_enabled:m.$.featureToggles.dashboardRestoreUI})}var H=t(19519),te=t(24439);function ue(){const[s,o]=(0,E.ET)();return(0,e.jsx)(H.bj,{showStarredFilter:!0,showLayout:!0,state:s,getTagOptions:o.getTagOptions,getSortOptions:(0,te.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,te.getGrafanaSearcher)().sortPlaceholder,onLayoutChange:o.onLayoutChange,onStarredFilterChange:o.onStarredFilterChange,onSortChange:o.onSortChange,onTagFilterChange:o.onTagFilterChange,onDatasourceChange:o.onDatasourceChange,onPanelTypeChange:o.onPanelTypeChange,onSetIncludePanels:o.onSetIncludePanels})}var ge=t(69529),me=t(72109),fe=t(76442),ve=t(92955),N=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(N||{}),Ee=t(32885),se=t(91793),De=t(10022),We=t(39070),de=t(13544),Pe=t(10880),Ce=t(49952);function Fe({row:{original:s},isSelected:o,onItemSelectionChange:g}){const l=s.item;if(!o)return(0,e.jsx)(xe,{});if(l.kind==="ui")return l.uiKind==="pagination-placeholder"?(0,e.jsx)(Pe.S,{disabled:!0,value:!1}):(0,e.jsx)(xe,{});if((0,Ce.I)(l.uid))return(0,e.jsx)(xe,{});const n=o(l);return(0,e.jsx)(Pe.S,{"data-testid":de.Tp.pages.BrowseDashboards.table.checkbox(l.uid),"aria-label":(0,i.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:n===N.Selected,indeterminate:n===N.Mixed,onChange:h=>g?.(l,h.currentTarget.checked)})}function xe(){const s=(0,v.of)(Ne);return(0,e.jsx)("span",{className:s.checkboxSpacer})}const Ne=s=>({checkboxSpacer:(0,u.css)({paddingLeft:s.spacing(2)})});function we({isSelected:s,onAllSelectionChange:o}){const g=s?.("$all")??N.Unselected;return(0,e.jsx)(Pe.S,{value:g===N.Selected,indeterminate:g===N.Mixed,"aria-label":(0,i.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:l=>{g===N.Mixed?o?.(!1):o?.(l.currentTarget.checked)}})}var $e=t(70255),Oe=t(94753),Ve=t(29158),ze=t(62930),Te=t(14578),He=t(50720),Ie=t(78318),Qe=t(40957),je=t(18759);const Me="md",Ae="sm";function Ge({row:{original:s},onFolderClick:o,treeID:g}){const l=(0,v.of)(Ye),{item:n,level:h,isOpen:x}=s,S=(0,j.V6)(),M=x&&!S[n.uid],P=(0,Qe.cu)(s.item,x);return n.kind==="ui"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(je.T,{level:h,spacing:{xs:1,md:3}}),(0,e.jsx)("span",{className:l.folderButtonSpacer}),n.uiKind==="empty-folder"?(0,e.jsx)("em",{className:l.emptyText,children:(0,e.jsx)(Oe.E,{variant:"body",color:"secondary",truncate:!0,children:"No items"})}):(0,e.jsx)($e.A,{width:200})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(je.T,{level:h,spacing:{xs:1,md:3}}),n.kind==="folder"?(0,e.jsx)(Ve.K,{size:Me,className:l.chevron,onClick:()=>{o(n.uid,!x)},name:x?"angle-down":"angle-right","aria-label":x?(0,i.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:n.title}):(0,i.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:n.title})}):(0,e.jsx)("span",{className:l.folderButtonSpacer}),(0,e.jsxs)("div",{className:l.iconNameContainer,children:[M?(0,e.jsx)(ze.y,{size:Ae}):(0,e.jsx)(Te.I,{size:Ae,name:P}),(0,e.jsx)(Oe.E,{variant:"body",truncate:!0,id:g&&(0,Ce.e)(g,n),children:n.url?(0,e.jsx)(He.N,{onClick:()=>{(0,d.rR)("manage_dashboards_result_clicked")},href:n.url,className:l.link,children:n.title}):n.title})]})]})}const Ye=s=>({chevron:(0,u.css)({marginRight:s.spacing(1),width:(0,Ie.cs)(Me)}),emptyText:(0,u.css)({overflow:"hidden"}),folderButtonSpacer:(0,u.css)({paddingLeft:`calc(${(0,Ie.cs)(Me)}px + ${s.spacing(1)})`}),iconNameContainer:(0,u.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,u.css)({"&:hover":{textDecoration:"underline"}})});var _e=t(64149);function Ze({row:{original:s}}){const o=(0,v.of)(Je),g=s.item;return g.kind==="ui"?g.uiKind==="pagination-placeholder"?(0,e.jsx)(_e.L.Skeleton,{}):null:g.tags?(0,e.jsx)(_e.L,{className:o.tagList,tags:g.tags}):null}function Je(s){return{tagList:(0,u.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var Xe=t(37811);const Le=36,ye=36,ke=0;function qe({items:s,width:o,height:g,isSelected:l,onFolderClick:n,onAllSelectionChange:h,onItemSelectionChange:x,isItemLoaded:S,requestLoadMore:M,canSelect:P=!1}){const w=(0,r.useId)(),B=(0,r.useRef)(null),$=(0,r.useRef)(null),V=(0,v.of)(Re);(0,r.useEffect)(()=>{B.current&&B.current.resetloadMoreItemsCache(!0),$.current&&$.current.resetAfterIndex(0)},[s]);const _=(0,r.useMemo)(()=>{const z={id:"checkbox",width:0,Header:we,Cell:Fe},k={id:"name",width:3,Header:(0,e.jsx)("span",{style:{paddingLeft:24},children:(0,e.jsx)(i.x6,{i18nKey:"browse-dashboards.dashboards-tree.name-column",children:"Name"})}),Cell:Se=>(0,e.jsx)(Ge,{...Se,onFolderClick:n})},oe={id:"tags",width:2,Header:(0,i.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:Ze};return[P&&z,k,oe].filter(We.zz)},[n,P]),W=(0,Ee.useTable)({columns:_,data:s},Xe.A),{getTableProps:Y,getTableBodyProps:ae,headerGroups:le}=W,ce=(0,r.useMemo)(()=>({table:W,isSelected:l,onAllSelectionChange:h,onItemSelectionChange:x,treeID:w}),[W,l,h,x,s,w]),G=(0,r.useCallback)(z=>S(z),[S]),Z=(0,r.useCallback)((z,k)=>{const{parentUID:oe}=s[z];M(oe)},[M,s]),he=(0,r.useCallback)(z=>{const k=s[z];return k.item.kind==="ui"&&k.item.uiKind==="divider"?ke:ye},[s]);return(0,e.jsxs)("div",{...Y(),role:"table",children:[le.map(z=>{const{key:k,...oe}=z.getHeaderGroupProps({style:{width:o}});return(0,e.jsx)("div",{...oe,className:(0,u.cx)(V.row,V.headerRow),children:z.headers.map(be=>{const{key:Se,...vt}=be.getHeaderProps();return(0,e.jsx)("div",{...vt,role:"columnheader",className:V.cell,children:be.render("Header",{isSelected:l,onAllSelectionChange:h})},Se)})},k)}),(0,e.jsx)("div",{...ae(),"data-testid":de.Tp.pages.BrowseDashboards.table.body,children:(0,e.jsx)(De.A,{ref:B,itemCount:s.length,isItemLoaded:G,loadMoreItems:Z,children:({onItemsRendered:z,ref:k})=>(0,e.jsx)(se._m,{ref:oe=>{k(oe),$.current=oe},height:g-Le,width:o,itemCount:s.length,itemData:ce,estimatedItemSize:ye,itemSize:he,onItemsRendered:z,children:et})})})]})}function et({index:s,style:o,data:g}){const l=(0,v.of)(Re),{table:n,isSelected:h,onItemSelectionChange:x,treeID:S}=g,{rows:M,prepareRow:P}=n,w=M[s];P(w);const B=w.original.item,{key:$,...V}=w.getRowProps({style:o});return B.kind==="ui"&&B.uiKind==="divider"?(0,e.jsx)("div",{...V,children:(0,e.jsx)("hr",{className:l.divider})},$):(0,e.jsx)("div",{...V,className:(0,u.cx)(l.row,l.bodyRow),"aria-labelledby":(0,Ce.e)(S,B),"data-testid":de.Tp.pages.BrowseDashboards.table.row("title"in B?B.title:B.uid),children:w.cells.map(_=>{const{key:W,...Y}=_.getCellProps();return(0,e.jsx)("div",{...Y,className:l.cell,children:_.render("Cell",{isSelected:h,onItemSelectionChange:x,treeID:S})},W)})},$)}const Re=s=>({row:(0,u.css)({gap:s.spacing(1)}),divider:(0,u.css)({borderTop:`1px solid ${s.colors.border.weak}`,width:"100%",margin:0}),headerRow:(0,u.css)({backgroundColor:s.colors.background.secondary,height:Le}),bodyRow:(0,u.css)({height:ye,"&:hover":{backgroundColor:s.colors.emphasize(s.colors.background.primary,.03)}}),cell:(0,u.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,u.css)({"&:hover":{textDecoration:"underline"}})});function tt({folderUID:s,width:o,height:g,canSelect:l}){const n=(0,j.eC)(s),h=(0,p.useDispatch)(),x=(0,j.q0)(s),S=(0,j.Ms)(),M=(0,j.V6)(),P=(0,r.useCallback)((_,W)=>{h((0,j.wn)({folderUID:_,isOpen:W})),W&&h((0,j.Ii)({parentUID:_,pageSize:ve.md}))},[h]),w=(0,r.useCallback)((_,W)=>{h((0,j.t$)({item:_,isSelected:W}))},[h]),B=(0,r.useCallback)(_=>{if(_==="$all"){if(S.$all)return N.Selected;for(const ae of Object.values(S))if(typeof ae!="boolean"){for(const le in ae)if(ae[le])return N.Mixed}return N.Unselected}return S[_.kind][_.uid]?N.Selected:Be(_,M,S)?N.Mixed:N.Unselected},[S,M]),$=(0,r.useCallback)(_=>{const W=x[_];if(!W)return!1;const Y=W.item;return!(Y.kind==="ui"&&Y.uiKind==="pagination-placeholder")},[x]),V=(0,j.Zg)();return n==="fulfilled"&&x.length===0?(0,e.jsx)("div",{style:{width:o},children:l?(0,e.jsx)(ge.p,{variant:"call-to-action",button:(0,e.jsx)(f.z9,{href:s?`dashboard/new?folderUid=${s}`:"dashboard/new",icon:"plus",size:"lg",children:(0,e.jsx)(i.x6,{i18nKey:"browse-dashboards.empty-state.button-title",children:"Create dashboard"})}),message:s?(0,i.t)("browse-dashboards.empty-state.title-folder","This folder doesn't have any dashboards yet"):(0,i.t)("browse-dashboards.empty-state.title","You haven't created any dashboards yet"),children:s&&(0,e.jsxs)(i.x6,{i18nKey:"browse-dashboards.empty-state.pro-tip",children:["Add/move dashboards to your folder at"," ",(0,e.jsx)(me.Y,{external:!1,href:"/dashboards",children:"Browse dashboards"})]})}):(0,e.jsx)(fe.c,{callToActionElement:(0,e.jsx)("span",{children:"This folder is empty"})})}):(0,e.jsx)(qe,{canSelect:l,items:x,width:o,height:g,isSelected:B,onFolderClick:P,onAllSelectionChange:_=>h((0,j.cT)({isSelected:_,folderUID:s})),onItemSelectionChange:w,isItemLoaded:$,requestLoadMore:V})}function Be(s,o,g){const l=o[s.uid];return l?l.items.some(n=>{const h=g[n.kind][n.uid];return h||Be(n,o,g)}):!1}var st=t(38138),pe=t(64539),at=t(83122),ot=t(87978),nt=t(49785),rt=t(88575),lt=t(10354),dt=t(71500);const Ke={folderName:""};function it({onCancel:s,onConfirm:o}){const{handleSubmit:g,register:l,formState:{errors:n}}=(0,nt.mN)({defaultValues:Ke}),h=(0,i.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),x=async M=>{try{return await dt.P.validateNewFolderName(M),!0}catch(P){if(P instanceof Error)return P.message;throw P}},S=(0,i.t)("browse-dashboards.new-folder-form.name-label","Folder name");return(0,e.jsxs)("form",{name:"addFolder",onSubmit:g(M=>o(M.folderName)),"data-testid":de.Tp.pages.BrowseDashboards.NewFolderForm.form,children:[(0,e.jsx)(rt.D,{label:S,invalid:!!n.folderName,error:n.folderName&&n.folderName.message,children:(0,e.jsx)(lt.p,{"data-testid":de.Tp.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",defaultValue:Ke.folderName,...l("folderName",{required:h,validate:async M=>await x(M)})})}),(0,e.jsxs)(K.B,{children:[(0,e.jsx)(f.$n,{variant:"secondary",fill:"outline",onClick:s,children:(0,e.jsx)(i.x6,{i18nKey:"browse-dashboards.new-folder-form.cancel-label",children:"Cancel"})}),(0,e.jsx)(f.$n,{type:"submit",children:(0,e.jsx)(i.x6,{i18nKey:"browse-dashboards.new-folder-form.create-label",children:"Create"})})]})]})}function ct({parentFolder:s,canCreateDashboard:o,canCreateFolder:g}){const[l,n]=(0,r.useState)(!1),h=(0,b.zy)(),[x]=(0,a.Vc)(),[S,M]=(0,r.useState)(!1),P=async B=>{try{await x({title:B,parentUid:s?.uid});const $=s?.parents?s.parents.length+1:0;(0,d.rR)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:$})}finally{M(!1)}},w=(0,e.jsxs)(st.W,{children:[o&&(0,e.jsx)(pe.D,{label:A(),onClick:()=>(0,d.rR)("grafana_menu_item_clicked",{url:ie("/dashboard/new",s?.uid),from:h.pathname}),url:ie("/dashboard/new",s?.uid)}),g&&(0,e.jsx)(pe.D,{onClick:()=>M(!0),label:T()}),o&&(0,e.jsx)(pe.D,{label:c(),onClick:()=>(0,d.rR)("grafana_menu_item_clicked",{url:ie("/dashboard/import",s?.uid),from:h.pathname}),url:ie("/dashboard/import",s?.uid)})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(at.m,{overlay:w,onVisibleChange:n,children:(0,e.jsxs)(f.$n,{children:[I(),(0,e.jsx)(Te.I,{name:l?"angle-up":"angle-down"})]})}),S&&(0,e.jsx)(ot._,{title:T(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>M(!1),size:"sm",children:(0,e.jsx)(it,{onConfirm:P,onCancel:()=>M(!1)})})]})}function ie(s,o){const g=o?s+"?folderUid="+o:s;return m.$.appSubUrl?m.$.appSubUrl+g:g}var ht=t(9134),ut=t(2960),gt=t(49904);const Ue=(0,r.memo)(({match:s})=>{const{uid:o}=s.params,g=(0,p.useDispatch)(),l=(0,v.of)(mt),[n,h]=(0,E.ET)(),x=h.hasSearchFilters(),S=(0,b.zy)(),M=(0,r.useMemo)(()=>new URLSearchParams(S.search),[S.search]);(0,r.useEffect)(()=>{h.initStateFromUrl(o),g((0,j.cT)({isSelected:!1,folderUID:void 0}))},[g,o,h]),(0,r.useEffect)(()=>{h.onSetStarred(M.has("starred"))},[M,h]),(0,r.useEffect)(()=>{!x&&n.result&&h.setState({result:void 0,includePanels:void 0})},[x,n.result,h]);const{data:P}=(0,a.kH)(o??a.hT),[w]=(0,a.iB)(),B=(0,r.useMemo)(()=>{if(!P)return;const G=(0,D.R4)(P),Z=(0,D.Cg)(P.uid),he=G.children?.find(z=>z.id===Z);return he&&(he.active=!0),G},[P]),$=(0,j.QE)(),{canEditFolders:V,canEditDashboards:_,canCreateDashboards:W,canCreateFolders:Y}=(0,gt.N)(P),ae=V&&o,le=V||_,ce=async G=>{if(P){const Z=await w({...P,title:G});if("error"in Z)throw(0,d.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error",error:Z.error}),Z.error;(0,d.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,d.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})};return(0,e.jsx)(C.Y,{navId:"dashboards/browse",pageNav:B,onEditTitle:ae?ce:void 0,actions:(0,e.jsxs)(e.Fragment,{children:[P&&(0,e.jsx)(ht.m,{folder:P}),(W||Y)&&(0,e.jsx)(ct,{parentFolder:P,canCreateDashboard:W,canCreateFolder:Y})]}),children:(0,e.jsxs)(C.Y.Contents,{className:l.pageContents,children:[(0,e.jsx)("div",{children:(0,e.jsx)(y.Z,{placeholder:O(n.includePanels),value:n.query,escapeRegex:!1,onChange:G=>h.onQueryChange(G)})}),$?(0,e.jsx)(q,{}):(0,e.jsx)("div",{className:l.filters,children:(0,e.jsx)(ue,{})}),(0,e.jsx)("div",{className:l.subView,children:(0,e.jsx)(L.Ay,{children:({width:G,height:Z})=>x?(0,e.jsx)(ut.Q,{canSelect:le,width:G,height:Z,searchState:n,searchStateManager:h}):(0,e.jsx)(tt,{canSelect:le,width:G,height:Z,folderUID:o})})})]})})}),mt=s=>({pageContents:(0,u.css)({display:"flex",flexDirection:"column",gap:s.spacing(1),height:"100%"}),subView:(0,u.css)({height:"100%"}),filters:(0,u.css)({display:"none",[s.breakpoints.up("md")]:{display:"block"}})});Ue.displayName="BrowseDashboardsPage";const ft=Ue},18241:(ne,F,t)=>{t.d(F,{T:()=>D});var e=t(74848),u=t(96540),r=t(32264),b=t(96374),L=t(94753),d=t(68402),v=t(42418),y=t(8484),C=t(55314),p=t(43907);const D=({onConfirm:E,onDismiss:i,selectedItems:O,...A})=>{const{data:T}=(0,C.G2)(O),c=!!(T&&(T.alertRule||T.libraryPanel)),[I,a]=(0,u.useState)(!1),m=async()=>{a(!0);try{await E(),a(!1),i()}catch{a(!1)}};return(0,e.jsx)(b.u,{body:(0,e.jsxs)(e.Fragment,{children:[r.$.featureToggles.dashboardRestore&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(L.E,{element:"p",children:(0,e.jsx)(y.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(d.$,{v:2})]}),(0,e.jsx)(L.E,{element:"p",children:(0,e.jsx)(y.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(p.x,{selectedItems:O}),(0,e.jsx)(d.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:c?(0,e.jsx)(v.F,{severity:"warning",title:(0,y.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(y.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,y.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:I?(0,y.t)("browse-dashboards.action.deleting","Deleting..."):(0,y.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:i,onConfirm:m,title:(0,y.t)("browse-dashboards.action.delete-modal-title","Delete"),...A,disabled:c})}},51887:(ne,F,t)=>{t.d(F,{J:()=>E});var e=t(74848),u=t(96540),r=t(37390),b=t(42418),L=t(94753),d=t(68402),v=t(88575),y=t(55852),C=t(36607),p=t(8484),D=t(43907);const E=({onConfirm:i,onDismiss:O,selectedItems:A,...T})=>{const[c,I]=(0,u.useState)(),[a,m]=(0,u.useState)(!1),f=Object.keys(A.folder).filter(U=>A.folder[U]),K=async()=>{if(c!==void 0){m(!0);try{await i(c),m(!1),O()}catch{m(!1)}}};return(0,e.jsxs)(r.a,{title:(0,p.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:O,...T,children:[f.length>0&&(0,e.jsx)(b.F,{severity:"info",title:(0,p.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(L.E,{element:"p",children:(0,e.jsx)(p.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(D.x,{selectedItems:A}),(0,e.jsx)(d.$,{v:3}),(0,e.jsx)(v.D,{label:(0,p.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(C.d,{value:c,excludeUIDs:f,onChange:I})}),(0,e.jsxs)(r.a.ButtonRow,{children:[(0,e.jsx)(y.$n,{onClick:O,variant:"secondary",fill:"outline",children:(0,e.jsx)(p.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(y.$n,{disabled:c===void 0||a,onClick:K,variant:"primary",children:a?(0,p.t)("browse-dashboards.action.moving","Moving..."):(0,p.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(ne,F,t)=>{t.d(F,{m:()=>m});var e=t(74848),u=t(96540),r=t(32264),b=t(14110),L=t(12131),d=t(38138),v=t(64539),y=t(83122),C=t(55852),p=t(14578),D=t(87978),E=t(5108),i=t(10096),O=t(8484),A=t(28444),T=t(55314),c=t(49904),I=t(18241),a=t(51887);function m({folder:f}){const[K,U]=(0,u.useState)(!1),[Q,J]=(0,u.useState)(!1),[j]=(0,T.aF)(),[X]=(0,T.Ko)(),{canEditFolders:re,canDeleteFolders:q,canViewPermissions:ee,canSetPermissions:R}=(0,c.N)(f),H=r.$.featureToggles.nestedFolders&&re,te=async se=>{await j({folder:f,destinationUID:se}),(0,b.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},ue=async()=>{await X(f),(0,b.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:se}=f,De=se&&se.length?se[se.length-1].url:"/dashboards";L.Ny.push(De)},ge=()=>{i.lE.publish(new A.S8({component:a.J,props:{selectedItems:{folder:{[f.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:te}}))},me=()=>{i.lE.publish(new A.S8({component:I.T,props:{selectedItems:{folder:{[f.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:ue}}))},fe=(0,O.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),ve=(0,O.t)("browse-dashboards.folder-actions-button.move","Move"),N=(0,O.t)("browse-dashboards.folder-actions-button.delete","Delete"),Ee=(0,e.jsxs)(d.W,{children:[ee&&(0,e.jsx)(v.D,{onClick:()=>J(!0),label:fe}),H&&(0,e.jsx)(v.D,{onClick:ge,label:ve}),q&&(0,e.jsx)(v.D,{destructive:!0,onClick:me,label:N})]});return!ee&&!H&&!q?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.m,{overlay:Ee,onVisibleChange:U,children:(0,e.jsxs)(C.$n,{variant:"secondary",children:[(0,e.jsx)(O.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(p.I,{name:K?"angle-up":"angle-down"})]})}),Q&&(0,e.jsx)(D._,{title:(0,O.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:f.title,onClose:()=>J(!1),size:"md",children:(0,e.jsx)(E.x,{resource:"folders",resourceId:f.uid,canSetPermissions:R})})]})}},2960:(ne,F,t)=>{t.d(F,{Q:()=>O});var e=t(74848),u=t(96540),r=t(78368),b=t(14236),L=t(69529),d=t(55852),v=t(8484),y=t(97427),C=t(66359),p=t(31678),D=t(37690);const E=25,i={view:new r.R((0,b.Vc)({fields:[{name:"uid",display:!0,values:Array(E).fill(null)},{name:"kind",display:!0,values:Array(E).fill("dashboard")},{name:"name",display:!0,values:Array(E).fill("")},{name:"location",display:!0,values:Array(E).fill("")},{name:"tags",display:!0,values:Array(E).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:E};function O({width:T,height:c,canSelect:I,searchState:a,searchStateManager:m,emptyState:f}){const K=(0,p.useDispatch)(),U=(0,p.useSelector)(R=>R.browseDashboards.selectedItems),Q=(0,D.QE)(),{keyboardEvents:J}=(0,y.d)(),j=a.result??i,X=(0,u.useCallback)((R,H)=>R?R==="*"&&H==="*"?Q:R==="*"?!1:U[A(R)][H]??!1:!1,[U,Q]),re=(0,u.useCallback)(()=>{K((0,D.cT)({isSelected:!1,folderUID:void 0}))},[K]),q=(0,u.useCallback)((R,H)=>{const te=!X(R,H);K((0,D.t$)({item:{kind:A(R),uid:H},isSelected:te}))},[X,K]);if(j.totalRows===0){const R=f??(0,e.jsx)(L.p,{button:(0,e.jsx)(d.$n,{variant:"secondary",onClick:m.onClearSearchAndFilters,children:(0,e.jsx)(v.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,v.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,e.jsx)("div",{style:{width:T},children:R})}const ee={response:j,selection:I?X:void 0,selectionToggle:I?q:void 0,clearSelection:re,width:T,height:c,onTagSelected:m.onAddTag,keyboardEvents:J,onDatasourceChange:a.datasource?m.onDatasourceChange:void 0,onClickItem:m.onSearchItemClicked};return(0,e.jsx)(C.P,{...ee})}function A(T){switch(T){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+T)}},49904:(ne,F,t)=>{t.d(F,{N:()=>L});var e=t(32264),u=t(10096),r=t(31678);function b(d,v){return v?u.TP.hasPermissionInMetadata(d,v):u.TP.hasPermission(d)}function L(d){const v=b(r.AccessControlAction.DashboardsCreate,d),y=!!((!d||e.$.featureToggles.nestedFolders)&&b(r.AccessControlAction.FoldersCreate)),C=b(r.AccessControlAction.FoldersDelete,d),p=b(r.AccessControlAction.DashboardsWrite,d),D=b(r.AccessControlAction.FoldersWrite,d),E=b(r.AccessControlAction.FoldersPermissionsWrite,d),i=b(r.AccessControlAction.FoldersPermissionsRead,d);return{canCreateDashboards:v,canCreateFolders:y,canDeleteFolders:C,canEditDashboards:p,canEditFolders:D,canSetPermissions:E,canViewPermissions:i}}},19519:(ne,F,t)=>{t.d(F,{bj:()=>A});var e=t(74848),u=t(32196),r=t(32264),b=t(40845),L=t(67061),d=t(10880),v=t(55852),y=t(94354),C=t(73725),p=t(99818),D=t(8484),E=t(64161);function i(){return[{value:E.P.Folders,icon:"folder",description:(0,D.t)("search.actions.view-as-folders","View by folders")},{value:E.P.List,icon:"list-ul",description:(0,D.t)("search.actions.view-as-list","View as list")}]}function O(c){const I=c.layout??E.P.Folders;return I===E.P.Folders&&(c.query||c.sort||c.starred||c.tag.length>0)?E.P.List:I}const A=({state:c,showStarredFilter:I,showLayout:a,sortPlaceholder:m,onLayoutChange:f,onSortChange:K,onStarredFilterChange:U=()=>{},onTagFilterChange:Q,getTagOptions:J,getSortOptions:j,onDatasourceChange:X,onPanelTypeChange:re,onSetIncludePanels:q})=>{const ee=(0,b.of)(T),R=O(c),H=c.tag.length||c.starred||c.query||c.datasource||c.panel_type?[E.P.Folders]:[];return(0,e.jsxs)(L.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(L.B,{gap:2,alignItems:"center",children:[(0,e.jsx)(p.$,{isClearable:!1,tags:c.tag,tagOptions:J,onChange:Q}),r.$.featureToggles.panelTitleSearch&&(0,e.jsx)(d.S,{"data-testid":"include-panels",disabled:R===E.P.Folders,value:c.includePanels,onChange:()=>q(!c.includePanels),label:(0,D.t)("search.actions.include-panels","Include panels")}),I&&(0,e.jsx)("div",{className:ee.checkboxWrapper,children:(0,e.jsx)(d.S,{label:(0,D.t)("search.actions.starred","Starred"),onChange:U,value:c.starred})}),c.datasource&&(0,e.jsx)(v.$n,{icon:"times",variant:"secondary",onClick:()=>X(void 0),children:(0,e.jsxs)(D.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:c.datasource}]})}),c.panel_type&&(0,e.jsxs)(v.$n,{icon:"times",variant:"secondary",onClick:()=>re(void 0),children:["Panel: ",c.panel_type]})]}),(0,e.jsxs)(L.B,{gap:2,children:[a&&(0,e.jsx)(y.z,{options:i(),disabledOptions:H,onChange:f,value:R}),(0,e.jsx)(C.r,{onChange:te=>K(te?.value),value:c.sort,getSortOptions:j,placeholder:m||(0,D.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};A.displayName="ActionRow";const T=c=>({checkboxWrapper:(0,u.css)({label:{lineHeight:"1.2"}})})},39788:(ne,F,t)=>{t.d(F,{ET:()=>c,lC:()=>O,ue:()=>D});var e=t(2543),u=t.n(e),r=t(12131),b=t(2619),L=t(33390),d=t(53477),v=t(6204),y=t(24439),C=t(64161),p=t(16757);const D={query:"",tag:[],starred:!1,layout:C.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},E={sort:null,starred:null,query:null,tag:null,layout:null},i=()=>localStorage.getItem(d.YU)===C.P.List?C.P.List:C.P.Folders;class O extends b.Q{constructor(){super(...arguments),this.updateLocation=(0,e.debounce)(a=>r.Ny.partial(a,!0),300),this.doSearchWithDebounce=(0,e.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...E})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(m=>m!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const m=a.currentTarget.checked;this.setStateAndDoSearch({starred:m})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=a=>{a!==this.state.starred&&this.setStateAndDoSearch({starred:a})},this.onSortChange=a=>{a?localStorage.setItem(d.w7,a):localStorage.removeItem(d.w7),this.state.layout===C.P.Folders?this.setStateAndDoSearch({sort:a,layout:C.P.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(d.YU,a),this.state.sort&&a===C.P.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),L.A.set(d.d7,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,y.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,v.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,v.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(a,m=!0){const f=(0,p.N1)(r.Ny.getSearchObject());(f.query||f.datasource||f.panel_type)&&(f.layout=C.P.List);const K=i(),U=localStorage.getItem(d.w7)??void 0,Q=K===C.P.List?f.sort||U:null;this.setState({...D,...f,layout:K,sort:Q??D.sort,prevSort:U,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),m&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(a){const m=a.sort||this.state.sort||localStorage.getItem(d.w7)||void 0;this.setState({sort:m,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===C.P.List)}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,v.J$)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const m=(0,y.getGrafanaSearcher)(),f=Date.now();(this.state.starred?m.starred(this.lastQuery):m.search(this.lastQuery)).then(U=>{f>this.lastSearchTimestamp&&(this.setState({result:U,loading:!1}),this.lastSearchTimestamp=f)}).catch(U=>{(0,v.KZ)(this.state.eventTrackingNamespace,{...a,error:U?.message}),this.setState({loading:!1})})}}let A;function T(){if(!A){const a=localStorage.getItem(d.YU)??D.layout;let m=L.A.getBool(d.d7,!0);m&&(m=!1),A=new O({...D,layout:a,includePanels:m})}return A}function c(){const I=T();return[I.useState(),I]}}}]);

//# sourceMappingURL=DashboardListPage.7e92d2810841edcba9e2.js.map