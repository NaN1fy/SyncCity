"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9856],{69546:(oe,p,n)=>{n.d(p,{b:()=>X});var e=n(74848),c=n(96540),D=n(13544),b=n(12942),Q=n(94753),B=n(90613),u=n(56034),$=n(14578),z=n(78369),y=n(55852),M=n(67061),F=n(48840),N=n(19384),G=n(96374),Y=n(89062),H=n(85927),J=n(46334),v=n(10096),O=n(31678),ne=n(5133);const Z=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,S=m=>{const h=m?.isExternallySynced;return!v.TP.hasPermissionInMetadata(O.AccessControlAction.OrgUsersWrite,m)||h},V=D.Tp.pages.UserListPage.UsersListPage,X=({users:m,orgId:h,onRoleChange:x,onRemoveUser:W,fetchData:_,changePage:E,page:w,totalPages:i,rolesLoading:l})=>{const[f,R]=(0,c.useState)(null),[K,k]=(0,c.useState)([]);(0,c.useEffect)(()=>{async function r(){try{if(v.TP.hasPermission(O.AccessControlAction.ActionRolesList)){let o=await(0,H.RL)(h);k(o)}}catch{console.error("Error loading options")}}v.TP.licensedAccessControlEnabled()&&r()},[h]);const q=(0,c.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:r}})=>r&&(0,e.jsx)(b.e,{src:r,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:r}})=>(0,e.jsx)("div",{children:r}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:r&&(0,e.jsx)(e.Fragment,{children:r==="10 years"?(0,e.jsx)(Q.E,{color:"disabled",children:"Never"}):r})}),sortType:(r,o)=>new Date(r.original.lastSeenAt).getTime()-new Date(o.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:r},row:{original:o}})=>{const U=S(o);return v.TP.licensedAccessControlEnabled()?(0,e.jsx)(Y.y,{userId:o.userId,roles:o.roles||[],isLoading:l,orgId:h,roleOptions:K,basicRole:r,onBasicRoleChange:C=>x(C,o),basicRoleDisabled:U,basicRoleDisabledMessage:Z,width:40}):(0,e.jsx)(ne.r,{"aria-label":"Role",value:r,disabled:U,onChange:C=>x(C,o)})}},{id:"info",header:"",cell:({row:{original:r}})=>S(r)&&(0,e.jsx)(B.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,e.jsx)(u.m,{interactive:!0,content:(0,e.jsxs)("div",{children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]}),children:(0,e.jsx)($.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(r)&&r.length>0&&(0,e.jsx)(J.E,{label:r[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:r&&(0,e.jsx)(z.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:r}})=>v.TP.hasPermissionInMetadata(O.AccessControlAction.OrgUsersRemove,r)&&(0,e.jsx)(y.$n,{size:"sm",variant:"destructive",onClick:()=>{R(r)},icon:"times","aria-label":`Delete user ${r.name}`})}],[l,h,K,x]);return(0,e.jsxs)(M.B,{direction:"column",gap:2,"data-testid":V.container,children:[(0,e.jsx)(F.j,{columns:q,data:m,getRowId:r=>String(r.userId),fetchData:_}),(0,e.jsx)(M.B,{justifyContent:"flex-end",children:(0,e.jsx)(N.d,{onNavigate:E,currentPage:w,numberOfPages:i,hideWhenSinglePage:!0})}),!!f&&(0,e.jsx)(G.u,{body:`Are you sure you want to delete user ${f?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{R(null)},isOpen:!0,onConfirm:()=>{f&&(W(f),R(null))}})]})}},31083:(oe,p,n)=>{n.r(p),n.d(p,{UsersListPageContent:()=>te,UsersListPageUnconnected:()=>re,default:()=>he});var e=n(74848),c=n(96540),D=n(71468),b=n(36663),Q=n(42418),B=n(69444),u=n(10096),$=n(69546),z=n(10534),y=n(55852),M=n(47259);const F={revokeInvite:M.eb},N=(0,D.connect)(null,F);class G extends c.PureComponent{render(){const{invitee:t,revokeInvite:a}=this.props;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.email}),(0,e.jsx)("td",{children:t.name}),(0,e.jsxs)("td",{className:"text-right",children:[(0,e.jsx)(z.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>t.url,children:"Copy Invite"}),"\xA0"]}),(0,e.jsx)("td",{children:(0,e.jsx)(y.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>a(t.code),"aria-label":"Revoke Invite"})})]})}}const Y=N(G);class H extends c.PureComponent{render(){const{invitees:t}=this.props;return(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Email"}),(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{style:{width:"34px"}})]})}),(0,e.jsx)("tbody",{"data-testid":"InviteesTable-body",children:t.map((a,d)=>(0,e.jsx)(Y,{invitee:a},`${a.id}-${d}`))})]})}}var J=n(25508),v=n(40823);const{selectAll:O,selectById:ne,selectTotal:Z}=v.Tp,S=(s,t)=>t,V=(0,J.Mz)([O,S],(s,t)=>{const a=new RegExp(t,"i");return s.filter(g=>a.test(g.name)||a.test(g.email))});var X=n(14186),m=n(67647),h=n(94354),x=n(2913),W=n(31678),_=n(2543),E=n(17172),w=n(80714),i=n(87617);function l(){return async(s,t)=>{try{s((0,i.Cj)());const{perPage:a,page:d,searchQuery:g,sort:I}=t().users,P=await(0,E.AI)().get("/api/org/users/search",(0,w.F)({perpage:a,page:d,query:g,sort:I}));if(u.TP.licensedAccessControlEnabled()&&u.TP.hasPermission(W.AccessControlAction.ActionUserRolesList)){s((0,i.dJ)());const A=u.TP.user.orgId,L=P?.orgUsers.map(j=>j.userId),T=await(0,E.AI)().post("/api/access-control/users/roles/search",{userIds:L,orgId:A});P.orgUsers.forEach(j=>{j.roles=T?T[j.userId]||[]:[]}),s((0,i.jE)())}s((0,i.Y_)(P))}catch{(0,i.g4)()}}}const f=(0,_.debounce)(s=>s(l()),300);function R(s){return async t=>{await(0,E.AI)().patch(`/api/org/users/${s.userId}`,{role:s.role}),t(l())}}function K(s){return async t=>{await(0,E.AI)().delete(`/api/org/users/${s}`),t(l())}}function k(s){return async t=>{t((0,i.EC)(s)),t(l())}}function q({sortBy:s}){const t=s.length?`${s[0].id}-${s[0].desc?"desc":"asc"}`:void 0;return async a=>{a((0,i.$u)(t)),a(l())}}function r(s){return async t=>{t((0,i.t_)(s)),f(t)}}const o=s=>{const t=new RegExp(s.searchQuery,"i");return s.users.filter(a=>t.test(a.login)||t.test(a.email)||t.test(a.name))},U=s=>s.searchQuery;function C(s){return{searchQuery:U(s.users),pendingInvitesCount:Z(s.invites),externalUserMngLinkName:s.users.externalUserMngLinkName,externalUserMngLinkUrl:s.users.externalUserMngLinkUrl}}const ie={changeSearchQuery:r},ce=(0,D.connect)(C,ie)(({externalUserMngLinkName:s,externalUserMngLinkUrl:t,searchQuery:a,pendingInvitesCount:d,changeSearchQuery:g,onShowInvites:I,showInvites:P})=>{const A=[{label:"Users",value:"users"},{label:`Pending Invites (${d})`,value:"invites"}],T=u.TP.hasPermission(W.AccessControlAction.OrgUsersAdd)&&!(x.Ay.disableLoginForm&&x.Ay.externalUserMngInfo);return(0,e.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,e.jsx)(X.I,{grow:!0,children:(0,e.jsx)(m.Z,{value:a,onChange:g,placeholder:"Search user by login, email or name"})}),d>0&&(0,e.jsx)("div",{style:{marginLeft:"1rem"},children:(0,e.jsx)(h.z,{value:P?"invites":"users",options:A,onChange:I})}),T&&(0,e.jsx)(y.z9,{href:"org/users/invite",children:"Invite"}),t&&(0,e.jsx)(y.z9,{href:t,target:"_blank",rel:"noopener",children:s})]})});function le(s){const t=U(s.users);return{users:o(s.users),searchQuery:U(s.users),page:s.users.page,totalPages:s.users.totalPages,perPage:s.users.perPage,invitees:V(s.invites,t),externalUserMngInfo:s.users.externalUserMngInfo,isLoading:s.users.isLoading,rolesLoading:s.users.rolesLoading}}const de={loadUsers:l,fetchInvitees:M.G7,changePage:k,changeSort:q,updateUser:R,removeUser:K},ge=(0,D.connect)(le,de),re=({users:s,page:t,totalPages:a,invitees:d,externalUserMngInfo:g,isLoading:I,rolesLoading:P,loadUsers:A,fetchInvitees:L,changePage:T,updateUser:j,removeUser:ue,changeSort:ve})=>{const[ee,Pe]=(0,c.useState)(!1),ae=g?(0,b.G)(g):"";(0,c.useEffect)(()=>{A(),L()},[L,A]);const me=(se,Ue)=>{j({...Ue,role:se})},xe=se=>ue(se.userId),Ee=()=>{Pe(!ee)},fe=()=>ee?(0,e.jsx)(H,{invitees:d}):(0,e.jsx)($.b,{users:s,orgId:u.TP.user.orgId,rolesLoading:P,onRoleChange:me,onRemoveUser:xe,fetchData:ve,changePage:T,page:t,totalPages:a});return(0,e.jsxs)(B.Y.Contents,{isLoading:!I,children:[(0,e.jsx)(ce,{onShowInvites:Ee,showInvites:ee}),ae&&(0,e.jsx)(Q.F,{severity:"info",title:"",children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:ae}})}),I&&fe()]})},te=ge(re);function he(){return(0,e.jsx)(B.Y,{navId:"users",children:(0,e.jsx)(te,{})})}}}]);

//# sourceMappingURL=UsersListPage.b4bbb02516eb4f1dd26b.js.map