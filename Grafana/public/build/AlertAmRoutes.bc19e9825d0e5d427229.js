"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6719],{40715:(k,D,e)=>{e.d(D,{o:()=>A});var t=e(96540),i=e(31678),o=e(97007);function A(v){const E=(0,i.useDispatch)(),C=(0,t.useRef)(v);C.current=v,(0,t.useEffect)(()=>()=>{E((0,o.N)({cleanupAction:C.current}))},[E])}},34708:(k,D,e)=>{e.r(D),e.d(D,{default:()=>es,findRoutesMatchingFilters:()=>Xe});var t=e(74848),i=e(32196),o=e(96540),A=e(41053),v=e(40845),E=e(63021),C=e(40675),L=e(40980),V=e(39558),S=e(42418),u=e(67061),c=e(66602),l=e(83277),j=e(31678),I=e(40715),R=e(82843),d=e(55740),p=e(49962),P=e(68788);const T=p.Hr.injectEndpoints({endpoints:n=>({contactPointsState:n.query({queryFn:async({amSourceName:s})=>{try{return{data:await(0,P.pB)(s)}}catch(a){return{error:a}}}})})}),W=n=>{const s={receivers:{},errorCount:0},{currentData:a}=T.useContactPointsStateQuery({amSourceName:n??""},{skip:!n,pollingInterval:d.cB});return a??s};var $=e(37959),X=e(57895),nt=e(42941),O=e(55852),h=e(96374),U=e(38138),Y=e(39938),q=e(50720),st=e(29158),tt=e(64756),y=e(64853),F=e(19073),et=e(51488),pt=e(23770),it=e(57220),N=e(56361),vt=e(54486),Fe=e(75591),ie=e(23088);const le=({buttonIcon:n,buttonLabel:s,buttonSize:a="lg",buttonVariant:r="primary",onButtonClick:m,text:x,href:f,showButton:g=!0})=>{const b=(0,v.of)(ce),G={className:b.button,icon:n,size:a,variant:r};return(0,t.jsx)(ie.Z,{children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:b.text,children:x}),g&&(f?(0,t.jsx)(O.z9,{href:f,type:"button",...G,children:s}):(0,t.jsx)(O.$n,{onClick:m,type:"button",...G,children:s}))]})})},ce=n=>({container:(0,i.css)({backgroundColor:n.colors.background.secondary,color:n.colors.text.secondary,padding:n.spacing(4),textAlign:"center"}),text:(0,i.css)({marginBottom:n.spacing(2)}),button:(0,i.css)({margin:n.spacing(2,0,1)})});var de=e(48205),Qt=e(26058),Wt=e(79938),Lt=e(16293),jt=e(76648),xt=e(84029);const ue=({exportFormat:n,onClose:s})=>{const{currentData:a="",isFetching:r}=Wt.hK.useExportMuteTimingsQuery({format:n}),m=`mute-timings-${new Date().getTime()}`;return r?(0,t.jsx)(V._,{text:"Loading...."}):(0,t.jsx)(Lt.J,{format:n,textDefinition:a,downloadFileName:m,onClose:s})},me=({exportFormat:n,onClose:s,muteTimingName:a})=>{const{currentData:r="",isFetching:m}=Wt.hK.useExportMuteTimingQuery({format:n,muteTiming:a}),x=`mute-timing-${a}-${new Date().getTime()}`;return m?(0,t.jsx)(V._,{text:"Loading...."}):(0,t.jsx)(Lt.J,{format:n,textDefinition:r,downloadFileName:x,onClose:s})},Ue=({onClose:n,muteTimingName:s})=>{const[a,r]=(0,o.useState)("yaml");return(0,t.jsx)(jt.m,{activeTab:a,onTabChange:r,onClose:n,formatProviders:Object.values(xt.sl),children:s?(0,t.jsx)(me,{exportFormat:a,onClose:n,muteTimingName:s}):(0,t.jsx)(ue,{exportFormat:a,onClose:n})})};var Jt=e(4724);const Ge=Symbol("all mute timings"),_e=()=>{const[n,s]=(0,o.useState)(null),[a,r]=(0,nt.A)(!1),m=(0,o.useCallback)(()=>{s(null),r(!1)},[r]),x=g=>{s(g),r(!0)};return[(0,o.useMemo)(()=>!n||!a?null:n===Ge?(0,t.jsx)(Ue,{onClose:m}):(0,t.jsx)(Ue,{muteTimingName:n,onClose:m}),[a,m,n]),x]},ke=({alertManagerSourceName:n,muteTimingNames:s,hideActions:a})=>{const r=(0,v.of)(pe),m=(0,tt.wA)(),{currentData:x}=(0,et.f)(n,{refetchOnFocus:!0,refetchOnReconnect:!0}),f=x?.alertmanager_config,[g,b]=(0,o.useState)(""),G=(0,o.useMemo)(()=>{const Q=f?(0,Jt.IT)(f):[],ct=f?.muteTimeProvenances??{};return Q.filter(({name:Z})=>s?s.includes(Z):!0).map(Z=>({id:Z.name,data:{...Z,provenance:ct[Z.name]}}))},[s,f]),[K,w]=(0,F.L7)(F.QI.CreateMuteTiming),[H,B]=_e(),[M,J]=(0,F.L7)(F.QI.ExportMuteTimings),z=qe(n,a,b,B);return(0,t.jsxs)("div",{className:r.container,children:[(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",children:[(0,t.jsx)("span",{children:"Enter specific time intervals when not to send notifications or freeze notifications for recurring periods of time."}),(0,t.jsx)(Qt.h,{}),!a&&G.length>0&&(0,t.jsx)(y._,{actions:[F.QI.CreateMuteTiming],children:(0,t.jsx)(O.z9,{className:r.muteTimingsButtons,icon:"plus",variant:"primary",href:(0,N.nL)("alerting/routes/mute-timing/new",n),children:"Add mute timing"})}),M&&(0,t.jsx)(O.$n,{icon:"download-alt",className:r.muteTimingsButtons,variant:"secondary","aria-label":"export all",disabled:!J,onClick:()=>B(Ge),children:"Export all"})]}),G.length>0?(0,t.jsx)(Fe.E,{items:G,cols:z,pagination:{itemsPerPage:25}}):a?(0,t.jsx)(le,{text:"No mute timings configured",buttonLabel:"",showButton:!1}):(0,t.jsx)(le,{text:"You haven't created any mute timings yet",buttonLabel:"Add mute timing",buttonIcon:"plus",buttonSize:"lg",href:(0,N.nL)("alerting/routes/mute-timing/new",n),showButton:w}),!a&&(0,t.jsx)(h.u,{isOpen:!!g,title:"Delete mute timing",body:`Are you sure you would like to delete "${g}"`,confirmText:"Delete",onConfirm:()=>{m((0,pt.$8)(n,g)),b("")},onDismiss:()=>b("")}),H]})};function qe(n,s=!1,a,r){const[[m,x],[f,g]]=(0,F.Hl)([F.QI.UpdateMuteTiming,F.QI.DeleteMuteTiming]),b=!s&&(x||g),[G,K]=(0,F.L7)(F.QI.ExportMuteTimings),w=(0,v.of)(pe);return(0,o.useMemo)(()=>{const H=[{id:"name",label:"Name",renderCell:function({data:M}){return(0,t.jsxs)(t.Fragment,{children:[M.name," ",M.provenance&&(0,t.jsx)(de.rS,{})]})},size:"250px"},{id:"timeRange",label:"Time range",renderCell:({data:B})=>(0,Jt.av)(B)}];return b&&H.push({id:"actions",label:"",renderCell:function({data:M}){return(0,t.jsx)(tn,{muteTiming:M,alertManagerSourceName:n,setMuteTimingName:a})},size:"150px",className:w.actionsColumn}),G&&H.push({id:"actions",label:"",renderCell:function({data:M}){return(0,t.jsx)("div",{children:(0,t.jsx)(U.W.Item,{icon:"download-alt",label:"Export",ariaLabel:"export",disabled:!K,"data-testid":"export",onClick:()=>r(M.name)})})},size:"100px"}),H},[n,a,b,G,K,r,w.actionsColumn])}function tn({muteTiming:n,alertManagerSourceName:s,setMuteTimingName:a}){const r=(0,v.of)(pe),m=s===it.hY;return n.provenance?(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[(0,vt.d6)(n)&&!m&&(0,t.jsx)(Y.E,{text:"Disabled",color:"orange",className:r.disabledBadge}),(0,t.jsx)(q.N,{href:(0,N.nL)("/alerting/routes/mute-timing/edit",s,{muteName:n.name}),children:(0,t.jsx)(st.K,{name:"file-alt",tooltip:"View mute timing"})})]}):(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:[(0,vt.d6)(n)&&!m&&(0,t.jsx)(Y.E,{text:"Disabled",color:"orange",className:r.disabledBadge}),(0,t.jsx)(y._,{actions:[F.QI.UpdateMuteTiming],children:(0,t.jsx)(q.N,{href:(0,N.nL)("/alerting/routes/mute-timing/edit",s,{muteName:n.name}),children:(0,t.jsx)(st.K,{name:"edit",tooltip:"Edit mute timing",className:r.editButton})})}),(0,t.jsx)(y._,{actions:[F.QI.DeleteMuteTiming],children:(0,t.jsx)(st.K,{name:"trash-alt",tooltip:"Delete mute timing",onClick:()=>a(n.name)})})]})}const pe=n=>({container:(0,i.css)({display:"flex",flexFlow:"column nowrap"}),muteTimingsButtons:(0,i.css)({marginBottom:n.spacing(2),alignSelf:"flex-end"}),disabledBadge:(0,i.css)({height:"fit-content"}),editButton:(0,i.css)({display:"flex"}),actionsColumn:(0,i.css)({justifyContent:"flex-end"})});var ut=e(2543),lt=e(88575),en=e(60029),bt=e(56034),Ft=e(14578),ge=e(10354),Rt=e(90182),It=e(94753),nn=e(39964),Ut=e(98164),Xt=e(32642);const sn=({receivers:n,onChangeReceiver:s,onChangeMatchers:a,matchingCount:r})=>{const[m,x]=(0,nn.l)(),f=(0,o.useRef)(null),{queryString:g,contactPoint:b}=rn(m),G=(0,v.of)(ln),K=(0,o.useCallback)(()=>(0,ut.debounce)(a,500),[a]);(0,o.useEffect)(()=>{s(b)},[b,s]),(0,o.useEffect)(()=>{const z=(0,Xt.Zc)(g??"").map(Ut.NL);K()(z)},[K,g]);const w=(0,o.useCallback)(()=>{f.current&&(f.current.value=""),x({contactPoint:void 0,queryString:void 0})},[x]),H=n.map(on),B=H.find(z=>z.value===b)??null,M=g||b;let J=!!(g&&g.length>3);try{g?(0,Xt.S6)(g):J=!0}catch{J=!1}return(0,t.jsxs)(u.B,{direction:"row",alignItems:"flex-end",gap:1,children:[(0,t.jsx)(lt.D,{className:G.noBottom,label:(0,t.jsx)(en.J,{children:(0,t.jsxs)(u.B,{gap:.5,children:[(0,t.jsx)("span",{children:"Search by matchers"}),(0,t.jsx)(bt.m,{content:(0,t.jsxs)("div",{children:["Filter notification policies by using a comma separated list of matchers, e.g.:",(0,t.jsx)("pre",{children:"severity=critical, region=EMEA"})]}),children:(0,t.jsx)(Ft.I,{name:"info-circle",size:"sm"})})]})}),invalid:!J,error:J?null:"Query must use valid matcher syntax",children:(0,t.jsx)(ge.p,{ref:f,"data-testid":"search-query-input",placeholder:"Search",width:46,prefix:(0,t.jsx)(Ft.I,{name:"search"}),onChange:z=>{x({queryString:z.currentTarget.value})},defaultValue:g})}),(0,t.jsx)(lt.D,{label:"Search by contact point",style:{marginBottom:0},children:(0,t.jsx)(Rt.l6,{id:"receiver","aria-label":"Search by contact point",value:B,options:H,onChange:z=>{x({contactPoint:z?.value})},width:28,isClearable:!0})}),M&&(0,t.jsxs)(u.B,{alignItems:"center",children:[(0,t.jsx)(O.$n,{variant:"secondary",icon:"times",onClick:w,children:"Clear filters"}),(0,t.jsxs)(It.E,{variant:"bodySmall",color:"secondary",children:[r===0&&"No policies matching filters.",r===1&&`${r} policy matches the filters.`,r>1&&`${r} policies match the filters.`]})]})]})};function Ne(n,s){const a=new Map;function r(m,x){const f=[...x,m];if(s(m)){const g=a.get(m)??[];a.set(m,[...g,...f])}m.routes?.forEach(g=>r(g,f))}return r(n,[]),a}function an(n,s){const a=(0,Xt.J$)(n);return s.every(r=>a.some(m=>(0,ut.isEqual)(r,m)))}const on=n=>({label:n.name,value:n.name}),rn=n=>({queryString:n.get("queryString")??void 0,contactPoint:n.get("contactPoint")??void 0}),ln=()=>({noBottom:(0,i.css)({marginBottom:0})});var Et=e(37390),cn=e(62930),Gt=e(60021),dn=e(35016),un=e(26423),mn=e(12210),he=e(99494),pn=e(37534);const gn=()=>{const{installed:n}=(0,mn._)(he.W.OnCall),{data:s}=un.WG.useGrafanaOnCallIntegrationsQuery(void 0,{skip:!n});return r=>{const m=s??[];if(n&&(0,pn.p8)(r,m))return he.W.OnCall}},Ke=n=>{const s=gn(),a=r=>({label:r.name,value:r.name,grafanaAppReceiverType:s(r)});return n.map(a)};var hn=e(55127),Nt=e.n(hn);const fn=({active:n=0,suppressed:s=0,unprocessed:a=0})=>{const r=[],m=n+s+a;return n&&r.push((0,t.jsx)(Y.E,{color:"red",text:`${n} firing`},"firing")),s&&r.push((0,t.jsx)(Y.E,{color:"blue",text:`${s} suppressed`},"suppressed")),a&&r.push((0,t.jsx)(Y.E,{color:"orange",text:`${a} unprocessed`},"unprocessed")),r.length>1&&r.unshift((0,t.jsxs)(o.Fragment,{children:[m," ",Nt()("instance",m)]},"total")),!!r.length?(0,t.jsx)(u.B,{gap:.5,children:r}):null};var Dt=e(49785),vn=e(82762),at=e(79657),St=e(33915),$e=e(99903),Zt=e(27835);const xn=({actionButtons:n,alertManagerSourceName:s,onSubmit:a,receivers:r,route:m})=>{const x=(0,v.of)($e.t),[f,g]=(0,o.useState)(!1),[b,G]=(0,o.useState)((0,at.gY)(m.group_by)),K=(0,at.YE)(m),{handleSubmit:w,register:H,control:B,formState:{errors:M},setValue:J,getValues:z}=(0,Dt.mN)({defaultValues:{...K,overrideTimings:!0,overrideGrouping:!0}});return(0,t.jsxs)("form",{onSubmit:w(a),children:[(0,t.jsx)(lt.D,{label:"Default contact point",invalid:!!M.receiver,error:M.receiver?.message,children:(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:x.container,"data-testid":"am-receiver-select",children:[(0,t.jsx)(Dt.xI,{render:({field:{onChange:Q,ref:ct,...Z}})=>(0,t.jsx)(Rt.l6,{"aria-label":"Default contact point",...Z,className:x.input,onChange:mt=>Q((0,at.eb)(mt)),options:r}),control:B,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),(0,t.jsx)("span",{children:"or"}),(0,t.jsx)(q.N,{className:x.linkText,href:(0,N.nL)("/alerting/notifications/receivers/new",s),children:"Create a contact point"})]})})}),(0,t.jsx)(lt.D,{label:"Group by",description:"Combine multiple alerts into a single notification by grouping them by the same label values.","data-testid":"am-group-select",children:(0,t.jsx)(Dt.xI,{render:({field:{onChange:Q,ref:ct,...Z}})=>(0,t.jsx)(Rt.KF,{"aria-label":"Group by",...Z,allowCustomValue:!0,className:x.input,onCreateOption:mt=>{G(gt=>[...gt,(0,at.Mk)(mt)]),J("groupBy",[...Z.value||[],mt])},onChange:mt=>Q((0,at.ie)(mt)),options:[...at.Yl,...b]}),control:B,name:"groupBy"})}),(0,t.jsx)(vn.S,{collapsible:!0,className:x.collapse,isOpen:f,label:"Timing options",onToggle:g,children:(0,t.jsxs)("div",{className:x.timingFormContainer,children:[(0,t.jsx)(lt.D,{label:"Group wait",description:"The waiting time before sending the first notification for a new group of alerts. Default 30 seconds.",invalid:!!M.groupWaitValue,error:M.groupWaitValue?.message,"data-testid":"am-group-wait",children:(0,t.jsx)(St.V,{...H("groupWaitValue",{validate:at.hH}),placeholder:Zt.H.group_wait,className:x.promDurationInput,"aria-label":"Group wait"})}),(0,t.jsx)(lt.D,{label:"Group interval",description:"The wait time before sending a notification about changes in the alert group after the first notification has been sent. Default is 5 minutes.",invalid:!!M.groupIntervalValue,error:M.groupIntervalValue?.message,"data-testid":"am-group-interval",children:(0,t.jsx)(St.V,{...H("groupIntervalValue",{validate:at.hH}),placeholder:Zt.H.group_interval,className:x.promDurationInput,"aria-label":"Group interval"})}),(0,t.jsx)(lt.D,{label:"Repeat interval",description:"The wait time before resending a notification that has already been sent successfully. Default is 4 hours. Should be a multiple of Group interval.",invalid:!!M.repeatIntervalValue,error:M.repeatIntervalValue?.message,"data-testid":"am-repeat-interval",children:(0,t.jsx)(St.V,{...H("repeatIntervalValue",{validate:Q=>{const ct=z("groupIntervalValue");return(0,at.DY)(Q,ct)}}),placeholder:Zt.H.repeat_interval,className:x.promDurationInput,"aria-label":"Repeat interval"})})]})}),(0,t.jsx)("div",{className:x.container,children:n})]})};var fe=e(15292),yn=e(72093),we=e(70383);function jn(){const{selectedAlertmanager:n}=(0,we.VI)(),{currentData:s}=(0,et.f)(n),a=s?.alertmanager_config;return(0,o.useMemo)(()=>(a?(0,Jt.IT)(a):[])?.map(x=>({value:x.name,label:x.name,description:x.time_intervals.map(f=>(0,Ut.LF)(f)).join(", AND ")}))??[],[a])}var Ct=e(97174);const Ve=({actionButtons:n,receivers:s,route:a,onSubmit:r,defaults:m})=>{const x=(0,v.of)(Pn),f=(0,v.of)($e.t),[g,b]=(0,o.useState)((0,at.gY)(a?.group_by)),G=jn(),K=[{name:"",operator:Gt.ho.equal,value:""}],w=s.sort(En),H={...(0,at.YE)(a),...m},B={...H,object_matchers:a?H.object_matchers:K},{handleSubmit:M,control:J,register:z,formState:{errors:Q},setValue:ct,watch:Z,getValues:mt}=(0,Dt.mN)({defaultValues:B}),{fields:gt,append:Pt,remove:yt}=(0,Dt.jz)({control:J,name:"object_matchers"});return(0,t.jsxs)("form",{onSubmit:M(r),children:[(0,t.jsx)("input",{type:"hidden",...z("id")}),(0,t.jsxs)(u.B,{direction:"column",alignItems:"flex-start",children:[(0,t.jsx)("div",{children:"Matching labels"}),gt.length===0&&(0,t.jsx)(Y.E,{color:"orange",className:x.noMatchersWarning,icon:"exclamation-triangle",text:"If no matchers are specified, this notification policy will handle all alert instances."}),gt.length>0&&(0,t.jsx)("div",{className:x.matchersContainer,children:gt.map((ot,rt)=>(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",children:[(0,t.jsx)(lt.D,{label:"Label",invalid:!!Q.object_matchers?.[rt]?.name,error:Q.object_matchers?.[rt]?.name?.message,children:(0,t.jsx)(ge.p,{...z(`object_matchers.${rt}.name`,{required:"Field is required"}),defaultValue:ot.name,placeholder:"label",autoFocus:!0})}),(0,t.jsx)(lt.D,{label:"Operator",children:(0,t.jsx)(Dt.xI,{render:({field:{onChange:_,ref:ht,...Mt}})=>(0,t.jsx)(Rt.l6,{...Mt,className:x.matchersOperator,onChange:At=>_(At?.value),options:Ut.xH,"aria-label":"Operator"}),defaultValue:ot.operator,control:J,name:`object_matchers.${rt}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,t.jsx)(lt.D,{label:"Value",invalid:!!Q.object_matchers?.[rt]?.value,error:Q.object_matchers?.[rt]?.value?.message,children:(0,t.jsx)(ge.p,{...z(`object_matchers.${rt}.value`),defaultValue:ot.value,placeholder:"value"})}),(0,t.jsx)(st.K,{tooltip:"Remove matcher",name:"trash-alt",onClick:()=>yt(rt),children:"Remove"})]},ot.id))}),(0,t.jsx)(O.$n,{className:x.addMatcherBtn,icon:"plus",onClick:()=>Pt(at.Rg),variant:"secondary",type:"button",children:"Add matcher"})]}),(0,t.jsx)(lt.D,{label:"Contact point",children:(0,t.jsx)(Dt.xI,{render:({field:{onChange:ot,ref:rt,..._}})=>(0,t.jsx)(Rt.l6,{"aria-label":"Contact point",..._,className:f.input,onChange:ht=>ot((0,at.eb)(ht)),options:w,isClearable:!0}),control:J,name:"receiver"})}),(0,t.jsx)(lt.D,{label:"Continue matching subsequent sibling nodes",children:(0,t.jsx)(fe.d,{id:"continue-toggle",...z("continue")})}),(0,t.jsx)(lt.D,{label:"Override grouping",children:(0,t.jsx)(fe.d,{id:"override-grouping-toggle",...z("overrideGrouping")})}),Z().overrideGrouping&&(0,t.jsx)(lt.D,{label:"Group by",description:"Combine multiple alerts into a single notification by grouping them by the same label values. If empty, it is inherited from the parent policy.",children:(0,t.jsx)(Dt.xI,{rules:{validate:ot=>!ot||ot.length===0?"At least one group by option is required.":!0},render:({field:{onChange:ot,ref:rt,..._},fieldState:{error:ht}})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Rt.KF,{"aria-label":"Group by",..._,invalid:!!ht,allowCustomValue:!0,className:f.input,onCreateOption:Mt=>{b(At=>[...At,(0,at.Mk)(Mt)]),ct("groupBy",[..._.value||[],Mt])},onChange:Mt=>ot((0,at.ie)(Mt)),options:[...at.Yl,...g]}),ht&&(0,t.jsx)(yn.P,{children:ht.message})]}),control:J,name:"groupBy"})}),(0,t.jsx)(lt.D,{label:"Override general timings",children:(0,t.jsx)(fe.d,{id:"override-timings-toggle",...z("overrideTimings")})}),Z().overrideTimings&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(lt.D,{label:Ct.G.groupWait.label,description:Ct.G.groupWait.description,invalid:!!Q.groupWaitValue,error:Q.groupWaitValue?.message,children:(0,t.jsx)(St.V,{...z("groupWaitValue",{validate:at.hH}),"aria-label":Ct.G.groupWait.ariaLabel,className:f.promDurationInput})}),(0,t.jsx)(lt.D,{label:Ct.G.groupInterval.label,description:Ct.G.groupInterval.description,invalid:!!Q.groupIntervalValue,error:Q.groupIntervalValue?.message,children:(0,t.jsx)(St.V,{...z("groupIntervalValue",{validate:at.hH}),"aria-label":Ct.G.groupInterval.ariaLabel,className:f.promDurationInput})}),(0,t.jsx)(lt.D,{label:Ct.G.repeatInterval.label,description:Ct.G.repeatInterval.description,invalid:!!Q.repeatIntervalValue,error:Q.repeatIntervalValue?.message,children:(0,t.jsx)(St.V,{...z("repeatIntervalValue",{validate:(ot="")=>{const rt=mt("groupIntervalValue");return(0,at.DY)(ot,rt)}}),"aria-label":Ct.G.repeatInterval.ariaLabel,className:f.promDurationInput})})]}),(0,t.jsx)(lt.D,{label:"Mute timings","data-testid":"am-mute-timing-select",description:"Add mute timing to policy",invalid:!!Q.muteTimeIntervals,children:(0,t.jsx)(Dt.xI,{render:({field:{onChange:ot,ref:rt,..._}})=>(0,t.jsx)(Rt.KF,{"aria-label":"Mute timings",..._,className:f.input,onChange:ht=>ot((0,at.ie)(ht)),options:G}),control:J,name:"muteTimeIntervals"})}),n]})};function En(n){return n.grafanaAppReceiverType===he.W.OnCall?-1:0}const Pn=n=>{const s=n.spacing(3.5);return{addMatcherBtn:(0,i.css)({marginBottom:s}),matchersContainer:(0,i.css)({backgroundColor:n.colors.background.secondary,padding:`${n.spacing(1.5)} ${n.spacing(2)}`,paddingBottom:0,width:"fit-content"}),matchersOperator:(0,i.css)({minWidth:"120px"}),noMatchersWarning:(0,i.css)({padding:`${n.spacing(1)} ${n.spacing(2)}`,marginBottom:n.spacing(1)})}};var ze=e(26928);const Mn=(n=[],s,a)=>{const[r,m]=(0,o.useState)(!1),[x,f]=(0,o.useState)(void 0),[g,b]=(0,o.useState)(),G=Ke(n),K=(0,o.useCallback)(()=>{b(void 0),f(void 0),m(!1)},[]),w=(0,o.useCallback)((B,M)=>{b(B),f(M),m(!0)},[]);return[(0,o.useMemo)(()=>a?(0,t.jsx)(ve,{isOpen:r}):(0,t.jsx)(Et.a,{isOpen:r,onDismiss:K,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Add notification policy",children:(0,t.jsx)(Ve,{receivers:G,defaults:{groupBy:g?.group_by},onSubmit:B=>{g&&x&&s(B,g,x)},actionButtons:(0,t.jsxs)(Et.a.ButtonRow,{children:[(0,t.jsx)(O.$n,{type:"button",variant:"secondary",onClick:K,fill:"outline",children:"Cancel"}),(0,t.jsx)(O.$n,{type:"submit",children:"Save policy"})]})})}),[G,s,K,x,a,g,r]),w,K]},An=(n,s,a,r)=>{const[m,x]=(0,o.useState)(!1),[f,g]=(0,o.useState)(!1),[b,G]=(0,o.useState)(),K=Ke(s),w=(0,o.useCallback)(()=>{G(void 0),x(!1)},[]),H=(0,o.useCallback)((M,J)=>{g(J??!1),G(M),x(!0)},[]);return[(0,o.useMemo)(()=>r?(0,t.jsx)(ve,{isOpen:m}):(0,t.jsxs)(Et.a,{isOpen:m,onDismiss:w,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Edit notification policy",children:[f&&b&&(0,t.jsx)(xn,{alertManagerSourceName:n,onSubmit:a,receivers:K,route:b,actionButtons:(0,t.jsxs)(Et.a.ButtonRow,{children:[(0,t.jsx)(O.$n,{type:"button",variant:"secondary",onClick:w,fill:"outline",children:"Cancel"}),(0,t.jsx)(O.$n,{type:"submit",children:"Update default policy"})]})}),!f&&(0,t.jsx)(Ve,{receivers:K,route:b,onSubmit:a,actionButtons:(0,t.jsxs)(Et.a.ButtonRow,{children:[(0,t.jsx)(O.$n,{type:"button",variant:"secondary",onClick:w,fill:"outline",children:"Cancel"}),(0,t.jsx)(O.$n,{type:"submit",children:"Update policy"})]})})]}),[K,n,w,a,f,r,b,m]),H,w]},In=(n,s)=>{const[a,r]=(0,o.useState)(!1),[m,x]=(0,o.useState)(),f=(0,o.useCallback)(()=>{x(void 0),r(!1)},[x]),g=(0,o.useCallback)(K=>{x(K),r(!0)},[]),b=(0,o.useCallback)(()=>{m&&n(m)},[n,m]);return[(0,o.useMemo)(()=>s?(0,t.jsx)(ve,{isOpen:a}):(0,t.jsxs)(Et.a,{isOpen:a,onDismiss:f,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Delete notification policy",children:[(0,t.jsx)("p",{children:"Deleting this notification policy will permanently remove it."}),(0,t.jsx)("p",{children:"Are you sure you want to delete this policy?"}),(0,t.jsxs)(Et.a.ButtonRow,{children:[(0,t.jsx)(O.$n,{type:"button",variant:"destructive",onClick:b,children:"Yes, delete policy"}),(0,t.jsx)(O.$n,{type:"button",variant:"secondary",onClick:f,children:"Cancel"})]})]}),[f,b,s,a]),g,f]},Dn=n=>{const[s,a]=(0,o.useState)(!1),[r,m]=(0,o.useState)([]),[x,f]=(0,o.useState)([]),[g,b]=(0,o.useState)("default"),G=(0,o.useCallback)(()=>{a(!1),m([]),f([])},[]),K=(0,o.useCallback)((B,M,J)=>{m(B),M&&f(M),J&&b(J),a(!0)},[]),w=(0,o.useMemo)(()=>{const B=r.flatMap(M=>M.alerts);return(0,ut.groupBy)(B,M=>M.status.state)},[r]);return[(0,o.useMemo)(()=>(0,t.jsxs)(Et.a,{isOpen:s,onDismiss:G,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",gap:1,wrap:"wrap",children:[(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,t.jsx)(Ft.I,{name:"x"})," Matchers"]}),(0,t.jsx)(ze.s,{matchers:x,formatter:g})]}),children:[(0,t.jsxs)(u.B,{direction:"column",children:[(0,t.jsx)(fn,{active:w[Gt.Or.Active]?.length,suppressed:w[Gt.Or.Suppressed]?.length,unprocessed:w[Gt.Or.Unprocessed]?.length}),(0,t.jsx)("div",{children:r.map((B,M)=>(0,t.jsx)(dn._,{alertManagerSourceName:n,group:B},M))})]}),(0,t.jsx)(Et.a.ButtonRow,{children:(0,t.jsx)(O.$n,{type:"button",variant:"secondary",onClick:G,children:"Cancel"})})]}),[r,G,w,x,g,s,n]),K,G]},ve=({isOpen:n})=>(0,t.jsx)(Et.a,{isOpen:n,onDismiss:()=>{},closeOnBackdropClick:!1,closeOnEscape:!1,title:(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",gap:.5,children:["Updating... ",(0,t.jsx)(cn.y,{inline:!0})]}),children:"Please wait while we update your notification policies."});var Cn=e(32264),Ye=e(83122),_t=e(72109),Tn=e(69613),Bt=e(8484),xe=e(23896),ye=e(10685),On=e(19645),He=e(79581),je=e(35108),Ee=e(8406),Tt=e(55196);const bn=({exportFormat:n,onClose:s})=>{const{currentData:a="",isFetching:r}=Wt.hK.useExportPoliciesQuery({format:n}),m=`policies-${new Date().getTime()}`;return r?(0,t.jsx)(V._,{text:"Loading...."}):(0,t.jsx)(Lt.J,{format:n,textDefinition:a,downloadFileName:m,onClose:s})},Rn=({onClose:n})=>{const[s,a]=(0,o.useState)("yaml");return(0,t.jsx)(jt.m,{activeTab:s,onTabChange:a,onClose:n,formatProviders:Object.values(xt.sl),children:(0,t.jsx)(bn,{exportFormat:s,onClose:n})})},Qe=n=>{const{receivers:s=[],contactPointsState:a,readOnly:r=!1,provisioned:m=!1,alertGroups:x=[],alertManagerSourceName:f,currentRoute:g,routeTree:b,inheritedProperties:G,routesMatchingFilters:K={filtersApplied:!1,matchedRoutesWithPath:new Map},matchingInstancesPreview:w={enabled:!1},onEditPolicy:H,onAddPolicy:B,onDeletePolicy:M,onShowAlertInstances:J,isAutoGenerated:z=!1}=n,Q=(0,v.of)(Kt),ct=g===b,Z=g.receiver,mt=g.continue??!1,gt=(0,Xt.J$)(g),Pt=!!(gt&&gt.length),{filtersApplied:yt,matchedRoutesWithPath:ot}=K,rt=Array.from(ot.keys()),_=yt&&rt.some(dt=>dt.id===g.id),ht=Array.from(ot.values()).flat(),Mt=ht.some(dt=>dt.id===g.id),At=[],qt=!Pt&&!ct&&!mt,Me=Z??G?.receiver??"",Ae=a?zn(Me,a):[],te=g.routes??[],$t=yt?te.filter(dt=>ht.some(Ht=>Ht.id===dt.id)):te,wt=$t.length>0,[Ie,ee]=(0,nt.A)(!1),Vt=w?.groupsMap?.get(g.id),De=Vt?(0,ut.sumBy)(Vt,dt=>dt.alerts.length):void 0,[Ce,Te]=(0,F.L7)(F.QI.ViewAutogeneratedPolicyTree),zt=Je(g),[Yt,Oe]=(0,nt.A)(!zt),be=g.group_by,Re=g.mute_time_intervals??[],Ze={group_wait:g.group_wait,group_interval:g.group_interval,repeat_interval:g.repeat_interval};Ae.forEach(dt=>{At.push(dt)});const ne=20,[se,Se]=(0,o.useState)(ne),ae=Bn(z,ct,m,H,g,ee,M);if(z&&(!Te||!Ce)||yt&&!Mt)return null;const ft=ct||zt,Ot=$t.filter(dt=>ht.some(Ht=>Ht.id===dt.id)),oe=yt?Ot:$t,re=oe.slice(0,se),Le=oe.length-re.length,ns=Le>0;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(u.B,{direction:"column",gap:1.5,children:[(0,t.jsxs)("div",{className:Q.policyWrapper(_),"data-testid":ct?"am-root-route-container":"am-route-container",children:[mt&&(0,t.jsx)(Fn,{}),qt&&(0,t.jsx)(Un,{}),(0,t.jsx)("div",{className:Q.policyItemWrapper,children:(0,t.jsxs)(u.B,{direction:"column",gap:1,children:[(0,t.jsx)("div",{children:(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",gap:1,children:[wt?(0,t.jsx)(st.K,{name:Yt?"angle-down":"angle-right",onClick:Oe,"aria-label":Yt?"Collapse":"Expand"}):null,ft?zt?(0,t.jsx)(Nn,{}):(0,t.jsx)(Gn,{}):Pt?(0,t.jsx)(ze.s,{matchers:gt??[],formatter:(0,Ut.VE)(f)}):(0,t.jsx)("span",{className:Q.metadata,children:"No matchers"}),(0,t.jsx)(Qt.h,{}),At.length>0&&(0,t.jsx)(Ln,{errors:At}),m&&(0,t.jsx)(de.rS,{}),(0,t.jsxs)(u.B,{direction:"row",gap:.5,children:[!z&&!r&&(0,t.jsx)(y._,{actions:[F.QI.CreateNotificationPolicy],children:(0,t.jsx)(xe.A,{shouldWrap:m,wrap:Pe,children:ct?(0,t.jsx)(O.$n,{variant:"secondary",icon:"plus",size:"sm",disabled:m,type:"button",onClick:()=>B(g,"child"),children:"New child policy"}):(0,t.jsx)(Ye.m,{overlay:(0,t.jsxs)(U.W,{children:[(0,t.jsx)(U.W.Item,{label:"New sibling above",icon:"arrow-up",onClick:()=>B(g,"above")}),(0,t.jsx)(U.W.Item,{label:"New sibling below",icon:"arrow-down",onClick:()=>B(g,"below")}),(0,t.jsx)(U.W.Divider,{}),(0,t.jsx)(U.W.Item,{label:"New child policy",icon:"plus",onClick:()=>B(g,"child")})]}),children:(0,t.jsx)(O.$n,{size:"sm",variant:"secondary",disabled:m,icon:"angle-down",type:"button",children:"Add new policy"})})})}),ae.length>0&&(0,t.jsx)(Ye.m,{overlay:(0,t.jsx)(U.W,{children:ae}),children:(0,t.jsx)(O.$n,{icon:"ellipsis-h",variant:"secondary",size:"sm",type:"button","aria-label":"more-actions","data-testid":"more-actions"})})]})]})}),(0,t.jsx)(Sn,{matchingInstancesPreview:w,numberOfAlertInstances:De,contactPoint:Z??void 0,groupBy:be,muteTimings:Re,timingOptions:Ze,inheritedProperties:G,alertManagerSourceName:f,receivers:s,matchingAlertGroups:Vt,matchers:gt,isDefaultPolicy:ct,onShowAlertInstances:J})]})})]}),(0,t.jsx)("div",{className:Q.childPolicies,children:Yt&&(0,t.jsxs)(t.Fragment,{children:[re.map(dt=>{const Ht=(0,He.W$)(g,dt,G),ss=Je(dt)||z,as=r||m||z;return(0,t.jsx)(Qe,{routeTree:b,currentRoute:dt,receivers:s,contactPointsState:a,readOnly:as,inheritedProperties:Ht,onAddPolicy:B,onEditPolicy:H,onDeletePolicy:M,onShowAlertInstances:J,alertManagerSourceName:f,alertGroups:x,routesMatchingFilters:K,matchingInstancesPreview:w,isAutoGenerated:ss,provisioned:m},dt.id)}),ns&&(0,t.jsxs)(O.$n,{size:"sm",icon:"angle-down",variant:"secondary",className:Q.moreButtons,onClick:()=>Se(se+ne),children:[Le," additional ",Nt()("policy",Le)]})]})}),Ie&&(0,t.jsx)(Rn,{onClose:ee})]})})};function Sn({numberOfAlertInstances:n,isDefaultPolicy:s,timingOptions:a,groupBy:r,muteTimings:m=[],matchingInstancesPreview:x,inheritedProperties:f,matchingAlertGroups:g,onShowAlertInstances:b,matchers:G,contactPoint:K,alertManagerSourceName:w,receivers:H}){const B=(0,v.of)(Kt),M=f&&f.group_by,J=f&&Object.keys(f).length>0,z=(0,ut.isArray)(r)&&r[0]==="...",Q=!z&&(0,ut.isArray)(r)&&r.length>0,ct=s&&(0,ut.isArray)(r)&&r.length===0,Z=!!m.length;return(0,t.jsx)("div",{className:B.metadataRow,children:(0,t.jsxs)(u.B,{direction:"row",alignItems:"center",gap:1,children:[x.enabled&&(0,t.jsxs)(Tt.P,{icon:"layers-alt",onClick:()=>{g&&b(g,G,(0,Ut.VE)(w))},"data-testid":"matching-instances",children:[(0,t.jsx)(It.E,{color:"primary",children:n??"-"}),(0,t.jsx)("span",{children:Nt()("instance",n)})]}),K&&(0,t.jsxs)(Tt.P,{icon:"at","data-testid":"contact-point",children:[(0,t.jsx)("span",{children:"Delivered to"}),(0,t.jsx)(Vn,{alertManagerSourceName:w,receivers:H,contactPoint:K})]}),!M&&(0,t.jsxs)(t.Fragment,{children:[Q&&(0,t.jsxs)(Tt.P,{icon:"layer-group","data-testid":"grouping",children:[(0,t.jsx)("span",{children:"Grouped by"}),(0,t.jsx)(It.E,{color:"primary",children:r.join(", ")})]}),ct&&(0,t.jsx)(Tt.P,{icon:"layer-group",children:(0,t.jsx)("span",{children:"Single group"})}),z&&(0,t.jsx)(Tt.P,{icon:"layer-group",children:(0,t.jsx)("span",{children:"Not grouping"})})]}),Z&&(0,t.jsxs)(Tt.P,{icon:"calendar-slash","data-testid":"mute-timings",children:[(0,t.jsx)("span",{children:"Muted when"}),(0,t.jsx)($n,{timings:m,alertManagerSourceName:w})]}),a&&(0,t.jsx)(wn,{timingOptions:s?(0,ut.defaults)(a,Zt.H):a}),J&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(Tt.P,{icon:"corner-down-right-alt","data-testid":"inherited-properties",children:[(0,t.jsx)("span",{children:"Inherited"}),(0,t.jsx)(Kn,{properties:f})]})})]})})}const Bn=(n,s,a,r,m,x,f)=>{const[[g,b],[G,K],[w,H]]=(0,F.Hl)([F.QI.UpdateNotificationPolicyTree,F.QI.DeleteNotificationPolicy,F.QI.ExportNotificationPolicies]),B=[],M=H&&w&&s&&!n,J=g&&b,z=G&&K&&!s&&!n;return J&&B.push((0,t.jsx)(o.Fragment,{children:(0,t.jsx)(xe.A,{shouldWrap:a,wrap:Pe,children:(0,t.jsx)(U.W.Item,{icon:"edit",disabled:a||n,label:"Edit",onClick:()=>r(m,s)})})},"edit-policy")),M&&B.push((0,t.jsx)(U.W.Item,{icon:"download-alt",label:"Export",onClick:x},"export-policy")),z&&B.push((0,t.jsxs)(o.Fragment,{children:[(0,t.jsx)(U.W.Divider,{}),(0,t.jsx)(xe.A,{shouldWrap:a,wrap:Pe,children:(0,t.jsx)(U.W.Item,{destructive:!0,icon:"trash-alt",disabled:a||n,label:"Delete",onClick:()=>f(m)})})]},"delete-policy")),B},Wn="__grafana_autogenerated__";function Je(n){return!(Cn.$.featureToggles.alertingSimplifiedRouting??!1)||!n.object_matchers?!1:n.object_matchers.some(a=>a[0]===Wn&&a[1]===Gt.ho.equal&&a[2]==="true")??!1}const Pe=n=>(0,t.jsx)(bt.m,{content:"Provisioned items cannot be edited in the UI",placement:"top",children:(0,t.jsx)("span",{children:n})}),Ln=({errors:n})=>(0,t.jsx)(je.j,{arrow:!0,placement:"top",content:(0,t.jsx)(u.B,{direction:"column",gap:.5,children:n.map(s=>(0,t.jsx)(o.Fragment,{children:s},(0,ut.uniqueId)()))}),children:(0,t.jsx)("span",{children:(0,t.jsx)(Y.E,{icon:"exclamation-circle",color:"red",text:Nt()("error",n.length,!0)})})}),Fn=()=>{const n=(0,v.of)(Kt);return(0,t.jsx)(bt.m,{placement:"top",content:"This route will continue matching other policies",children:(0,t.jsx)("div",{className:n.gutterIcon,"data-testid":"continue-matching",children:(0,t.jsx)(Ft.I,{name:"arrow-down"})})})},Un=()=>{const n=(0,v.of)(Kt);return(0,t.jsx)(bt.m,{placement:"top",content:"This policy matches all labels",children:(0,t.jsx)("div",{className:n.gutterIcon,"data-testid":"matches-all",children:(0,t.jsx)(Ft.I,{name:"exclamation-triangle"})})})};function Gn(){const n=(0,v.of)(Kt);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(It.E,{element:"h2",variant:"body",weight:"medium",children:"Default policy"}),(0,t.jsx)("span",{className:n.metadata,children:"All alert instances will be handled by the default policy if no other matching policies are found."})]})}function Nn(){return(0,t.jsx)(It.E,{element:"h3",variant:"body",weight:"medium",children:"Auto-generated policies"})}const Kn=({properties:n})=>(0,t.jsx)(je.j,{arrow:!0,placement:"top",content:(0,t.jsx)(u.B,{direction:"row",gap:.5,children:Object.entries(n).map(([s,a])=>a?(0,t.jsx)(Ee.J,{label:Yn(s),value:Hn(s,a)},s):null)}),children:(0,t.jsx)("div",{children:(0,t.jsx)(It.E,{color:"primary",children:Nt()("property",Object.keys(n).length,!0)})})}),$n=({timings:n,alertManagerSourceName:s})=>(0,t.jsx)("div",{children:n.map(a=>(0,t.jsx)(_t.Y,{href:(0,N.i7)(a,s),color:"primary",variant:"bodySmall",inline:!1,children:a},a))}),wn=({timingOptions:n})=>{const s=n.group_wait,a=n.group_interval,r=n.repeat_interval;if(!s&&!a&&!r)return null;const m=[];return s&&m.push((0,t.jsx)(bt.m,{placement:"top",content:(0,Bt.t)("alerting.policies.metadata.timingOptions.groupWait.description","How long to initially wait to send a notification for a group of alert instances."),children:(0,t.jsx)("span",{children:(0,t.jsxs)(Bt.x6,{i18nKey:"alerting.policies.metadata.timingOptions.groupWait.label",children:["Wait ",(0,t.jsx)(ye.S,{content:s})," to group instances"]})})})),a&&m.push((0,t.jsx)(bt.m,{placement:"top",content:(0,Bt.t)("alerting.policies.metadata.timingOptions.groupInterval.description","How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent."),children:(0,t.jsx)("span",{children:(0,t.jsxs)(Bt.x6,{i18nKey:"alerting.policies.metadata.timingOptions.groupInterval.label",children:["Wait ",(0,t.jsx)(ye.S,{content:a})," before sending updates"]})})})),r&&m.push((0,t.jsx)(bt.m,{placement:"top",content:(0,Bt.t)("alerting.policies.metadata.timingOptions.repeatInterval.description","How often notifications are sent if the group of alerts has not changed since the last notification."),children:(0,t.jsx)("span",{children:(0,t.jsxs)(Bt.x6,{i18nKey:"alerting.policies.metadata.timingOptions.repeatInterval.label",children:["Repeated every ",(0,t.jsx)(ye.S,{content:r})]})})})),(0,t.jsx)(Tt.P,{icon:"hourglass","data-testid":"timing-options",children:m.map((x,f)=>(0,t.jsxs)("span",{children:[x,f<m.length-1&&" \xB7 "]},(0,ut.uniqueId)()))})},Vn=({alertManagerSourceName:n,contactPoint:s,receivers:a})=>{const r=a.find(f=>f.name===s);if(!r)return(0,t.jsx)(_t.Y,{href:(0,N.bg)(s,n),color:"primary",variant:"bodySmall",inline:!1,children:s});if(!r.grafana_managed_receiver_configs)return(0,t.jsx)(_t.Y,{href:(0,N.bg)(s,n),color:"primary",variant:"bodySmall",inline:!1,children:s});const x=(0,ut.groupBy)(r.grafana_managed_receiver_configs,f=>f.type);return(0,t.jsx)(je.j,{arrow:!0,placement:"top",header:(0,t.jsxs)(Tt.P,{icon:"at",children:[(0,t.jsx)("div",{children:"Contact Point"}),(0,t.jsx)(It.E,{color:"primary",children:s})]}),content:(0,t.jsx)(u.B,{direction:"row",gap:.5,children:Object.entries(x).map(([f,g])=>(0,t.jsx)(Ee.J,{label:g.length>1?g.length:void 0,icon:On.M[f],value:(0,ut.upperFirst)(f)},(0,ut.uniqueId)()))}),children:(0,t.jsx)(_t.Y,{href:(0,N.bg)(s,n),color:"primary",variant:"bodySmall",inline:!1,children:s})},(0,ut.uniqueId)())};function zn(n,s){return Object.entries(s[n]?.notifiers??[]).reduce((m=[],[x,f])=>{const g=f.filter(b=>b.lastNotifyAttemptError).map(b=>(0,t.jsx)(Ee.J,{icon:"at",label:`Contact Point \u203A ${b.name}`,value:b.lastNotifyAttemptError},(0,ut.uniqueId)()));return m.concat(g)},[])}const Yn=n=>{switch(n){case"receiver":return"Contact Point";case"group_by":return"Group by";case"group_interval":return"Group interval";case"group_wait":return"Group wait";case"repeat_interval":return"Repeat interval";default:return n}},Hn=(n,s)=>{const a=n==="group_by"&&Array.isArray(s)&&s[0]==="...",r=n==="group_by"&&Array.isArray(s)&&s.length===0;return a?(0,t.jsx)(It.E,{variant:"bodySmall",color:"secondary",children:"Not grouping"}):r?(0,t.jsx)(It.E,{variant:"bodySmall",color:"secondary",children:"Single group"}):Array.isArray(s)?s.join(", "):s},Kt=n=>({matcher:s=>{const{color:a,borderColor:r}=(0,Tn.MC)(s);return{wrapper:(0,i.css)({color:"#fff",background:a,padding:`${n.spacing(.33)} ${n.spacing(.66)}`,fontSize:n.typography.bodySmall.fontSize,border:`solid 1px ${r}`,borderRadius:n.shape.radius.default})}},childPolicies:(0,i.css)({marginLeft:n.spacing(4),position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",borderLeft:`solid 1px ${n.colors.border.weak}`,marginTop:0,marginLeft:"-20px"}}),policyItemWrapper:(0,i.css)({padding:n.spacing(1.5)}),metadataRow:(0,i.css)({borderBottomLeftRadius:n.shape.borderRadius(2),borderBottomRightRadius:n.shape.borderRadius(2)}),policyWrapper:(s=!1)=>(0,i.css)({flex:1,position:"relative",background:n.colors.background.secondary,borderRadius:n.shape.radius.default,border:`solid 1px ${n.colors.border.weak}`,...s&&{borderColor:n.colors.primary.border,background:n.colors.primary.transparent}}),metadata:(0,i.css)({color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize,fontWeight:n.typography.bodySmall.fontWeight}),break:(0,i.css)({width:"100%",height:0,marginBottom:n.spacing(2)}),gutterIcon:(0,i.css)({position:"absolute",top:0,transform:"translateY(50%)",left:`-${n.spacing(4)}`,color:n.colors.text.secondary,background:n.colors.background.primary,width:"25px",height:"25px",textAlign:"center",border:`solid 1px ${n.colors.border.weak}`,borderRadius:n.shape.radius.default,padding:0}),moreButtons:(0,i.css)({marginTop:n.spacing(.5),marginBottom:n.spacing(1.5)})});var Qn=e(19143),Jn=e(88467),kt=e(67332),Xn=(n=>(n.NotificationPolicies="notification_policies",n.MuteTimings="mute_timings",n))(Xn||{});const Zn=()=>{const n=(0,j.useDispatch)(),s=(0,v.of)(kn),{useGetAlertmanagerAlertGroupsQuery:a}=R.m,[r,m]=(0,l.s)(),{tab:x}=qn(r),[f,g]=(0,o.useState)(x),[b,G]=(0,o.useState)(!1),[K,w]=(0,o.useState)(),[H,B]=(0,o.useState)([]),{selectedAlertmanager:M,hasConfigurationAPI:J,isGrafanaAlertmanager:z}=(0,we.VI)(),{getRouteGroupsMap:Q}=(0,Qn.L)(),ct=W(M??""),{currentData:Z,isLoading:mt,error:gt}=(0,et.f)(M,{refetchOnFocus:!0,refetchOnReconnect:!0}),Pt=Z?.alertmanager_config,{currentData:yt,refetch:ot}=a({amSourceName:M??""},{skip:!M}),rt=Pt?.receivers??[],_=(0,o.useMemo)(()=>{if(Pt?.route)return(0,at.QM)(Pt.route)},[Pt?.route]),[{value:ht,error:Mt},At]=(0,A.A)(Q,[Q]);(0,o.useEffect)(()=>{_&&yt&&At(_,yt,{unquoteMatchers:!z})},[_,yt,At,z]);const qt=(0,o.useMemo)(()=>_?Xe(_,{contactPointFilter:K,labelMatchersFilter:H}):{filtersApplied:!1,matchedRoutesWithPath:new Map},[K,H,_]),Me=!!Pt?.route?.provenance;function Ae(ft){if(!_)return;const Ot=(0,kt.AB)(M??"",ft,_);wt(Ot)}function te(ft){if(!_)return;const Ot=(0,kt.AS)(ft,_);wt(Ot)}function $t(ft,Ot,oe){if(!_)return;const re=(0,kt.I8)(M??"",ft,Ot,_,oe);wt(re)}function wt(ft){if(!Z)return;const Ot=(0,kt.dn)(ft);G(!0),n((0,pt.RW)({newConfig:{...Z,alertmanager_config:{...Z.alertmanager_config,route:Ot}},oldConfig:Z,alertManagerSourceName:M,successMessage:"Updated notification policies"})).unwrap().then(()=>{M&&ot(),Te(),Vt(),Oe()}).finally(()=>{G(!1)})}const[Ie,ee,Vt]=Mn(rt,$t,b),[De,Ce,Te]=An(M??"",rt,Ae,b),[zt,Yt,Oe]=In(te,b),[be,Re]=Dn(M??"");if((0,I.o)(ft=>ft.unifiedAlerting.saveAMConfig=Jn.jA),!M)return null;const ne=(Z?.alertmanager_config?(0,Jt.IT)(Z?.alertmanager_config):[]).length,se=Z&&!gt&&!mt,Se=!Z&&mt,ae=gt&&!mt,Be=f==="mute_timings",We=f==="notification_policies";return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.M,{currentAlertmanager:M}),(0,t.jsxs)(E.U,{children:[(0,t.jsx)(C.o,{label:"Notification Policies",active:We,onChangeTab:()=>{g("notification_policies"),m({tab:"notification_policies"})}}),(0,t.jsx)(C.o,{label:"Mute Timings",active:Be,counter:ne,onChangeTab:()=>{g("mute_timings"),m({tab:"mute_timings"})}})]}),(0,t.jsxs)(L.J,{className:s.tabContent,children:[Se&&(0,t.jsx)(V._,{text:"Loading Alertmanager config..."}),ae&&(0,t.jsx)(S.F,{severity:"error",title:"Error loading Alertmanager config",children:gt.message||"Unknown error."}),se&&(0,t.jsxs)(t.Fragment,{children:[We&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(u.B,{direction:"column",gap:1,children:[_&&(0,t.jsx)(sn,{receivers:rt,onChangeMatchers:B,onChangeReceiver:w,matchingCount:qt.matchedRoutesWithPath.size}),_&&(0,t.jsx)(Qe,{receivers:rt,routeTree:_,currentRoute:_,alertGroups:yt??[],contactPointsState:ct.receivers,readOnly:!J,provisioned:Me,alertManagerSourceName:M,onAddPolicy:ee,onEditPolicy:Ce,onDeletePolicy:Yt,onShowAlertInstances:Re,routesMatchingFilters:qt,matchingInstancesPreview:{groupsMap:ht,enabled:!Mt},isAutoGenerated:!1})]}),Ie,De,zt,be]}),Be&&(0,t.jsx)(ke,{alertManagerSourceName:M,hideActions:!J})]})]})]})},Xe=(n,s)=>{const{contactPointFilter:a,labelMatchersFilter:r=[]}=s,m=a||r.length>0,x=!!a&&r.length>0;if(!m)return{filtersApplied:!1,matchedRoutesWithPath:new Map};let f=[];const g=(0,He._I)(n),b=a?Ne(g,B=>B.receiver===a):new Map,G=Array.from(b.keys());G&&f.push(G);const K=r.length?Ne(g,B=>an(B,r)):new Map,w=Array.from(K.keys());return K.size>0&&f.push(w),{filtersApplied:!0,matchedRoutesWithPath:x?_n(K,b):new Map([...K,...b])}};function _n(...n){const s=new Map;for(const a of n[0].keys())n.every(r=>r.has(a))&&s.set(a,n[0].get(a));return s}const kn=n=>({tabContent:(0,i.css)({marginTop:n.spacing(2)})});function qn(n){let s="notification_policies";return n.tab==="notification_policies"&&(s="notification_policies"),n.tab==="mute_timings"&&(s="mute_timings"),{tab:s}}const ts=()=>(0,t.jsx)($.y,{navId:"am-routes",accessType:"notification",children:(0,t.jsx)(Zn,{})}),es=(0,c.Xc)(ts,{style:"page"})},64853:(k,D,e)=>{e.d(D,{_:()=>v});var t=e(74848),i=e(2543),o=e.n(i),A=e(19073);const v=({actions:u,children:c})=>{const l=(0,i.filter)(u,V),j=(0,i.filter)(u,S);return l.length?(0,t.jsx)(E,{actions:l,children:c}):j.length?(0,t.jsx)(C,{actions:j,children:c}):null},E=({actions:u,children:c})=>{const l=(0,A.iI)();return L(l,u)?(0,t.jsx)(t.Fragment,{children:c}):null},C=({actions:u,children:c})=>{const l=(0,A.e2)();return L(l,u)?(0,t.jsx)(t.Fragment,{children:c}):null};function L(u,c){return(0,i.chain)(u).pick(c).values().value().some(([l,j])=>j===!0)}function V(u){return Object.values(A.QI).includes(u)}function S(u){return Object.values(A.RY).includes(u)}},64047:(k,D,e)=>{e.d(D,{e:()=>o});var t=e(74848),i=e(55852);const o=({isCollapsed:A,onToggle:v,idControlled:E,className:C,text:L,size:V="xl",...S})=>(0,t.jsx)(i.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!A,"aria-controls":E,className:C,icon:A?"angle-right":"angle-down",onClick:()=>v(!A),...S,children:L})},23896:(k,D,e)=>{e.d(D,{A:()=>o});var t=e(96540);function i({children:A,shouldWrap:v,wrap:E},C){return v?(0,t.cloneElement)(E(A)):A}const o=(0,t.forwardRef)(i)},23088:(k,D,e)=>{e.d(D,{Z:()=>A});var t=e(74848),i=e(32196),o=e(40845);const A=({children:E})=>{const C=(0,o.of)(v);return(0,t.jsx)("div",{className:C.container,children:E})},v=E=>({container:(0,i.css)({backgroundColor:E.colors.background.secondary,color:E.colors.text.secondary,padding:E.spacing(4),textAlign:"center"})})},57895:(k,D,e)=>{e.d(D,{M:()=>V});var t=e(74848),i=e(32196),o=e(40845),A=e(42418),v=e(60021),E=e(82843),C=e(19073),L=e(57220);function V({currentAlertmanager:u}){const c=(0,o.of)(S),l=u!==L.hY,[j,I]=(0,C.Ej)(C.RY.ReadConfigurationStatus),R=j&&I,{currentData:d}=E.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(void 0,{skip:l||!R});if(!(d?.alertmanagersChoice&&[v.nA.External,v.nA.All].includes(d?.alertmanagersChoice))||l)return null;const P=d.numExternalAlertmanagers>0;return d.alertmanagersChoice===v.nA.External?(0,t.jsxs)(A.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:["Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts.",(0,t.jsx)("div",{className:c.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):d.alertmanagersChoice===v.nA.All&&P?(0,t.jsxs)(A.F,{title:"You have additional Alertmanagers to configure",severity:"warning",children:["Ensure you make configuration changes in the correct Alertmanagers; both internal and external. Changing one will not affect the others.",(0,t.jsx)("div",{className:c.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):null}const S=u=>({adminHint:(0,i.css)({fontSize:u.typography.bodySmall.fontSize,fontWeight:u.typography.bodySmall.fontWeight})})},35016:(k,D,e)=>{e.d(D,{_:()=>st});var t=e(74848),i=e(32196),o=e(96540),A=e(40845),v=e(67061),E=e(72109),C=e(60021),L=e(56361),V=e(69087),S=e(64047),u=e(55196),c=e(70416),l=e(10562),j=e(97754),I=e(55852),R=e(16233),d=e(31678),p=e(19073),P=e(57220),T=e(71223),W=e(64853);const $=({alert:y,alertManagerSourceName:F})=>{const et=(0,A.of)(X),pt=(0,P.z2)(F),it=pt?R.TP.hasPermission(d.AccessControlAction.AlertingRuleRead):!0;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:et.actionsRow,children:[y.status.state===C.Or.Suppressed&&(0,t.jsx)(W._,{actions:[p.QI.CreateSilence,p.QI.UpdateSilence],children:(0,t.jsx)(I.z9,{href:`${(0,L.nL)("/alerting/silences",F)}&silenceIds=${y.status.silencedBy.join(",")}`,className:et.button,icon:"bell",size:"sm",children:"Manage silences"})}),y.status.state===C.Or.Active&&(0,t.jsx)(W._,{actions:[p.QI.CreateSilence],children:(0,t.jsx)(I.z9,{href:(0,L.BK)(F,y.labels),className:et.button,icon:"bell-slash",size:"sm",children:"Silence"})}),it&&y.generatorURL&&(0,t.jsx)(I.z9,{className:et.button,href:y.generatorURL,icon:"chart-line",size:"sm",children:pt?"See alert rule":"See source"})]}),Object.entries(y.annotations).map(([N,vt])=>(0,t.jsx)(T.s,{annotationKey:N,value:vt},N)),(0,t.jsxs)("div",{className:et.receivers,children:["Receivers:"," ",y.receivers.map(({name:N})=>N).filter(N=>!!N).join(", ")]})]})},X=y=>({button:(0,i.css)({"& + &":{marginLeft:y.spacing(1)}}),actionsRow:(0,i.css)({padding:`${y.spacing(2,0)} !important`,borderBottom:`1px solid ${y.colors.border.medium}`}),receivers:(0,i.css)({padding:y.spacing(1,0)})}),nt=({alerts:y,alertManagerSourceName:F})=>{const et=(0,A.of)(O),pt=(0,o.useMemo)(()=>[{id:"state",label:"Notification state",renderCell:({data:N})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.y,{state:N.status.state}),(0,t.jsxs)("span",{className:et.duration,children:["for"," ",(0,c.dU)({start:new Date(N.startsAt),end:new Date(N.endsAt)})]})]}),size:"220px"},{id:"labels",label:"Instance labels",renderCell:({data:{labels:N}})=>(0,t.jsx)(V.m,{labels:N,size:"sm"}),size:1}],[et]),it=(0,o.useMemo)(()=>y.map(N=>({id:N.fingerprint,data:N})),[y]);return(0,t.jsx)("div",{className:et.tableWrapper,"data-testid":"alert-group-table",children:(0,t.jsx)(l.B,{cols:pt,items:it,isExpandable:!0,renderExpandedContent:({data:N})=>(0,t.jsx)($,{alert:N,alertManagerSourceName:F})})})},O=y=>({tableWrapper:(0,i.css)({marginTop:y.spacing(3),[y.breakpoints.up("md")]:{marginLeft:y.spacing(4.5)}}),duration:(0,i.css)({marginLeft:y.spacing(1),fontSize:y.typography.bodySmall.fontSize})});var h=e(55127),U=e.n(h);const Y=y=>({[C.Or.Active]:(0,i.css)({color:y.colors.error.text}),[C.Or.Suppressed]:(0,i.css)({color:y.colors.primary.text}),[C.Or.Unprocessed]:(0,i.css)({color:y.colors.secondary.text})}),q=({group:y})=>{const F=(0,A.of)(Y),et=y.alerts.length,pt=y.alerts.reduce((it,N)=>(it[N.status.state]?it[N.status.state]+=1:it[N.status.state]=1,it),{});return(0,t.jsxs)("div",{children:[`${et} ${U()("alert",et)}: `,Object.entries(pt).map(([it,N],vt)=>(0,t.jsxs)("span",{className:F[it],children:[vt>0&&", ",`${N} ${it}`]},`${JSON.stringify(y.labels)}-notifications-${vt}`))]})},st=({alertManagerSourceName:y,group:F})=>{const[et,pt]=(0,o.useState)(!0),it=(0,A.of)(tt),N=F.receiver.name!=="NONE",vt=F.receiver.name;return(0,t.jsxs)("div",{className:it.wrapper,children:[(0,t.jsxs)("div",{className:it.header,children:[(0,t.jsxs)("div",{className:it.group,"data-testid":"alert-group",children:[(0,t.jsx)(S.e,{size:"sm",isCollapsed:et,onToggle:()=>pt(!et),"data-testid":"alert-group-collapse-toggle"}),Object.keys(F.labels).length?(0,t.jsxs)(v.B,{direction:"row",alignItems:"center",children:[(0,t.jsx)(V.m,{labels:F.labels,size:"sm"}),N&&(0,t.jsxs)(u.P,{icon:"at",children:["Delivered to"," ",(0,t.jsx)(E.Y,{href:(0,L.bg)(vt,y),variant:"bodySmall",color:"primary",inline:!1,children:F.receiver.name})]})]}):(0,t.jsx)("span",{children:"No grouping"})]}),(0,t.jsx)(q,{group:F})]}),!et&&(0,t.jsx)(nt,{alertManagerSourceName:y,alerts:F.alerts})]})},tt=y=>({wrapper:(0,i.css)({"& + &":{marginTop:y.spacing(2)}}),header:(0,i.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:`${y.spacing(1)} ${y.spacing(1)} ${y.spacing(1)} 0`,backgroundColor:y.colors.background.secondary,width:"100%"}),group:(0,i.css)({display:"flex",flexDirection:"row",alignItems:"center"}),summary:(0,i.css)({}),[C.Or.Active]:(0,i.css)({color:y.colors.error.main}),[C.Or.Suppressed]:(0,i.css)({color:y.colors.primary.main}),[C.Or.Unprocessed]:(0,i.css)({color:y.colors.secondary.main})})},10685:(k,D,e)=>{e.d(D,{S:()=>o});var t=e(74848),i=e(94753);const o=({content:A})=>(0,t.jsx)(i.E,{color:"primary",children:A})},16293:(k,D,e)=>{e.d(D,{J:()=>j});var t=e(74848),i=e(32196),o=e(4213),A=e.n(o),v=e(96540),E=e(70713),C=e(40845),L=e(32372),V=e(55852),S=e(10534),u=e(72109),c=e(42418),l=e(84029);function j({format:d,textDefinition:p,downloadFileName:P,onClose:T}){const W=(0,C.of)(I),$=l.sl[d],X=(0,v.useCallback)(()=>{const O=new Blob([p],{type:`application/${d};charset=utf-8`});A()(O,`${P}.${d}`)},[p,P,d]),nt=(0,v.useMemo)(()=>$.formatter?$.formatter(p):p,[$,p]);return(0,t.jsxs)("div",{className:W.container,children:[(0,t.jsx)(R,{exportProvider:$}),(0,t.jsx)("div",{className:W.content,children:(0,t.jsx)(E.Ay,{disableWidth:!0,children:({height:O})=>(0,t.jsx)(L.B,{width:"100%",height:O,language:d,value:nt,monacoOptions:{minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",readOnly:!0}})})}),(0,t.jsxs)("div",{className:W.actions,children:[(0,t.jsx)(V.$n,{variant:"secondary",onClick:T,children:"Cancel"}),(0,t.jsx)(S.b,{icon:"copy",getText:()=>p,children:"Copy code"}),(0,t.jsx)(V.$n,{icon:"download-alt",onClick:X,children:"Download"})]})]})}const I=d=>({container:(0,i.css)({display:"flex",flexDirection:"column",height:"100%",gap:d.spacing(2)}),content:(0,i.css)({flex:"1 1 100%"}),actions:(0,i.css)({flex:0,justifyContent:"flex-end",display:"flex",gap:d.spacing(1)})});function R({exportProvider:d}){const{name:p,type:P}=d,T={file:{title:"File-provisioning format",component:(0,t.jsxs)(t.Fragment,{children:[p," format is only valid for File Provisioning."," ",(0,t.jsx)(u.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/file-provisioning/",external:!0,children:"Read more in the docs."})]})},api:{title:"API-provisioning format",component:(0,t.jsxs)(t.Fragment,{children:[p," format is only valid for API Provisioning."," ",(0,t.jsx)(u.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/http-api-provisioning/",external:!0,children:"Read more in the docs."})]})},terraform:{title:"Terraform-provisioning format",component:(0,t.jsxs)(t.Fragment,{children:[p," format is only valid for Terraform Provisioning."," ",(0,t.jsx)(u.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/terraform-provisioning/",external:!0,children:"Read more in the docs."})]})}},{title:W,component:$}=T[P];return(0,t.jsx)(c.F,{title:W,severity:"info",bottomSpacing:0,topSpacing:0,children:$})}},76648:(k,D,e)=>{e.d(D,{m:()=>A});var t=e(74848),i=e(87978),o=e(73716);function A({activeTab:v,onTabChange:E,children:C,onClose:L,formatProviders:V,title:S="Export"}){const u=Object.values(V).map(c=>({label:c.name,value:c.exportFormat}));return(0,t.jsx)(i._,{title:S,subtitle:"Select the format and download the file or copy the contents to clipboard",tabs:(0,t.jsx)(o.sb,{tabs:u,setActiveTab:E,activeTab:v}),onClose:L,size:"md",children:C})}},84029:(k,D,e)=>{e.d(D,{sl:()=>A});const t={name:"JSON",exportFormat:"json",type:"file",formatter:E=>{try{return JSON.stringify(JSON.parse(E),null,4)}catch{return E}}},i={name:"YAML",exportFormat:"yaml",type:"file"},o={name:"Terraform (HCL)",exportFormat:"hcl",type:"terraform"},A={[t.exportFormat]:t,[i.exportFormat]:i,[o.exportFormat]:o},v=[t,i]},4724:(k,D,e)=>{e.d(D,{Hy:()=>C,IT:()=>L,av:()=>S,oB:()=>V});var t=e(74848),i=e(95093),o=e.n(i),A=e(96540),v=e(98164);const E=/^((([01][0-9])|(2[0-3])):[0-5][0-9])$|(^24:00$)/,C=u=>u?E.test(u):!0,L=u=>[...u.mute_time_intervals??[],...u.time_intervals??[]],V=(u,c)=>{if(!u&&!c)return!0;if(!u&&c||u&&!c)return!1;const l="HH:mm",j=o()().startOf("day").add(u,l),I=o()().startOf("day").add(c,l);return!!(u&&c&&j.isBefore(I)||u&&c&&I.isAfter(j))};function S(u){return u.time_intervals.map((l,j)=>{const{times:I,weekdays:R,days_of_month:d,months:p,years:P,location:T}=l,W=(0,v.Dm)(I,T),$=(0,v.uH)(R),X=(0,v.UL)(d),nt=(0,v.$P)(p),O=(0,v.mP)(P);return(0,t.jsxs)(A.Fragment,{children:[`${W} ${$}`,(0,t.jsx)("br",{}),[X,nt,O].join(" | "),(0,t.jsx)("br",{})]},JSON.stringify(l)+j)})}},26928:(k,D,e)=>{e.d(D,{s:()=>S});var t=e(74848),i=e(32196),o=e(2543),A=e.n(o),v=e(40845),E=e(67061),C=e(69613),L=e(32642),V=e(35108);const S=({matchers:l,formatter:j="default"})=>{const I=(0,v.of)(c),R=5,d=(0,o.take)(l,R),p=(0,o.takeRight)(l,l.length-R),P=p.length>0;return(0,t.jsx)("span",{"data-testid":"label-matchers",children:(0,t.jsxs)(E.B,{direction:"row",gap:1,alignItems:"center",wrap:"wrap",children:[d.map(T=>(0,t.jsx)(u,{matcher:T,formatter:j},(0,o.uniqueId)())),P&&(0,t.jsx)(V.j,{arrow:!0,placement:"top",content:(0,t.jsx)(t.Fragment,{children:p.map(T=>(0,t.jsx)(u,{matcher:T},(0,o.uniqueId)()))}),children:(0,t.jsx)("span",{children:(0,t.jsx)("div",{className:I.metadata,children:`and ${p.length} more`})})})]})})},u=({matcher:l,formatter:j="default"})=>{const I=(0,v.of)(c);return(0,t.jsx)("div",{className:I.matcher(l[0]).wrapper,children:(0,t.jsx)(E.B,{direction:"row",gap:0,alignItems:"baseline",children:L.t8[j](l)})})},c=l=>({matcher:j=>{const{color:I,borderColor:R}=(0,C.MC)(j);return{wrapper:(0,i.css)({color:"#fff",background:I,padding:`${l.spacing(.33)} ${l.spacing(.66)}`,fontSize:l.typography.bodySmall.fontSize,border:`solid 1px ${R}`,borderRadius:l.shape.borderRadius(2),whiteSpace:"pre"})}},metadata:(0,i.css)({color:l.colors.text.secondary,fontSize:l.typography.bodySmall.fontSize,fontWeight:l.typography.bodySmall.fontWeight})})},33915:(k,D,e)=>{e.d(D,{V:()=>c});var t=e(74848),i=e(96540),o=e(10354),A=e(14578),v=e(35108),E=e(32196),C=e(40845),L=e(41068);function V(){const l=(0,C.of)(u);return(0,t.jsxs)("div",{children:["Prometheus duration format consist of a number followed by a time unit.",(0,t.jsx)("br",{}),"Different units can be combined for more granularity.",(0,t.jsx)("hr",{}),(0,t.jsxs)("div",{className:l.list,children:[(0,t.jsxs)("div",{className:l.header,children:[(0,t.jsx)("div",{children:"Symbol"}),(0,t.jsx)("div",{children:"Time unit"}),(0,t.jsx)("div",{children:"Example"})]}),(0,t.jsx)(S,{unit:L.y.seconds,name:"seconds",example:"20s"}),(0,t.jsx)(S,{unit:L.y.minutes,name:"minutes",example:"10m"}),(0,t.jsx)(S,{unit:L.y.hours,name:"hours",example:"4h"}),(0,t.jsx)(S,{unit:L.y.days,name:"days",example:"3d"}),(0,t.jsx)(S,{unit:L.y.weeks,name:"weeks",example:"2w"}),(0,t.jsxs)("div",{className:l.examples,children:[(0,t.jsx)("div",{children:"Multiple units combined"}),(0,t.jsx)("code",{children:"1m30s, 2h30m20s, 1w2d"})]})]})]})}function S({unit:l,name:j,example:I}){const R=(0,C.of)(u);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:R.unit,children:l}),(0,t.jsx)("div",{children:j}),(0,t.jsx)("code",{children:I})]})}const u=l=>({unit:(0,E.css)({fontWeight:l.typography.fontWeightBold}),list:(0,E.css)({display:"grid",gridTemplateColumns:"max-content 1fr 2fr",gap:l.spacing(1,3)}),header:(0,E.css)({display:"contents",fontWeight:l.typography.fontWeightBold}),examples:(0,E.css)({display:"contents","& > div":{gridColumn:"1 / span 2"}})}),c=(0,i.forwardRef)((l,j)=>(0,t.jsx)(o.p,{suffix:(0,t.jsx)(v.j,{content:(0,t.jsx)(V,{}),disabled:!1,children:(0,t.jsx)(A.I,{name:"info-circle",size:"lg"})}),...l,ref:j}));c.displayName="PromDurationInput"},99903:(k,D,e)=>{e.d(D,{t:()=>i});var t=e(32196);const i=o=>({container:(0,t.css)({alignItems:"center",display:"flex",flexFlow:"row nowrap","& > * + *":{marginLeft:o.spacing(1)}}),input:(0,t.css)({flex:1}),promDurationInput:(0,t.css)({maxWidth:o.spacing(32)}),timingFormContainer:(0,t.css)({padding:o.spacing(1)}),linkText:(0,t.css)({textDecoration:"underline"}),collapse:(0,t.css)({border:"none",background:"none",color:o.colors.text.primary})})},97174:(k,D,e)=>{e.d(D,{G:()=>t});const t={groupWait:{label:"Group wait",description:"The wait time before sending the first notification for a new group of alerts. If empty, it is inherited from the parent policy.",ariaLabel:"Group wait value"},groupInterval:{label:"Group interval",description:"The wait time before sending a notification about changes in the alert group after the first notification has been sent. If empty, it is inherited from the parent policy.",ariaLabel:"Group interval value"},repeatInterval:{label:"Repeat interval",description:"The wait time before resending a notification that has already been sent successfully.",ariaLabel:"Repeat interval value"}}},27835:(k,D,e)=>{e.d(D,{H:()=>t});const t={group_wait:"30s",group_interval:"5m",repeat_interval:"4h"}},73716:(k,D,e)=>{e.d(D,{G_:()=>p,sb:()=>P});var t=e(74848),i=e(32196),o=e(20382),A=e(96540),v=e(49785),E=e(70713),C=e(40845),L=e(87978),V=e(63021),S=e(40675),u=e(55852),c=e(56034),l=e(14578),j=e(32372),I=e(63066),R=e(23662);const d=[{label:"Yaml",value:"yaml"}],p=({onClose:O})=>{const[h,U]=(0,A.useState)("yaml"),{setValue:Y}=(0,v.xW)(),q=(0,C.of)(nt),st=tt=>{for(const y in tt)Y(y,tt[y]);O()};return(0,t.jsx)(L._,{title:"Inspect Alert rule",subtitle:(0,t.jsx)("div",{className:q.subtitle,children:(0,t.jsx)(P,{tabs:d,setActiveTab:U,activeTab:h})}),onClose:O,children:h==="yaml"&&(0,t.jsx)(T,{onSubmit:st})})};function P({tabs:O,activeTab:h,setActiveTab:U}){return(0,t.jsx)(V.U,{children:O.map((Y,q)=>(0,t.jsx)(S.o,{label:Y.label,value:Y.value,onChangeTab:()=>U(Y.value),active:h===Y.value},`${Y.value}-${q}`))})}const T=({onSubmit:O})=>{const h=(0,C.of)(X),{getValues:U}=(0,v.xW)(),Y=(0,I.l1)(U()),[q,st]=(0,A.useState)((0,o.Bh)(Y)),tt=()=>{const y=(0,o.Hh)(q),F=U(),et=$(y);O({...F,...et})};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:h.applyButton,children:[(0,t.jsx)(u.$n,{type:"button",onClick:tt,children:"Apply"}),(0,t.jsx)(c.m,{content:(0,t.jsx)(W,{}),theme:"info",placement:"left-start",interactive:!0,children:(0,t.jsx)(l.I,{name:"exclamation-triangle",size:"xl"})})]}),(0,t.jsx)("div",{className:h.content,children:(0,t.jsx)(E.Ay,{disableWidth:!0,children:({height:y})=>(0,t.jsx)(j.B,{width:"100%",height:y,language:"yaml",value:q,onBlur:st,monacoOptions:{minimap:{enabled:!1}}})})})]})};function W(){return(0,t.jsxs)("div",{children:["The YAML content in the editor only contains alert rule configuration ",(0,t.jsx)("br",{}),"To configure Prometheus, you need to provide the rest of the"," ",(0,t.jsx)("a",{href:"https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/",target:"_blank",rel:"noreferrer",children:"configuration file content."})]})}function $(O){return(0,R.$y)(O)?(0,I.Qk)(O):(0,R.i7)(O)?(0,I.XI)(O):{}}const X=O=>({content:(0,i.css)({flexGrow:1,height:"100%",paddingBottom:"16px",marginBottom:O.spacing(2)}),applyButton:(0,i.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexGrow:0,marginBottom:O.spacing(2)})}),nt=()=>({subtitle:(0,i.css)({display:"flex",alignItems:"center",justifyContent:"space-between"})})},51488:(k,D,e)=>{e.d(D,{f:()=>i});var t=e(82843);function i(o,A){const v=t.m.endpoints.getAlertmanagerConfiguration.useQuery(o??"",{refetchOnMountOrArgChange:!0,...A,skip:!o});return{...v,error:v.error}}},19645:(k,D,e)=>{e.d(D,{M:()=>t});const t={discord:"discord",email:"envelope",googlechat:"google-hangouts-alt",hipchat:"hipchat",line:"line",pagerduty:"pagerduty",slack:"slack",teams:"microsoft",telegram:"telegram-alt",webhook:"link",sns:"amazon"}},19143:(k,D,e)=>{e.d(D,{L:()=>V});var t=e(14590),i=e(96540),o=e(25027),A=e(67278);const v=()=>new A.c(new URL(e.p+e.u(5398),e.b));let E;function C(){let S;if(E===void 0)try{S=v(),E=t.LV(S)}catch(c){c instanceof Error&&(0,o.vV)(c)}return{disposeWorker:()=>{S&&E&&(E[t.A2](),S.terminate(),E=void 0,S=void 0)}}}function L(S){if(!E)throw new Error("Route Matcher has not been initialized")}function V(){(0,i.useEffect)(()=>{const{disposeWorker:c}=C();return c},[]);const S=(0,i.useCallback)(async(c,l,j)=>{L(E);const I=performance.now(),R=await E.getRouteGroupsMap(c,l,j),d=performance.now()-I;return(0,o.fH)(`Route Groups Matched in  ${d} ms`,{matchingTime:d.toString(),alertGroupsCount:l.length.toString(),topLevelRoutesCount:c.routes?.length.toString()??"0"}),R},[]),u=(0,i.useCallback)(async(c,l,j)=>{L(E);const I=performance.now(),R=await E.matchInstancesToRoute(c,l,j),d=performance.now()-I;return(0,o.fH)(`Instances Matched in  ${d} ms`,{matchingTime:d.toString(),instancesToMatchCount:l.length.toString(),topLevelRoutesCount:c.routes?.length.toString()??"0"}),R},[]);return{getRouteGroupsMap:S,matchInstancesToRoute:u}}},79657:(k,D,e)=>{e.d(D,{DY:()=>O,Mk:()=>P,QM:()=>R,Rg:()=>c,SJ:()=>p,YE:()=>d,Yl:()=>j,eb:()=>W,gY:()=>T,hH:()=>X,ie:()=>$});var t=e(2543),i=e.n(t),o=e(60021),A=e(98164),v=e(57220),E=e(32642),C=e(67332),L=e(25968);const V=(h,U)=>Object.entries(h??{}).reduce((Y,[q,st])=>[...Y,{name:q,value:st,operator:U?o.ho.regex:o.ho.equal}],[]),S=h=>h.value,u=h=>(h??[]).map(S),c={name:"",value:"",operator:o.ho.equal},l=["grafana_folder","alertname"],j=[{label:"grafana_folder",value:"grafana_folder",isFixed:!0},{label:"alertname",value:"alertname",isFixed:!0},{label:"Disable (...)",value:"..."}],I={id:"",overrideGrouping:!1,groupBy:l,object_matchers:[],routes:[],continue:!1,receiver:"",overrideTimings:!1,groupWaitValue:"",groupIntervalValue:"",repeatIntervalValue:"",muteTimeIntervals:[]};function R(h){return{id:(0,t.uniqueId)("route-"),...h,routes:(h.routes??[]).map(R)}}const d=h=>{if(!h)return I;const U="id"in h?h.id:(0,t.uniqueId)("route-");if(Object.keys(h).length===0)return{...I,id:U};const Y=[];h.routes?.forEach(tt=>{const y=d(tt);Y.push(y)});const q=h.object_matchers?.map(tt=>({name:tt[0],operator:tt[1],value:tt[2]}))??[],st=h.matchers?.flatMap(tt=>(0,E.So)(tt).flatMap(A.MU)).map(({name:tt,operator:y,value:F})=>({name:(0,E.Ig)(tt),operator:y,value:(0,E.Ig)(F)}))??[];return{id:U,object_matchers:[...st,...q,...V(h.match,!1),...V(h.match_re,!0)],continue:h.continue??!1,receiver:h.receiver??"",overrideGrouping:Array.isArray(h.group_by)&&h.group_by.length>0,groupBy:h.group_by??void 0,overrideTimings:[h.group_wait,h.group_interval,h.repeat_interval].some(Boolean),groupWaitValue:h.group_wait??"",groupIntervalValue:h.group_interval??"",repeatIntervalValue:h.repeat_interval??"",routes:Y,muteTimeIntervals:h.mute_time_intervals??[]}},p=(h,U,Y)=>{const q=(0,C.eM)(U.id??"",Y),{overrideGrouping:st,groupBy:tt,overrideTimings:y,groupWaitValue:F,groupIntervalValue:et,repeatIntervalValue:pt,receiver:it}=U,N=void 0,vt=st?tt:N,ie=y&&F?F:N,ce=y&&et?et:N,Qt=y&&pt?pt:N,Wt=U.object_matchers?.filter(xt=>xt.name&&xt.operator&&xt.value!==null&&xt.value!==void 0).map(({name:xt,operator:ue,value:me})=>[xt,ue,me]),Lt=U.routes?.map(xt=>p(h,xt,Y)),jt={...q??{},continue:U.continue,group_by:vt,object_matchers:Wt,match:void 0,match_re:void 0,group_wait:ie,group_interval:ce,repeat_interval:Qt,routes:Lt,mute_time_intervals:U.muteTimeIntervals,receiver:it};return h!==v.hY?(jt.matchers=U.object_matchers?.map(E.b2),jt.object_matchers=void 0):(jt.object_matchers=(0,E.J$)(jt),jt.matchers=void 0),U.receiver&&(jt.receiver=U.receiver),jt},P=h=>({label:h,value:h}),T=h=>(h??[]).map(P),W=h=>h===null?null:h?S(h)??"":"",$=h=>h?u(h):[];function X(h){return!h||h.length===0?!0:(0,L.TN)(h)||"Invalid duration format. Must be {number}{time_unit}"}const nt=h=>h.map(U=>{const[Y,q,st]=U;return`${Y}${q}${st}`}),O=(h,U="")=>{if(h.length===0)return!0;const Y=X(h),q=X(U);if(Y!==!0)return Y;if(q!==!0)return q;const st=(0,L.P8)(h),tt=(0,L.P8)(U);return tt!==0&&st<tt?"Repeat interval should be higher or equal to Group interval":!0}},54486:(k,D,e)=>{e.d(D,{KR:()=>A,Ww:()=>E,d6:()=>u,iF:()=>L,jU:()=>o,jb:()=>S,oU:()=>v});var t=e(2543),i=e.n(t);const o=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],A=["january","february","march","april","may","june","july","august","september","october","november","december"],v={times:[{start_time:"",end_time:""}],weekdays:"",days_of_month:"",months:"",years:"",location:"",disable:!1},E=(c,l,j)=>c?c.split(",").map(I=>I.trim()).every(I=>I.split(":").every(l))||j:!0,C=c=>c?c.split(",").map(l=>l.trim()):void 0,L=c=>{const l=c.time_intervals.map(({times:j,weekdays:I,days_of_month:R,months:d,years:p,location:P,disable:T})=>{const W={times:V(j,T),weekdays:C(I)?.map($=>$.toLowerCase()),days_of_month:C(R),months:C(d),years:C(p),location:P||void 0};return(0,t.omitBy)(W,t.isUndefined)});return{name:c.name,time_intervals:l}};function V(c,l){if(l)return[];const j=c?.filter(({start_time:I,end_time:R})=>!!I&&!!R);return j?.length?j:void 0}function S(c){return c.times?.length===0||c.weekdays?.length===0||c.days_of_month?.length===0||c.months?.length===0||c.years?.length===0}function u(c){return c.time_intervals.every(l=>S(l))}},79581:(k,D,e)=>{e.d(D,{W$:()=>c,_I:()=>l,rJ:()=>V});var t=e(2543),i=e.n(t),o=e(60021),A=e(32642);const v=["receiver","group_by","group_wait","group_interval","repeat_interval"];function E(d,p){const P=C(d,p),T=new Map(p.map(W=>[W,{match:!1,matcher:null}]));return d.forEach(W=>{const $=p.find(X=>R(W,X));$&&T.set($,{match:!0,matcher:W})}),{matches:P,labelsMatch:T}}function C(d,p){for(const P of d)if(!I(P,p))return!1;return!0}function L(d,p){let P=[];const T=E(d.object_matchers??[],p);if(!T.matches)return[];if(d.routes)for(const W of d.routes){let $=L(W,p);if(P=P.concat($),$.length&&!W.continue)break}return P.length===0&&P.push({route:d,labelsMatch:T.labelsMatch}),P}function V(d){function p(T){T.object_matchers=(0,A.J$)(T),delete T.matchers,delete T.match,delete T.match_re,T.routes?.forEach(p)}const P=structuredClone(d);return p(P),P}function S(d){function p(T){T.object_matchers=T.object_matchers?.map(([W,$,X])=>[unquoteWithUnescape(W),$,unquoteWithUnescape(X)]),T.routes?.forEach(p)}const P=structuredClone(d);return p(P),P}function u(d,p,P){const T=[];return P.reduce((W,$)=>{const X=$.alerts.filter(nt=>{const O=Object.entries(nt.labels);return L(d,O).some(h=>h.route===p)});return X.length&&W.push({...$,alerts:X}),W},T)}function c(d,p,P){const W={...(0,t.pick)(d,v),...P};return(0,t.reduce)(W,(X,nt,O)=>{const h=nt!=null,q=[void 0,"",null].some(y=>p[O]===y)&&h,st=O==="group_by"&&h&&(0,t.isArray)(p[O])&&p[O]?.length===0;return(q||st)&&(X[O]=nt),X},{})}function l(d){return{...d,routes:d.routes?.map(p=>{const P=c(d,p);return l({...p,...P})})}}const j={[o.ho.equal]:(d,p)=>d===p,[o.ho.notEqual]:(d,p)=>d!==p,[o.ho.regex]:(d,p)=>new RegExp(`^(?:${p})$`).test(d),[o.ho.notRegex]:(d,p)=>!new RegExp(`^(?:${p})$`).test(d)};function I(d,p){const[P,T,W]=d;let $="";const X=Object.fromEntries(p)[P];X&&($=X);const nt=j[T];if(!nt)throw new Error(`no such operator: ${T}`);return nt($,W)}function R(d,p){let[P,T]=p;const[W,$,X]=d;if(P!==W)return!1;const nt=j[$];if(!nt)throw new Error(`no such operator: ${$}`);return nt(T,X)}},67332:(k,D,e)=>{e.d(D,{AB:()=>E,AS:()=>C,I8:()=>L,dn:()=>S,eM:()=>u});var t=e(1932),i=e(2543),o=e.n(i),A=e(14588),v=e(79657);const E=(c,l,j)=>{if(!u(l.id??"",j))throw new Error(`No such route with ID '${l.id}'`);function R(d){let p=d;if(d.id===l.id){const P=(0,v.SJ)(c,l,j);p={...d,...P}}return{...p,routes:d.routes?.map(R)}}return R(j)},C=(c,l)=>{if(c.id===l.id)throw new Error("You cant remove the root policy");function j(I){return{...I,routes:I.routes?.reduce((R=[],d)=>(d.id===c.id||R.push(j(d)),R),[])}}return j(l)},L=(c,l,j,I,R)=>{const d=(0,v.SJ)(c,l,I);return(0,t.jM)(I,p=>{const[P,T,W]=V(p,j);if(P===void 0||T===void 0||W===void 0)throw new Error(`could not find reference route "${j.id}" in tree`);R==="child"&&(P.routes?P.routes.push(d):P.routes=[d]),R==="above"&&(T.routes=(0,A.insertBeforeImmutably)(T.routes??[],d,W)),R==="below"&&(T.routes=(0,A.insertAfterImmutably)(T.routes??[],d,W))})};function V(c,l){let j,I,R;function d(p,P,T){j||(p.id===l.id&&(j=p,I=T,R=P),p.routes&&p.routes.forEach((W,$)=>d(W,$,p)))}return d(c,0,c),[j,I,R]}function S(c){return(0,i.omit)({...c,routes:c.routes?.map(l=>S(l))},"id")}function u(c,l){return l.id===c?l:l.routes?.find(j=>u(c,j))}}}]);

//# sourceMappingURL=AlertAmRoutes.bc19e9825d0e5d427229.js.map