"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7049],{99226:(De,ie,t)=>{t.d(ie,{gv:()=>$});var e=t(74848),i=t(2543),R=t.n(i),S=t(32264),B=t(67061),f=t(55852),P=t(25968);const M=S.$.unifiedAlerting.minInterval??"10s",Q=((Y=M)=>{const L=[(0,P.M9)("10s"),(0,P.M9)("30s"),(0,P.M9)("1m"),(0,P.M9)("5m"),(0,P.M9)("10m"),(0,P.M9)("15m"),(0,P.M9)("30m"),(0,P.M9)("1h")],I=(0,P.P8)(Y),Z=L.filter(A=>I<=A),ue=(0,i.times)(8-Z.length,A=>{const ce=(0,i.last)(Z)??I,k=Z.length===0?1:2;return ce*k*(A+1)});return[...Z,...ue].map(P.an)})(M),$=({currentInterval:Y,onSelect:X})=>(0,e.jsx)(B.B,{direction:"row",gap:.5,role:"listbox",children:Q.map(L=>{const I=Y===L;return(0,e.jsx)(f.$n,{role:"option","aria-selected":I,variant:I?"primary":"secondary",size:"sm",onClick:()=>X(L),children:L},L)})})},1723:(De,ie,t)=>{t.d(ie,{R:()=>Ae,I:()=>K});var e=t(74848),i=t(32196),R=t(96540),S=t(49785),B=t(40845),f=t(67061),P=t(29158),M=t(88575),z=t(60029),Q=t(10354),$=t(94753),Y=t(15292),X=t(56034),L=t(14578),I=t(8484),Z=t(25027),ue=t(9518),A=t(61410),ce=t(57220),k=t(25968),xe=t(64047),de=t(22040),ne=t(2543),pe=t(26272),q=t(13544),_=t(55852),Se=t(90182),Fe=t(90613),me=t(37390),Oe=t(28138),Pe=t(16233),je=t(11230),U=t(31678),be=t(79938),Le=t(730),ye=t(63066),Ne=t(23662),we=t(48205),re=t(99226),Ke=t(85242);const Ee=()=>{const a=(0,B.of)(Me),n=()=>window.open("https://github.com/grafana/grafana/issues/42947","_blank");return(0,e.jsxs)(f.B,{gap:.5,children:[(0,e.jsx)("div",{className:a.slashNotAllowed,children:"Folders with '/' character are not allowed."}),(0,e.jsx)(X.m,{placement:"top",content:"Link to the Github issue",theme:"info",children:(0,e.jsx)(L.I,{name:"info-circle",size:"xs",className:a.infoIcon,onClick:n})})]})},Ie=a=>a.indexOf("/")!==-1;function Ve(a){const{value:n}=a,r={warningCondition:l=>Ie(l),warningComponent:Ee},u={disallowValues:!0,isAllowedValue:l=>!Ie(l)};return(0,e.jsx)(Ke.sR,{showRoot:!1,rootName:"",allowEmpty:!0,initialFolderUid:n?.uid,searchQueryType:U.SearchQueryType.AlertFolder,...a,permissionLevel:U.PermissionLevelString.Edit,customAdd:u,folderWarning:r})}const Me=a=>({slashNotAllowed:(0,i.css)({color:a.colors.warning.main,fontSize:"12px",marginBottom:"2px"}),infoIcon:(0,i.css)({color:a.colors.warning.main,fontSize:"12px",marginBottom:"2px",cursor:"pointer"})});var Te=t(7921);const Be=1e3,s=(a,n)=>{const{isLoading:o,currentData:r}=be.hK.endpoints.rulerNamespace.useQuery({namespace:a,rulerConfig:Le.$q},{skip:!a,refetchOnMountOrArgChange:!0});return{groupOptions:(0,R.useMemo)(()=>r?(Object.values(r).flat()??[]).map(m=>{const g=c(m);return{label:m.name,value:m.name,description:m.interval??ye.T6,isDisabled:n?!1:g,isProvisioned:g}}).sort(d):[],[r,n]),loading:o}},c=a=>a.rules.some(n=>(0,Ne.lT)(n)&&!!n.grafana_alert.provenance),d=(a,n)=>a.label?.localeCompare(n.label??"")||0,j=(a,n)=>a.label?.toLowerCase().includes(n.toLowerCase());function C({groupfoldersForGrafana:a,enableProvisionedGroups:n}){const{formState:{errors:o},watch:r,setValue:u,control:l}=(0,S.xW)(),m=(0,B.of)(p),g=r("folder"),N=r("group"),{groupOptions:E,loading:h}=s(g?.uid??"",n),[v,G]=(0,R.useState)(!1),[b,T]=(0,R.useState)(!1),H=()=>G(!0),V=()=>T(!0),W=x=>{he(),u("folder",x),G(!1)},ve=(x,ae)=>{u("group",x),u("evaluateEvery",ae),T(!1)},he=(0,R.useCallback)(()=>{u("group","")},[u]),le=(0,R.useCallback)(async x=>{const ae=x?E.filter(Re=>j(Re,x)):E;return(0,ne.take)(ae,Be)},[E]),$e=(0,R.useMemo)(()=>(0,ne.debounce)(le,300,{leading:!0}),[le]),Ue=N?{value:N,label:N}:void 0;return(0,e.jsxs)("div",{className:m.container,children:[(0,e.jsxs)(f.B,{alignItems:"center",children:[(0,e.jsx)(M.D,{label:(0,e.jsx)(z.J,{htmlFor:"folder",description:"Select a folder to store your rule.",children:"Folder"}),className:m.formInput,error:o.folder?.message,"data-testid":"folder-picker",children:(0,e.jsx)(f.B,{direction:"row",alignItems:"center",children:!v&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(S.xI,{render:({field:{ref:x,...ae}})=>(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(Ve,{inputId:"folder",invalid:!!o.folder?.message,...ae,enableReset:!0,onChange:({title:Re,uid:fe})=>{ae.onChange({title:Re,uid:fe}),he()}})}),name:"folder",rules:{required:{value:!0,message:"Select a folder"},validate:{pathSeparator:x=>(0,Te.G0)(x.uid)}}}),(0,e.jsx)($.E,{color:"secondary",children:"or"}),(0,e.jsx)(_.$n,{onClick:H,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!Pe.TP.hasPermission(U.AccessControlAction.FoldersCreate),"data-testid":q.Tp.components.AlertRules.newFolderButton,children:"New folder"})]})||(0,e.jsx)("div",{children:"Creating new folder..."})})}),v&&(0,e.jsx)(F,{onCreate:W,onClose:()=>G(!1)})]}),v&&(0,e.jsx)(F,{onCreate:W,onClose:()=>G(!1)}),(0,e.jsxs)(f.B,{alignItems:"center",children:[(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(M.D,{label:"Evaluation group and interval","data-testid":"group-picker",description:"Define how often the alert rule is evaluated.",className:m.formInput,error:o.group?.message,invalid:!!o.group?.message,children:(0,e.jsx)(S.xI,{render:({field:{ref:x,...ae},fieldState:Re})=>(0,e.jsx)(Se.DW,{disabled:!g||h,inputId:"group",...ae,onChange:fe=>{ae.onChange(fe.label??"")},isLoading:h,invalid:!!g&&!N&&!!Re.error,loadOptions:$e,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:Ue,defaultOptions:E,getOptionLabel:fe=>(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:fe.label}),fe.isProvisioned&&(0,e.jsxs)(e.Fragment,{children:[" ",(0,e.jsx)(we.rS,{})]})]}),placeholder:"Select an evaluation group..."},(0,ne.uniqueId)()),name:"group",control:l,rules:{required:{value:!0,message:"Must enter a group name"},validate:{pathSeparator:x=>(0,Te.G0)(x)}}})})}),(0,e.jsxs)(Fe.a,{marginTop:4,gap:1,display:"flex",alignItems:"center",children:[(0,e.jsx)($.E,{color:"secondary",children:"or"}),(0,e.jsx)(_.$n,{onClick:V,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!g,"data-testid":q.Tp.components.AlertRules.newEvaluationGroupButton,children:"New evaluation group"})]}),b&&(0,e.jsx)(O,{onCreate:ve,onClose:()=>T(!1),groupfoldersForGrafana:a})]})]})}function F({onClose:a,onCreate:n}){const o=(0,B.of)(p),[r,u]=(0,R.useState)(""),l=async()=>{const g=await(0,je.vV)({title:r});if(!g.uid){Oe.A.emit(pe.r1.alertError,["Folder could not be created"]);return}const N={title:g.title,uid:g.uid};n(N),Oe.A.emit(pe.r1.alertSuccess,["Folder Created","OK"])},m=Ie(r);return(0,e.jsxs)(me.a,{className:o.modal,isOpen:!0,title:"New folder",onDismiss:a,onClickBackdrop:a,children:[(0,e.jsx)("div",{className:o.modalTitle,children:"Create a new folder to store your rule"}),(0,e.jsxs)("form",{onSubmit:l,children:[(0,e.jsx)(M.D,{label:(0,e.jsx)(z.J,{htmlFor:"folder",children:"Folder name"}),error:"The folder name can't contain slashes",invalid:m,children:(0,e.jsx)(Q.p,{"data-testid":q.Tp.components.AlertRules.newFolderNameField,autoFocus:!0,id:"folderName",placeholder:"Enter a name",value:r,onChange:g=>u(g.currentTarget.value),className:o.formInput})}),(0,e.jsxs)(me.a.ButtonRow,{children:[(0,e.jsx)(_.$n,{variant:"secondary",type:"button",onClick:a,children:"Cancel"}),(0,e.jsx)(_.$n,{type:"submit",disabled:!r||m,"data-testid":q.Tp.components.AlertRules.newFolderNameCreateButton,children:"Create"})]})]})]})}function O({onClose:a,onCreate:n,groupfoldersForGrafana:o}){const r=(0,B.of)(p),u=()=>{n(V("group"),V("evaluateEvery"))},{watch:l}=(0,S.xW)(),m="eval-every-input",[g,N]=l(["group","folder.title"]),E=(o&&o[N]?.find(le=>le.name===g)?.rules)??[],h=()=>{a()},v=(0,S.mN)({defaultValues:{group:"",evaluateEvery:ye.T6},mode:"onChange",shouldFocusError:!0}),{register:G,handleSubmit:b,formState:T,setValue:H,getValues:V,watch:W}=v,ve=W("evaluateEvery"),he=le=>{H("evaluateEvery",le,{shouldValidate:!0})};return(0,e.jsxs)(me.a,{className:r.modal,isOpen:!0,title:"New evaluation group",onDismiss:h,onClickBackdrop:h,children:[(0,e.jsx)("div",{className:r.modalTitle,children:"Create a new evaluation group to use for this alert rule."}),(0,e.jsx)(S.Op,{...v,children:(0,e.jsxs)("form",{onSubmit:b(()=>u()),children:[(0,e.jsx)(M.D,{label:(0,e.jsx)(z.J,{htmlFor:"group",description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group"}),error:T.errors.group?.message,invalid:!!T.errors.group,children:(0,e.jsx)(Q.p,{"data-testid":q.Tp.components.AlertRules.newEvaluationGroupName,className:r.formInput,autoFocus:!0,id:"group",placeholder:"Enter a name",...G("group",{required:{value:!0,message:"Required."}})})}),(0,e.jsx)(M.D,{error:T.errors.evaluateEvery?.message,invalid:T.errors.evaluateEvery?!0:void 0,label:(0,e.jsx)(z.J,{htmlFor:m,description:"How often all rules in the group are evaluated.",children:"Evaluation interval"}),children:(0,e.jsxs)(f.B,{direction:"column",children:[(0,e.jsx)(Q.p,{"data-testid":q.Tp.components.AlertRules.newEvaluationGroupInterval,className:r.formInput,id:m,placeholder:ye.T6,...G("evaluateEvery",(0,de.iS)(E))}),(0,e.jsx)(f.B,{direction:"row",alignItems:"flex-end",children:(0,e.jsx)(re.gv,{currentInterval:ve,onSelect:he})})]})}),(0,e.jsxs)(me.a.ButtonRow,{children:[(0,e.jsx)(_.$n,{variant:"secondary",type:"button",onClick:h,children:"Cancel"}),(0,e.jsx)(_.$n,{type:"submit",disabled:!T.isValid,"data-testid":q.Tp.components.AlertRules.newEvaluationGroupCreate,children:"Create"})]})]})})]})}const p=a=>({container:(0,i.css)({display:"flex",flexDirection:"column",alignItems:"baseline",maxWidth:`${a.breakpoints.values.lg}px`,justifyContent:"space-between"}),formInput:(0,i.css)({flexGrow:1}),modal:(0,i.css)({width:`${a.breakpoints.values.sm}px`}),modalTitle:(0,i.css)({color:a.colors.text.secondary,marginBottom:a.spacing(2)})});var y=t(94822);const D=[{value:y.Q8.Alerting,label:"Alerting"},{value:y.Q8.NoData,label:"No Data"},{value:y.Q8.OK,label:"Normal"},{value:y.Q8.Error,label:"Error"},{value:y.Q8.KeepLast,label:"Keep Last State"}],oe=({includeNoData:a,includeError:n,...o})=>{const r=(0,R.useMemo)(()=>a?n?D:D.filter(u=>u.value!==y.Q8.Error):D.filter(u=>u.value!==y.Q8.NoData),[a,n]);return(0,e.jsx)(Se.l6,{options:r,...o})};var J=t(19338);function ee(a){const n=(0,k.P8)(a);return[0,n*1,n*2,n*3,n*4,n*5].map(k.an)}function se({selectedPendingPeriod:a,groupEvaluationInterval:n,onSelect:o}){const r=l=>a===l,u=ee(n);return(0,e.jsx)(f.B,{direction:"row",gap:.5,role:"listbox",children:u.map(l=>(0,e.jsx)(_.$n,{role:"option","aria-selected":r(l),variant:r(l)?"primary":"secondary",size:"sm",onClick:()=>{o(l)},children:l==="0s"?"None":l},l))})}var te=t(271);const K=10,Ce=a=>({required:{value:!0,message:"Required."},validate:n=>{if(n==="0")return!0;try{const o=(0,k.M9)(n);if(o===0)return!0;try{const r=(0,k.M9)(a);return o>=r?!0:(0,I.t)("alert-rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(o){return o instanceof Error?o.message:(0,I.t)("alert-rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}}),ge=(a,n)=>{const{groupOptions:o}=s(a,!1);return!(0,R.useCallback)(u=>o.some(l=>l.label===u),[o])(n)};function w({evaluateEvery:a,setEvaluateEvery:n,enableProvisionedGroups:o}){const r=(0,B.of)(Ge),{watch:u,setValue:l,getValues:m}=(0,S.xW)(),[g,N]=(0,R.useState)(!1),[E,h,v]=u(["group","folder.uid","folder.title"]),b=(0,A.$)(x=>x.rulerRules)[ce.hY],H=(0,ue.dy)(ce.hY).find(x=>x.uid===h),V=H?.groups.find(x=>x.name===E),W=ge(h??"",E);(0,R.useEffect)(()=>{!W&&V?.interval&&n(V.interval)},[n,W,l,V]);const ve=(x=!1)=>{x||(0,Z.fH)(Z.le.leavingRuleGroupEdit),N(!1)},he=()=>N(!0),le=b?.loading||W||!h||!E,$e={name:v,rulesSource:ce.hY,groups:[]},Ue={name:E,interval:a,rules:[],totals:{}};return(0,e.jsxs)("div",{children:[(0,e.jsx)(C,{groupfoldersForGrafana:b?.result,enableProvisionedGroups:o}),v&&g&&(0,e.jsx)(de.u5,{namespace:H??$e,group:V??Ue,folderUid:h,onClose:()=>ve(),intervalEditOnly:!0,hideFolder:!0}),v&&E&&(0,e.jsx)("div",{className:r.evaluationContainer,children:(0,e.jsx)(f.B,{direction:"column",gap:0,children:(0,e.jsx)("div",{className:r.marginTop,children:(0,e.jsx)(f.B,{direction:"column",gap:1,children:m("group")&&m("evaluateEvery")&&(0,e.jsxs)("span",{children:[(0,e.jsxs)(I.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-group.text",evaluateEvery:a,children:["All rules in the selected group are evaluated every ",{evaluateEvery:a},"."]}),!W&&(0,e.jsx)(P.K,{name:"pen","aria-label":"Edit",disabled:le,onClick:he})]})})})})})]})}function We({evaluateEvery:a}){const n=(0,B.of)(Ge),{register:o,formState:{errors:r},setValue:u,watch:l}=(0,S.xW)(),m="eval-for-input",g=l("evaluateFor"),N=E=>{u("evaluateFor",E)};return(0,e.jsx)(f.B,{direction:"row","justify-content":"flex-start","align-items":"flex-start",children:(0,e.jsx)(M.D,{label:(0,e.jsx)(z.J,{htmlFor:"evaluateFor",description:'Period the threshold condition must be met to trigger the alert. Selecting "None" triggers the alert immediately once the condition is met.',children:(0,e.jsx)(I.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.pending-period",children:"Pending period"})}),className:n.inlineField,error:r.evaluateFor?.message,invalid:r.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsxs)(f.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(Q.p,{id:m,width:8,...o("evaluateFor",Ce(a))}),(0,e.jsx)(se,{selectedPendingPeriod:g,groupEvaluationInterval:a,onSelect:N})]})})})}function ze(){return(0,e.jsxs)(f.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)($.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(I.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.info-help.text",children:"Define the alert behavior when the evaluation fails or the query returns no data."})}),(0,e.jsx)(J.G,{contentText:"These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts.",externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:"Read more about this option",title:"Configure no data and error handling"})]})}function Qe(){return(0,e.jsxs)(f.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)($.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(I.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.description.text",children:"Define how the alert rule is evaluated."})}),(0,e.jsx)(J.G,{contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(I.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description1",children:"Evaluation groups are containers for evaluating alert and recording rules."})}),(0,e.jsx)("p",{children:(0,e.jsx)(I.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description2",children:"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval."})}),(0,e.jsx)("p",{children:(0,e.jsx)(I.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description3",children:"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."})})]}),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:"Read about evaluation and alert states",title:"Alert rule evaluation"})]})}function Ae({evaluateEvery:a,setEvaluateEvery:n,existing:o,enableProvisionedGroups:r}){const u=(0,B.of)(Ge),[l,m]=(0,R.useState)(!1),{watch:g,setValue:N}=(0,S.xW)(),E=g("isPaused");return(0,e.jsxs)(te.P,{stepNo:3,title:"Set evaluation behavior",description:Qe(),children:[(0,e.jsxs)(f.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(w,{setEvaluateEvery:n,evaluateEvery:a,enableProvisionedGroups:r}),(0,e.jsx)(We,{evaluateEvery:a}),o&&(0,e.jsx)(M.D,{htmlFor:"pause-alert-switch",children:(0,e.jsx)(S.xI,{render:()=>(0,e.jsxs)(f.B,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsx)(Y.d,{id:"pause-alert",onChange:h=>{N("isPaused",h.currentTarget.checked)},value:!!E}),(0,e.jsxs)("label",{htmlFor:"pause-alert",className:u.switchLabel,children:[(0,e.jsx)(I.x6,{i18nKey:"alert-rule-form.pause",children:"Pause evaluation"}),(0,e.jsx)(X.m,{placement:"top",content:"Turn on to pause evaluation for this alert rule.",theme:"info",children:(0,e.jsx)(L.I,{tabIndex:0,name:"info-circle",size:"sm",className:u.infoIcon})})]})]}),name:"isPaused"})})]}),(0,e.jsx)(xe.e,{isCollapsed:!l,onToggle:h=>m(!h),text:"Configure no data and error handling"}),l&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ze,{}),(0,e.jsx)(M.D,{htmlFor:"no-data-state-input",label:"Alert state if no data or all values are null",children:(0,e.jsx)(S.xI,{render:({field:{onChange:h,ref:v,...G}})=>(0,e.jsx)(oe,{...G,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:b=>h(b?.value)}),name:"noDataState"})}),(0,e.jsx)(M.D,{htmlFor:"exec-err-state-input",label:"Alert state if execution error or timeout",children:(0,e.jsx)(S.xI,{render:({field:{onChange:h,ref:v,...G}})=>(0,e.jsx)(oe,{...G,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:b=>h(b?.value)}),name:"execErrState"})})]})]})}const Ge=a=>({inlineField:(0,i.css)({marginBottom:0}),evaluateLabel:(0,i.css)({marginRight:a.spacing(1)}),evaluationContainer:(0,i.css)({color:a.colors.text.secondary,maxWidth:`${a.breakpoints.values.sm}px`,fontSize:a.typography.size.sm}),intervalChangedLabel:(0,i.css)({marginBottom:a.spacing(1)}),warningIcon:(0,i.css)({justifySelf:"center",marginRight:a.spacing(1),color:a.colors.warning.text}),infoIcon:(0,i.css)({marginLeft:"10px"}),warningMessage:(0,i.css)({color:a.colors.warning.text}),bold:(0,i.css)({fontWeight:"bold"}),alignInterval:(0,i.css)({marginTop:a.spacing(1),marginLeft:`-${a.spacing(1)}`}),marginTop:(0,i.css)({marginTop:a.spacing(1)}),switchLabel:(0,i.css)({color:a.colors.text.primary,cursor:"pointer",fontSize:a.typography.bodySmall.fontSize})})},22040:(De,ie,t)=>{t.d(ie,{u5:()=>Te,iS:()=>Me});var e=t(74848),i=t(32196),R=t(2543),S=t(96540),B=t(49785),f=t(39938),P=t(40845),M=t(37390),z=t(67061),Q=t(88575),$=t(60029),Y=t(10354),X=t(55852),L=t(42418),I=t(3169),Z=t(99140),ue=t(72635),A=t(79938),ce=t(17172);function k(s){if((0,ce.NF)(s)&&s.status===404)return null;throw s}var xe=t(48070),de=t(57220),ne=t(6833),pe=t(43482);function q(){const[s]=(0,pe.D)(),[c]=A.hK.endpoints.upsertRuleGroupForNamespace.useMutation();return(0,ne.Yb)(async(d,j)=>{const{namespaceName:C}=d,F=(0,xe.lF)({interval:j}),{newRuleGroupDefinition:O,rulerConfig:p}=await s(d,F),y=(0,ue.t)("alerting.rule-groups.update.success","Successfully updated rule group");return c({rulerConfig:p,namespace:C,payload:O,requestOptions:{successMessage:y}}).unwrap()})}function _(){const[s]=(0,pe.D)(),[c]=A.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[d]=A.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[j]=A.hK.endpoints.deleteRuleGroupFromNamespace.useMutation(),C=(0,ue.t)("alerting.rule-groups.move.success","Successfully moved rule group");return(0,ne.Yb)(async(F,O,p,y)=>{if((0,de.z2)(F.dataSourceName))throw new Error("Moving a Grafana-managed rule group to another folder is currently not supported.");const D=(0,xe.fO)({namespaceName:O,groupName:p,interval:y}),{newRuleGroupDefinition:oe,rulerConfig:J}=await s(F,D),ee=F.namespaceName,se=D.payload.namespaceName,te=F.groupName,K=D.payload.groupName;if(K&&(!!K&&te!==K)&&(await c({rulerConfig:J,namespace:se,group:K,requestOptions:{showErrorAlert:!1}}).unwrap().catch(k))?.rules?.length)throw new Error("Target group already has rules, merging rule groups is currently not supported.");return await d({rulerConfig:J,namespace:se,payload:oe,requestOptions:{successMessage:C}}).unwrap(),await j({rulerConfig:J,namespace:ee,group:te,requestOptions:{showSuccessAlert:!1}}).unwrap()})}function Se(){const[s]=(0,pe.D)(),[c]=A.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[d]=A.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[j]=A.hK.endpoints.deleteRuleGroupFromNamespace.useMutation();return(0,ne.Yb)(async(C,F,O)=>{const p=(0,xe.KL)({groupName:F,interval:O}),{newRuleGroupDefinition:y,rulerConfig:D}=await s(C,p),oe=C.groupName,J=p.payload.groupName,ee=C.namespaceName,se=(0,ue.t)("alerting.rule-groups.rename.success","Successfully renamed rule group");if((await c({rulerConfig:D,namespace:ee,group:J,requestOptions:{showErrorAlert:!1}}).unwrap().catch(k))?.rules?.length)throw new Error("Target group has existing rules, merging rule groups is currently not supported.");const K=await d({rulerConfig:D,namespace:ee,payload:y,requestOptions:{successMessage:se}}).unwrap();return await j({rulerConfig:D,namespace:ee,group:oe,requestOptions:{showSuccessAlert:!1}}).unwrap(),K})}var Fe=t(23770),me=t(82775),Oe=t(56361),Pe=t(63066),je=t(23662),U=t(25968),be=t(75591),Le=t(32264);const ye=()=>(0,e.jsxs)(L.F,{severity:"warning",title:"Global evaluation interval limit exceeded",children:["A minimum evaluation interval of ",(0,e.jsx)("strong",{children:Le.$.unifiedAlerting.minInterval})," has been configured in Grafana.",(0,e.jsx)("br",{}),"Please contact the administrator to configure a lower interval."]});var Ne=t(99106),we=t(99226),re=t(1723);const Ke=10;function Ee({message:s,error:c}){return c?(0,e.jsx)(f.E,{color:"red",icon:"exclamation-circle",text:"Error",tooltip:s}):(0,e.jsx)(f.E,{color:"orange",icon:"exclamation-triangle",text:"Unknown",tooltip:s})}const Ie=s=>{try{const c=(0,U.M9)(s);return!(c<re.I*1e3||c%(re.I*1e3)!==0)}catch{return!1}},Ve=({rulesWithoutRecordingRules:s})=>{const c=(0,P.of)(Be),{watch:d}=(0,B.xW)(),j=d("groupInterval"),C=!j,F=s.slice().map((p,y)=>({id:y,data:(0,je.jg)(p,j)})).sort((p,y)=>(0,U.P8)(p.data.forDuration)-(0,U.P8)(y.data.forDuration)),O=(0,S.useMemo)(()=>[{id:"alertName",label:"Alert",renderCell:({data:{alertName:p}})=>(0,e.jsx)(e.Fragment,{children:p}),size:"330px"},{id:"for",label:"Pending period",renderCell:({data:{forDuration:p}})=>(0,e.jsx)(e.Fragment,{children:p}),size:.5},{id:"numberEvaluations",label:"#Eval",renderCell:({data:{evaluationsToFire:p}})=>C?(0,e.jsx)(Ee,{message:"#Evaluations not available."}):Ie(j)?p===0?(0,e.jsx)(Ee,{message:"Invalid 'For' value: it should be greater or equal to evaluation interval.",error:!0}):(0,e.jsx)(e.Fragment,{children:p}):(0,e.jsx)(Ee,{message:"Invalid evaluation interval format",error:!0}),size:.4}],[j,C]);return(0,e.jsx)("div",{className:c.tableWrapper,children:(0,e.jsx)(be.E,{items:F,cols:O,pagination:{itemsPerPage:Ke}})})},Me=s=>({required:{value:!0,message:"Required."},validate:c=>{try{const d=(0,U.M9)(c);if(d<re.I*1e3)return`Cannot be less than ${re.I} seconds.`;if(d%(re.I*1e3)!==0)return`Must be a multiple of ${re.I} seconds.`;if((0,Fe.uQ)(s,c).length===0)return!0;{const j=s.map(F=>{const{forDuration:O}=(0,je.jg)(F,c);return(0,U.P8)(O)}),C=Math.min(...j);return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,U.an)(C)}".`}}catch(d){return d instanceof Error?d.message:"Failed to parse duration"}}});function Te(s){const{namespace:c,group:d,onClose:j,intervalEditOnly:C,folderUid:F}=s,O=(0,P.of)(Be),p=(0,I._2)(),[y,D]=q(),[oe,J]=Se(),[ee,se]=_(),{loading:te,error:K}=(0,ne.Gz)(y,ee,oe),Ce=(0,S.useMemo)(()=>({namespaceName:(0,Ne.EL)(c).name,groupName:d.name,groupInterval:d.interval??Pe.T6}),[c,d.name,d.interval]),ge=(0,de.EV)(c.rulesSource),w=ge===de.hY,We=(0,Ne.EL)(c).parents,ze=w?"Folder":"Namespace",Qe=async v=>{const G={dataSourceName:ge,groupName:d.name,namespaceName:w?F:c.name},b=w?(0,Ne.wf)(v.namespaceName,We):v.namespaceName,T=v.groupName,H=v.groupInterval,V=w?!1:b!==G.namespaceName,W=T!==G.groupName;try{V?await se.execute(G,b,T,H):W?await J.execute(G,T,H):await D.execute(G,H),j(!0),await(0,Z.JD)((0,Fe.eB)({rulesSourceName:ge}))}catch{}},Ae=(0,B.mN)({mode:"onBlur",defaultValues:Ce,shouldFocusError:!0}),{handleSubmit:Ge,register:a,watch:n,formState:{isDirty:o,errors:r,isValid:u},setValue:l,getValues:m}=Ae,g=()=>{p.error("There are errors in the form. Correct the errors and retry.")},N=(0,R.compact)(d.rules.map(v=>v.rulerRule).filter(v=>!(0,je.i7)(v))),E=N.length>0,h=C||w?"Edit evaluation group":"Edit namespace or evaluation group";return(0,e.jsx)(M.a,{className:O.modal,isOpen:!0,title:h,onDismiss:j,onClickBackdrop:j,children:(0,e.jsx)(B.Op,{...Ae,children:(0,e.jsx)("form",{onSubmit:Ge(Qe,g),children:(0,e.jsxs)(e.Fragment,{children:[!s.hideFolder&&(0,e.jsxs)(z.B,{gap:1,alignItems:"center",children:[(0,e.jsx)(Q.D,{className:O.formInput,label:(0,e.jsx)($.J,{htmlFor:"namespaceName",description:!w&&"Change the current namespace name. Moving groups between namespaces is not supported",children:ze}),invalid:r.namespaceName?!0:void 0,error:r.namespaceName?.message,children:(0,e.jsx)(Y.p,{id:"namespaceName",readOnly:C||w,...a("namespaceName",{required:"Namespace name is required."})})}),w&&s.folderUrl&&(0,e.jsx)(X.z9,{href:s.folderUrl,title:"Go to folder",variant:"secondary",icon:"folder-open",target:"_blank"})]}),(0,e.jsx)(Q.D,{label:(0,e.jsx)($.J,{htmlFor:"groupName",description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group"}),invalid:!!r.groupName,error:r.groupName?.message,children:(0,e.jsx)(Y.p,{autoFocus:!0,id:"groupName",readOnly:C,...a("groupName",{required:"Evaluation group name is required."})})}),(0,e.jsx)(Q.D,{label:(0,e.jsx)($.J,{htmlFor:"groupInterval",description:"How often is the rule evaluated. Applies to every rule within the group.",children:(0,e.jsx)(z.B,{gap:.5,children:"Evaluation interval"})}),invalid:r.groupInterval?!0:void 0,error:r.groupInterval?.message,children:(0,e.jsxs)(z.B,{direction:"column",children:[(0,e.jsx)(Y.p,{id:"groupInterval",placeholder:Pe.T6,...a("groupInterval",Me(N))}),(0,e.jsx)(we.gv,{currentInterval:m("groupInterval"),onSelect:v=>l("groupInterval",v,{shouldValidate:!0,shouldDirty:!0})})]})}),w&&(0,me.q)(n("groupInterval")).exceedsLimit&&(0,e.jsx)(ye,{}),!E&&(0,e.jsx)("div",{children:"This group does not contain alert rules."}),E&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:"List of rules that belong to this group"}),(0,e.jsx)("div",{className:O.evalRequiredLabel,children:"#Eval column represents the number of evaluations needed before alert starts firing."}),(0,e.jsx)(Ve,{rulesWithoutRecordingRules:N})]}),K&&(0,e.jsx)(L.F,{title:"Failed to update rule group",children:(0,Oe.JZ)(K)}),(0,e.jsx)("div",{className:O.modalButtons,children:(0,e.jsxs)(M.a.ButtonRow,{children:[(0,e.jsx)(X.$n,{variant:"secondary",type:"button",disabled:te,onClick:()=>j(!1),fill:"outline",children:"Cancel"}),(0,e.jsx)(X.$n,{type:"submit",disabled:!o||!u||te,children:te?"Saving...":"Save"})]})})]})},JSON.stringify(Ce))})})}const Be=s=>({modal:(0,i.css)({maxWidth:"560px"}),modalButtons:(0,i.css)({top:"-24px",position:"relative"}),formInput:(0,i.css)({flex:1}),tableWrapper:(0,i.css)({marginTop:s.spacing(2),marginBottom:s.spacing(2),height:"100%"}),evalRequiredLabel:(0,i.css)({fontSize:s.typography.bodySmall.fontSize})})},41520:(De,ie,t)=>{t.d(ie,{V:()=>R});var e=t(96540),i=t(75471);function R(){return(0,e.useMemo)(()=>(0,i.Q9)(),[])}}}]);

//# sourceMappingURL=7049.17828b321e7a5ecbb5e9.js.map