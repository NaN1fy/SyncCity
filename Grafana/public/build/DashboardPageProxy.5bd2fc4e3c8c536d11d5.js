"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9136],{77709:(Nt,k,o)=>{o.r(k),o.d(k,{default:()=>Ss});var n=o(74848),W=o(16817),x=o(32264),p=o(96540),O=o(64388),re=o(80943),z=o(69444),G=o(39419),J=o(33390),V=o(20470),f=o(31678),h=o(32196),L=o(24180),b=o(12131),E=o(71678),y=o(40845),F=o(37390),S=o(55852),U=o(16233);const Pe=(0,p.memo)(({dashboard:e})=>{const t=(0,p.useMemo)(()=>b.Ny.getLocation().pathname,[e]),{showModal:a,hideModal:s}=(0,p.useContext)(E.wE);(0,p.useEffect)(()=>{const i=u=>{je(e,e.getInitialSaveModel())||e.state.isDirty&&(u.preventDefault(),u.returnValue="")};return window.addEventListener("beforeunload",i),()=>window.removeEventListener("beforeunload",i)},[e]);const r=i=>t===i.pathname||je(e,e.getInitialSaveModel())||!e.state.isDirty?!0:(a(Et,{dashboard:e,onSaveDashboardClick:()=>{s(),e.openSaveDrawer({onSaveSuccess:()=>{Se(i)}})},onDiscard:()=>{e.exitEditMode({skipConfirm:!0}),s(),Se(i)},onDismiss:s}),!1);return(0,n.jsx)(L.XG,{when:!0,message:r})});Pe.displayName="DashboardPrompt";function Se(e){e&&setTimeout(()=>b.Ny.push(e),10)}const Et=({onDiscard:e,onDismiss:t,onSaveDashboardClick:a})=>{const s=(0,y.of)(Mt);return(0,n.jsxs)(F.a,{isOpen:!0,title:"Unsaved changes",onDismiss:t,icon:"exclamation-triangle",className:s.modal,children:[(0,n.jsx)("h5",{children:"Do you want to save your changes?"}),(0,n.jsxs)(F.a.ButtonRow,{children:[(0,n.jsx)(S.$n,{variant:"secondary",onClick:t,fill:"outline",children:"Cancel"}),(0,n.jsx)(S.$n,{variant:"destructive",onClick:e,children:"Discard"}),(0,n.jsx)(S.$n,{onClick:a,children:"Save dashboard"})]})]})},Mt=()=>({modal:(0,h.css)({width:"500px"})});function je(e,t){if(!t||t.version===0||!U.TP.isSignedIn||!e)return!0;const{canSave:a,fromScript:s,fromFile:r}=e.state.meta;return!U.TP.isEditor&&!a?!0:!a||s||r}var Ce=o(72255);function wt({match:e,route:t,queryParams:a,history:s}){const r=(0,Ce.sP)(),{dashboard:i,isLoading:u,loadError:d}=r.useState(),c=s.location.state?.routeReloadCounter,l=(0,p.useMemo)(()=>!!J.A.getObject(V.us),[e.params.uid,e.params.slug,e.params.type]);return(0,p.useEffect)(()=>(t.routeName===f.DashboardRoutes.Normal&&e.params.type==="snapshot"?r.loadSnapshot(e.params.slug):r.loadDashboard({uid:e.params.uid??"",route:t.routeName,urlFolderUid:a.folderUid,keepDashboardFromExploreInLocalStorage:!1}),()=>{r.clearState()}),[r,e.params.uid,t.routeName,a.folderUid,c,e.params.slug,e.params.type]),(0,p.useEffect)(()=>{i&&l&&t.routeName!==f.DashboardRoutes.New&&i.onEnterEditMode(l)},[i,l,t.routeName]),i?e.params.type!=="snapshot"&&i.state.uid&&i.state.uid!==e.params.uid&&t.routeName!==f.DashboardRoutes.Home?null:(0,n.jsxs)(re.$L,{scene:i,children:[(0,n.jsx)(i.Component,{model:i},i.state.key),(0,n.jsx)(Pe,{dashboard:i})]}):(0,n.jsxs)(z.Y,{layout:O.k.Canvas,"data-testid":"dashboard-scene-page",children:[u&&(0,n.jsx)(G.A,{}),d&&(0,n.jsx)("h2",{children:d})]})}const Te=wt;var Y=o(71468),It=o(71733),j=o(13544),De=o(82467),Lt=o(7392),Rt=o(76888),Ne=o(3169);function At(e){switch(e.kiosk){case"tv":return f.KioskMode.TV;case"1":case!0:return f.KioskMode.Full;default:return null}}var Ft=o(91219),oe=o(17422),Ee=o(6473),Me=o(14110),B=o(42418),Ut=o(61680);const Ot="grafana.angularDeprecation.dashboardNoticeAndMigration.isDismissed";function zt(e){return Ot+"."+e}function Vt(){const e="__feature.autoMigrateOldPanels",t=new URL(window.location.toString());t.searchParams.has(e)||t.searchParams.append(e,"true"),window.open(t.toString(),"_self")}function Bt({dashboardUid:e,showAutoMigrateLink:t}){return(0,n.jsx)(Ut.b,{storageKey:zt(e),defaultValue:!1,children:(a,s)=>a?null:(0,n.jsx)("div",{children:(0,n.jsx)(B.F,{severity:"warning",title:"This dashboard depends on Angular, which is deprecated and will stop working in future releases of Grafana.",onRemove:()=>{(0,Me.rR)("angular_deprecation_notice_dismissed"),s(!0)},children:(0,n.jsxs)("div",{className:"markdown-html",children:[(0,n.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/developers/angular_deprecation/",className:"external-link",target:"_blank",rel:"noreferrer",children:"Read our deprecation notice and migration advice."}),(0,n.jsx)("br",{}),t&&(0,n.jsx)(S.$n,{fill:"outline",size:"sm",onClick:Vt,style:{marginTop:10},children:"Try migration"})]})})})})}var $t=o(8480);const Wt=()=>{const e=new URL(window.location.toString()),t=new URLSearchParams(e.search);t.forEach((a,s)=>{if(s.startsWith("__feature.")){const r=s.substring(10);$t.mz.has(r)&&t.delete(s)}}),window.location.href=new URL(e.origin+e.pathname+"?"+t.toString()).toString()},Gt=()=>{window.open("https://github.com/grafana/grafana/issues/new?assignees=&labels=&projects=&template=0-bug-report.yaml&title=Product+Area%3A+Short+description+of+bug")};function Qt({dashboardUid:e}){const t=(0,y.of)(Ht),[a,s]=(0,p.useState)(!0);return a?(0,n.jsx)(B.F,{severity:"info",title:"This dashboard was migrated from Angular. Please make sure everything is behaving as expected and save and refresh this dashboard to persist the migration.",onRemove:()=>s(!1),children:(0,n.jsxs)("div",{className:"markdown-html",children:[(0,n.jsx)(S.$n,{fill:"outline",size:"sm",className:t.linkButton,onClick:Gt,children:"Report issue"}),(0,n.jsx)(S.$n,{fill:"outline",size:"sm",className:t.linkButton,onClick:Wt,children:"Revert migration"})]})}):null}const Ht=e=>({linkButton:(0,h.css)({marginRight:10})});var Cs=o(53652);function Ts(e){const t=e.match.params.slug??"",a=useAsync(()=>getGrafanaStorage().list("content/"+t),[t]),s=t.length>0?`g/${t}/`:"g/",r=we(t),i=()=>a.value?a.value.fields[0].values.map(c=>{let l=c;const g=l.indexOf(".")<0,m=!g&&l.endsWith(".json"),v=`${s}${l}`;return jsxs(Card,{href:g||m?v:void 0,children:[jsx(Card.Heading,{children:l}),jsx(Card.Figure,{children:jsx(Icon,{name:g?"folder":m?"gf-grid":"file-alt",size:"sm"})})]},l)}):a.loading?jsx(Spinner,{}):jsx("div",{children:"?"}),u=Ie();return jsx(Page,{navModel:u,pageNav:r,children:i()})}function we(e){const t=e.split("/");let a=[],s="g",r;for(let i=0;i<t.length;i++)s+=`/${t[i]}`,a.push({text:t[i],url:s,parentItem:r}),r=a[a.length-1];return r}function Ie(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const Ds=null;var R=o(28444),Le=o(72401),Kt=o(75096),Re=o(10354),Z=o(14578),ie=o(40276),Ae=o(36974),kt=o(48889),Fe=o(17706);const Jt=()=>{const e=(0,y.of)(Yt),[t,a]=(0,p.useState)(""),s=(0,f.useSelector)(d=>d.dashboard.getModel()),r=(0,p.useMemo)(()=>(0,Fe.nr)(),[]),i=(0,p.useMemo)(()=>(0,Fe.CO)(r,t),[r,t]),u=()=>{b.Ny.partial({addWidget:null})};return(0,n.jsxs)(F.a,{title:"Select widget type",closeOnEscape:!0,closeOnBackdropClick:!0,isOpen:!0,className:e.modal,onClickBackdrop:u,onDismiss:u,children:[(0,n.jsx)(Re.p,{type:"search",autoFocus:!0,className:e.searchInput,value:t,prefix:(0,n.jsx)(Z.I,{name:"search"}),placeholder:"Search widget",onChange:d=>{a(d.currentTarget.value)}}),(0,n.jsx)(ie.E,{children:(0,n.jsx)("div",{className:e.grid,children:i.map((d,c)=>(0,n.jsx)(kt.f,{disabled:!1,isCurrent:!1,plugin:d,onClick:l=>{const g=(0,Ae.ob)(s,d.id);b.Ny.partial({editPanel:g,addWidget:null})}},d.id))})})]})},Yt=e=>({modal:(0,h.css)({width:"65%",maxWidth:"960px",[e.breakpoints.down("md")]:{width:"100%"}}),searchInput:(0,h.css)({marginBottom:e.spacing(2)}),grid:(0,h.css)({display:"grid",gridGap:e.spacing(1)})});var Zt=o(16495),Xt=o(82138),qt=o(9980),X=o(2543),_t=o(28138),en=o(40996),tn=o(57767),nn=o(43535),an=o(88861);const Ue=({panel:e,folderUid:t,isUnsavedPrompt:a,onDismiss:s,onConfirm:r,onDiscard:i})=>{const[u,d]=(0,p.useState)(""),c=(0,W.A)(async()=>{const T=await(0,tn.xV)(e.libraryPanel.uid);return T.length>0?T.map(M=>M.title):[]},[e.libraryPanel.uid]),[l,g]=(0,p.useState)([]);(0,en.A)(()=>c.value?g(c.value.filter(T=>T.toLowerCase().includes(u.toLowerCase()))):g([]),300,[c.value,u]);const{saveLibraryPanel:m}=(0,an.b)(),v=(0,y.of)(nn.o),N=(0,p.useCallback)(()=>{i()},[i]),C=a?"Unsaved library panel changes":"Save library panel";return(0,n.jsx)(F.a,{title:C,icon:"save",onDismiss:s,isOpen:!0,children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:v.textInfo,children:["This update will affect ",(0,n.jsxs)("strong",{children:[e.libraryPanel.meta?.connectedDashboards," ",e.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."]}),"The following dashboards using the panel will be affected:"]}),(0,n.jsx)(Re.p,{className:v.dashboardSearch,prefix:(0,n.jsx)(Z.I,{name:"search"}),placeholder:"Search affected dashboards",value:u,onChange:T=>d(T.currentTarget.value)}),c.loading?(0,n.jsx)("p",{children:"Loading connected dashboards..."}):(0,n.jsxs)("table",{className:v.myTable,children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:(0,n.jsx)("th",{children:"Dashboard name"})})}),(0,n.jsx)("tbody",{children:l.map((T,M)=>(0,n.jsx)("tr",{children:(0,n.jsx)("td",{children:T})},`dashrow-${M}`))})]}),(0,n.jsxs)(F.a.ButtonRow,{children:[(0,n.jsx)(S.$n,{variant:"secondary",onClick:s,fill:"outline",children:"Cancel"}),a&&(0,n.jsx)(S.$n,{variant:"destructive",onClick:N,children:"Discard"}),(0,n.jsx)(S.$n,{onClick:()=>{m(e,t).then(()=>{r()})},children:"Update all"})]})]})})};var sn=o(98365),Oe=o(19752),le=o(79971),ze=o(80095),A=o(53466);function rn(e,t){return async a=>{const s=t.initEditPanel(e);a((0,A.GU)({panel:s,sourcePanel:e}))}}function Ve(){return async(e,t)=>{const{getPanel:a}=t().panelEditor;a().configRev=0,e((0,A.MJ)(!0))}}function on(e,t){return a=>{if(e.libraryPanel?.uid===void 0||!t)return;const s=e.getSaveModel();for(const r of t.panels){if(ln(e,r))continue;r.restoreModel({...s,...(0,X.pick)(r,"gridPos","id")});const i=r.plugin?.meta.id!==e.plugin?.meta.id;r.plugin=e.plugin,r.configRev++,i&&(r.generateNewKey(),a((0,ze.XM)({key:r.key,plugin:r.plugin}))),setTimeout(()=>{r.getQueryRunner().useLastResultFrom(e.getQueryRunner())},20)}e.repeat&&setTimeout(()=>t.processRepeats(),20)}}function ln(e,t){return!!(t.libraryPanel?.uid!==e.libraryPanel.uid||t.id&&t.id===e.id||t.repeatPanelId)}function dn(){return async(e,t)=>{const a=t().dashboard.getModel(),{getPanel:s,getSourcePanel:r,shouldDiscardChanges:i}=t().panelEditor,u=s();a&&a.exitPanelEditor();const d=r();if(cn(u)&&!i){const c=u.getSaveModel(),l=d.type!==u.type;e(on(u,a)),d.restoreModel(c),d.configRev++,l&&(d.plugin=u.plugin,d.generateNewKey(),await e((0,ze.XM)({key:d.key,plugin:u.plugin}))),setTimeout(()=>{d.getQueryRunner().useLastResultFrom(u.getQueryRunner()),d.render(),u.hasSavedPanelEditChange&&!u.hasChanged&&(d.configRev=0)},20)}d.isNew&&(i?a&&(0,Oe.FC)(a,d,!0):delete d.isNew),e((0,le.O6)(u.key)),e((0,A.Ox)())}}function cn(e){return e.hasChanged||e.hasSavedPanelEditChange||e.isAngularPlugin()}function de(e){return(t,a)=>{const s={...a().panelEditor.ui,...e};t((0,A.fR)(s));try{J.A.setObject(A.wi,s)}catch(r){console.error(r)}}}var un=o(78050);const hn=({dashboard:e,onSaveSuccess:t,onDiscard:a,onDismiss:s})=>(0,n.jsxs)(F.a,{isOpen:!0,title:"Unsaved changes",onDismiss:s,icon:"exclamation-triangle",className:(0,h.css)({width:"500px"}),children:[(0,n.jsx)("h5",{children:"Do you want to save your changes?"}),(0,n.jsxs)(F.a.ButtonRow,{children:[(0,n.jsx)(S.$n,{variant:"secondary",onClick:s,fill:"outline",children:"Cancel"}),(0,n.jsx)(S.$n,{variant:"destructive",onClick:a,children:"Discard"}),(0,n.jsx)(un.C,{dashboard:e,onSaveSuccess:t})]})]}),Be=(0,p.memo)(({dashboard:e})=>{const[t,a]=(0,p.useState)({original:null}),s=(0,f.useDispatch)(),{original:r,originalPath:i}=t,{showModal:u,hideModal:d}=(0,p.useContext)(E.wE);(0,p.useEffect)(()=>{const l=setTimeout(()=>{const m=b.Ny.getLocation().pathname,v=e.getSaveModelCloneOld();a({originalPath:m,original:v})},1e3),g=_t.l.subscribe(R.Eu,()=>{const m=e.getSaveModelCloneOld();a({originalPath:i,original:m})});return()=>{clearTimeout(l),g.unsubscribe()}},[e,i]),(0,p.useEffect)(()=>{const l=g=>{$e(e,r)||Ge(e,r)&&(g.preventDefault(),g.returnValue="")};return window.addEventListener("beforeunload",l),()=>window.removeEventListener("beforeunload",l)},[e,r]);const c=l=>{const g=e.panelInEdit,m=new URLSearchParams(l.search);return g&&g.libraryPanel&&g.hasChanged&&!m.has("editPanel")?(u(Ue,{isUnsavedPrompt:!0,panel:e.panelInEdit,folderUid:e.meta.folderUid??"",onConfirm:()=>{d(),q(l)},onDiscard:()=>{s(Ve()),q(l),d()},onDismiss:d}),!1):i===l.pathname||!r?(g&&!m.has("editPanel")&&s(dn()),!0):$e(e,r)||!Ge(e,r)?!0:(u(hn,{dashboard:e,onSaveSuccess:()=>{d(),q(l)},onDiscard:()=>{a({...t,original:null}),d(),q(l)},onDismiss:d}),!1)};return(0,n.jsx)(L.XG,{when:!0,message:c})});Be.displayName="DashboardPrompt";function q(e){e&&setTimeout(()=>b.Ny.push(e),10)}function $e(e,t){if(!t||t.version===0||!U.TP.isSignedIn||!e)return!0;const{canSave:a,fromScript:s,fromFile:r}=e.meta;return!U.TP.isEditor&&!a?!0:!a||s||r}function We(e){const t=new sn.G(e);t.expandRows();const a=t.getSaveModelClone();if(delete a.time,delete a.refresh,a.schemaVersion=0,delete a.timezone,a.panels=[],a.templating?.list)for(const s of a.templating.list)delete s.current,delete s.options,delete s.filters;return a}function Ge(e,t){if(e.hasUnsavedChanges())return!0;const a=We(e.getSaveModelCloneOld()),s=We(t),r=(0,X.find)(a.nav,{type:"timepicker"}),i=(0,X.find)(s.nav,{type:"timepicker"});r&&i&&(r.now=i.now);const u=JSON.stringify(a,null),d=JSON.stringify(s,null);return u!==d}var pn=o(62639),w=o(16560),Qe=o(40334),ce=o(70713),He=o(41987),Ke=o(87978),Q=o(67061),gn=o(29678),ue=o(63021),_=o(40675),fn=o(62930),ee=o(88575),mn=o(90182),ke=o(10534),vn=o(32372),te=o(66864),H=o(15292),xn=o(4213),bn=o.n(xn),yn=o(72724),ne=o(83195),Pn=o(2619),Sn=o(85445),$=o(74856),jn=o(34214),Je=o(18803),K=(e=>(e[e.Support=0]="Support",e[e.Data=1]="Data",e))(K||{}),ae=(e=>(e[e.PanelSnapshot=0]="PanelSnapshot",e[e.GithubComment=1]="GithubComment",e))(ae||{});class Cn extends Pn.Q{constructor(t){super({panel:t,panelTitle:t.replaceVariables(t.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,s=Math.pow(1024,2)*1.5;return a.length>s?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:s}=this.state,r=new Blob([a],{type:"text/plain"}),i=`debug-${s}-${(0,yn.LE)(new Date)}.json.txt`;bn()(r,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:s}=this.state;this.setState({randomize:{...s,[a]:!s[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,V.OI)({meta:{},dashboard:a}),o.g.open(x.$.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:t,randomize:a,snapshotUpdate:s}=this.state,r=await(0,Je.E_)(t,a,(0,$.jG)().timeRange()),i=JSON.stringify(r,null,2),u=(0,Je.jD)(t,i),d=(0,ne.cN)((0,ne.j_)("bytes")(i?.length??0));let c;if(!t.isAngularPlugin())try{const l=new jn.G(r,{isEmbedded:!0});c=(0,Sn.EH)(l,r).state.body}catch(l){console.log("Error creating scene:",l)}this.setState({snapshot:r,snapshotText:i,markdownText:u,snapshotSize:d,snapshotUpdate:s+1,scene:c})}}function Tn({panel:e,plugin:t,onClose:a}){const s=(0,y.of)(Dn),r=(0,p.useMemo)(()=>new Cn(e),[e]),{currentTab:i,loading:u,error:d,options:c,showMessage:l,snapshotSize:g,markdownText:m,snapshotText:v,randomize:N,panelTitle:C,scene:T}=r.useState();if((0,p.useEffect)(()=>{r.buildDebugDashboard()},[r,t,N]),!t)return null;const M=[{label:"Snapshot",value:K.Support},{label:"Data",value:K.Data}],I=x.$.supportBundlesEnabled&&U.TP.hasPermission(f.AccessControlAction.ActionSupportBundlesCreate);return(0,n.jsxs)(Ke._,{title:"Get help with this panel",size:"lg",onClose:a,subtitle:(0,n.jsxs)(Q.B,{direction:"column",gap:1,children:[(0,n.jsxs)(Q.B,{direction:"row",gap:1,children:[(0,n.jsx)(gn.y,{featureState:He.Ay.beta}),(0,n.jsxs)("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer",children:["Troubleshooting docs ",(0,n.jsx)(Z.I,{name:"external-link-alt"})]})]}),(0,n.jsx)("span",{className:"muted",children:"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."}),I&&(0,n.jsxs)("span",{className:"muted",children:["You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",(0,n.jsx)("a",{href:"/support-bundles",children:"support bundles section"}),"."]})]}),tabs:(0,n.jsx)(ue.U,{children:M.map((D,se)=>(0,n.jsx)(_.o,{label:D.label,active:D.value===i,onChangeTab:()=>r.onCurrentTabChange(D.value)},`${D.value}-${se}`))}),children:[u&&(0,n.jsx)(fn.y,{}),d&&(0,n.jsx)(B.F,{title:d.title,children:d.message}),i===K.Data&&(0,n.jsxs)("div",{className:s.code,children:[(0,n.jsxs)("div",{className:s.opts,children:[(0,n.jsx)(ee.D,{label:"Template",className:s.field,children:(0,n.jsx)(mn.l6,{options:c,value:l,onChange:r.onShowMessageChange})}),l===ae.GithubComment?(0,n.jsx)(ke.b,{icon:"copy",getText:r.onGetMarkdownForClipboard,children:"Copy to clipboard"}):(0,n.jsxs)(S.$n,{icon:"download-alt",onClick:r.onDownloadDashboard,children:["Download (",g,")"]})]}),(0,n.jsx)(ce.Ay,{disableWidth:!0,children:({height:D})=>(0,n.jsx)(vn.B,{width:"100%",height:D,language:l===ae.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:l===ae.GithubComment?m:v,readOnly:!1,onBlur:r.onSetSnapshotText})})]}),i===K.Support&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ee.D,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal.",children:(0,n.jsxs)(te.Gy,{children:[(0,n.jsx)(H.K,{label:"Labels",id:"randomize-labels",showLabel:!0,value:!!N.labels,onChange:()=>r.onToggleRandomize("labels")}),(0,n.jsx)(H.K,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:!!N.names,onChange:()=>r.onToggleRandomize("names")}),(0,n.jsx)(H.K,{label:"String values",id:"randomize-string-values",showLabel:!0,value:!!N.values,onChange:()=>r.onToggleRandomize("values")})]})}),(0,n.jsx)(ee.D,{label:"Support snapshot",description:`Panel: ${C}`,children:(0,n.jsxs)(Q.B,{children:[(0,n.jsxs)(S.$n,{icon:"download-alt",onClick:r.onDownloadDashboard,children:["Dashboard (",g,")"]}),(0,n.jsx)(ke.b,{icon:"github",getText:r.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard",children:"Copy to clipboard"}),(0,n.jsx)(S.$n,{onClick:r.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab",children:"Preview"})]})}),(0,n.jsx)(ce.Ay,{disableWidth:!0,children:({height:D})=>(0,n.jsx)("div",{style:{height:D,overflow:"auto"},children:T&&(0,n.jsx)(T.Component,{model:T})})})]})]})}const Dn=e=>({code:(0,h.css)({flexGrow:1,height:"100%",overflow:"scroll"}),field:(0,h.css)({width:"100%"}),opts:(0,h.css)({display:"flex",width:"100%",flexGrow:0,alignItems:"center",justifyContent:"flex-end",button:{marginLeft:"8px"}})});var he=o(39070);const pe=(e,t,a)=>{const s=(0,p.useRef)(),[r,i]=(0,p.useState)();return(0,p.useEffect)(()=>{let u=-1,d=0;return s.current=e.getQueryRunner().getData({withTransforms:t.withTransforms,withFieldConfig:!1}).subscribe({next:c=>{if(a){if(u===c.structureRev){const l=Date.now();if(l-d<1e4)return;d=l}u=c.structureRev??-1}i(c)}}),()=>{s.current&&s.current.unsubscribe()}},[e,t.withTransforms]),{data:r,isLoading:r?.state===he.Gu.Loading,hasSeries:r?!!r.series:!1,hasError:!!(r&&(r.error||r?.errors?.length||r.state===he.Gu.Error))}};var Ye=o(72574),ge=o(8484),Nn=o(61453),En=o(82344),Mn=o(61396);const wn=({data:e,metadataDatasource:t})=>!t||!t.components?.MetadataInspector?(0,n.jsx)(ge.x6,{i18nKey:"dashboard.inspect-meta.no-inspector",children:"No Metadata Inspector"}):(0,n.jsx)(t.components.MetadataInspector,{datasource:t,data:e.series});var In=o(32067),Ln=o(90820);const Rn=({panel:e,plugin:t,dashboard:a,tabs:s,data:r,isDataLoading:i,dataOptions:u,metadataDatasource:d,defaultTab:c,onDataOptionsChange:l,onClose:g})=>{const[m,v]=(0,p.useState)(c??w.q.Data);if(!t)return null;let N=An(r),C=m;s.find(I=>I.value===m)||(C=w.q.JSON);const T=(0,Ye.w)().replace(e.title,e.scopedVars,"text")||"Panel",M=(0,ge.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:T});return(0,n.jsxs)(Ke._,{title:M,subtitle:r&&Fn(r),onClose:g,tabs:(0,n.jsx)(ue.U,{children:s.map((I,D)=>(0,n.jsx)(_.o,{label:I.label,active:I.value===C,onChangeTab:()=>v(I.value||w.q.Data)},`${I.value}-${D}`))}),children:[C===w.q.Data&&(0,n.jsx)(Nn.q,{dataName:e.getDisplayTitle(),panelPluginId:e.type,fieldConfig:e.fieldConfig,hasTransformations:!!e.transformations?.length,data:r&&r.series,isLoading:i,options:u,onOptionsChange:l,timeZone:a.timezone,app:He.Jk.Dashboard}),r&&C===w.q.Meta&&(0,n.jsx)(wn,{data:r,metadataDatasource:d}),C===w.q.JSON&&(0,n.jsx)(Mn.w,{panel:e,dashboard:a,data:r,onClose:g}),C===w.q.Error&&(0,n.jsx)(En.y,{errors:N}),r&&C===w.q.Stats&&(0,n.jsx)(In.N,{data:r,timeZone:a.getTimezone()}),r&&C===w.q.Query&&(0,n.jsx)(Ln.e,{data:r,onRefreshQuery:()=>e.refresh()})]})};function An(e){let t=e?.errors??[];return e?.error&&!t.includes(e.error)&&(t=[e.error,...t]),!t.length&&e?.state===he.Gu.Error?[{message:"Error loading data"}]:t}function Fn(e){const{request:t}=e;if(!t||(0,X.isEmpty)(t))return"";const a=t.targets.length,s=t.endTime?t.endTime-t.startTime:0,r=(0,ne.cN)((0,ne.j_)("ms")(s));return(0,n.jsxs)(ge.x6,{i18nKey:"dashboard.inspect.subtitle",children:[{queryCount:a}," queries with total query time of ",{formatted:r}]})}var Ze=o(65123);const Un=({panel:e,dashboard:t,plugin:a})=>{const s=(0,L.zy)(),r=new URLSearchParams(s.search).get("inspectTab"),[i,u]=(0,p.useState)({withTransforms:r===w.q.Error,withFieldConfig:!0}),{data:d,isLoading:c,hasError:l}=pe(e,i,!1),g=(0,Ze.sd)(d),m=(0,Ze.kx)(e,t,a,l,g),v=()=>{b.Ny.partial({inspect:null,inspectTab:null})};return a?r===w.q.Help?(0,n.jsx)(Tn,{panel:e,plugin:a,onClose:v}):(0,n.jsx)(Rn,{dashboard:t,panel:e,plugin:a,defaultTab:r,tabs:m,data:d,isDataLoading:c,dataOptions:i,onDataOptionsChange:u,metadataDatasource:g,onClose:v}):null},On=(e,t)=>{const a=(0,Qe.U)(e,t.panel);return a?{plugin:a.plugin}:{plugin:null}},zn=(0,Y.connect)(On)(Un);var Xe=o(64423),qe=o(94354),fe=o(27746),Vn=o(15068),_e=o(3911),Bn=o(75269),et=o(58720),$n=o(10096),me=o(12470),ve=o(56034),Wn=o(20601),Gn=o(13344);const Qn=e=>{const t=(0,p.useMemo)(()=>Wn.B.get(e.variable.type).picker,[e.variable]);return e.variable?(0,n.jsxs)(Q.B,{gap:0,children:[(0,n.jsx)(Hn,{variable:e.variable}),e.variable.hide!==me.zL.hideVariable&&t&&(0,n.jsx)(t,{variable:e.variable,readOnly:e.readOnly??!1})]}):(0,n.jsx)("div",{children:"Couldn't load variable"})};function Hn({variable:e}){const t=(0,p.useMemo)(()=>e.label||e.name,[e]);if(e.hide!==me.zL.dontHide)return null;const a=Gn.qz+e.id;return e.description?(0,n.jsx)(ve.m,{content:e.description,placement:"bottom",children:(0,n.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":j.Tp.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a,children:t})}):(0,n.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":j.Tp.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a,children:t})}const tt=({variables:e,readOnly:t})=>{const[a,s]=(0,p.useState)([]),r=(0,y.of)(Kn);return(0,p.useEffect)(()=>{s(e.filter(i=>i.hide!==me.zL.hideVariable))},[e]),a.length===0?null:(0,n.jsx)(n.Fragment,{children:a.map(i=>(0,n.jsx)("div",{className:r.submenuItem,"data-testid":j.Tp.pages.Dashboard.SubMenu.submenuItem,children:(0,n.jsx)(Qn,{variable:i,readOnly:t})},i.id))})},Kn=e=>({submenuItem:(0,h.css)({display:"inline-block",".fa-caret-down":{fontSize:"75%",paddingLeft:e.spacing(1)},".gf-form":{marginBottom:0}})});var kn=o(81862),Jn=o(54174),nt=o(82792),xe=o(87421),Yn=o(39569),Zn=o(62367),Xn=o(70497),qn=o(26443),_n=o(19727),ea=o(41394);const at=e=>t=>t.plugins.panels[e]||(0,ea.$)(`Panel plugin not found (${e})`,!0),be=({panel:e})=>{const t=(0,f.useDispatch)(),a=(0,f.useSelector)(at(e.type)),s=(0,f.useSelector)(d=>d.panelEditor.ui.isPanelOptionsVisible),r=(0,f.useSelector)(d=>d.panelEditor.isVizPickerOpen),i=()=>{t((0,A.eK)(!r))},u=()=>{t(de({isPanelOptionsVisible:!s}))};return a?(0,n.jsx)("div",{className:st.wrapper,children:(0,n.jsxs)(_n.e,{children:[(0,n.jsx)(fe.I,{className:st.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:r,onClick:i,"data-testid":j.Tp.components.PanelEditor.toggleVizPicker,"aria-label":"Change Visualization",variant:"canvas",fullWidth:!0,children:a.meta.name}),(0,n.jsx)(fe.I,{tooltip:s?"Close options pane":"Show options pane",icon:s?"angle-right":"angle-left",onClick:u,variant:"canvas","data-testid":j.Tp.components.PanelEditor.toggleVizOptions,"aria-label":s?"Close options pane":"Show options pane"})]})}):null};be.displayName="VisualizationTab";const st={wrapper:(0,h.css)({display:"flex",flexDirection:"column"}),vizButton:(0,h.css)({textAlign:"left"})};var ta=o(78685),na=o(67647),rt=o(15054),ot=o(14792),aa=o(68313),sa=o(96227),ra=o(96374);const oa=({onConfirm:e,onDismiss:t,panel:a})=>{const s=(0,nt.X)(a),r=`${s?"Changing":"Replace with"} library panel`,i=`${s?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return(0,n.jsx)(ra.u,{onConfirm:e,onDismiss:t,confirmText:s?"Change":"Replace",title:r,body:i,dismissText:"Cancel",isOpen:!0})};var ia=o(83791);const la=({panel:e,searchQuery:t,isWidget:a=!1})=>{const[s,r]=(0,p.useState)(!1),[i,u]=(0,p.useState)(void 0),[d,c]=(0,p.useState)([]),l=(0,p.useCallback)(T=>{c(T.map(M=>M.id))},[c]),g=(0,ot.UA)().getCurrent(),m=(0,f.useDispatch)(),v=async()=>{i&&(u(void 0),m((0,le.Xk)(e,i)))},N=()=>r(!0),C=()=>u(void 0);return(0,n.jsxs)(te.gW,{spacing:"md",children:[!e.libraryPanel&&(0,n.jsx)(te.gW,{align:"center",children:(0,n.jsx)(S.$n,{icon:"plus",onClick:N,variant:"secondary",fullWidth:!0,children:"Create new library panel"})}),(0,n.jsx)(aa.$,{onChange:l,isWidget:a}),(0,n.jsx)("div",{className:da.libraryPanelsView,children:(0,n.jsx)(ia.y,{currentPanelId:e.libraryPanel?.uid,searchString:t,panelFilter:d,onClickCard:u,showSecondaryActions:!0,isWidget:a})}),s&&(0,n.jsx)(sa.o,{panel:e,onDismiss:()=>r(!1),initialFolderUid:g?.meta.folderUid,isOpen:s}),i&&(0,n.jsx)(oa,{panel:e,onDismiss:C,onConfirm:v})]})},da={libraryPanelsView:(0,h.css)`
    width: 100%;
  `};var ca=o(56707),it=o(86292),P=o(32696);const lt=({panel:e,data:t})=>{const a=(0,f.useSelector)(at(e.type)),[s,r]=(0,p.useState)(""),i=!!a.meta.skipDataQuery,u=!!(i&&x.$.featureToggles.vizAndWidgetSplit),d=u?rt.MM:rt.wV,c=u?P.__.Widgets:P.__.Visualizations,[l,g]=(0,ta.A)(d,c),m=(0,f.useDispatch)(),v=(0,y.of)(ua),N=(0,p.useRef)(null),C=(0,p.useCallback)(D=>{m((0,le.gW)({panel:e,...D})),D.withModKey||m((0,A.eK)(!1))},[m,e]),T=()=>{m((0,A.eK)(!1))};if(!a)return null;const M=[{label:"Visualizations",value:P.__.Visualizations},{label:"Suggestions",value:P.__.Suggestions},{label:"Library panels",value:P.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}],I=[{label:"Widgets",value:P.__.Widgets},{label:"Library panels",value:P.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return(0,n.jsxs)("div",{className:v.openWrapper,children:[(0,n.jsxs)("div",{className:v.formBox,children:[(0,n.jsxs)("div",{className:v.searchRow,children:[(0,n.jsx)(na.Z,{value:s,onChange:r,ref:N,autoFocus:!0,placeholder:"Search for..."}),(0,n.jsx)(S.$n,{title:"Close",variant:"secondary",icon:"angle-up",className:v.closeButton,"aria-label":j.Tp.components.PanelEditor.toggleVizPicker,onClick:T})]}),(0,n.jsx)(ee.D,{className:v.customFieldMargin,children:(0,n.jsx)(qe.z,{options:u?I:M,value:l,onChange:g,fullWidth:!0})})]}),(0,n.jsx)("div",{className:v.scrollWrapper,children:(0,n.jsx)(ie.E,{autoHeightMin:"100%",children:(0,n.jsxs)("div",{className:v.scrollContent,children:[l===P.__.Visualizations&&(0,n.jsx)(it.G,{pluginId:a.meta.id,onChange:C,searchQuery:s}),l===P.__.Widgets&&(0,n.jsx)(it.G,{pluginId:a.meta.id,onChange:C,searchQuery:s,isWidget:!0}),l===P.__.Suggestions&&(0,n.jsx)(ca.a,{onChange:C,searchQuery:s,panel:e,data:t}),l===P.__.LibraryPanels&&(0,n.jsx)(la,{searchQuery:s,panel:e,isWidget:i},"Panel Library")]})})})]})};lt.displayName="VisualizationSelectPane";const ua=e=>({icon:(0,h.css)({color:e.v1.palette.gray33}),wrapper:(0,h.css)({display:"flex",flexDirection:"column",flex:"1 1 0",height:"100%"}),vizButton:(0,h.css)({textAlign:"left"}),scrollWrapper:(0,h.css)({flexGrow:1,minHeight:0}),scrollContent:(0,h.css)({padding:e.spacing(1)}),openWrapper:(0,h.css)({display:"flex",flexDirection:"column",flex:"1 1 100%",height:"100%",background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`}),searchRow:(0,h.css)({display:"flex",marginBottom:e.spacing(1)}),closeButton:(0,h.css)({marginLeft:e.spacing(1)}),customFieldMargin:(0,h.css)({marginBottom:e.spacing(1)}),formBox:(0,h.css)({padding:e.spacing(1),paddingBottom:0})}),ha=({plugin:e,panel:t,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r,dashboard:i,instanceState:u})=>{const d=(0,y.of)(pa),c=(0,f.useSelector)(g=>g.panelEditor.isVizPickerOpen),{data:l}=pe(t,{withTransforms:!0,withFieldConfig:!1},!0);return(0,n.jsxs)("div",{className:d.wrapper,"data-testid":j.Tp.components.PanelEditor.OptionsPane.content,children:[!c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:d.vizButtonWrapper,children:(0,n.jsx)(be,{panel:t})}),(0,n.jsx)("div",{className:d.optionsWrapper,children:(0,n.jsx)(qn.Ff,{panel:t,dashboard:i,plugin:e,instanceState:u,data:l,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r})})]}),c&&(0,n.jsx)(lt,{panel:t,data:l})]})},pa=e=>({wrapper:(0,h.css)({height:"100%",width:"100%",display:"flex",flex:"1 1 0",flexDirection:"column",padding:0}),optionsWrapper:(0,h.css)({flexGrow:1,minHeight:0}),vizButtonWrapper:(0,h.css)({padding:`0 ${e.spacing(2,2)} 0`}),legacyOptions:(0,h.css)({label:"legacy-options",".panel-options-grid":{display:"flex",flexDirection:"column"},".panel-options-group":{marginBottom:0},".panel-options-group__body":{padding:`${e.spacing(2)} 0`},".section":{display:"block",margin:`${e.spacing(2)} 0`,"&:first-child":{marginTop:0}}})});var dt=o(3591),ga=o(91052),fa=o(20726),ma=o(36663),va=(e=>(e.Error="Error",e.Info="Info",e.Links="Links",e))(va||{});class xa extends p.Component{constructor(){super(...arguments),this.timeSrv=(0,$.jG)(),this.getInfoMode=()=>{const{panel:t,error:a}=this.props;if(a)return"Error";if(t.description)return"Info";if(t.links&&t.links.length)return"Links"},this.getInfoContent=()=>{const{panel:t,theme:a}=this.props,s=t.description||"",r=(0,Ye.w)().replace(s,t.scopedVars),i=(0,ma.G)(r),u=this.props.links&&this.props.links.getLinks(t.replaceVariables),d=Pa(a);return(0,n.jsxs)("div",{className:d.content,children:[(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:i}}),u&&u.length>0&&(0,n.jsx)("ul",{className:d.cornerLinks,children:u.map((c,l)=>(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:c.href,target:c.target,children:c.title})},l))})]})},this.onClickError=()=>{b.Ny.partial({inspect:this.props.panel.id,inspectTab:w.q.Error})}}render(){const{error:t}=this.props,a=this.getInfoMode();return a?a==="Error"&&t?(0,n.jsx)(ct,{infoMode:a,content:t,onClick:this.onClickError}):a==="Info"||a==="Links"?(0,n.jsx)(ct,{infoMode:a,content:this.getInfoContent}):null:null}}const ba=(0,y.cV)(xa);function ct({infoMode:e,content:t,onClick:a}){const s=e==="Error"?"error":"info",r=j.Tp.components.Panels.Panel.headerCornerInfo(e.toLowerCase()),i=(0,y.of)(Sa);return(0,n.jsx)(ve.m,{content:t,placement:"top-start",theme:s,interactive:!0,children:(0,n.jsxs)("button",{type:"button",className:i.infoCorner,onClick:a,"aria-label":r,children:[(0,n.jsx)(Z.I,{name:ya[e],size:e==="Links"?"sm":"lg",className:(0,h.cx)(i.icon,{[i.iconLinks]:e==="Links"})}),(0,n.jsx)("span",{className:(0,h.cx)(i.inner,{[i.error]:e==="Error"})})]})})}const ya={Error:"exclamation",Info:"info",Links:"external-link-alt"},Pa=e=>({content:(0,h.css)({overflow:"auto",code:{whiteSpace:"normal",wordWrap:"break-word"},"pre > code":{display:"block"}}),cornerLinks:(0,h.css)({listStyle:"none",paddingLeft:0})}),Sa=e=>({icon:(0,h.css)({position:"absolute",top:0,left:0,zIndex:2,fill:e.colors.text.maxContrast}),iconLinks:(0,h.css)({left:e.spacing(.5),top:e.spacing(.25)}),inner:(0,h.css)({width:0,height:0,position:"absolute",left:0,bottom:0,borderBottom:`${e.spacing(4)} solid transparent`,borderLeft:`${e.spacing(4)} solid ${e.colors.background.secondary}`}),error:(0,h.css)({borderLeftColor:e.colors.error.main}),infoCorner:(0,h.css)({background:"none",border:"none",color:e.colors.text.secondary,cursor:"pointer",position:"absolute",left:0,top:0,width:e.spacing(4),height:e.spacing(4),zIndex:3})});function ja({width:e,height:t,panel:a,dashboard:s}){const{data:r}=pe(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,u]=(0,p.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,p.useEffect)(()=>{const c=(0,$.jG)(),l=a.events.subscribe(dt._,()=>{const g=(0,Oe.nk)(a,c.timeRange());a.runAllPanelQueries({dashboardUID:s.uid,dashboardTimezone:s.getTimezone(),timeData:g,width:e})});return()=>{l.unsubscribe()}},[a,s,e]),!r)return null;const d=r?.errors?r.errors.length>1?"Multiple errors found. Click for more details":r.errors[0].message:r?.error?.message;return(0,n.jsx)(ga.NR,{width:e,height:t,padding:"none",children:(c,l)=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ba,{panel:a,error:d}),(0,n.jsx)(fa.m,{title:"Raw data",pluginId:"table",width:c,height:l,data:r,options:i,onOptionsChange:u})]})})}var ut=o(69731),ht=o(8984),Ca=o(40980),pt=o(27747);const Ta=({panel:e,dashboard:t,...a})=>{const{rules:s,loading:r}=(0,pt.S)({panelId:e.id,dashboardUID:t.uid});return(0,n.jsx)(_.o,{...a,counter:r?null:s.length})};var Da=o(39558),Na=o(76885),gt=o(25027),Ea=o(63066);const ft=({dashboard:e,panel:t,className:a})=>{const s=(0,f.useSelector)(c=>c.templating),r=(0,L.zy)(),{loading:i,value:u}=(0,W.A)(()=>(0,Ea.mp)(t,e),[t,e,s]);if(i)return(0,n.jsx)(S.$n,{disabled:!0,children:"New alert rule"});if(!u)return(0,n.jsx)(B.F,{severity:"info",title:"No alerting capable query found",children:"Cannot create alerts from this panel because no query to an alerting capable datasource is found."});const d=Na.kM.renderUrl("alerting/new",{defaults:JSON.stringify(u),returnTo:r.pathname+r.search});return(0,n.jsx)(S.z9,{icon:"bell",onClick:()=>(0,gt.fH)(gt.le.alertRuleFromPanel),href:d,className:a,"data-testid":"create-alert-rule-button",children:"New alert rule"})};var Ma=o(80215),mt=o(75471),wa=o(56361);const Ia=({dashboard:e,panel:t})=>{const a=(0,y.of)(La),{errors:s,loading:r,rules:i}=(0,pt.S)({dashboardUID:e.uid,panelId:t.id,poll:!0}),u=(0,mt.Wd)("grafana"),d=U.TP.hasPermission(u.create),c=s.length?(0,n.jsx)(B.F,{title:"Errors loading rules",severity:"error",children:s.map((l,g)=>(0,n.jsxs)("div",{children:["Failed to load Grafana rules state: ",(0,wa.JZ)(l)]},g))}):null;return r&&!i.length?(0,n.jsxs)("div",{className:a.innerWrapper,children:[c,(0,n.jsx)(Da._,{text:"Loading rules..."})]}):i.length?(0,n.jsx)(ie.E,{autoHeightMin:"100%",children:(0,n.jsxs)("div",{className:a.innerWrapper,children:[c,(0,n.jsx)(Ma.s,{rules:i}),!!e.meta.canSave&&d&&(0,n.jsx)(ft,{className:a.newButton,panel:t,dashboard:e})]})}):(0,n.jsxs)("div",{"data-testid":j.Tp.components.PanelAlertTabContent.content,className:a.noRulesWrapper,children:[c,!!e.uid&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"There are no alert rules linked to this panel."}),!!e.meta.canSave&&d&&(0,n.jsx)(ft,{panel:t,dashboard:e})]}),!e.uid&&!!e.meta.canSave&&(0,n.jsx)(B.F,{severity:"info",title:"Dashboard not saved",children:"Dashboard must be saved before alerts can be added."})]})},La=e=>({newButton:(0,h.css)({marginTop:e.spacing(3)}),innerWrapper:(0,h.css)({padding:e.spacing(2)}),noRulesWrapper:(0,h.css)({margin:e.spacing(2),backgroundColor:e.colors.background.secondary,padding:e.spacing(3)})});var Ra=o(66879),vt=o(22391),Aa=o(47311),ye=o(31193),Fa=o(37464);class Ua extends p.PureComponent{constructor(t){super(t),this.updateLastUsedDatasource=a=>{(0,Aa.tw)(a)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{b.Ny.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:s}=this.props;s.updateQueries(a),a.dataSource.uid!==s.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(t){const a=t.datasource??{default:!0},s=(0,ye.tR)().getInstanceSettings(a);return this.updateLastUsedDatasource(a),{cacheTimeout:s?.meta.queryOptions?.cacheTimeout?t.cacheTimeout:void 0,dataSource:{default:s?.isDefault,...s?(0,vt.p$)(s):{type:void 0,uid:void 0}},queryCachingTTL:s?.cachingConfig?.enabled?t.queryCachingTTL:void 0,queries:t.targets,maxDataPoints:t.maxDataPoints,minInterval:t.interval,timeRange:{from:t.timeFrom,shift:t.timeShift,hide:t.hideTimeOverride}}}async componentDidMount(){const{panel:t}=this.props;if(!t.datasource){let a;const s=(0,ot.UA)().getCurrent()?.uid??"",r=(0,Ae.CW)(s);r?.datasourceUid!==null&&(a=(0,ye.tR)().getInstanceSettings(r?.datasourceUid)),a||(a=(0,ye.tR)().getInstanceSettings(null)),t.datasource=(0,vt.p$)(a),this.forceUpdate()}}render(){const{panel:t}=this.props;if(!t.datasource)return null;const a=this.buildQueryOptions(t);return(0,n.jsx)(Fa.g,{options:a,queryRunner:t.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const xt=(0,p.memo)(({panel:e,dashboard:t,tabs:a,onChangeTab:s})=>{const r=(0,ut.C)(),i=(0,y.of)(za),u=(0,p.useCallback)(l=>{let g="panel_editor_tabs_changed";x.$.featureToggles.transformationsRedesign&&(g="transformations_redesign_"+g),l.active||(0,Me.rR)(g,{tab_id:l.id}),s(l)},[s]);(0,p.useEffect)(()=>{const l=new Xe.yU;return l.add(e.events.subscribe(R.zq,r)),l.add(e.events.subscribe(R.JI,r)),()=>l.unsubscribe()},[e,t,r]);const d=a.find(l=>l.active);if(a.length===0)return null;const c=x.$.unifiedAlertingEnabled;return(0,n.jsxs)("div",{className:i.wrapper,children:[(0,n.jsx)(ue.U,{className:i.tabBar,hideBorder:!0,children:a.map(l=>l.id===P.M8.Alert&&c?(0,n.jsx)(Ta,{label:l.text,active:l.active,onChangeTab:()=>s(l),icon:(0,ht.toIconName)(l.icon),panel:e,dashboard:t},l.id):(0,n.jsx)(_.o,{label:l.text,active:l.active,onChangeTab:()=>u(l),icon:(0,ht.toIconName)(l.icon),counter:Oa(e,l)},l.id))}),(0,n.jsxs)(Ca.J,{className:i.tabContent,children:[d.id===P.M8.Query&&(0,n.jsx)(Ua,{panel:e,queries:e.targets}),d.id===P.M8.Alert&&(0,n.jsx)(Ia,{panel:e,dashboard:t}),d.id===P.M8.Transform&&(0,n.jsx)(Ra.o,{panel:e})]})]})});xt.displayName="PanelEditorTabs";function Oa(e,t){switch(t.id){case P.M8.Query:return e.targets.length;case P.M8.Alert:return e.alert?1:0;case P.M8.Transform:return(e.getTransformations()??[]).length}return null}const za=e=>({wrapper:(0,h.css)({display:"flex",flexDirection:"column",height:"100%"}),tabBar:(0,h.css)({paddingLeft:e.spacing(2)}),tabContent:(0,h.css)({padding:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,background:e.colors.background.primary,border:`1px solid ${e.components.panel.borderColor}`,borderLeft:"none",borderBottom:"none",borderTopRightRadius:e.shape.borderRadius(1.5)})});var Va=o(41811),Ba=o(2913),$a=o(57220);const Wa=(0,Va.A)((e,t)=>{const a=[];if(!t)return a;let s=P.M8.Visualize;if(t.meta.skipDataQuery)return[];t.meta.skipDataQuery||(s=P.M8.Query,a.push({id:P.M8.Query,text:"Query",icon:"database",active:!1}),a.push({id:P.M8.Transform,text:"Transform data",icon:"process",active:!1})),Ga(t)&&a.push({id:P.M8.Alert,text:"Alert",icon:"bell",active:!1});const r=a.find(i=>i.id===(e||s))??a[0];return r.active=!0,a});function Ga(e){const{unifiedAlertingEnabled:t=!1}=(0,Ba.zj)(),a=U.TP.hasPermission((0,mt.Wd)($a.hY).read);if(!(t&&a))return!1;const r=e.meta.id==="graph",i=e.meta.id==="timeseries";return r||i}var Qa=o(54612);const Ha=(e,t)=>{const a=e.panelEditor.getPanel(),s=(0,Qe.U)(e,a);return{panel:a,plugin:s?.plugin,instanceState:s?.instanceState,initDone:e.panelEditor.initDone,uiState:e.panelEditor.ui,tableViewEnabled:e.panelEditor.tableViewEnabled,variables:(0,xe.SS)(t.dashboard.uid,e)}},Ka={initPanelEditor:rn,discardPanelChanges:Ve,updatePanelEditorUIState:de,updateTimeZoneForSession:kn.Cj,toggleTableView:A.kw,notifyApp:De.dx},ka=(0,Y.connect)(Ha,Ka);class Ja extends p.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{b.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{$n.lE.publish(new R.S8({component:Xn.$,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,nt.X)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=t=>{b.Ny.partial({tab:t.id})},this.onFieldConfigChange=t=>{this.props.panel.updateFieldConfig({...t})},this.onPanelOptionsChanged=t=>{this.props.panel.updateOptions(t)},this.onPanelConfigChanged=(t,a)=>{this.props.panel.setProperty(t,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=t=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:t})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{b.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:t,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new Xe.yU,this.eventSubs.add(t.events.subscribe(R.PR,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(t,a){const{dashboard:s,panel:r,uiState:i,tableViewEnabled:u,theme:d}=this.props;return(0,n.jsxs)("div",{className:t.mainPaneWrapper,children:[this.renderPanelToolbar(t),(0,n.jsx)("div",{className:t.panelWrapper,children:(0,n.jsx)(ce.Ay,{children:({width:c,height:l})=>{if(c<3||l<3)return null;if(a&&(l-=d.spacing.gridSize*2),u)return(0,n.jsx)(ja,{width:c,height:l,panel:r,dashboard:s});const g=(0,Qa.A)(i.mode,c,l,r);return(0,n.jsx)("div",{className:t.centeringContainer,style:{width:c,height:l},children:(0,n.jsx)("div",{style:g,"data-panelid":r.id,children:(0,n.jsx)(Yn.L,{stateKey:r.key,dashboard:s,panel:r,isEditing:!0,isViewing:!1,lazy:!1,width:g.width,height:g.height},r.key)})})}})})]},"panel")}renderPanelAndEditor(t,a){const{panel:s,dashboard:r,plugin:i,tab:u}=this.props,d=Wa(u,i),c=d.length===0,l=this.renderPanel(a,c);return d.length===0?(0,n.jsx)("div",{className:a.onlyPanel,children:l}):(0,n.jsxs)(et.g,{splitOrientation:"horizontal",maxSize:-200,paneSize:t.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:g=>{g&&de({topPaneSize:g/window.innerHeight})},children:[l,(0,n.jsx)("div",{className:a.tabsWrapper,"data-testid":j.Tp.components.PanelEditor.DataPane.content,children:(0,n.jsx)(xt,{panel:s,dashboard:r,tabs:d,onChangeTab:this.onChangeTab},s.key)},"panel-editor-tabs")]})}renderTemplateVariables(t){const{variables:a}=this.props;return a.length?(0,n.jsx)("div",{className:t.variablesWrapper,children:(0,n.jsx)(tt,{variables:a})}):null}renderPanelToolbar(t){const{dashboard:a,uiState:s,variables:r,updateTimeZoneForSession:i,panel:u,tableViewEnabled:d}=this.props;return(0,n.jsx)("div",{className:t.panelToolbar,children:(0,n.jsxs)(te.Gy,{justify:r.length>0?"space-between":"flex-end",align:"flex-start",children:[this.renderTemplateVariables(t),(0,n.jsxs)(Q.B,{gap:1,children:[(0,n.jsx)(H.K,{label:"Table view",showLabel:!0,id:"table-view",value:d,onClick:this.onToggleTableView,"data-testid":j.Tp.components.PanelEditor.toggleTableView}),(0,n.jsx)(qe.z,{value:s.mode,options:P.Nt,onChange:this.onDisplayModeChange}),(0,n.jsx)(Zn.$,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!s.isPanelOptionsVisible&&(0,n.jsx)(be,{panel:u})]})]})})}renderEditorActions(){const t="sm";let a=[(0,n.jsx)(S.$n,{onClick:this.onDiscard,title:"Undo all changes",size:t,variant:"destructive",fill:"outline",children:"Discard"},"discard"),this.props.dashboard.meta.canSave&&(this.props.panel.libraryPanel?(0,n.jsx)(S.$n,{onClick:this.onSaveLibraryPanel,variant:"primary",size:t,title:"Apply changes and save library panel",children:"Save library panel"},"save-panel"):(0,n.jsx)(S.$n,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",size:t,variant:"secondary",children:"Save"},"save")),(0,n.jsx)(S.$n,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":j.Tp.components.PanelEditor.applyButton,size:t,children:"Apply"},"apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,(0,n.jsx)(E.$s,{children:({showModal:s,hideModal:r})=>(0,n.jsx)(fe.I,{onClick:()=>{s(Jn.l,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:r,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",children:"Unlink"},"unlink")},"unlink-controller")),a.pop()),a}renderOptionsPane(){const{plugin:t,dashboard:a,panel:s,instanceState:r}=this.props;return t?(0,n.jsx)(ha,{plugin:t,dashboard:a,panel:s,instanceState:r,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):(0,n.jsx)("div",{})}render(){const{initDone:t,uiState:a,theme:s,sectionNav:r,pageNav:i,className:u,updatePanelEditorUIState:d}=this.props,c=Za(s,this.props);return t?(0,n.jsxs)(z.Y,{navModel:r,pageNav:i,"data-testid":j.Tp.components.PanelEditor.General.content,layout:O.k.Custom,className:u,children:[(0,n.jsx)(Bn.H,{actions:(0,n.jsx)(Vn.U,{alignment:"right",children:this.renderEditorActions()})}),(0,n.jsxs)("div",{className:c.wrapper,children:[(0,n.jsx)("div",{className:c.verticalSplitPanesWrapper,children:a.isPanelOptionsVisible?(0,n.jsxs)(et.g,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:l=>{l&&d({rightPaneSize:l/window.innerWidth})},children:[this.renderPanelAndEditor(a,c),this.renderOptionsPane()]}):this.renderPanelAndEditor(a,c)}),this.state.showSaveLibraryPanelModal&&(0,n.jsx)(Ue,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel})]})]}):null}}const Ya=(0,y.cV)(ka(Ja)),Za=(0,_e.N)((e,t)=>{const{uiState:a}=t,s=e.spacing(2);return{wrapper:(0,h.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:e.spacing(2)}),verticalSplitPanesWrapper:(0,h.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",position:"relative"}),mainPaneWrapper:(0,h.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",paddingRight:`${a.isPanelOptionsVisible?0:s}`}),variablesWrapper:(0,h.css)({label:"variablesWrapper",display:"flex",flexGrow:1,flexWrap:"wrap",gap:e.spacing(1,2)}),panelWrapper:(0,h.css)({flex:"1 1 0",minHeight:0,width:"100%",paddingLeft:s}),tabsWrapper:(0,h.css)({height:"100%",width:"100%"}),panelToolbar:(0,h.css)({display:"flex",padding:`0 0 ${s} ${s}`,justifyContent:"space-between",flexWrap:"wrap"}),angularWarning:(0,h.css)({display:"flex",height:e.spacing(4),alignItems:"center"}),toolbarLeft:(0,h.css)({paddingLeft:e.spacing(1)}),centeringContainer:(0,h.css)({display:"flex",justifyContent:"center",alignItems:"center",position:"relative",flexDirection:"column"}),onlyPanel:(0,h.css)({height:"100%",position:"absolute",overflow:"hidden",width:"100%"})}});var Xa=o(1702),qa=o(39268),_a=o(14186),es=o(89963),ts=o(42972);const ns=({annotation:e,events:t,onEnabledChanged:a})=>{const[s,r]=(0,p.useState)(!1),i=(0,y.of)(as),u=()=>(0,ts.Dh)().cancel(e);return(0,p.useEffect)(()=>{const d=t.getStream(R.xc).subscribe({next:l=>{l.payload===e&&r(!0)}}),c=t.getStream(R.yj).subscribe({next:l=>{l.payload===e&&r(!1)}});return()=>{d.unsubscribe(),c.unsubscribe()}}),(0,n.jsx)("div",{className:i.annotation,children:(0,n.jsxs)(qa.C,{children:[(0,n.jsx)(_a.I,{label:e.name,disabled:s,"data-testid":j.Tp.pages.Dashboard.SubMenu.Annotations.annotationLabel(e.name),children:(0,n.jsx)(H.K,{label:e.name,value:e.enable,onChange:()=>a(e),disabled:s,"data-testid":j.Tp.pages.Dashboard.SubMenu.Annotations.annotationToggle(e.name)})}),(0,n.jsx)("div",{className:i.indicator,children:(0,n.jsx)(es.I,{loading:s,onCancel:u})})]})},e.name)};function as(e){return{annotation:(0,h.css)({display:"inline-block",marginRight:e.spacing(1),".fa-caret-down":{fontSize:"75%",paddingLeft:e.spacing(1)},".gf-form-inline .gf-form":{marginBottom:0}}),indicator:(0,h.css)({alignSelf:"center",padding:`0 ${e.spacing(.5)}`})}}const ss=({annotations:e,onAnnotationChanged:t,events:a})=>{const[s,r]=(0,p.useState)([]);return(0,p.useEffect)(()=>{r(e.filter(i=>i.hide!==!0))},[e]),s.length===0?null:(0,n.jsx)("div",{"data-testid":j.Tp.pages.Dashboard.SubMenu.Annotations.annotationsWrapper,children:s.map(i=>(0,n.jsx)(ns,{events:a,annotation:i,onEnabledChanged:t},i.name))})};var rs=o(94701),os=o(80997),is=o(4588),ls=o(6923),bt=o(52424);const ds=({dashboard:e,links:t})=>{const a=(0,ut.C)();return(0,rs.A)(()=>{const s=e.events.subscribe(dt.sR,a);return()=>s.unsubscribe()}),t.length?(0,n.jsx)(n.Fragment,{children:t.map((s,r)=>{const i=(0,ls.mQ)().getAnchorInfo(s),u=`${s.title}-$${r}`;if(s.type==="dashboards")return(0,n.jsx)(bt.aK,{link:s,linkInfo:i,dashboardUID:e.uid},u);const d=is.G[s.icon],c=(0,n.jsx)(bt.Zx,{href:(0,os.Jf)(i.href),target:s.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":j.Tp.components.DashboardLinks.link,icon:d,children:i.title});return(0,n.jsx)("div",{"data-testid":j.Tp.components.DashboardLinks.container,children:s.tooltip?(0,n.jsx)(ve.m,{content:i.tooltip,children:c}):c},u)})}):null};class cs extends p.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=t=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const s=this.props.dashboard.annotations.list[a];if(s.name===t.name){s.enable=!s.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=t=>{t.preventDefault()}}render(){const{dashboard:t,variables:a,links:s,annotations:r,theme:i}=this.props,u=hs(i),d=t.meta.isSnapshot??!1;return(0,n.jsxs)("div",{className:u.submenu,children:[(0,n.jsx)("form",{"aria-label":"Template variables",className:u.formStyles,onSubmit:this.disableSubmitOnEnter,children:(0,n.jsx)(tt,{variables:a,readOnly:d})}),(0,n.jsx)(ss,{annotations:r,onAnnotationChanged:this.onAnnotationStateChanged,events:t.events}),(0,n.jsx)("div",{className:u.spacer}),t&&(0,n.jsx)(ds,{dashboard:t,links:s})]})}}const us=(e,t)=>{const{uid:a}=t.dashboard,s=(0,xe.nx)(a,e);return{variables:(0,xe.pi)(a,s.variables)}},hs=(0,_e.N)(e=>({formStyles:(0,h.css)({display:"contents",flexWrap:"wrap"}),submenu:(0,h.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignContent:"flex-start",alignItems:"flex-start",gap:`${e.spacing(1)} ${e.spacing(2)}`,padding:`0 0 ${e.spacing(1)} 0`}),spacer:(0,h.css)({flexGrow:1})})),yt=(0,y.cV)((0,Y.connect)(us)(cs));yt.displayName="SubMenu";var ps=o(2118),gs=o(61582),Pt=o(84423),fs=o(3673);const ms=e=>({initPhase:e.dashboard.initPhase,initError:e.dashboard.initError,dashboard:e.dashboard.getModel(),navIndex:e.navIndex}),vs={initDashboard:V.vR,cleanUpDashboardAndVariables:fs.Bz,notifyApp:De.dx,cancelVariables:Le.Y7,templateVarsChangedInUrl:Le.Hn},xs=(0,Y.connect)(ms,vs);class bs extends p.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let t;this.props.dashboard?.liveNow&&(t=(0,$.jG)().timeRange()),gs.a.setLiveTimeRange(t)},this.setScrollRef=t=>{this.setState({scrollElement:t})},this.onCloseShareModal=()=>{b.Ny.partial({shareView:null})}}static{this.contextType=Rt.YE}getCleanState(){return{editView:null,editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:t,match:a,queryParams:s}=this.props;t&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:s.folderUid,panelType:s.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(t,a){const{dashboard:s,match:r,templateVarsChangedInUrl:i}=this.props,u=this.props.history.location.state?.routeReloadCounter;if(s){if(t.match.params.uid!==r.params.uid||u!==void 0&&this.forceRouteReloadCounter!==u){this.initDashboard(),this.forceRouteReloadCounter=u;return}if(t.location.search!==this.props.location.search){const d=t.queryParams,c=this.props.queryParams;(c?.from!==d?.from||c?.to!==d?.to)&&((0,$.jG)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!d?.refresh&&c?.refresh&&(0,$.jG)().setAutoRefresh(c.refresh);const l=(0,Kt.Wz)(this.props.queryParams,t.queryParams);l&&i(s.uid,l)}this.state.editPanel&&!a.editPanel&&(Ee.t.setEditingState(!0),this.props.dashboard?.events.publish(new R.sL(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(Ee.t.setEditingState(!1),this.props.dashboard?.events.publish(new R.i0(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,Ne.gi)("Permission to edit panel denied")),b.Ny.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,Ne.gi)("Panel not found")),b.Ny.partial({editPanel:null,viewPanel:null})),x.$.featureToggles.bodyScrolling&&this.state.updateScrollTop!==void 0&&this.state.updateScrollTop!==a.updateScrollTop&&window.scrollTo(0,this.state.updateScrollTop)}}static getDerivedStateFromProps(t,a){const{dashboard:s,queryParams:r}=t,i=r.editPanel,u=r.viewPanel,d=r.editview;if(!s)return a;const c={...a};if(x.$.featureToggles.bodyScrolling&&(!a.editView&&d?(c.editView=d,c.rememberScrollTop=window.scrollY,c.updateScrollTop=0):a.editView&&!d&&(c.updateScrollTop=a.rememberScrollTop,c.editView=null)),!a.editPanel&&i){const l=s.getPanelByUrlId(i);l?s.canEditPanel(l)?(c.editPanel=l,c.rememberScrollTop=x.$.featureToggles.bodyScrolling?window.scrollY:a.scrollElement?.scrollTop,x.$.featureToggles.bodyScrolling&&(c.updateScrollTop=0)):c.editPanelAccessDenied=!0:c.panelNotFound=!0}else a.editPanel&&!i&&(c.editPanel=null,c.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&u){const l=s.getPanelByUrlId(u);l?(s.initViewPanel(l),c.viewPanel=l,c.rememberScrollTop=x.$.featureToggles.bodyScrolling?window.scrollY:a.scrollElement?.scrollTop,c.updateScrollTop=0):c.panelNotFound=!0}else a.viewPanel&&!u&&(s.exitViewPanel(a.viewPanel),c.viewPanel=null,c.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(c.panelNotFound=!1,c.editPanelAccessDenied=!1),ys(t,c)}getInspectPanel(){const{dashboard:t,queryParams:a}=this.props,s=a.inspect;if(!t||!s)return null;const r=t.getPanelById(parseInt(s,10));return r||null}render(){const{dashboard:t,initError:a,queryParams:s}=this.props,{editPanel:r,viewPanel:i,updateScrollTop:u,pageNav:d,sectionNav:c}=this.state,l=At(this.props.queryParams);if(!t||!d||!c)return(0,n.jsx)(qt.P,{initPhase:this.props.initPhase});const g=this.getInspectPanel(),m=!r&&!l&&!this.props.queryParams.editview&&t.isSubMenuVisible(),v=l!==f.KioskMode.Full&&!s.editview,N=(0,h.cx)({"panel-in-fullscreen":!!i,"page-hidden":!!(s.editview||r)});if(t.meta.dashboardNotFound)return(0,n.jsx)(z.Y,{navId:"dashboards/browse",layout:O.k.Canvas,pageNav:{text:"Not found"},children:(0,n.jsx)(Lt.L,{entity:"Dashboard"})});const C=new Set(["autoMigrateOldPanels","autoMigrateGraphPanel","autoMigrateTablePanel","autoMigratePiechartPanel","autoMigrateWorldmapPanel","autoMigrateStatPanel","disableAngular"]),T=()=>{const D=new URLSearchParams(window.location.search);let se=!1;return D.forEach((Ct,Tt)=>{if(Tt.startsWith("__feature.")){const Dt=Tt.substring(10),js=Ct==="true"||Ct==="";if(x.$.featureToggles[Dt])return;if(C.has(Dt)&&js){se=!0;return}}}),se},M=t.panels.some(D=>D.autoMigrateFrom&&Pt.NB[D.autoMigrateFrom]!=null),I=x.$.featureToggles.angularDeprecationUI&&M&&T()&&t.uid!==null;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(z.Y,{navModel:c,pageNav:d,layout:O.k.Canvas,className:N,scrollRef:this.setScrollRef,scrollTop:u,children:[v&&(0,n.jsx)("header",{"data-testid":j.Tp.pages.Dashboard.DashNav.navV2,children:(0,n.jsx)(Zt.U,{dashboard:t,title:t.title,folderTitle:t.meta.folderTitle,isFullscreen:!!i,kioskMode:l,hideTimePicker:t.timepicker.hidden})}),(0,n.jsx)(Be,{dashboard:t}),a&&(0,n.jsx)(Xt.y,{}),m&&(0,n.jsx)("section",{"aria-label":j.Tp.pages.Dashboard.SubMenu.submenu,children:(0,n.jsx)(yt,{dashboard:t,annotations:t.annotations.list,links:t.links})}),x.$.featureToggles.angularDeprecationUI&&t.hasAngularPlugins()&&t.uid!==null&&(0,n.jsx)(Bt,{dashboardUid:t.uid,showAutoMigrateLink:t.panels.some(D=>Pt.vI.includes(D.type))}),I&&(0,n.jsx)(Qt,{dashboardUid:t.uid}),(0,n.jsx)(ps.N,{dashboard:t,isEditable:!!t.meta.canEdit,viewPanel:i,editPanel:r}),g&&(0,n.jsx)(zn,{dashboard:t,panel:g}),s.shareView&&(0,n.jsx)(Xa.ShareModal,{dashboard:t,onDismiss:this.onCloseShareModal})]}),r&&(0,n.jsx)(Ya,{dashboard:t,sourcePanel:r,tab:this.props.queryParams.tab,sectionNav:c,pageNav:d}),s.editview&&(0,n.jsx)(pn.s,{dashboard:t,editview:s.editview,pageNav:d,sectionNav:c}),s.addWidget&&x.$.featureToggles.vizAndWidgetSplit&&(0,n.jsx)(Jt,{})]})}}function ys(e,t){const{dashboard:a,navIndex:s}=e;if(!a)return t;let r=t.pageNav,i=t.sectionNav;if((!r||a.title!==r.text||a.meta.folderUrl!==r.parentItem?.url)&&(r={text:a.title,url:It.I.getUrlForPartial(e.history.location,{editview:null,editPanel:null,viewPanel:null})}),e.route.routeName===f.DashboardRoutes.Path){i=Ie();const d=we(e.match.params.slug);d?.parentItem&&(d.parentItem=d.parentItem)}else i=(0,oe.tc)(e.navIndex,Ft.L1+a.uid,(0,oe.tc)(e.navIndex,"dashboards/browse"));const{folderUid:u}=a.meta;if(u&&r&&i.main.id!=="starred"){const d=(0,oe.tc)(s,`folder-dashboards-${u}`).main;d.id!=="not-found"&&(r={...r,parentItem:d})}return(t.editPanel||t.viewPanel)&&(r={...r,text:`${t.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),t.pageNav===r&&t.sectionNav===i?t:{...t,pageNav:r,sectionNav:i}}const St=(0,y.cV)(bs);St.displayName="DashboardPage";const jt=xs(St);function Ps(e){const t=e.queryParams.scenes===!0,a=e.queryParams.scenes===!1;if(t||x.$.featureToggles.dashboardScene&&!a)return(0,n.jsx)(Te,{...e});const s=(0,Ce.sP)(),r=!!(e.route.routeName===f.DashboardRoutes.Home||e.route.routeName===f.DashboardRoutes.Normal&&e.match.params.uid),i=(0,W.A)(async()=>e.match.params.type==="snapshot"?null:s.fetchDashboard({route:e.route.routeName,uid:e.match.params.uid??"",keepDashboardFromExploreInLocalStorage:!0}),[e.match.params.uid,e.route.routeName]);return x.$.featureToggles.dashboardSceneForViewers?i.loading||i?.value?.dashboard?.uid!==e.match.params.uid&&i.value?.meta?.isNew!==!0?null:i.value&&!(i.value.meta?.canEdit||i.value.meta?.canMakeEditable)&&r?(0,n.jsx)(Te,{...e}):(0,n.jsx)(jt,{...e}):(0,n.jsx)(jt,{...e})}const Ss=Ps},53652:(Nt,k,o)=>{o.d(k,{E:()=>z,o:()=>J});var n=o(89667),W=o(57875),x=o(17172),p=o(32264),O=o(27677);class re{constructor(){}async get(f){const h=`api/storage/read/${f}`.replace("//","/");return(0,x.AI)().get(h)}async list(f){let h="api/storage/list/";f&&(h+=f+"/");const L=await(0,x.AI)().get(h);if(L?.data){const b=(0,n.or)(L);for(const E of b.fields)E.display=(0,W.J)({field:E,theme:p.$.theme2});return b}}async createFolder(f){const h=await(0,x.AI)().post("/api/storage/createFolder",JSON.stringify({path:f}));return h.success?{}:{error:h.message??"unknown error"}}async deleteFolder(f){const h=await(0,x.AI)().post("/api/storage/deleteFolder",JSON.stringify(f));return h.success?{}:{error:h.message??"unknown error"}}async deleteFile(f){const h=await(0,x.AI)().post(`/api/storage/delete/${f.path}`);return h.success?{}:{error:h.message??"unknown error"}}async delete(f){return f.isFolder?this.deleteFolder({path:f.path,force:!0}):this.deleteFile({path:f.path})}async upload(f,h,L){const b=new FormData;b.append("folder",f),b.append("file",h),b.append("overwriteExistingFile",String(L));const E=await fetch("/api/storage/upload",{method:"POST",body:b});let y=await E.json();return y||(y={}),y.status=E.status,y.statusText=E.statusText,E.status!==200&&!y.err&&(y.err=!0),y}async write(f,h){return O.IB.post(`/api/storage/write/${f}`,h)}async getConfig(){return(0,x.AI)().get("/api/storage/config")}async getOptions(f){return(0,x.AI)().get(`/api/storage/options/${f}`)}}function z(V,f){const L=V.toLowerCase().trim();return f.map(E=>E.trim().toLowerCase()).includes(L)}let G;function J(){return G||(G=new re),G}}}]);

//# sourceMappingURL=DashboardPageProxy.5bd2fc4e3c8c536d11d5.js.map