"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9119],{57582:(H,M,s)=>{s.r(M),s.d(M,{default:()=>F});var e=s(74848),o=s(96540),j=s(49785),T=s(41053),y=s(42418),R=s(17408),p=s(88575),L=s(10354),B=s(55852),x=s(69444),m=s(10096),f=s(31678),W=s(69546),c=s(17172),K=s(80714);const S=30,N=async n=>await(0,c.AI)().get(`/api/orgs/${n}`),h=async(n,t)=>m.TP.hasPermission(f.AccessControlAction.OrgUsersRead)?(0,c.AI)().get(`/api/orgs/${n}/users/search`,(0,K.F)({perpage:S,page:t})):{orgUsers:[]},v=async(n,t)=>{const d=t.map(i=>i.userId),u=await(0,c.AI)().post("/api/access-control/users/roles/search",{userIds:d,orgId:n});t.forEach(i=>{i.roles=u?u[i.userId]||[]:[]})},$=(n,t)=>(0,c.AI)().patch(`/api/orgs/${t}/users/${n.userId}`,n),b=(n,t)=>(0,c.AI)().delete(`/api/orgs/${t}/users/${n.userId}`),U=(n,t)=>(0,c.AI)().put(`/api/orgs/${t}`,{name:n}),F=({match:n})=>{const t=parseInt(n.params.id,10),d=m.TP.hasPermission(f.AccessControlAction.OrgsWrite),u=m.TP.hasPermission(f.AccessControlAction.OrgUsersRead),[i,_]=(0,o.useState)([]),[P,z]=(0,o.useState)(1),[I,O]=(0,o.useState)(1),[E,A]=(0,T.A)(()=>N(t),[]),{handleSubmit:Y,register:G,formState:{errors:a}}=(0,j.mN)(),[,r]=(0,T.A)(async l=>{const g=await h(t,l);m.TP.licensedAccessControlEnabled()&&await v(t,g.orgUsers);const w=g?.perPage!==0?Math.ceil(g.totalCount/g.perPage):0;return O(w),_(g.orgUsers),g.orgUsers},[]);(0,o.useEffect)(()=>{A(),r(P)},[A,r,P]);const C=async({orgName:l})=>{await U(l,t)},D=()=>(0,e.jsx)(y.F,{severity:"info",title:"Access denied",children:"You do not have permission to see users in this organization. To update this organization, contact your server administrator."}),J=l=>{z(l)},Q=async l=>{await b(l,t),r(P)},X=async(l,g)=>{await $({...g,role:l},t),r(P)},Z={text:E?.value?.name??"",icon:"shield",subTitle:"Manage settings and user roles for an organization."};return(0,e.jsx)(x.Y,{navId:"global-orgs",pageNav:Z,subTitle:"Manage settings for this specific org.",children:(0,e.jsx)(x.Y.Contents,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.s,{children:"Edit organization"}),E.value&&(0,e.jsxs)("form",{onSubmit:Y(C),style:{maxWidth:"600px"},children:[(0,e.jsx)(p.D,{label:"Name",invalid:!!a.orgName,error:"Name is required",disabled:!d,children:(0,e.jsx)(L.p,{...G("orgName",{required:!0}),id:"org-name-input",defaultValue:E.value.name})}),(0,e.jsx)(B.$n,{type:"submit",disabled:!d,children:"Update"})]}),(0,e.jsxs)("div",{style:{marginTop:"20px"},children:[(0,e.jsx)(R.s,{children:"Organization users"}),!u&&D(),u&&!!i.length&&(0,e.jsx)(W.b,{users:i,orgId:t,onRoleChange:X,onRemoveUser:Q,changePage:J,page:P,totalPages:I})]})]})})})}},69546:(H,M,s)=>{s.d(M,{b:()=>F});var e=s(74848),o=s(96540),j=s(13544),T=s(12942),y=s(94753),R=s(90613),p=s(56034),L=s(14578),B=s(78369),x=s(55852),m=s(67061),f=s(48840),W=s(19384),c=s(96374),K=s(89062),S=s(85927),N=s(46334),h=s(10096),v=s(31678),$=s(5133);const b=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,U=n=>{const t=n?.isExternallySynced;return!h.TP.hasPermissionInMetadata(v.AccessControlAction.OrgUsersWrite,n)||t},V=j.Tp.pages.UserListPage.UsersListPage,F=({users:n,orgId:t,onRoleChange:d,onRemoveUser:u,fetchData:i,changePage:_,page:P,totalPages:z,rolesLoading:I})=>{const[O,E]=(0,o.useState)(null),[A,Y]=(0,o.useState)([]);(0,o.useEffect)(()=>{async function a(){try{if(h.TP.hasPermission(v.AccessControlAction.ActionRolesList)){let r=await(0,S.RL)(t);Y(r)}}catch{console.error("Error loading options")}}h.TP.licensedAccessControlEnabled()&&a()},[t]);const G=(0,o.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:a}})=>a&&(0,e.jsx)(T.e,{src:a,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:a}})=>(0,e.jsx)("div",{children:a}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:a}})=>a,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:a}})=>a,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:a}})=>(0,e.jsx)(e.Fragment,{children:a&&(0,e.jsx)(e.Fragment,{children:a==="10 years"?(0,e.jsx)(y.E,{color:"disabled",children:"Never"}):a})}),sortType:(a,r)=>new Date(a.original.lastSeenAt).getTime()-new Date(r.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:a},row:{original:r}})=>{const C=U(r);return h.TP.licensedAccessControlEnabled()?(0,e.jsx)(K.y,{userId:r.userId,roles:r.roles||[],isLoading:I,orgId:t,roleOptions:A,basicRole:a,onBasicRoleChange:D=>d(D,r),basicRoleDisabled:C,basicRoleDisabledMessage:b,width:40}):(0,e.jsx)($.r,{"aria-label":"Role",value:a,disabled:C,onChange:D=>d(D,r)})}},{id:"info",header:"",cell:({row:{original:a}})=>U(a)&&(0,e.jsx)(R.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,e.jsx)(p.m,{interactive:!0,content:(0,e.jsxs)("div",{children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]}),children:(0,e.jsx)(L.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:a}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(a)&&a.length>0&&(0,e.jsx)(N.E,{label:a[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:a}})=>(0,e.jsx)(e.Fragment,{children:a&&(0,e.jsx)(B.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:a}})=>h.TP.hasPermissionInMetadata(v.AccessControlAction.OrgUsersRemove,a)&&(0,e.jsx)(x.$n,{size:"sm",variant:"destructive",onClick:()=>{E(a)},icon:"times","aria-label":`Delete user ${a.name}`})}],[I,t,A,d]);return(0,e.jsxs)(m.B,{direction:"column",gap:2,"data-testid":V.container,children:[(0,e.jsx)(f.j,{columns:G,data:n,getRowId:a=>String(a.userId),fetchData:i}),(0,e.jsx)(m.B,{justifyContent:"flex-end",children:(0,e.jsx)(W.d,{onNavigate:_,currentPage:P,numberOfPages:z,hideWhenSinglePage:!0})}),!!O&&(0,e.jsx)(c.u,{body:`Are you sure you want to delete user ${O?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{E(null)},isOpen:!0,onConfirm:()=>{O&&(u(O),E(null))}})]})}}}]);

//# sourceMappingURL=AdminEditOrgPage.e854c5b1f38156bdc957.js.map