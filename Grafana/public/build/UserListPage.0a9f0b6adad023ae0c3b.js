"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743,9856],{20972:(As,B,n)=>{n.r(B),n.d(B,{default:()=>Fs});var s=n(74848),c=n(32196),v=n(96540),U=n(13544),Z=n(32264),j=n(40675),p=n(40845),q=n(63021),g=n(8484),W=n(16233),E=n(72254),z=n(69444),H=n(31678),_=n(31083),ss=n(71468),es=n(67647),ns=n(94354),f=n(55852),J=n(69529),xs=n(10096),as=n(12942),ts=n(72109),L=n(67061),R=n(56034),D=n(14578),T=n(94753),N=n(78369),V=n(48840),rs=n(19384),F=n(46334),os=n(90613);const b=({units:e,icon:t})=>e?.length?e.length>1?(0,s.jsx)(R.m,{placement:"top",content:(0,s.jsx)(L.B,{direction:"column",children:e?.map(r=>(0,s.jsx)("span",{children:r.name},r.name))}),children:(0,s.jsx)(A,{icon:t,children:e.length})}):(0,s.jsx)(A,{icon:t,children:e[0].name}):null,A=(0,v.forwardRef)(({children:e,icon:t},r)=>(0,s.jsxs)(os.a,{ref:r,display:"flex",alignItems:"center",marginRight:1,children:[(0,s.jsx)(D.I,{name:t})," ",(0,s.jsx)(os.a,{marginLeft:1,children:e})]}));A.displayName="TooltipContent";const Q=({users:e,showPaging:t,totalPages:r,onChangePage:d,currentPage:m,fetchData:x})=>{const K=(0,v.useMemo)(()=>e.some(o=>o.licensedRole),[e]),u=(0,v.useMemo)(()=>e.some(o=>o.orgs),[e]),k=(0,v.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:o}})=>o&&(0,s.jsx)(as.e,{src:o,alt:"User avatar"})},{id:"login",header:"Login",cell:({row:{original:o}})=>(0,s.jsx)(ts.Y,{color:"primary",inline:!1,href:`/admin/users/edit/${o.id}`,title:"Edit user",children:o.login}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:o}})=>o,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:o}})=>o,sortType:"string"},...u?[{id:"orgs",header:"Belongs to",cell:({cell:{value:o,row:$}})=>(0,s.jsxs)(L.B,{alignItems:"center",children:[(0,s.jsx)(b,{units:o,icon:"building"}),$.original.isAdmin&&(0,s.jsx)(R.m,{placement:"top",content:"Grafana Admin",children:(0,s.jsx)(D.I,{name:"shield"})})]})}]:[],...K?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:o}})=>o==="None"?(0,s.jsxs)(T.E,{color:"disabled",children:["Not assigned"," ",(0,s.jsx)(R.m,{placement:"top",content:"A licensed role will be assigned when this user signs in",children:(0,s.jsx)(D.I,{name:"question-circle"})})]}):o}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:o}})=>(0,s.jsx)(s.Fragment,{children:o&&(0,s.jsx)(s.Fragment,{children:o==="10 years"?(0,s.jsx)(T.E,{color:"disabled",children:"Never"}):o})}),sortType:(o,$)=>new Date(o.original.lastSeenAt).getTime()-new Date($.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:o}})=>(0,s.jsx)(s.Fragment,{children:Array.isArray(o)&&o.length>0&&(0,s.jsx)(F.E,{label:o[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:o}})=>(0,s.jsx)(s.Fragment,{children:o&&(0,s.jsx)(N.v,{colorIndex:9,name:"Disabled"})})},{id:"edit",header:"",cell:({row:{original:o}})=>(0,s.jsx)(f.z9,{variant:"secondary",size:"sm",icon:"pen",href:`admin/users/edit/${o.id}`,"aria-label":`Edit user ${o.name}`,tooltip:"Edit user"})}],[K,u]);return(0,s.jsxs)(L.B,{direction:"column",gap:2,children:[(0,s.jsx)(V.j,{columns:k,data:e,getRowId:o=>String(o.id),fetchData:x}),t&&(0,s.jsx)(L.B,{justifyContent:"flex-end",children:(0,s.jsx)(rs.d,{numberOfPages:r,currentPage:m,onNavigate:d})})]})};var P=n(57334);const X=[],vs=e=>{X.push(e)},cs=U.Tp.pages.UserListPage.UserListAdminPage,i={fetchUsers:P.hU,changeQuery:P.nM,changePage:P.yd,changeFilter:P.$u,changeSort:P.Vk},y=e=>({users:e.userListAdmin.users,query:e.userListAdmin.query,showPaging:e.userListAdmin.showPaging,totalPages:e.userListAdmin.totalPages,page:e.userListAdmin.page,filters:e.userListAdmin.filters,isLoading:e.userListAdmin.isLoading}),js=(0,ss.connect)(y,i)(({fetchUsers:e,query:t,changeQuery:r,users:d,showPaging:m,changeFilter:x,filters:K,totalPages:u,page:k,changePage:o,changeSort:$,isLoading:Rs})=>{const fs=(0,p.of)(Ns);return(0,v.useEffect)(()=>{e()},[e]),(0,s.jsxs)(z.Y.Contents,{children:[(0,s.jsx)("div",{className:fs.actionBar,"data-testid":cs.container,children:(0,s.jsxs)("div",{className:fs.row,children:[(0,s.jsx)(es.Z,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:t,onChange:r}),(0,s.jsx)(ns.z,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:ms=>x({name:"activeLast30Days",value:ms}),value:K.find(ms=>ms.name==="activeLast30Days")?.value,className:fs.filter}),X.map((ms,Gs)=>(0,s.jsx)(ms,{filters:K,onChange:x,className:fs.filter},Gs)),xs.TP.hasPermission(H.AccessControlAction.UsersCreate)&&(0,s.jsx)(f.z9,{href:"admin/users/create",variant:"primary",children:"New user"})]})}),!Rs&&d.length===0?(0,s.jsx)(J.p,{message:(0,g.t)("users.empty-state.message","No users found"),variant:"not-found"}):(0,s.jsx)(Q,{users:d,showPaging:m,totalPages:u,onChangePage:o,currentPage:k,fetchData:$})]})});function $s(){return jsx(Page,{navId:"global-users",children:jsx(js,{})})}const Ns=e=>({filter:(0,c.css)({margin:e.spacing(0,1),[e.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,c.css)({marginBottom:e.spacing(2),display:"flex",alignItems:"flex-start",gap:e.spacing(2),[e.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,c.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:e.spacing(.5),flexGrow:1,[e.breakpoints.down("sm")]:{flexWrap:"wrap",gap:e.spacing(2),width:"100%"}})}),Ss=null;var bs=n(39938),Us=n(23088);const Ls=e=>{if(!e.includes(" "))return{browser:e,computer:""};const t=e.split(" ");return{browser:t[0],computer:t[1]}},ds=(e,t)=>e.length>t?e.substring(0,t)+"...":e,ps=({value:e})=>{const t=Ls(e);return(0,s.jsx)(R.m,{theme:"info-alt",content:e,placement:"top-end",interactive:!0,children:(0,s.jsxs)("span",{children:[ds(t.browser,10),ds(t.computer,10)]})})},Ds=({devices:e,showPaging:t,totalPages:r,onChangePage:d,currentPage:m,fetchData:x})=>{const K=(0,v.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:u}})=>u&&(0,s.jsx)(as.e,{src:u,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:u}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:u}})=>(0,s.jsx)(ps,{value:u}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:u}})=>u,sortType:(u,k)=>new Date(u.original.updatedAt).getTime()-new Date(k.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:u}})=>u&&(0,s.jsx)(bs.E,{text:u,color:"orange"})}],[]);return(0,s.jsxs)(L.B,{direction:"column",gap:2,children:[(0,s.jsx)(V.j,{columns:K,data:e,getRowId:u=>u.deviceId,fetchData:x}),t&&(0,s.jsx)(L.B,{justifyContent:"flex-end",children:(0,s.jsx)(rs.d,{numberOfPages:r,currentPage:m,onNavigate:d})}),e.length===0&&(0,s.jsx)(Us.Z,{children:(0,s.jsx)("span",{children:"No anonymous users found."})})]})},a={fetchUsersAnonymousDevices:P.xq,changeAnonUserSort:P.A5,changeAnonPage:P.is,changeAnonQuery:P.Bc},l=e=>({devices:e.userListAnonymousDevices.devices,query:e.userListAnonymousDevices.query,showPaging:e.userListAnonymousDevices.showPaging,totalPages:e.userListAnonymousDevices.totalPages,page:e.userListAnonymousDevices.page,filters:e.userListAnonymousDevices.filters}),h=U.Tp.pages.UserListPage.UserListAdminPage,S=(0,ss.connect)(l,a)(({devices:e,fetchUsersAnonymousDevices:t,query:r,changeAnonQuery:d,filters:m,showPaging:x,totalPages:K,page:u,changeAnonPage:k,changeAnonUserSort:o})=>{const $=(0,p.of)(Y);return(0,v.useEffect)(()=>{t()},[t]),(0,s.jsxs)(z.Y.Contents,{children:[(0,s.jsx)("div",{className:$.actionBar,"data-testid":h.container,children:(0,s.jsxs)("div",{className:$.row,children:[(0,s.jsx)(es.Z,{placeholder:"Search devices by IP address.",autoFocus:!0,value:r,onChange:d}),(0,s.jsx)(ns.z,{options:[{label:"Active last 30 days",value:!0}],value:m.find(Rs=>Rs.name==="activeLast30Days")?.value,className:$.filter})]})}),(0,s.jsx)(Ds,{devices:e,showPaging:x,totalPages:K,onChangePage:k,currentPage:u,fetchData:o})]})});function G(){return jsx(Page,{navId:"anonymous-users",children:jsx(S,{})})}const Y=e=>({filter:(0,c.css)({margin:e.spacing(0,1),[e.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,c.css)({marginBottom:e.spacing(2),display:"flex",alignItems:"flex-start",gap:e.spacing(2),[e.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,c.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:e.spacing(.5),flexGrow:1,[e.breakpoints.down("sm")]:{flexWrap:"wrap",gap:e.spacing(2),width:"100%"}})}),ls=null;var M=n(72686),O=n(37390),Ts=n(39558),Ps=n(71678);const gs=U.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,Es=({email:e,onDismiss:t})=>{const r=(0,p.of)(Is),{data:d,isLoading:m}=(0,M.kd)(e);return(0,s.jsx)(O.a,{className:r.modal,isOpen:!0,title:(0,g.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:t,children:m?(0,s.jsx)("div",{className:r.loading,children:(0,s.jsx)(Ts._,{text:(0,g.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})}):d?.map(x=>(0,s.jsxs)("div",{className:r.listItem,"data-testid":gs.listItem(x.dashboardUid),children:[(0,s.jsx)("p",{className:r.dashboardTitle,children:x.dashboardTitle}),(0,s.jsxs)("div",{className:r.urlsContainer,children:[(0,s.jsx)("a",{rel:"noreferrer",target:"_blank",className:(0,c.cx)("external-link",r.url),href:(0,E.mL)(x.publicDashboardAccessToken),onClick:t,children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link",children:"Public dashboard URL"})}),(0,s.jsx)("span",{className:r.urlsDivider,children:"\u2022"}),(0,s.jsx)("a",{className:(0,c.cx)("external-link",r.url),href:(0,E.gN)(x.dashboardUid,x.slug),onClick:t,children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting",children:"Public dashboard settings"})})]}),(0,s.jsx)("hr",{className:r.divider})]},x.dashboardUid))})},ys=({email:e})=>{const t=(0,g.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return(0,s.jsx)(Ps.$s,{children:({showModal:r,hideModal:d})=>(0,s.jsx)(f.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:t,"aria-label":t,onClick:()=>r(Es,{email:e,onDismiss:d})})})},Is=e=>({modal:(0,c.css)`
    width: 590px;
  `,loading:(0,c.css)`
    display: flex;
    justify-content: center;
  `,listItem:(0,c.css)`
    display: flex;
    flex-direction: column;
    gap: ${e.spacing(.5)};
  `,divider:(0,c.css)`
    margin: ${e.spacing(1.5,0)};
    color: ${e.colors.text.secondary};
  `,urlsContainer:(0,c.css)`
    display: flex;
    gap: ${e.spacing(.5)};

    ${e.breakpoints.down("sm")} {
      flex-direction: column;
    }
  `,urlsDivider:(0,c.css)`
    color: ${e.colors.text.secondary};
    ${e.breakpoints.down("sm")} {
      display: none;
    }
  `,dashboardTitle:(0,c.css)`
    font-size: ${e.typography.body.fontSize};
    font-weight: ${e.typography.fontWeightBold};
    margin-bottom: 0;
  `,url:(0,c.css)`
    font-size: ${e.typography.body.fontSize};
  `}),Cs=({user:e,hideModal:t})=>{const[r]=(0,M.g9)(),d=(0,p.of)(Os),m=()=>{r({email:e.email}),t()};return(0,s.jsxs)(O.a,{className:d.modal,isOpen:!0,title:(0,g.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:t,children:[(0,s.jsx)("p",{className:d.description,children:(0,s.jsxs)(g.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1",children:["Are you sure you want to revoke access for ",{email:e.email},"?"]})}),(0,s.jsx)("p",{className:d.description,children:(0,s.jsxs)(g.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:e.email},"'s access to all public dashboards."]})}),(0,s.jsxs)(O.a.ButtonRow,{children:[(0,s.jsx)(f.$n,{type:"button",variant:"secondary",onClick:t,fill:"outline",children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button",children:"Cancel"})}),(0,s.jsx)(f.$n,{type:"button",variant:"destructive",onClick:m,children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button",children:"Revoke access"})})]})]})},Ms=({user:e})=>{const t=(0,g.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return(0,s.jsx)(Ps.$s,{children:({showModal:r,hideModal:d})=>(0,s.jsx)(f.$n,{size:"sm",variant:"destructive",onClick:()=>r(Cs,{user:e,hideModal:d}),icon:"times","aria-label":t,title:t})})},Os=e=>({modal:(0,c.css)({width:"500px"}),description:(0,c.css)({fontSize:e.typography.body.fontSize,margin:0})}),hs=U.Tp.pages.UserListPage.publicDashboards,Bs=()=>{const{data:e,isLoading:t}=(0,M.AK)();return(0,s.jsx)(z.Y.Contents,{isLoading:t,children:(0,s.jsxs)("table",{className:"filter-table form-inline","data-testid":hs.container,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label",children:"Email"})}),(0,s.jsxs)("th",{children:[(0,s.jsx)("span",{children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label",children:"Activated"})}),(0,s.jsx)(R.m,{placement:"top",content:(0,g.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard"),children:(0,s.jsx)(D.I,{name:"question-circle"})})]}),(0,s.jsx)("th",{children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label",children:"Last active"})}),(0,s.jsx)("th",{children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label",children:"Origin"})}),(0,s.jsx)("th",{children:(0,s.jsx)(g.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label",children:"Role"})}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:e?.map(r=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsx)("span",{className:"ellipsis",title:r.email,children:r.email})}),(0,s.jsx)("td",{className:"max-width-10",children:r.firstSeenAtAge}),(0,s.jsx)("td",{className:"max-width-10",children:r.lastSeenAtAge}),(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsxs)(L.B,{gap:2,children:[(0,s.jsxs)("span",{children:[r.totalDashboards," dashboard(s)"]}),(0,s.jsx)(ys,{email:r.email})]})}),(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsx)(N.v,{name:"Viewer",colorIndex:19})}),(0,s.jsx)("td",{className:"text-right",children:(0,s.jsx)(Ms,{user:r})})]},r.email))})]})})};var Ws=(e=>(e.ADMIN="admin",e.ORG="org",e.PUBLIC_DASHBOARDS="public-dashboards",e.ANON="anon",e))(Ws||{});const us=U.Tp.pages.UserListPage,Ks=({view:e,setView:t})=>(0,s.jsx)(j.o,{label:(0,g.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:e==="public-dashboards",onChangeTab:()=>t("public-dashboards"),"data-testid":us.tabs.publicDashboardsUsers}),zs={admin:(0,s.jsx)(js,{}),org:(0,s.jsx)(_.UsersListPageContent,{}),"public-dashboards":(0,s.jsx)(Bs,{}),anon:(0,s.jsx)(S,{})};function Fs(){const e=(0,p.of)(Qs),t=W.TP.hasPermission(H.AccessControlAction.UsersRead),r=W.TP.hasPermission(H.AccessControlAction.OrgUsersRead),[d,m]=(0,v.useState)(()=>t?"admin":r?"org":null),x=r&&t;return(0,s.jsxs)(z.Y,{navId:"global-users",children:[x?(0,s.jsxs)(q.U,{className:e.tabsMargin,children:[(0,s.jsx)(j.o,{label:"All users",active:d==="admin",onChangeTab:()=>m("admin"),"data-testid":us.tabs.allUsers}),(0,s.jsx)(j.o,{label:"Organization users",active:d==="org",onChangeTab:()=>m("org"),"data-testid":us.tabs.orgUsers}),Z.$.anonymousEnabled&&(0,s.jsx)(j.o,{label:"Anonymous devices",active:d==="anon",onChangeTab:()=>m("anon"),"data-testid":us.tabs.anonUserDevices}),(0,E.AY)()&&(0,s.jsx)(Ks,{view:d,setView:m})]}):(0,E.AY)()&&(0,s.jsxs)(q.U,{className:e.tabsMargin,children:[(0,s.jsx)(j.o,{label:"Users",active:d==="org",onChangeTab:()=>m("org"),"data-testid":us.tabs.users}),(0,s.jsx)(Ks,{view:d,setView:m})]}),d?zs[d]:(0,s.jsx)(_.UsersListPageContent,{})]})}const Qs=e=>({tabsMargin:(0,c.css)({marginBottom:e.spacing(3)})})},69546:(As,B,n)=>{n.d(B,{b:()=>R});var s=n(74848),c=n(96540),v=n(13544),U=n(12942),Z=n(94753),j=n(90613),p=n(56034),q=n(14578),g=n(78369),W=n(55852),E=n(67061),z=n(48840),H=n(19384),_=n(96374),ss=n(89062),es=n(85927),ns=n(46334),f=n(10096),J=n(31678),xs=n(5133);const as=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,ts=D=>{const T=D?.isExternallySynced;return!f.TP.hasPermissionInMetadata(J.AccessControlAction.OrgUsersWrite,D)||T},L=v.Tp.pages.UserListPage.UsersListPage,R=({users:D,orgId:T,onRoleChange:N,onRemoveUser:V,fetchData:rs,changePage:F,page:os,totalPages:b,rolesLoading:A})=>{const[Q,P]=(0,c.useState)(null),[X,vs]=(0,c.useState)([]);(0,c.useEffect)(()=>{async function i(){try{if(f.TP.hasPermission(J.AccessControlAction.ActionRolesList)){let y=await(0,es.RL)(T);vs(y)}}catch{console.error("Error loading options")}}f.TP.licensedAccessControlEnabled()&&i()},[T]);const cs=(0,c.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:i}})=>i&&(0,s.jsx)(U.e,{src:i,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:i}})=>(0,s.jsx)("div",{children:i}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>i,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:i}})=>i,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:i}})=>(0,s.jsx)(s.Fragment,{children:i&&(0,s.jsx)(s.Fragment,{children:i==="10 years"?(0,s.jsx)(Z.E,{color:"disabled",children:"Never"}):i})}),sortType:(i,y)=>new Date(i.original.lastSeenAt).getTime()-new Date(y.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:i},row:{original:y}})=>{const w=ts(y);return f.TP.licensedAccessControlEnabled()?(0,s.jsx)(ss.y,{userId:y.userId,roles:y.roles||[],isLoading:A,orgId:T,roleOptions:X,basicRole:i,onBasicRoleChange:is=>N(is,y),basicRoleDisabled:w,basicRoleDisabledMessage:as,width:40}):(0,s.jsx)(xs.r,{"aria-label":"Role",value:i,disabled:w,onChange:is=>N(is,y)})}},{id:"info",header:"",cell:({row:{original:i}})=>ts(i)&&(0,s.jsx)(j.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,s.jsx)(p.m,{interactive:!0,content:(0,s.jsxs)("div",{children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,s.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]}),children:(0,s.jsx)(q.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:i}})=>(0,s.jsx)(s.Fragment,{children:Array.isArray(i)&&i.length>0&&(0,s.jsx)(ns.E,{label:i[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:i}})=>(0,s.jsx)(s.Fragment,{children:i&&(0,s.jsx)(g.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:i}})=>f.TP.hasPermissionInMetadata(J.AccessControlAction.OrgUsersRemove,i)&&(0,s.jsx)(W.$n,{size:"sm",variant:"destructive",onClick:()=>{P(i)},icon:"times","aria-label":`Delete user ${i.name}`})}],[A,T,X,N]);return(0,s.jsxs)(E.B,{direction:"column",gap:2,"data-testid":L.container,children:[(0,s.jsx)(z.j,{columns:cs,data:D,getRowId:i=>String(i.userId),fetchData:rs}),(0,s.jsx)(E.B,{justifyContent:"flex-end",children:(0,s.jsx)(H.d,{onNavigate:F,currentPage:os,numberOfPages:b,hideWhenSinglePage:!0})}),!!Q&&(0,s.jsx)(_.u,{body:`Are you sure you want to delete user ${Q?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{P(null)},isOpen:!0,onConfirm:()=>{Q&&(V(Q),P(null))}})]})}},23088:(As,B,n)=>{n.d(B,{Z:()=>U});var s=n(74848),c=n(32196),v=n(40845);const U=({children:j})=>{const p=(0,v.of)(Z);return(0,s.jsx)("div",{className:p.container,children:j})},Z=j=>({container:(0,c.css)({backgroundColor:j.colors.background.secondary,color:j.colors.text.secondary,padding:j.spacing(4),textAlign:"center"})})},31083:(As,B,n)=>{n.r(B),n.d(B,{UsersListPageContent:()=>ps,UsersListPageUnconnected:()=>ds,default:()=>Ds});var s=n(74848),c=n(96540),v=n(71468),U=n(36663),Z=n(42418),j=n(69444),p=n(10096),q=n(69546),g=n(10534),W=n(55852),E=n(47259);const z={revokeInvite:E.eb},H=(0,v.connect)(null,z);class _ extends c.PureComponent{render(){const{invitee:l,revokeInvite:h}=this.props;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:l.email}),(0,s.jsx)("td",{children:l.name}),(0,s.jsxs)("td",{className:"text-right",children:[(0,s.jsx)(g.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>l.url,children:"Copy Invite"}),"\xA0"]}),(0,s.jsx)("td",{children:(0,s.jsx)(W.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>h(l.code),"aria-label":"Revoke Invite"})})]})}}const ss=H(_);class es extends c.PureComponent{render(){const{invitees:l}=this.props;return(0,s.jsxs)("table",{className:"filter-table form-inline",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Email"}),(0,s.jsx)("th",{children:"Name"}),(0,s.jsx)("th",{}),(0,s.jsx)("th",{style:{width:"34px"}})]})}),(0,s.jsx)("tbody",{"data-testid":"InviteesTable-body",children:l.map((h,I)=>(0,s.jsx)(ss,{invitee:h},`${h.id}-${I}`))})]})}}var ns=n(25508),f=n(40823);const{selectAll:J,selectById:xs,selectTotal:as}=f.Tp,ts=(a,l)=>l,L=(0,ns.Mz)([J,ts],(a,l)=>{const h=new RegExp(l,"i");return a.filter(C=>h.test(C.name)||h.test(C.email))});var R=n(14186),D=n(67647),T=n(94354),N=n(2913),V=n(31678),rs=n(2543),F=n(17172),os=n(80714),b=n(87617);function A(){return async(a,l)=>{try{a((0,b.Cj)());const{perPage:h,page:I,searchQuery:C,sort:S}=l().users,G=await(0,F.AI)().get("/api/org/users/search",(0,os.F)({perpage:h,page:I,query:C,sort:S}));if(p.TP.licensedAccessControlEnabled()&&p.TP.hasPermission(V.AccessControlAction.ActionUserRolesList)){a((0,b.dJ)());const Y=p.TP.user.orgId,ls=G?.orgUsers.map(O=>O.userId),M=await(0,F.AI)().post("/api/access-control/users/roles/search",{userIds:ls,orgId:Y});G.orgUsers.forEach(O=>{O.roles=M?M[O.userId]||[]:[]}),a((0,b.jE)())}a((0,b.Y_)(G))}catch{(0,b.g4)()}}}const Q=(0,rs.debounce)(a=>a(A()),300);function P(a){return async l=>{await(0,F.AI)().patch(`/api/org/users/${a.userId}`,{role:a.role}),l(A())}}function X(a){return async l=>{await(0,F.AI)().delete(`/api/org/users/${a}`),l(A())}}function vs(a){return async l=>{l((0,b.EC)(a)),l(A())}}function cs({sortBy:a}){const l=a.length?`${a[0].id}-${a[0].desc?"desc":"asc"}`:void 0;return async h=>{h((0,b.$u)(l)),h(A())}}function i(a){return async l=>{l((0,b.t_)(a)),Q(l)}}const y=a=>{const l=new RegExp(a.searchQuery,"i");return a.users.filter(h=>l.test(h.login)||l.test(h.email)||l.test(h.name))},w=a=>a.searchQuery;function is(a){return{searchQuery:w(a.users),pendingInvitesCount:as(a.invites),externalUserMngLinkName:a.users.externalUserMngLinkName,externalUserMngLinkUrl:a.users.externalUserMngLinkUrl}}const js={changeSearchQuery:i},Ss=(0,v.connect)(is,js)(({externalUserMngLinkName:a,externalUserMngLinkUrl:l,searchQuery:h,pendingInvitesCount:I,changeSearchQuery:C,onShowInvites:S,showInvites:G})=>{const Y=[{label:"Users",value:"users"},{label:`Pending Invites (${I})`,value:"invites"}],M=p.TP.hasPermission(V.AccessControlAction.OrgUsersAdd)&&!(N.Ay.disableLoginForm&&N.Ay.externalUserMngInfo);return(0,s.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,s.jsx)(R.I,{grow:!0,children:(0,s.jsx)(D.Z,{value:h,onChange:C,placeholder:"Search user by login, email or name"})}),I>0&&(0,s.jsx)("div",{style:{marginLeft:"1rem"},children:(0,s.jsx)(T.z,{value:G?"invites":"users",options:Y,onChange:S})}),M&&(0,s.jsx)(W.z9,{href:"org/users/invite",children:"Invite"}),l&&(0,s.jsx)(W.z9,{href:l,target:"_blank",rel:"noopener",children:a})]})});function bs(a){const l=w(a.users);return{users:y(a.users),searchQuery:w(a.users),page:a.users.page,totalPages:a.users.totalPages,perPage:a.users.perPage,invitees:L(a.invites,l),externalUserMngInfo:a.users.externalUserMngInfo,isLoading:a.users.isLoading,rolesLoading:a.users.rolesLoading}}const Us={loadUsers:A,fetchInvitees:E.G7,changePage:vs,changeSort:cs,updateUser:P,removeUser:X},Ls=(0,v.connect)(bs,Us),ds=({users:a,page:l,totalPages:h,invitees:I,externalUserMngInfo:C,isLoading:S,rolesLoading:G,loadUsers:Y,fetchInvitees:ls,changePage:M,updateUser:O,removeUser:Ts,changeSort:Ps})=>{const[gs,Es]=(0,c.useState)(!1),ys=C?(0,U.G)(C):"";(0,c.useEffect)(()=>{Y(),ls()},[ls,Y]);const Is=(hs,Bs)=>{O({...Bs,role:hs})},Cs=hs=>Ts(hs.userId),Ms=()=>{Es(!gs)},Os=()=>gs?(0,s.jsx)(es,{invitees:I}):(0,s.jsx)(q.b,{users:a,orgId:p.TP.user.orgId,rolesLoading:G,onRoleChange:Is,onRemoveUser:Cs,fetchData:Ps,changePage:M,page:l,totalPages:h});return(0,s.jsxs)(j.Y.Contents,{isLoading:!S,children:[(0,s.jsx)(Ss,{onShowInvites:Ms,showInvites:gs}),ys&&(0,s.jsx)(Z.F,{severity:"info",title:"",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:ys}})}),S&&Os()]})},ps=Ls(ds);function Ds(){return(0,s.jsx)(j.Y,{navId:"users",children:(0,s.jsx)(ps,{})})}}}]);

//# sourceMappingURL=UserListPage.0a9f0b6adad023ae0c3b.js.map