"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2042],{82042:(ke,J,a)=>{a.r(J),a.d(J,{CreateAlertButton:()=>ae,default:()=>Ve});var e=a(74848),g=a(32196),E=a(96540),le=a(24180),ie=a(41053),oe=a(10940),ce=a(49185),de=a(76885),ue=a(66602),R=a(40845),b=a(55852),me=a(57514),ge=a(31678),F=a(25027),L=a(19073),xe=a(9518),X=a(14285),Z=a(61410),K=a(23770),ve=a(55740),S=a(57220),B=a(56361),he=a(37959),je=a(45058),pe=a(75648),fe=a(67381),ye=a(92467),Re=a(84866),P=a(2543),Ie=a(42941),D=a(18461),T=a(23662),Ce=a(55127),z=a.n(Ce),m=a(67061),f=a(72109),M=a(83122),v=a(38138),N=a(94753),Ee=a(42418),j=a(94822),Q=a(75214),y=a(55196),Y=a(90141),k=a(26058),be=a(56034),G=a(14578),Be=a(39890);function q({state:s,health:t,recording:o=!1,isPaused:i=!1}){const l={[j.cF.Inactive]:"check-circle",[j.cF.Pending]:"circle",[j.cF.Firing]:"exclamation-circle"},h={[j.cF.Inactive]:"success",[j.cF.Pending]:"warning",[j.cF.Firing]:"error"},r={[j.cF.Inactive]:"Normal",[j.cF.Pending]:"Pending",[j.cF.Firing]:"Firing"};let n=s?l[s]:"circle",x=s?h[s]:"secondary",u=s?r[s]:"unknown";return o&&(n="record-audio",x="success",u="Recording"),t==="nodata"&&(n="exclamation-triangle",x="warning",u="Insufficient data"),(0,Be.lf)(t)&&(n="times-circle",x="error",u="Failed to evaluate rule"),i&&(n="pause-circle",x="warning",u="Paused"),(0,e.jsx)(be.m,{content:u,placement:"right",children:(0,e.jsx)("div",{children:(0,e.jsx)(N.E,{color:x,children:(0,e.jsx)(G.I,{name:n,size:"lg"})})})})}var Ne=a(13064);const _=s=>{const{name:t,summary:o,state:i,health:l,error:h,href:r,isProvisioned:n,lastEvaluation:x,evaluationInterval:u,isPaused:p=!1,instancesCount:A=0,contactPoint:I,labels:$}=s,U=(0,R.of)(O);return(0,e.jsx)("li",{className:U.alertListItemContainer,role:"treeitem","aria-selected":"false",children:(0,e.jsxs)(m.B,{direction:"row",alignItems:"start",gap:1,wrap:"nowrap",children:[(0,e.jsx)(q,{state:i,health:l,isPaused:p}),(0,e.jsxs)(m.B,{direction:"column",gap:.5,flex:"1",children:[(0,e.jsx)("div",{children:(0,e.jsxs)(m.B,{direction:"column",gap:0,children:[(0,e.jsx)(m.B,{direction:"row",alignItems:"start",children:(0,e.jsx)(f.Y,{href:r,inline:!1,children:t})}),(0,e.jsx)(ee,{content:o,error:h})]})}),(0,e.jsx)("div",{children:(0,e.jsxs)(m.B,{direction:"row",gap:1,children:[!p&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(se,{lastEvaluation:x,evaluationInterval:u,health:l,state:i,error:h}),(0,e.jsx)(y.P,{icon:"layers-alt",children:(0,e.jsx)(f.Y,{href:r+"?tab=instances",variant:"bodySmall",color:"primary",inline:!1,children:z()("instance",A,!0)})})]}),!(0,P.isEmpty)($)&&(0,e.jsx)(y.P,{icon:"tag-alt",children:(0,e.jsx)(f.Y,{href:r,variant:"bodySmall",color:"primary",inline:!1,children:z()("label",(0,Q.rm)($),!0)})}),I&&!p&&(0,e.jsxs)(y.P,{icon:"at",children:["Delivered to"," ",(0,e.jsx)(f.Y,{href:(0,B.bg)(I,S.hY),variant:"bodySmall",color:"primary",inline:!1,children:I})]})]})})]}),(0,e.jsxs)(m.B,{direction:"row",alignItems:"center",gap:1,wrap:"nowrap",children:[(0,e.jsx)(b.$n,{variant:"secondary",size:"sm",icon:"pen",type:"button",disabled:n,children:"Edit"}),(0,e.jsx)(M.m,{overlay:(0,e.jsxs)(v.W,{children:[(0,e.jsx)(v.W.Item,{label:"Silence",icon:"bell-slash"}),(0,e.jsx)(v.W.Divider,{}),(0,e.jsx)(v.W.Item,{label:"Export",disabled:n,icon:"download-alt"}),(0,e.jsx)(v.W.Item,{label:"Delete",disabled:n,icon:"trash-alt",destructive:!0})]}),children:(0,e.jsx)(Y.A,{})})]})]})})};function ee({content:s,error:t}){return t?(0,e.jsx)(N.E,{variant:"bodySmall",color:"error",weight:"light",truncate:!0,children:t}):s?(0,e.jsx)(N.E,{variant:"bodySmall",color:"secondary",children:s}):null}const Ae=({name:s,error:t,state:o,health:i,isProvisioned:l,href:h,labels:r,lastEvaluation:n,evaluationInterval:x})=>{const u=(0,R.of)(O);return(0,e.jsx)("li",{className:u.alertListItemContainer,role:"treeitem","aria-selected":"false",children:(0,e.jsx)(m.B,{direction:"row",alignItems:"center",gap:1,children:(0,e.jsxs)(m.B,{direction:"row",alignItems:"start",gap:1,flex:"1",children:[(0,e.jsx)(q,{health:i,recording:!0}),(0,e.jsxs)(m.B,{direction:"column",gap:.5,children:[(0,e.jsxs)(m.B,{direction:"column",gap:0,children:[(0,e.jsx)(m.B,{direction:"row",alignItems:"start",children:(0,e.jsx)(f.Y,{href:h,variant:"body",weight:"bold",inline:!1,children:s})}),(0,e.jsx)(ee,{error:t})]}),(0,e.jsx)("div",{children:(0,e.jsxs)(m.B,{direction:"row",gap:1,children:[(0,e.jsx)(se,{lastEvaluation:n,evaluationInterval:x,health:i,state:o,error:t}),!(0,P.isEmpty)(r)&&(0,e.jsx)(y.P,{icon:"tag-alt",children:(0,e.jsx)(f.Y,{variant:"bodySmall",color:"primary",href:h,inline:!1,children:z()("label",(0,Q.rm)(r),!0)})})]})})]}),(0,e.jsx)(k.h,{}),(0,e.jsx)(b.$n,{variant:"secondary",size:"sm",icon:"pen",type:"button",disabled:l,"data-testid":"edit-rule-action",children:"Edit"}),(0,e.jsx)(M.m,{overlay:(0,e.jsxs)(v.W,{children:[(0,e.jsx)(v.W.Item,{label:"Export",disabled:l,icon:"download-alt"}),(0,e.jsx)(v.W.Item,{label:"Delete",disabled:l,icon:"trash-alt",destructive:!0})]}),children:(0,e.jsx)(Y.A,{})})]})})})};function se({lastEvaluation:s,evaluationInterval:t,state:o}){const i=(0,Ne.C)(s,t);return o===j.cF.Firing&&i?(0,e.jsxs)(y.P,{icon:"clock-nine",children:["Firing for ",(0,e.jsx)(N.E,{color:"primary",children:"2m 34s"}),i&&(0,e.jsxs)(e.Fragment,{children:["\xB7 next evaluation in ",i.humanized]})]}):i?(0,e.jsxs)(y.P,{icon:"clock-nine",children:["Next evaluation ",i.humanized]}):null}const Fe=({rule:s})=>{const t=(0,R.of)(O),o={namespace:s.namespace.name,group:s.group.name,name:s.name};return(0,F.vV)(new Error("unknown rule type"),o),(0,e.jsx)(Ee.F,{title:"Unknown rule type",className:t.resetMargin,children:(0,e.jsxs)("details",{children:[(0,e.jsx)("summary",{children:"Rule definition"}),(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:JSON.stringify(s.rulerRule,null,2)})})]})})},O=s=>({alertListItemContainer:(0,g.css)({position:"relative",listStyle:"none",background:s.colors.background.primary,borderBottom:`solid 1px ${s.colors.border.weak}`,padding:s.spacing(1,1,1,1.5)}),resetMargin:(0,g.css)({margin:0})});var Le=a(39938);const Se=({name:s,provenance:t,interval:o,onToggle:i,isOpen:l=!1,children:h})=>{const r=(0,R.of)(Pe),n=!!t;return(0,e.jsxs)(m.B,{direction:"column",role:"treeitem","aria-expanded":l,"aria-selected":"false",gap:0,children:[(0,e.jsx)("div",{className:r.headerWrapper,children:(0,e.jsxs)(m.B,{direction:"row",alignItems:"center",gap:1,children:[(0,e.jsx)("button",{className:(0,g.cx)(r.hiddenButton,r.largerClickTarget),type:"button",onClick:i,children:(0,e.jsxs)(m.B,{alignItems:"center",gap:.5,children:[(0,e.jsx)(G.I,{name:l?"angle-down":"angle-right"}),(0,e.jsx)(N.E,{truncate:!0,variant:"body",children:s})]})}),n&&(0,e.jsx)(Le.E,{color:"purple",text:"Provisioned"}),(0,e.jsx)(k.h,{}),o&&(0,e.jsx)(y.P,{icon:"history",children:o}),(0,e.jsx)(b.$n,{size:"sm",icon:"pen",variant:"secondary",disabled:n,"data-testid":"edit-group-action",children:"Edit"}),(0,e.jsx)(M.m,{overlay:(0,e.jsxs)(v.W,{children:[(0,e.jsx)(v.W.Item,{label:"Re-order rules",icon:"flip",disabled:n}),(0,e.jsx)(v.W.Divider,{}),(0,e.jsx)(v.W.Item,{label:"Export",icon:"download-alt"}),(0,e.jsx)(v.W.Item,{label:"Delete",icon:"trash-alt",destructive:!0,disabled:n})]}),children:(0,e.jsx)(Y.A,{size:"sm"})})]})}),l&&(0,e.jsx)("div",{role:"group",children:h})]})},Pe=s=>({headerWrapper:(0,g.css)({padding:`${s.spacing(1)} ${s.spacing(1)}`,background:s.colors.background.secondary,border:"none",borderBottom:`solid 1px ${s.colors.border.weak}`,borderTopLeftRadius:s.shape.radius.default,borderTopRightRadius:s.shape.radius.default}),hiddenButton:(0,g.css)({border:"none",background:"transparent"}),largerClickTarget:(0,g.css)({padding:s.spacing(.5),margin:`-${s.spacing(.5)}`})}),Te=Se,$e=({group:s,rulesSource:t})=>{const[o,i]=(0,Ie.A)(!1);return(0,e.jsx)(Te,{name:s.name,interval:s.interval,isOpen:o,onToggle:i,children:s.rules.map((l,h)=>{const{rulerRule:r,promRule:n,annotations:x}=l;if(!r)return null;const u=(0,T.Z8)(n);if((0,T.$y)(r))return(0,e.jsx)(_,{state:u?n?.state:void 0,health:n?.health,error:n?.lastError,name:r.alert,labels:r.labels,lastEvaluation:n?.lastEvaluation,evaluationDuration:n?.evaluationTime,evaluationInterval:s.interval,instancesCount:u?(0,P.size)(n.alerts):void 0,href:(0,B.w$)(t,l),summary:x?.summary},(0,D.Ns)(r));if((0,T.i7)(r))return(0,e.jsx)(Ae,{name:r.record,health:n?.health,error:n?.lastError,lastEvaluation:n?.lastEvaluation,evaluationDuration:n?.evaluationTime,evaluationInterval:s.interval,labels:r.labels,href:(0,B.w$)(t,l)},(0,D.Ns)(r));if((0,T.lT)(r)){const p=r.grafana_alert.notification_settings?.receiver;return(0,e.jsx)(_,{name:r.grafana_alert.title,state:u?n?.state:void 0,health:n?.health,error:n?.lastError,labels:r.labels,isPaused:r.grafana_alert.is_paused,lastEvaluation:n?.lastEvaluation,evaluationDuration:n?.evaluationTime,evaluationInterval:s.interval,instancesCount:u?(0,P.size)(n.alerts):void 0,href:(0,B.w$)(t,l),summary:l.annotations?.summary,isProvisioned:!!r.grafana_alert.provenance,contactPoint:p},r.grafana_alert.uid)}return(0,e.jsx)(Fe,{rule:l},(0,D.Ns)(r))})})};var We=a(96636);const De=({children:s,name:t,href:o,application:i})=>{const l=(0,R.of)(Me);return(0,e.jsxs)("li",{className:l.namespaceWrapper,role:"treeitem","aria-selected":"false",children:[(0,e.jsx)("div",{className:l.namespaceTitle,children:(0,e.jsxs)(m.B,{alignItems:"center",gap:1,children:[(0,e.jsx)(ze,{application:i}),o?(0,e.jsx)(We.d,{title:"Alert rules",component:(0,e.jsx)(f.Y,{href:o,inline:!1,children:t})}):t]})}),s&&(0,e.jsx)("ul",{role:"group",className:l.groupItemsWrapper,children:s})]})},ze=({application:s})=>{switch(s){case j.N1.Prometheus:return(0,e.jsx)("img",{width:16,height:16,src:"public/app/plugins/datasource/prometheus/img/prometheus_logo.svg",alt:"Prometheus"});case j.N1.Mimir:return(0,e.jsx)("img",{width:16,height:16,src:"public/app/plugins/datasource/prometheus/img/mimir_logo.svg",alt:"Mimir"});case"loki":return(0,e.jsx)("img",{width:16,height:16,src:"public/app/plugins/datasource/loki/img/loki_icon.svg",alt:"Loki"});case"grafana":default:return(0,e.jsx)(G.I,{name:"folder"})}},Me=s=>({groupItemsWrapper:(0,g.css)({position:"relative",borderRadius:s.shape.radius.default,border:`solid 1px ${s.colors.border.weak}`,borderBottom:"none",marginLeft:s.spacing(3),"&:before":{content:"''",position:"absolute",height:"100%",borderLeft:`solid 1px ${s.colors.border.weak}`,marginTop:0,marginLeft:`-${s.spacing(2.5)}`}}),namespaceWrapper:(0,g.css)({display:"flex",flexDirection:"column",gap:s.spacing(1)}),namespaceTitle:(0,g.css)({padding:`${s.spacing(1)} ${s.spacing(1.5)}`,background:s.colors.background.secondary,border:`solid 1px ${s.colors.border.weak}`,borderRadius:s.shape.radius.default})}),Ye=De,Ge=pe.Ys+1,Oe=(0,ue.Xc)(()=>{const s=(0,ge.useDispatch)(),t=(0,R.of)(He),o=(0,E.useMemo)(S.gR,[]),[i,l]=(0,E.useState)(!1),h=(0,E.useCallback)(()=>l(!1),[]),{filterState:r,hasActiveFilters:n}=(0,X.dI)(),x=(0,Z.$)(d=>d.promRules),u=(0,Z.$)(d=>d.rulerRules),p=o.some(d=>x[d]?.loading||u[d]?.loading),A=Object.entries(x),I=Object.entries(u),$=A.every(([d,c])=>c.dispatched&&(c?.result!==void 0||c?.error!==void 0)),U=I.every(([d,c])=>c.dispatched&&(c?.result!==void 0||c?.error!==void 0)),we=A.every(([d,c])=>c.dispatched&&c?.result?.length===0),Je=I.every(([d,c])=>Object.entries(c?.result??{}).every(([re,C])=>C?.length===0)&&c.dispatched),W=n?void 0:Ge,[qe,Xe]=(0,ie.A)(async()=>{p||await s((0,K.yo)(!1,{limitAlerts:W}))},[p,W,s]);(0,E.useEffect)(()=>{(0,F.Sq)().catch(()=>{})},[]),(0,E.useEffect)(()=>{s((0,K.yo)(!1,{limitAlerts:W}))},[s,W]),(0,oe.A)(Xe,ve.HH);const ne=$&&we&&A.length>0&&Je&&U,H=!ne,Ze=(0,xe.dy)(),te=(0,X.i7)(Ze,r),Ke=te.sort((d,c)=>d.name.localeCompare(c.name));return(0,e.jsxs)(he.d,{navId:"alert-list",isLoading:!1,actions:H&&(0,e.jsx)(ae,{}),children:[(0,e.jsx)(fe.o,{}),(0,e.jsx)(Re.A,{onFilterCleared:h}),H&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:t.break}),(0,e.jsx)("div",{className:t.buttonsContainer,children:(0,e.jsxs)("div",{className:t.statsContainer,children:[n&&(0,e.jsx)(b.$n,{className:t.expandAllButton,icon:i?"angle-double-up":"angle-double-down",variant:"secondary",onClick:()=>l(!i),children:i?"Collapse all":"Expand all"}),(0,e.jsx)(ye.M_,{namespaces:te})]})})]}),ne&&(0,e.jsx)(je.w,{}),H&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ue,{visible:p}),(0,e.jsx)("ul",{className:t.rulesTree,role:"tree","aria-label":"List of alert rules",children:Ke.map(d=>{const{rulesSource:c,uid:V}=d,w=(0,S.Vr)(c),re=w==="grafana"&&V?(0,B.c$)(V,d.name):void 0;return(0,e.jsx)(Ye,{href:re,name:d.name,application:w,children:d.groups.sort((C,Qe)=>C.name.localeCompare(Qe.name)).map(C=>(0,e.jsx)($e,{group:C,rulesSource:c},C.name))},(0,S.v8)(c)+d.name)})})]})]})},{style:"page"}),Ue=({visible:s=!1})=>{const[t,{width:o}]=(0,ce.A)();return(0,e.jsx)("div",{ref:t,children:s&&(0,e.jsx)(me.G,{width:o})})},He=s=>({rulesTree:(0,g.css)({display:"flex",flexDirection:"column",gap:s.spacing(1)}),break:(0,g.css)({width:"100%",height:0,marginBottom:s.spacing(2),borderBottom:`solid 1px ${s.colors.border.medium}`}),buttonsContainer:(0,g.css)({marginBottom:s.spacing(2),display:"flex",justifyContent:"space-between"}),statsContainer:(0,g.css)({display:"flex",flexDirection:"row",alignItems:"center"}),expandAllButton:(0,g.css)({marginRight:s.spacing(1)})}),Ve=Oe;function ae(){const[s,t]=(0,L.Ej)(L.RY.CreateAlertRule),[o,i]=(0,L.Ej)(L.RY.CreateExternalAlertRule),l=(0,le.zy)();return s&&t||o&&i?(0,e.jsx)(b.z9,{href:de.kM.renderUrl("alerting/new/alerting",{returnTo:l.pathname+l.search}),icon:"plus",onClick:()=>(0,F.fH)(F.le.alertRuleFromScratch),children:"New alert rule"}):null}}}]);

//# sourceMappingURL=2042.e17d8c60d777b327465e.js.map